{
  "version": 3,
  "sources": ["../node_modules/cropperjs/dist/cropper.js", "../node_modules/pica/dist/pica.js", "../node_modules/file-saver/src/FileSaver.js", "../src/settings/palettes.ts", "../src/settings/systems.ts", "../src/export/exportfuncs.ts", "../src/common/util.ts", "../src/common/color.ts", "../src/dither/basecanvas.ts", "../src/export/fileviewers.ts", "../src/export/asm/c64_multi.asm", "../src/export/asm/apple2_hires.asm", "../src/export/asm/nes.asm", "../src/export/asm/msx.asm", "../src/export/asm/vcs.asm", "../src/export/asm/astrocade.asm", "../src/export/asm/atari8_d.asm", "../src/export/asm/zx.asm", "../src/export/asm/cpc.asm", "../src/export/asm/c64_fli.asm", "../src/dither/kernels.ts", "../src/ui/ui.ts", "../src/ui/sampleimages.ts"],
  "sourcesContent": ["/*!\n * Cropper.js v1.6.1\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2023-09-17T03:44:19.860Z\n */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.Cropper = factory());\n})(this, (function () { 'use strict';\n\n  function ownKeys(e, r) {\n    var t = Object.keys(e);\n    if (Object.getOwnPropertySymbols) {\n      var o = Object.getOwnPropertySymbols(e);\n      r && (o = o.filter(function (r) {\n        return Object.getOwnPropertyDescriptor(e, r).enumerable;\n      })), t.push.apply(t, o);\n    }\n    return t;\n  }\n  function _objectSpread2(e) {\n    for (var r = 1; r < arguments.length; r++) {\n      var t = null != arguments[r] ? arguments[r] : {};\n      r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n        _defineProperty(e, r, t[r]);\n      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n        Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n      });\n    }\n    return e;\n  }\n  function _typeof(o) {\n    \"@babel/helpers - typeof\";\n\n    return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n      return typeof o;\n    } : function (o) {\n      return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n    }, _typeof(o);\n  }\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  }\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n    }\n  }\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    Object.defineProperty(Constructor, \"prototype\", {\n      writable: false\n    });\n    return Constructor;\n  }\n  function _defineProperty(obj, key, value) {\n    key = _toPropertyKey(key);\n    if (key in obj) {\n      Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n      });\n    } else {\n      obj[key] = value;\n    }\n    return obj;\n  }\n  function _toConsumableArray(arr) {\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n  }\n  function _arrayWithoutHoles(arr) {\n    if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n  }\n  function _iterableToArray(iter) {\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n  }\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n    return arr2;\n  }\n  function _nonIterableSpread() {\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  function _toPrimitive(input, hint) {\n    if (typeof input !== \"object\" || input === null) return input;\n    var prim = input[Symbol.toPrimitive];\n    if (prim !== undefined) {\n      var res = prim.call(input, hint || \"default\");\n      if (typeof res !== \"object\") return res;\n      throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n    }\n    return (hint === \"string\" ? String : Number)(input);\n  }\n  function _toPropertyKey(arg) {\n    var key = _toPrimitive(arg, \"string\");\n    return typeof key === \"symbol\" ? key : String(key);\n  }\n\n  var IS_BROWSER = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n  var WINDOW = IS_BROWSER ? window : {};\n  var IS_TOUCH_DEVICE = IS_BROWSER && WINDOW.document.documentElement ? 'ontouchstart' in WINDOW.document.documentElement : false;\n  var HAS_POINTER_EVENT = IS_BROWSER ? 'PointerEvent' in WINDOW : false;\n  var NAMESPACE = 'cropper';\n\n  // Actions\n  var ACTION_ALL = 'all';\n  var ACTION_CROP = 'crop';\n  var ACTION_MOVE = 'move';\n  var ACTION_ZOOM = 'zoom';\n  var ACTION_EAST = 'e';\n  var ACTION_WEST = 'w';\n  var ACTION_SOUTH = 's';\n  var ACTION_NORTH = 'n';\n  var ACTION_NORTH_EAST = 'ne';\n  var ACTION_NORTH_WEST = 'nw';\n  var ACTION_SOUTH_EAST = 'se';\n  var ACTION_SOUTH_WEST = 'sw';\n\n  // Classes\n  var CLASS_CROP = \"\".concat(NAMESPACE, \"-crop\");\n  var CLASS_DISABLED = \"\".concat(NAMESPACE, \"-disabled\");\n  var CLASS_HIDDEN = \"\".concat(NAMESPACE, \"-hidden\");\n  var CLASS_HIDE = \"\".concat(NAMESPACE, \"-hide\");\n  var CLASS_INVISIBLE = \"\".concat(NAMESPACE, \"-invisible\");\n  var CLASS_MODAL = \"\".concat(NAMESPACE, \"-modal\");\n  var CLASS_MOVE = \"\".concat(NAMESPACE, \"-move\");\n\n  // Data keys\n  var DATA_ACTION = \"\".concat(NAMESPACE, \"Action\");\n  var DATA_PREVIEW = \"\".concat(NAMESPACE, \"Preview\");\n\n  // Drag modes\n  var DRAG_MODE_CROP = 'crop';\n  var DRAG_MODE_MOVE = 'move';\n  var DRAG_MODE_NONE = 'none';\n\n  // Events\n  var EVENT_CROP = 'crop';\n  var EVENT_CROP_END = 'cropend';\n  var EVENT_CROP_MOVE = 'cropmove';\n  var EVENT_CROP_START = 'cropstart';\n  var EVENT_DBLCLICK = 'dblclick';\n  var EVENT_TOUCH_START = IS_TOUCH_DEVICE ? 'touchstart' : 'mousedown';\n  var EVENT_TOUCH_MOVE = IS_TOUCH_DEVICE ? 'touchmove' : 'mousemove';\n  var EVENT_TOUCH_END = IS_TOUCH_DEVICE ? 'touchend touchcancel' : 'mouseup';\n  var EVENT_POINTER_DOWN = HAS_POINTER_EVENT ? 'pointerdown' : EVENT_TOUCH_START;\n  var EVENT_POINTER_MOVE = HAS_POINTER_EVENT ? 'pointermove' : EVENT_TOUCH_MOVE;\n  var EVENT_POINTER_UP = HAS_POINTER_EVENT ? 'pointerup pointercancel' : EVENT_TOUCH_END;\n  var EVENT_READY = 'ready';\n  var EVENT_RESIZE = 'resize';\n  var EVENT_WHEEL = 'wheel';\n  var EVENT_ZOOM = 'zoom';\n\n  // Mime types\n  var MIME_TYPE_JPEG = 'image/jpeg';\n\n  // RegExps\n  var REGEXP_ACTIONS = /^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/;\n  var REGEXP_DATA_URL = /^data:/;\n  var REGEXP_DATA_URL_JPEG = /^data:image\\/jpeg;base64,/;\n  var REGEXP_TAG_NAME = /^img|canvas$/i;\n\n  // Misc\n  // Inspired by the default width and height of a canvas element.\n  var MIN_CONTAINER_WIDTH = 200;\n  var MIN_CONTAINER_HEIGHT = 100;\n\n  var DEFAULTS = {\n    // Define the view mode of the cropper\n    viewMode: 0,\n    // 0, 1, 2, 3\n\n    // Define the dragging mode of the cropper\n    dragMode: DRAG_MODE_CROP,\n    // 'crop', 'move' or 'none'\n\n    // Define the initial aspect ratio of the crop box\n    initialAspectRatio: NaN,\n    // Define the aspect ratio of the crop box\n    aspectRatio: NaN,\n    // An object with the previous cropping result data\n    data: null,\n    // A selector for adding extra containers to preview\n    preview: '',\n    // Re-render the cropper when resize the window\n    responsive: true,\n    // Restore the cropped area after resize the window\n    restore: true,\n    // Check if the current image is a cross-origin image\n    checkCrossOrigin: true,\n    // Check the current image's Exif Orientation information\n    checkOrientation: true,\n    // Show the black modal\n    modal: true,\n    // Show the dashed lines for guiding\n    guides: true,\n    // Show the center indicator for guiding\n    center: true,\n    // Show the white modal to highlight the crop box\n    highlight: true,\n    // Show the grid background\n    background: true,\n    // Enable to crop the image automatically when initialize\n    autoCrop: true,\n    // Define the percentage of automatic cropping area when initializes\n    autoCropArea: 0.8,\n    // Enable to move the image\n    movable: true,\n    // Enable to rotate the image\n    rotatable: true,\n    // Enable to scale the image\n    scalable: true,\n    // Enable to zoom the image\n    zoomable: true,\n    // Enable to zoom the image by dragging touch\n    zoomOnTouch: true,\n    // Enable to zoom the image by wheeling mouse\n    zoomOnWheel: true,\n    // Define zoom ratio when zoom the image by wheeling mouse\n    wheelZoomRatio: 0.1,\n    // Enable to move the crop box\n    cropBoxMovable: true,\n    // Enable to resize the crop box\n    cropBoxResizable: true,\n    // Toggle drag mode between \"crop\" and \"move\" when click twice on the cropper\n    toggleDragModeOnDblclick: true,\n    // Size limitation\n    minCanvasWidth: 0,\n    minCanvasHeight: 0,\n    minCropBoxWidth: 0,\n    minCropBoxHeight: 0,\n    minContainerWidth: MIN_CONTAINER_WIDTH,\n    minContainerHeight: MIN_CONTAINER_HEIGHT,\n    // Shortcuts of events\n    ready: null,\n    cropstart: null,\n    cropmove: null,\n    cropend: null,\n    crop: null,\n    zoom: null\n  };\n\n  var TEMPLATE = '<div class=\"cropper-container\" touch-action=\"none\">' + '<div class=\"cropper-wrap-box\">' + '<div class=\"cropper-canvas\"></div>' + '</div>' + '<div class=\"cropper-drag-box\"></div>' + '<div class=\"cropper-crop-box\">' + '<span class=\"cropper-view-box\"></span>' + '<span class=\"cropper-dashed dashed-h\"></span>' + '<span class=\"cropper-dashed dashed-v\"></span>' + '<span class=\"cropper-center\"></span>' + '<span class=\"cropper-face\"></span>' + '<span class=\"cropper-line line-e\" data-cropper-action=\"e\"></span>' + '<span class=\"cropper-line line-n\" data-cropper-action=\"n\"></span>' + '<span class=\"cropper-line line-w\" data-cropper-action=\"w\"></span>' + '<span class=\"cropper-line line-s\" data-cropper-action=\"s\"></span>' + '<span class=\"cropper-point point-e\" data-cropper-action=\"e\"></span>' + '<span class=\"cropper-point point-n\" data-cropper-action=\"n\"></span>' + '<span class=\"cropper-point point-w\" data-cropper-action=\"w\"></span>' + '<span class=\"cropper-point point-s\" data-cropper-action=\"s\"></span>' + '<span class=\"cropper-point point-ne\" data-cropper-action=\"ne\"></span>' + '<span class=\"cropper-point point-nw\" data-cropper-action=\"nw\"></span>' + '<span class=\"cropper-point point-sw\" data-cropper-action=\"sw\"></span>' + '<span class=\"cropper-point point-se\" data-cropper-action=\"se\"></span>' + '</div>' + '</div>';\n\n  /**\n   * Check if the given value is not a number.\n   */\n  var isNaN = Number.isNaN || WINDOW.isNaN;\n\n  /**\n   * Check if the given value is a number.\n   * @param {*} value - The value to check.\n   * @returns {boolean} Returns `true` if the given value is a number, else `false`.\n   */\n  function isNumber(value) {\n    return typeof value === 'number' && !isNaN(value);\n  }\n\n  /**\n   * Check if the given value is a positive number.\n   * @param {*} value - The value to check.\n   * @returns {boolean} Returns `true` if the given value is a positive number, else `false`.\n   */\n  var isPositiveNumber = function isPositiveNumber(value) {\n    return value > 0 && value < Infinity;\n  };\n\n  /**\n   * Check if the given value is undefined.\n   * @param {*} value - The value to check.\n   * @returns {boolean} Returns `true` if the given value is undefined, else `false`.\n   */\n  function isUndefined(value) {\n    return typeof value === 'undefined';\n  }\n\n  /**\n   * Check if the given value is an object.\n   * @param {*} value - The value to check.\n   * @returns {boolean} Returns `true` if the given value is an object, else `false`.\n   */\n  function isObject(value) {\n    return _typeof(value) === 'object' && value !== null;\n  }\n  var hasOwnProperty = Object.prototype.hasOwnProperty;\n\n  /**\n   * Check if the given value is a plain object.\n   * @param {*} value - The value to check.\n   * @returns {boolean} Returns `true` if the given value is a plain object, else `false`.\n   */\n  function isPlainObject(value) {\n    if (!isObject(value)) {\n      return false;\n    }\n    try {\n      var _constructor = value.constructor;\n      var prototype = _constructor.prototype;\n      return _constructor && prototype && hasOwnProperty.call(prototype, 'isPrototypeOf');\n    } catch (error) {\n      return false;\n    }\n  }\n\n  /**\n   * Check if the given value is a function.\n   * @param {*} value - The value to check.\n   * @returns {boolean} Returns `true` if the given value is a function, else `false`.\n   */\n  function isFunction(value) {\n    return typeof value === 'function';\n  }\n  var slice = Array.prototype.slice;\n\n  /**\n   * Convert array-like or iterable object to an array.\n   * @param {*} value - The value to convert.\n   * @returns {Array} Returns a new array.\n   */\n  function toArray(value) {\n    return Array.from ? Array.from(value) : slice.call(value);\n  }\n\n  /**\n   * Iterate the given data.\n   * @param {*} data - The data to iterate.\n   * @param {Function} callback - The process function for each element.\n   * @returns {*} The original data.\n   */\n  function forEach(data, callback) {\n    if (data && isFunction(callback)) {\n      if (Array.isArray(data) || isNumber(data.length) /* array-like */) {\n        toArray(data).forEach(function (value, key) {\n          callback.call(data, value, key, data);\n        });\n      } else if (isObject(data)) {\n        Object.keys(data).forEach(function (key) {\n          callback.call(data, data[key], key, data);\n        });\n      }\n    }\n    return data;\n  }\n\n  /**\n   * Extend the given object.\n   * @param {*} target - The target object to extend.\n   * @param {*} args - The rest objects for merging to the target object.\n   * @returns {Object} The extended object.\n   */\n  var assign = Object.assign || function assign(target) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    if (isObject(target) && args.length > 0) {\n      args.forEach(function (arg) {\n        if (isObject(arg)) {\n          Object.keys(arg).forEach(function (key) {\n            target[key] = arg[key];\n          });\n        }\n      });\n    }\n    return target;\n  };\n  var REGEXP_DECIMALS = /\\.\\d*(?:0|9){12}\\d*$/;\n\n  /**\n   * Normalize decimal number.\n   * Check out {@link https://0.30000000000000004.com/}\n   * @param {number} value - The value to normalize.\n   * @param {number} [times=100000000000] - The times for normalizing.\n   * @returns {number} Returns the normalized number.\n   */\n  function normalizeDecimalNumber(value) {\n    var times = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100000000000;\n    return REGEXP_DECIMALS.test(value) ? Math.round(value * times) / times : value;\n  }\n  var REGEXP_SUFFIX = /^width|height|left|top|marginLeft|marginTop$/;\n\n  /**\n   * Apply styles to the given element.\n   * @param {Element} element - The target element.\n   * @param {Object} styles - The styles for applying.\n   */\n  function setStyle(element, styles) {\n    var style = element.style;\n    forEach(styles, function (value, property) {\n      if (REGEXP_SUFFIX.test(property) && isNumber(value)) {\n        value = \"\".concat(value, \"px\");\n      }\n      style[property] = value;\n    });\n  }\n\n  /**\n   * Check if the given element has a special class.\n   * @param {Element} element - The element to check.\n   * @param {string} value - The class to search.\n   * @returns {boolean} Returns `true` if the special class was found.\n   */\n  function hasClass(element, value) {\n    return element.classList ? element.classList.contains(value) : element.className.indexOf(value) > -1;\n  }\n\n  /**\n   * Add classes to the given element.\n   * @param {Element} element - The target element.\n   * @param {string} value - The classes to be added.\n   */\n  function addClass(element, value) {\n    if (!value) {\n      return;\n    }\n    if (isNumber(element.length)) {\n      forEach(element, function (elem) {\n        addClass(elem, value);\n      });\n      return;\n    }\n    if (element.classList) {\n      element.classList.add(value);\n      return;\n    }\n    var className = element.className.trim();\n    if (!className) {\n      element.className = value;\n    } else if (className.indexOf(value) < 0) {\n      element.className = \"\".concat(className, \" \").concat(value);\n    }\n  }\n\n  /**\n   * Remove classes from the given element.\n   * @param {Element} element - The target element.\n   * @param {string} value - The classes to be removed.\n   */\n  function removeClass(element, value) {\n    if (!value) {\n      return;\n    }\n    if (isNumber(element.length)) {\n      forEach(element, function (elem) {\n        removeClass(elem, value);\n      });\n      return;\n    }\n    if (element.classList) {\n      element.classList.remove(value);\n      return;\n    }\n    if (element.className.indexOf(value) >= 0) {\n      element.className = element.className.replace(value, '');\n    }\n  }\n\n  /**\n   * Add or remove classes from the given element.\n   * @param {Element} element - The target element.\n   * @param {string} value - The classes to be toggled.\n   * @param {boolean} added - Add only.\n   */\n  function toggleClass(element, value, added) {\n    if (!value) {\n      return;\n    }\n    if (isNumber(element.length)) {\n      forEach(element, function (elem) {\n        toggleClass(elem, value, added);\n      });\n      return;\n    }\n\n    // IE10-11 doesn't support the second parameter of `classList.toggle`\n    if (added) {\n      addClass(element, value);\n    } else {\n      removeClass(element, value);\n    }\n  }\n  var REGEXP_CAMEL_CASE = /([a-z\\d])([A-Z])/g;\n\n  /**\n   * Transform the given string from camelCase to kebab-case\n   * @param {string} value - The value to transform.\n   * @returns {string} The transformed value.\n   */\n  function toParamCase(value) {\n    return value.replace(REGEXP_CAMEL_CASE, '$1-$2').toLowerCase();\n  }\n\n  /**\n   * Get data from the given element.\n   * @param {Element} element - The target element.\n   * @param {string} name - The data key to get.\n   * @returns {string} The data value.\n   */\n  function getData(element, name) {\n    if (isObject(element[name])) {\n      return element[name];\n    }\n    if (element.dataset) {\n      return element.dataset[name];\n    }\n    return element.getAttribute(\"data-\".concat(toParamCase(name)));\n  }\n\n  /**\n   * Set data to the given element.\n   * @param {Element} element - The target element.\n   * @param {string} name - The data key to set.\n   * @param {string} data - The data value.\n   */\n  function setData(element, name, data) {\n    if (isObject(data)) {\n      element[name] = data;\n    } else if (element.dataset) {\n      element.dataset[name] = data;\n    } else {\n      element.setAttribute(\"data-\".concat(toParamCase(name)), data);\n    }\n  }\n\n  /**\n   * Remove data from the given element.\n   * @param {Element} element - The target element.\n   * @param {string} name - The data key to remove.\n   */\n  function removeData(element, name) {\n    if (isObject(element[name])) {\n      try {\n        delete element[name];\n      } catch (error) {\n        element[name] = undefined;\n      }\n    } else if (element.dataset) {\n      // #128 Safari not allows to delete dataset property\n      try {\n        delete element.dataset[name];\n      } catch (error) {\n        element.dataset[name] = undefined;\n      }\n    } else {\n      element.removeAttribute(\"data-\".concat(toParamCase(name)));\n    }\n  }\n  var REGEXP_SPACES = /\\s\\s*/;\n  var onceSupported = function () {\n    var supported = false;\n    if (IS_BROWSER) {\n      var once = false;\n      var listener = function listener() {};\n      var options = Object.defineProperty({}, 'once', {\n        get: function get() {\n          supported = true;\n          return once;\n        },\n        /**\n         * This setter can fix a `TypeError` in strict mode\n         * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Getter_only}\n         * @param {boolean} value - The value to set\n         */\n        set: function set(value) {\n          once = value;\n        }\n      });\n      WINDOW.addEventListener('test', listener, options);\n      WINDOW.removeEventListener('test', listener, options);\n    }\n    return supported;\n  }();\n\n  /**\n   * Remove event listener from the target element.\n   * @param {Element} element - The event target.\n   * @param {string} type - The event type(s).\n   * @param {Function} listener - The event listener.\n   * @param {Object} options - The event options.\n   */\n  function removeListener(element, type, listener) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var handler = listener;\n    type.trim().split(REGEXP_SPACES).forEach(function (event) {\n      if (!onceSupported) {\n        var listeners = element.listeners;\n        if (listeners && listeners[event] && listeners[event][listener]) {\n          handler = listeners[event][listener];\n          delete listeners[event][listener];\n          if (Object.keys(listeners[event]).length === 0) {\n            delete listeners[event];\n          }\n          if (Object.keys(listeners).length === 0) {\n            delete element.listeners;\n          }\n        }\n      }\n      element.removeEventListener(event, handler, options);\n    });\n  }\n\n  /**\n   * Add event listener to the target element.\n   * @param {Element} element - The event target.\n   * @param {string} type - The event type(s).\n   * @param {Function} listener - The event listener.\n   * @param {Object} options - The event options.\n   */\n  function addListener(element, type, listener) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var _handler = listener;\n    type.trim().split(REGEXP_SPACES).forEach(function (event) {\n      if (options.once && !onceSupported) {\n        var _element$listeners = element.listeners,\n          listeners = _element$listeners === void 0 ? {} : _element$listeners;\n        _handler = function handler() {\n          delete listeners[event][listener];\n          element.removeEventListener(event, _handler, options);\n          for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n            args[_key2] = arguments[_key2];\n          }\n          listener.apply(element, args);\n        };\n        if (!listeners[event]) {\n          listeners[event] = {};\n        }\n        if (listeners[event][listener]) {\n          element.removeEventListener(event, listeners[event][listener], options);\n        }\n        listeners[event][listener] = _handler;\n        element.listeners = listeners;\n      }\n      element.addEventListener(event, _handler, options);\n    });\n  }\n\n  /**\n   * Dispatch event on the target element.\n   * @param {Element} element - The event target.\n   * @param {string} type - The event type(s).\n   * @param {Object} data - The additional event data.\n   * @returns {boolean} Indicate if the event is default prevented or not.\n   */\n  function dispatchEvent(element, type, data) {\n    var event;\n\n    // Event and CustomEvent on IE9-11 are global objects, not constructors\n    if (isFunction(Event) && isFunction(CustomEvent)) {\n      event = new CustomEvent(type, {\n        detail: data,\n        bubbles: true,\n        cancelable: true\n      });\n    } else {\n      event = document.createEvent('CustomEvent');\n      event.initCustomEvent(type, true, true, data);\n    }\n    return element.dispatchEvent(event);\n  }\n\n  /**\n   * Get the offset base on the document.\n   * @param {Element} element - The target element.\n   * @returns {Object} The offset data.\n   */\n  function getOffset(element) {\n    var box = element.getBoundingClientRect();\n    return {\n      left: box.left + (window.pageXOffset - document.documentElement.clientLeft),\n      top: box.top + (window.pageYOffset - document.documentElement.clientTop)\n    };\n  }\n  var location = WINDOW.location;\n  var REGEXP_ORIGINS = /^(\\w+:)\\/\\/([^:/?#]*):?(\\d*)/i;\n\n  /**\n   * Check if the given URL is a cross origin URL.\n   * @param {string} url - The target URL.\n   * @returns {boolean} Returns `true` if the given URL is a cross origin URL, else `false`.\n   */\n  function isCrossOriginURL(url) {\n    var parts = url.match(REGEXP_ORIGINS);\n    return parts !== null && (parts[1] !== location.protocol || parts[2] !== location.hostname || parts[3] !== location.port);\n  }\n\n  /**\n   * Add timestamp to the given URL.\n   * @param {string} url - The target URL.\n   * @returns {string} The result URL.\n   */\n  function addTimestamp(url) {\n    var timestamp = \"timestamp=\".concat(new Date().getTime());\n    return url + (url.indexOf('?') === -1 ? '?' : '&') + timestamp;\n  }\n\n  /**\n   * Get transforms base on the given object.\n   * @param {Object} obj - The target object.\n   * @returns {string} A string contains transform values.\n   */\n  function getTransforms(_ref) {\n    var rotate = _ref.rotate,\n      scaleX = _ref.scaleX,\n      scaleY = _ref.scaleY,\n      translateX = _ref.translateX,\n      translateY = _ref.translateY;\n    var values = [];\n    if (isNumber(translateX) && translateX !== 0) {\n      values.push(\"translateX(\".concat(translateX, \"px)\"));\n    }\n    if (isNumber(translateY) && translateY !== 0) {\n      values.push(\"translateY(\".concat(translateY, \"px)\"));\n    }\n\n    // Rotate should come first before scale to match orientation transform\n    if (isNumber(rotate) && rotate !== 0) {\n      values.push(\"rotate(\".concat(rotate, \"deg)\"));\n    }\n    if (isNumber(scaleX) && scaleX !== 1) {\n      values.push(\"scaleX(\".concat(scaleX, \")\"));\n    }\n    if (isNumber(scaleY) && scaleY !== 1) {\n      values.push(\"scaleY(\".concat(scaleY, \")\"));\n    }\n    var transform = values.length ? values.join(' ') : 'none';\n    return {\n      WebkitTransform: transform,\n      msTransform: transform,\n      transform: transform\n    };\n  }\n\n  /**\n   * Get the max ratio of a group of pointers.\n   * @param {string} pointers - The target pointers.\n   * @returns {number} The result ratio.\n   */\n  function getMaxZoomRatio(pointers) {\n    var pointers2 = _objectSpread2({}, pointers);\n    var maxRatio = 0;\n    forEach(pointers, function (pointer, pointerId) {\n      delete pointers2[pointerId];\n      forEach(pointers2, function (pointer2) {\n        var x1 = Math.abs(pointer.startX - pointer2.startX);\n        var y1 = Math.abs(pointer.startY - pointer2.startY);\n        var x2 = Math.abs(pointer.endX - pointer2.endX);\n        var y2 = Math.abs(pointer.endY - pointer2.endY);\n        var z1 = Math.sqrt(x1 * x1 + y1 * y1);\n        var z2 = Math.sqrt(x2 * x2 + y2 * y2);\n        var ratio = (z2 - z1) / z1;\n        if (Math.abs(ratio) > Math.abs(maxRatio)) {\n          maxRatio = ratio;\n        }\n      });\n    });\n    return maxRatio;\n  }\n\n  /**\n   * Get a pointer from an event object.\n   * @param {Object} event - The target event object.\n   * @param {boolean} endOnly - Indicates if only returns the end point coordinate or not.\n   * @returns {Object} The result pointer contains start and/or end point coordinates.\n   */\n  function getPointer(_ref2, endOnly) {\n    var pageX = _ref2.pageX,\n      pageY = _ref2.pageY;\n    var end = {\n      endX: pageX,\n      endY: pageY\n    };\n    return endOnly ? end : _objectSpread2({\n      startX: pageX,\n      startY: pageY\n    }, end);\n  }\n\n  /**\n   * Get the center point coordinate of a group of pointers.\n   * @param {Object} pointers - The target pointers.\n   * @returns {Object} The center point coordinate.\n   */\n  function getPointersCenter(pointers) {\n    var pageX = 0;\n    var pageY = 0;\n    var count = 0;\n    forEach(pointers, function (_ref3) {\n      var startX = _ref3.startX,\n        startY = _ref3.startY;\n      pageX += startX;\n      pageY += startY;\n      count += 1;\n    });\n    pageX /= count;\n    pageY /= count;\n    return {\n      pageX: pageX,\n      pageY: pageY\n    };\n  }\n\n  /**\n   * Get the max sizes in a rectangle under the given aspect ratio.\n   * @param {Object} data - The original sizes.\n   * @param {string} [type='contain'] - The adjust type.\n   * @returns {Object} The result sizes.\n   */\n  function getAdjustedSizes(_ref4) {\n    var aspectRatio = _ref4.aspectRatio,\n      height = _ref4.height,\n      width = _ref4.width;\n    var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'contain';\n    var isValidWidth = isPositiveNumber(width);\n    var isValidHeight = isPositiveNumber(height);\n    if (isValidWidth && isValidHeight) {\n      var adjustedWidth = height * aspectRatio;\n      if (type === 'contain' && adjustedWidth > width || type === 'cover' && adjustedWidth < width) {\n        height = width / aspectRatio;\n      } else {\n        width = height * aspectRatio;\n      }\n    } else if (isValidWidth) {\n      height = width / aspectRatio;\n    } else if (isValidHeight) {\n      width = height * aspectRatio;\n    }\n    return {\n      width: width,\n      height: height\n    };\n  }\n\n  /**\n   * Get the new sizes of a rectangle after rotated.\n   * @param {Object} data - The original sizes.\n   * @returns {Object} The result sizes.\n   */\n  function getRotatedSizes(_ref5) {\n    var width = _ref5.width,\n      height = _ref5.height,\n      degree = _ref5.degree;\n    degree = Math.abs(degree) % 180;\n    if (degree === 90) {\n      return {\n        width: height,\n        height: width\n      };\n    }\n    var arc = degree % 90 * Math.PI / 180;\n    var sinArc = Math.sin(arc);\n    var cosArc = Math.cos(arc);\n    var newWidth = width * cosArc + height * sinArc;\n    var newHeight = width * sinArc + height * cosArc;\n    return degree > 90 ? {\n      width: newHeight,\n      height: newWidth\n    } : {\n      width: newWidth,\n      height: newHeight\n    };\n  }\n\n  /**\n   * Get a canvas which drew the given image.\n   * @param {HTMLImageElement} image - The image for drawing.\n   * @param {Object} imageData - The image data.\n   * @param {Object} canvasData - The canvas data.\n   * @param {Object} options - The options.\n   * @returns {HTMLCanvasElement} The result canvas.\n   */\n  function getSourceCanvas(image, _ref6, _ref7, _ref8) {\n    var imageAspectRatio = _ref6.aspectRatio,\n      imageNaturalWidth = _ref6.naturalWidth,\n      imageNaturalHeight = _ref6.naturalHeight,\n      _ref6$rotate = _ref6.rotate,\n      rotate = _ref6$rotate === void 0 ? 0 : _ref6$rotate,\n      _ref6$scaleX = _ref6.scaleX,\n      scaleX = _ref6$scaleX === void 0 ? 1 : _ref6$scaleX,\n      _ref6$scaleY = _ref6.scaleY,\n      scaleY = _ref6$scaleY === void 0 ? 1 : _ref6$scaleY;\n    var aspectRatio = _ref7.aspectRatio,\n      naturalWidth = _ref7.naturalWidth,\n      naturalHeight = _ref7.naturalHeight;\n    var _ref8$fillColor = _ref8.fillColor,\n      fillColor = _ref8$fillColor === void 0 ? 'transparent' : _ref8$fillColor,\n      _ref8$imageSmoothingE = _ref8.imageSmoothingEnabled,\n      imageSmoothingEnabled = _ref8$imageSmoothingE === void 0 ? true : _ref8$imageSmoothingE,\n      _ref8$imageSmoothingQ = _ref8.imageSmoothingQuality,\n      imageSmoothingQuality = _ref8$imageSmoothingQ === void 0 ? 'low' : _ref8$imageSmoothingQ,\n      _ref8$maxWidth = _ref8.maxWidth,\n      maxWidth = _ref8$maxWidth === void 0 ? Infinity : _ref8$maxWidth,\n      _ref8$maxHeight = _ref8.maxHeight,\n      maxHeight = _ref8$maxHeight === void 0 ? Infinity : _ref8$maxHeight,\n      _ref8$minWidth = _ref8.minWidth,\n      minWidth = _ref8$minWidth === void 0 ? 0 : _ref8$minWidth,\n      _ref8$minHeight = _ref8.minHeight,\n      minHeight = _ref8$minHeight === void 0 ? 0 : _ref8$minHeight;\n    var canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n    var maxSizes = getAdjustedSizes({\n      aspectRatio: aspectRatio,\n      width: maxWidth,\n      height: maxHeight\n    });\n    var minSizes = getAdjustedSizes({\n      aspectRatio: aspectRatio,\n      width: minWidth,\n      height: minHeight\n    }, 'cover');\n    var width = Math.min(maxSizes.width, Math.max(minSizes.width, naturalWidth));\n    var height = Math.min(maxSizes.height, Math.max(minSizes.height, naturalHeight));\n\n    // Note: should always use image's natural sizes for drawing as\n    // imageData.naturalWidth === canvasData.naturalHeight when rotate % 180 === 90\n    var destMaxSizes = getAdjustedSizes({\n      aspectRatio: imageAspectRatio,\n      width: maxWidth,\n      height: maxHeight\n    });\n    var destMinSizes = getAdjustedSizes({\n      aspectRatio: imageAspectRatio,\n      width: minWidth,\n      height: minHeight\n    }, 'cover');\n    var destWidth = Math.min(destMaxSizes.width, Math.max(destMinSizes.width, imageNaturalWidth));\n    var destHeight = Math.min(destMaxSizes.height, Math.max(destMinSizes.height, imageNaturalHeight));\n    var params = [-destWidth / 2, -destHeight / 2, destWidth, destHeight];\n    canvas.width = normalizeDecimalNumber(width);\n    canvas.height = normalizeDecimalNumber(height);\n    context.fillStyle = fillColor;\n    context.fillRect(0, 0, width, height);\n    context.save();\n    context.translate(width / 2, height / 2);\n    context.rotate(rotate * Math.PI / 180);\n    context.scale(scaleX, scaleY);\n    context.imageSmoothingEnabled = imageSmoothingEnabled;\n    context.imageSmoothingQuality = imageSmoothingQuality;\n    context.drawImage.apply(context, [image].concat(_toConsumableArray(params.map(function (param) {\n      return Math.floor(normalizeDecimalNumber(param));\n    }))));\n    context.restore();\n    return canvas;\n  }\n  var fromCharCode = String.fromCharCode;\n\n  /**\n   * Get string from char code in data view.\n   * @param {DataView} dataView - The data view for read.\n   * @param {number} start - The start index.\n   * @param {number} length - The read length.\n   * @returns {string} The read result.\n   */\n  function getStringFromCharCode(dataView, start, length) {\n    var str = '';\n    length += start;\n    for (var i = start; i < length; i += 1) {\n      str += fromCharCode(dataView.getUint8(i));\n    }\n    return str;\n  }\n  var REGEXP_DATA_URL_HEAD = /^data:.*,/;\n\n  /**\n   * Transform Data URL to array buffer.\n   * @param {string} dataURL - The Data URL to transform.\n   * @returns {ArrayBuffer} The result array buffer.\n   */\n  function dataURLToArrayBuffer(dataURL) {\n    var base64 = dataURL.replace(REGEXP_DATA_URL_HEAD, '');\n    var binary = atob(base64);\n    var arrayBuffer = new ArrayBuffer(binary.length);\n    var uint8 = new Uint8Array(arrayBuffer);\n    forEach(uint8, function (value, i) {\n      uint8[i] = binary.charCodeAt(i);\n    });\n    return arrayBuffer;\n  }\n\n  /**\n   * Transform array buffer to Data URL.\n   * @param {ArrayBuffer} arrayBuffer - The array buffer to transform.\n   * @param {string} mimeType - The mime type of the Data URL.\n   * @returns {string} The result Data URL.\n   */\n  function arrayBufferToDataURL(arrayBuffer, mimeType) {\n    var chunks = [];\n\n    // Chunk Typed Array for better performance (#435)\n    var chunkSize = 8192;\n    var uint8 = new Uint8Array(arrayBuffer);\n    while (uint8.length > 0) {\n      // XXX: Babel's `toConsumableArray` helper will throw error in IE or Safari 9\n      // eslint-disable-next-line prefer-spread\n      chunks.push(fromCharCode.apply(null, toArray(uint8.subarray(0, chunkSize))));\n      uint8 = uint8.subarray(chunkSize);\n    }\n    return \"data:\".concat(mimeType, \";base64,\").concat(btoa(chunks.join('')));\n  }\n\n  /**\n   * Get orientation value from given array buffer.\n   * @param {ArrayBuffer} arrayBuffer - The array buffer to read.\n   * @returns {number} The read orientation value.\n   */\n  function resetAndGetOrientation(arrayBuffer) {\n    var dataView = new DataView(arrayBuffer);\n    var orientation;\n\n    // Ignores range error when the image does not have correct Exif information\n    try {\n      var littleEndian;\n      var app1Start;\n      var ifdStart;\n\n      // Only handle JPEG image (start by 0xFFD8)\n      if (dataView.getUint8(0) === 0xFF && dataView.getUint8(1) === 0xD8) {\n        var length = dataView.byteLength;\n        var offset = 2;\n        while (offset + 1 < length) {\n          if (dataView.getUint8(offset) === 0xFF && dataView.getUint8(offset + 1) === 0xE1) {\n            app1Start = offset;\n            break;\n          }\n          offset += 1;\n        }\n      }\n      if (app1Start) {\n        var exifIDCode = app1Start + 4;\n        var tiffOffset = app1Start + 10;\n        if (getStringFromCharCode(dataView, exifIDCode, 4) === 'Exif') {\n          var endianness = dataView.getUint16(tiffOffset);\n          littleEndian = endianness === 0x4949;\n          if (littleEndian || endianness === 0x4D4D /* bigEndian */) {\n            if (dataView.getUint16(tiffOffset + 2, littleEndian) === 0x002A) {\n              var firstIFDOffset = dataView.getUint32(tiffOffset + 4, littleEndian);\n              if (firstIFDOffset >= 0x00000008) {\n                ifdStart = tiffOffset + firstIFDOffset;\n              }\n            }\n          }\n        }\n      }\n      if (ifdStart) {\n        var _length = dataView.getUint16(ifdStart, littleEndian);\n        var _offset;\n        var i;\n        for (i = 0; i < _length; i += 1) {\n          _offset = ifdStart + i * 12 + 2;\n          if (dataView.getUint16(_offset, littleEndian) === 0x0112 /* Orientation */) {\n            // 8 is the offset of the current tag's value\n            _offset += 8;\n\n            // Get the original orientation value\n            orientation = dataView.getUint16(_offset, littleEndian);\n\n            // Override the orientation with its default value\n            dataView.setUint16(_offset, 1, littleEndian);\n            break;\n          }\n        }\n      }\n    } catch (error) {\n      orientation = 1;\n    }\n    return orientation;\n  }\n\n  /**\n   * Parse Exif Orientation value.\n   * @param {number} orientation - The orientation to parse.\n   * @returns {Object} The parsed result.\n   */\n  function parseOrientation(orientation) {\n    var rotate = 0;\n    var scaleX = 1;\n    var scaleY = 1;\n    switch (orientation) {\n      // Flip horizontal\n      case 2:\n        scaleX = -1;\n        break;\n\n      // Rotate left 180\u00B0\n      case 3:\n        rotate = -180;\n        break;\n\n      // Flip vertical\n      case 4:\n        scaleY = -1;\n        break;\n\n      // Flip vertical and rotate right 90\u00B0\n      case 5:\n        rotate = 90;\n        scaleY = -1;\n        break;\n\n      // Rotate right 90\u00B0\n      case 6:\n        rotate = 90;\n        break;\n\n      // Flip horizontal and rotate right 90\u00B0\n      case 7:\n        rotate = 90;\n        scaleX = -1;\n        break;\n\n      // Rotate left 90\u00B0\n      case 8:\n        rotate = -90;\n        break;\n    }\n    return {\n      rotate: rotate,\n      scaleX: scaleX,\n      scaleY: scaleY\n    };\n  }\n\n  var render = {\n    render: function render() {\n      this.initContainer();\n      this.initCanvas();\n      this.initCropBox();\n      this.renderCanvas();\n      if (this.cropped) {\n        this.renderCropBox();\n      }\n    },\n    initContainer: function initContainer() {\n      var element = this.element,\n        options = this.options,\n        container = this.container,\n        cropper = this.cropper;\n      var minWidth = Number(options.minContainerWidth);\n      var minHeight = Number(options.minContainerHeight);\n      addClass(cropper, CLASS_HIDDEN);\n      removeClass(element, CLASS_HIDDEN);\n      var containerData = {\n        width: Math.max(container.offsetWidth, minWidth >= 0 ? minWidth : MIN_CONTAINER_WIDTH),\n        height: Math.max(container.offsetHeight, minHeight >= 0 ? minHeight : MIN_CONTAINER_HEIGHT)\n      };\n      this.containerData = containerData;\n      setStyle(cropper, {\n        width: containerData.width,\n        height: containerData.height\n      });\n      addClass(element, CLASS_HIDDEN);\n      removeClass(cropper, CLASS_HIDDEN);\n    },\n    // Canvas (image wrapper)\n    initCanvas: function initCanvas() {\n      var containerData = this.containerData,\n        imageData = this.imageData;\n      var viewMode = this.options.viewMode;\n      var rotated = Math.abs(imageData.rotate) % 180 === 90;\n      var naturalWidth = rotated ? imageData.naturalHeight : imageData.naturalWidth;\n      var naturalHeight = rotated ? imageData.naturalWidth : imageData.naturalHeight;\n      var aspectRatio = naturalWidth / naturalHeight;\n      var canvasWidth = containerData.width;\n      var canvasHeight = containerData.height;\n      if (containerData.height * aspectRatio > containerData.width) {\n        if (viewMode === 3) {\n          canvasWidth = containerData.height * aspectRatio;\n        } else {\n          canvasHeight = containerData.width / aspectRatio;\n        }\n      } else if (viewMode === 3) {\n        canvasHeight = containerData.width / aspectRatio;\n      } else {\n        canvasWidth = containerData.height * aspectRatio;\n      }\n      var canvasData = {\n        aspectRatio: aspectRatio,\n        naturalWidth: naturalWidth,\n        naturalHeight: naturalHeight,\n        width: canvasWidth,\n        height: canvasHeight\n      };\n      this.canvasData = canvasData;\n      this.limited = viewMode === 1 || viewMode === 2;\n      this.limitCanvas(true, true);\n      canvasData.width = Math.min(Math.max(canvasData.width, canvasData.minWidth), canvasData.maxWidth);\n      canvasData.height = Math.min(Math.max(canvasData.height, canvasData.minHeight), canvasData.maxHeight);\n      canvasData.left = (containerData.width - canvasData.width) / 2;\n      canvasData.top = (containerData.height - canvasData.height) / 2;\n      canvasData.oldLeft = canvasData.left;\n      canvasData.oldTop = canvasData.top;\n      this.initialCanvasData = assign({}, canvasData);\n    },\n    limitCanvas: function limitCanvas(sizeLimited, positionLimited) {\n      var options = this.options,\n        containerData = this.containerData,\n        canvasData = this.canvasData,\n        cropBoxData = this.cropBoxData;\n      var viewMode = options.viewMode;\n      var aspectRatio = canvasData.aspectRatio;\n      var cropped = this.cropped && cropBoxData;\n      if (sizeLimited) {\n        var minCanvasWidth = Number(options.minCanvasWidth) || 0;\n        var minCanvasHeight = Number(options.minCanvasHeight) || 0;\n        if (viewMode > 1) {\n          minCanvasWidth = Math.max(minCanvasWidth, containerData.width);\n          minCanvasHeight = Math.max(minCanvasHeight, containerData.height);\n          if (viewMode === 3) {\n            if (minCanvasHeight * aspectRatio > minCanvasWidth) {\n              minCanvasWidth = minCanvasHeight * aspectRatio;\n            } else {\n              minCanvasHeight = minCanvasWidth / aspectRatio;\n            }\n          }\n        } else if (viewMode > 0) {\n          if (minCanvasWidth) {\n            minCanvasWidth = Math.max(minCanvasWidth, cropped ? cropBoxData.width : 0);\n          } else if (minCanvasHeight) {\n            minCanvasHeight = Math.max(minCanvasHeight, cropped ? cropBoxData.height : 0);\n          } else if (cropped) {\n            minCanvasWidth = cropBoxData.width;\n            minCanvasHeight = cropBoxData.height;\n            if (minCanvasHeight * aspectRatio > minCanvasWidth) {\n              minCanvasWidth = minCanvasHeight * aspectRatio;\n            } else {\n              minCanvasHeight = minCanvasWidth / aspectRatio;\n            }\n          }\n        }\n        var _getAdjustedSizes = getAdjustedSizes({\n          aspectRatio: aspectRatio,\n          width: minCanvasWidth,\n          height: minCanvasHeight\n        });\n        minCanvasWidth = _getAdjustedSizes.width;\n        minCanvasHeight = _getAdjustedSizes.height;\n        canvasData.minWidth = minCanvasWidth;\n        canvasData.minHeight = minCanvasHeight;\n        canvasData.maxWidth = Infinity;\n        canvasData.maxHeight = Infinity;\n      }\n      if (positionLimited) {\n        if (viewMode > (cropped ? 0 : 1)) {\n          var newCanvasLeft = containerData.width - canvasData.width;\n          var newCanvasTop = containerData.height - canvasData.height;\n          canvasData.minLeft = Math.min(0, newCanvasLeft);\n          canvasData.minTop = Math.min(0, newCanvasTop);\n          canvasData.maxLeft = Math.max(0, newCanvasLeft);\n          canvasData.maxTop = Math.max(0, newCanvasTop);\n          if (cropped && this.limited) {\n            canvasData.minLeft = Math.min(cropBoxData.left, cropBoxData.left + (cropBoxData.width - canvasData.width));\n            canvasData.minTop = Math.min(cropBoxData.top, cropBoxData.top + (cropBoxData.height - canvasData.height));\n            canvasData.maxLeft = cropBoxData.left;\n            canvasData.maxTop = cropBoxData.top;\n            if (viewMode === 2) {\n              if (canvasData.width >= containerData.width) {\n                canvasData.minLeft = Math.min(0, newCanvasLeft);\n                canvasData.maxLeft = Math.max(0, newCanvasLeft);\n              }\n              if (canvasData.height >= containerData.height) {\n                canvasData.minTop = Math.min(0, newCanvasTop);\n                canvasData.maxTop = Math.max(0, newCanvasTop);\n              }\n            }\n          }\n        } else {\n          canvasData.minLeft = -canvasData.width;\n          canvasData.minTop = -canvasData.height;\n          canvasData.maxLeft = containerData.width;\n          canvasData.maxTop = containerData.height;\n        }\n      }\n    },\n    renderCanvas: function renderCanvas(changed, transformed) {\n      var canvasData = this.canvasData,\n        imageData = this.imageData;\n      if (transformed) {\n        var _getRotatedSizes = getRotatedSizes({\n            width: imageData.naturalWidth * Math.abs(imageData.scaleX || 1),\n            height: imageData.naturalHeight * Math.abs(imageData.scaleY || 1),\n            degree: imageData.rotate || 0\n          }),\n          naturalWidth = _getRotatedSizes.width,\n          naturalHeight = _getRotatedSizes.height;\n        var width = canvasData.width * (naturalWidth / canvasData.naturalWidth);\n        var height = canvasData.height * (naturalHeight / canvasData.naturalHeight);\n        canvasData.left -= (width - canvasData.width) / 2;\n        canvasData.top -= (height - canvasData.height) / 2;\n        canvasData.width = width;\n        canvasData.height = height;\n        canvasData.aspectRatio = naturalWidth / naturalHeight;\n        canvasData.naturalWidth = naturalWidth;\n        canvasData.naturalHeight = naturalHeight;\n        this.limitCanvas(true, false);\n      }\n      if (canvasData.width > canvasData.maxWidth || canvasData.width < canvasData.minWidth) {\n        canvasData.left = canvasData.oldLeft;\n      }\n      if (canvasData.height > canvasData.maxHeight || canvasData.height < canvasData.minHeight) {\n        canvasData.top = canvasData.oldTop;\n      }\n      canvasData.width = Math.min(Math.max(canvasData.width, canvasData.minWidth), canvasData.maxWidth);\n      canvasData.height = Math.min(Math.max(canvasData.height, canvasData.minHeight), canvasData.maxHeight);\n      this.limitCanvas(false, true);\n      canvasData.left = Math.min(Math.max(canvasData.left, canvasData.minLeft), canvasData.maxLeft);\n      canvasData.top = Math.min(Math.max(canvasData.top, canvasData.minTop), canvasData.maxTop);\n      canvasData.oldLeft = canvasData.left;\n      canvasData.oldTop = canvasData.top;\n      setStyle(this.canvas, assign({\n        width: canvasData.width,\n        height: canvasData.height\n      }, getTransforms({\n        translateX: canvasData.left,\n        translateY: canvasData.top\n      })));\n      this.renderImage(changed);\n      if (this.cropped && this.limited) {\n        this.limitCropBox(true, true);\n      }\n    },\n    renderImage: function renderImage(changed) {\n      var canvasData = this.canvasData,\n        imageData = this.imageData;\n      var width = imageData.naturalWidth * (canvasData.width / canvasData.naturalWidth);\n      var height = imageData.naturalHeight * (canvasData.height / canvasData.naturalHeight);\n      assign(imageData, {\n        width: width,\n        height: height,\n        left: (canvasData.width - width) / 2,\n        top: (canvasData.height - height) / 2\n      });\n      setStyle(this.image, assign({\n        width: imageData.width,\n        height: imageData.height\n      }, getTransforms(assign({\n        translateX: imageData.left,\n        translateY: imageData.top\n      }, imageData))));\n      if (changed) {\n        this.output();\n      }\n    },\n    initCropBox: function initCropBox() {\n      var options = this.options,\n        canvasData = this.canvasData;\n      var aspectRatio = options.aspectRatio || options.initialAspectRatio;\n      var autoCropArea = Number(options.autoCropArea) || 0.8;\n      var cropBoxData = {\n        width: canvasData.width,\n        height: canvasData.height\n      };\n      if (aspectRatio) {\n        if (canvasData.height * aspectRatio > canvasData.width) {\n          cropBoxData.height = cropBoxData.width / aspectRatio;\n        } else {\n          cropBoxData.width = cropBoxData.height * aspectRatio;\n        }\n      }\n      this.cropBoxData = cropBoxData;\n      this.limitCropBox(true, true);\n\n      // Initialize auto crop area\n      cropBoxData.width = Math.min(Math.max(cropBoxData.width, cropBoxData.minWidth), cropBoxData.maxWidth);\n      cropBoxData.height = Math.min(Math.max(cropBoxData.height, cropBoxData.minHeight), cropBoxData.maxHeight);\n\n      // The width/height of auto crop area must large than \"minWidth/Height\"\n      cropBoxData.width = Math.max(cropBoxData.minWidth, cropBoxData.width * autoCropArea);\n      cropBoxData.height = Math.max(cropBoxData.minHeight, cropBoxData.height * autoCropArea);\n      cropBoxData.left = canvasData.left + (canvasData.width - cropBoxData.width) / 2;\n      cropBoxData.top = canvasData.top + (canvasData.height - cropBoxData.height) / 2;\n      cropBoxData.oldLeft = cropBoxData.left;\n      cropBoxData.oldTop = cropBoxData.top;\n      this.initialCropBoxData = assign({}, cropBoxData);\n    },\n    limitCropBox: function limitCropBox(sizeLimited, positionLimited) {\n      var options = this.options,\n        containerData = this.containerData,\n        canvasData = this.canvasData,\n        cropBoxData = this.cropBoxData,\n        limited = this.limited;\n      var aspectRatio = options.aspectRatio;\n      if (sizeLimited) {\n        var minCropBoxWidth = Number(options.minCropBoxWidth) || 0;\n        var minCropBoxHeight = Number(options.minCropBoxHeight) || 0;\n        var maxCropBoxWidth = limited ? Math.min(containerData.width, canvasData.width, canvasData.width + canvasData.left, containerData.width - canvasData.left) : containerData.width;\n        var maxCropBoxHeight = limited ? Math.min(containerData.height, canvasData.height, canvasData.height + canvasData.top, containerData.height - canvasData.top) : containerData.height;\n\n        // The min/maxCropBoxWidth/Height must be less than container's width/height\n        minCropBoxWidth = Math.min(minCropBoxWidth, containerData.width);\n        minCropBoxHeight = Math.min(minCropBoxHeight, containerData.height);\n        if (aspectRatio) {\n          if (minCropBoxWidth && minCropBoxHeight) {\n            if (minCropBoxHeight * aspectRatio > minCropBoxWidth) {\n              minCropBoxHeight = minCropBoxWidth / aspectRatio;\n            } else {\n              minCropBoxWidth = minCropBoxHeight * aspectRatio;\n            }\n          } else if (minCropBoxWidth) {\n            minCropBoxHeight = minCropBoxWidth / aspectRatio;\n          } else if (minCropBoxHeight) {\n            minCropBoxWidth = minCropBoxHeight * aspectRatio;\n          }\n          if (maxCropBoxHeight * aspectRatio > maxCropBoxWidth) {\n            maxCropBoxHeight = maxCropBoxWidth / aspectRatio;\n          } else {\n            maxCropBoxWidth = maxCropBoxHeight * aspectRatio;\n          }\n        }\n\n        // The minWidth/Height must be less than maxWidth/Height\n        cropBoxData.minWidth = Math.min(minCropBoxWidth, maxCropBoxWidth);\n        cropBoxData.minHeight = Math.min(minCropBoxHeight, maxCropBoxHeight);\n        cropBoxData.maxWidth = maxCropBoxWidth;\n        cropBoxData.maxHeight = maxCropBoxHeight;\n      }\n      if (positionLimited) {\n        if (limited) {\n          cropBoxData.minLeft = Math.max(0, canvasData.left);\n          cropBoxData.minTop = Math.max(0, canvasData.top);\n          cropBoxData.maxLeft = Math.min(containerData.width, canvasData.left + canvasData.width) - cropBoxData.width;\n          cropBoxData.maxTop = Math.min(containerData.height, canvasData.top + canvasData.height) - cropBoxData.height;\n        } else {\n          cropBoxData.minLeft = 0;\n          cropBoxData.minTop = 0;\n          cropBoxData.maxLeft = containerData.width - cropBoxData.width;\n          cropBoxData.maxTop = containerData.height - cropBoxData.height;\n        }\n      }\n    },\n    renderCropBox: function renderCropBox() {\n      var options = this.options,\n        containerData = this.containerData,\n        cropBoxData = this.cropBoxData;\n      if (cropBoxData.width > cropBoxData.maxWidth || cropBoxData.width < cropBoxData.minWidth) {\n        cropBoxData.left = cropBoxData.oldLeft;\n      }\n      if (cropBoxData.height > cropBoxData.maxHeight || cropBoxData.height < cropBoxData.minHeight) {\n        cropBoxData.top = cropBoxData.oldTop;\n      }\n      cropBoxData.width = Math.min(Math.max(cropBoxData.width, cropBoxData.minWidth), cropBoxData.maxWidth);\n      cropBoxData.height = Math.min(Math.max(cropBoxData.height, cropBoxData.minHeight), cropBoxData.maxHeight);\n      this.limitCropBox(false, true);\n      cropBoxData.left = Math.min(Math.max(cropBoxData.left, cropBoxData.minLeft), cropBoxData.maxLeft);\n      cropBoxData.top = Math.min(Math.max(cropBoxData.top, cropBoxData.minTop), cropBoxData.maxTop);\n      cropBoxData.oldLeft = cropBoxData.left;\n      cropBoxData.oldTop = cropBoxData.top;\n      if (options.movable && options.cropBoxMovable) {\n        // Turn to move the canvas when the crop box is equal to the container\n        setData(this.face, DATA_ACTION, cropBoxData.width >= containerData.width && cropBoxData.height >= containerData.height ? ACTION_MOVE : ACTION_ALL);\n      }\n      setStyle(this.cropBox, assign({\n        width: cropBoxData.width,\n        height: cropBoxData.height\n      }, getTransforms({\n        translateX: cropBoxData.left,\n        translateY: cropBoxData.top\n      })));\n      if (this.cropped && this.limited) {\n        this.limitCanvas(true, true);\n      }\n      if (!this.disabled) {\n        this.output();\n      }\n    },\n    output: function output() {\n      this.preview();\n      dispatchEvent(this.element, EVENT_CROP, this.getData());\n    }\n  };\n\n  var preview = {\n    initPreview: function initPreview() {\n      var element = this.element,\n        crossOrigin = this.crossOrigin;\n      var preview = this.options.preview;\n      var url = crossOrigin ? this.crossOriginUrl : this.url;\n      var alt = element.alt || 'The image to preview';\n      var image = document.createElement('img');\n      if (crossOrigin) {\n        image.crossOrigin = crossOrigin;\n      }\n      image.src = url;\n      image.alt = alt;\n      this.viewBox.appendChild(image);\n      this.viewBoxImage = image;\n      if (!preview) {\n        return;\n      }\n      var previews = preview;\n      if (typeof preview === 'string') {\n        previews = element.ownerDocument.querySelectorAll(preview);\n      } else if (preview.querySelector) {\n        previews = [preview];\n      }\n      this.previews = previews;\n      forEach(previews, function (el) {\n        var img = document.createElement('img');\n\n        // Save the original size for recover\n        setData(el, DATA_PREVIEW, {\n          width: el.offsetWidth,\n          height: el.offsetHeight,\n          html: el.innerHTML\n        });\n        if (crossOrigin) {\n          img.crossOrigin = crossOrigin;\n        }\n        img.src = url;\n        img.alt = alt;\n\n        /**\n         * Override img element styles\n         * Add `display:block` to avoid margin top issue\n         * Add `height:auto` to override `height` attribute on IE8\n         * (Occur only when margin-top <= -height)\n         */\n        img.style.cssText = 'display:block;' + 'width:100%;' + 'height:auto;' + 'min-width:0!important;' + 'min-height:0!important;' + 'max-width:none!important;' + 'max-height:none!important;' + 'image-orientation:0deg!important;\"';\n        el.innerHTML = '';\n        el.appendChild(img);\n      });\n    },\n    resetPreview: function resetPreview() {\n      forEach(this.previews, function (element) {\n        var data = getData(element, DATA_PREVIEW);\n        setStyle(element, {\n          width: data.width,\n          height: data.height\n        });\n        element.innerHTML = data.html;\n        removeData(element, DATA_PREVIEW);\n      });\n    },\n    preview: function preview() {\n      var imageData = this.imageData,\n        canvasData = this.canvasData,\n        cropBoxData = this.cropBoxData;\n      var cropBoxWidth = cropBoxData.width,\n        cropBoxHeight = cropBoxData.height;\n      var width = imageData.width,\n        height = imageData.height;\n      var left = cropBoxData.left - canvasData.left - imageData.left;\n      var top = cropBoxData.top - canvasData.top - imageData.top;\n      if (!this.cropped || this.disabled) {\n        return;\n      }\n      setStyle(this.viewBoxImage, assign({\n        width: width,\n        height: height\n      }, getTransforms(assign({\n        translateX: -left,\n        translateY: -top\n      }, imageData))));\n      forEach(this.previews, function (element) {\n        var data = getData(element, DATA_PREVIEW);\n        var originalWidth = data.width;\n        var originalHeight = data.height;\n        var newWidth = originalWidth;\n        var newHeight = originalHeight;\n        var ratio = 1;\n        if (cropBoxWidth) {\n          ratio = originalWidth / cropBoxWidth;\n          newHeight = cropBoxHeight * ratio;\n        }\n        if (cropBoxHeight && newHeight > originalHeight) {\n          ratio = originalHeight / cropBoxHeight;\n          newWidth = cropBoxWidth * ratio;\n          newHeight = originalHeight;\n        }\n        setStyle(element, {\n          width: newWidth,\n          height: newHeight\n        });\n        setStyle(element.getElementsByTagName('img')[0], assign({\n          width: width * ratio,\n          height: height * ratio\n        }, getTransforms(assign({\n          translateX: -left * ratio,\n          translateY: -top * ratio\n        }, imageData))));\n      });\n    }\n  };\n\n  var events = {\n    bind: function bind() {\n      var element = this.element,\n        options = this.options,\n        cropper = this.cropper;\n      if (isFunction(options.cropstart)) {\n        addListener(element, EVENT_CROP_START, options.cropstart);\n      }\n      if (isFunction(options.cropmove)) {\n        addListener(element, EVENT_CROP_MOVE, options.cropmove);\n      }\n      if (isFunction(options.cropend)) {\n        addListener(element, EVENT_CROP_END, options.cropend);\n      }\n      if (isFunction(options.crop)) {\n        addListener(element, EVENT_CROP, options.crop);\n      }\n      if (isFunction(options.zoom)) {\n        addListener(element, EVENT_ZOOM, options.zoom);\n      }\n      addListener(cropper, EVENT_POINTER_DOWN, this.onCropStart = this.cropStart.bind(this));\n      if (options.zoomable && options.zoomOnWheel) {\n        addListener(cropper, EVENT_WHEEL, this.onWheel = this.wheel.bind(this), {\n          passive: false,\n          capture: true\n        });\n      }\n      if (options.toggleDragModeOnDblclick) {\n        addListener(cropper, EVENT_DBLCLICK, this.onDblclick = this.dblclick.bind(this));\n      }\n      addListener(element.ownerDocument, EVENT_POINTER_MOVE, this.onCropMove = this.cropMove.bind(this));\n      addListener(element.ownerDocument, EVENT_POINTER_UP, this.onCropEnd = this.cropEnd.bind(this));\n      if (options.responsive) {\n        addListener(window, EVENT_RESIZE, this.onResize = this.resize.bind(this));\n      }\n    },\n    unbind: function unbind() {\n      var element = this.element,\n        options = this.options,\n        cropper = this.cropper;\n      if (isFunction(options.cropstart)) {\n        removeListener(element, EVENT_CROP_START, options.cropstart);\n      }\n      if (isFunction(options.cropmove)) {\n        removeListener(element, EVENT_CROP_MOVE, options.cropmove);\n      }\n      if (isFunction(options.cropend)) {\n        removeListener(element, EVENT_CROP_END, options.cropend);\n      }\n      if (isFunction(options.crop)) {\n        removeListener(element, EVENT_CROP, options.crop);\n      }\n      if (isFunction(options.zoom)) {\n        removeListener(element, EVENT_ZOOM, options.zoom);\n      }\n      removeListener(cropper, EVENT_POINTER_DOWN, this.onCropStart);\n      if (options.zoomable && options.zoomOnWheel) {\n        removeListener(cropper, EVENT_WHEEL, this.onWheel, {\n          passive: false,\n          capture: true\n        });\n      }\n      if (options.toggleDragModeOnDblclick) {\n        removeListener(cropper, EVENT_DBLCLICK, this.onDblclick);\n      }\n      removeListener(element.ownerDocument, EVENT_POINTER_MOVE, this.onCropMove);\n      removeListener(element.ownerDocument, EVENT_POINTER_UP, this.onCropEnd);\n      if (options.responsive) {\n        removeListener(window, EVENT_RESIZE, this.onResize);\n      }\n    }\n  };\n\n  var handlers = {\n    resize: function resize() {\n      if (this.disabled) {\n        return;\n      }\n      var options = this.options,\n        container = this.container,\n        containerData = this.containerData;\n      var ratioX = container.offsetWidth / containerData.width;\n      var ratioY = container.offsetHeight / containerData.height;\n      var ratio = Math.abs(ratioX - 1) > Math.abs(ratioY - 1) ? ratioX : ratioY;\n\n      // Resize when width changed or height changed\n      if (ratio !== 1) {\n        var canvasData;\n        var cropBoxData;\n        if (options.restore) {\n          canvasData = this.getCanvasData();\n          cropBoxData = this.getCropBoxData();\n        }\n        this.render();\n        if (options.restore) {\n          this.setCanvasData(forEach(canvasData, function (n, i) {\n            canvasData[i] = n * ratio;\n          }));\n          this.setCropBoxData(forEach(cropBoxData, function (n, i) {\n            cropBoxData[i] = n * ratio;\n          }));\n        }\n      }\n    },\n    dblclick: function dblclick() {\n      if (this.disabled || this.options.dragMode === DRAG_MODE_NONE) {\n        return;\n      }\n      this.setDragMode(hasClass(this.dragBox, CLASS_CROP) ? DRAG_MODE_MOVE : DRAG_MODE_CROP);\n    },\n    wheel: function wheel(event) {\n      var _this = this;\n      var ratio = Number(this.options.wheelZoomRatio) || 0.1;\n      var delta = 1;\n      if (this.disabled) {\n        return;\n      }\n      event.preventDefault();\n\n      // Limit wheel speed to prevent zoom too fast (#21)\n      if (this.wheeling) {\n        return;\n      }\n      this.wheeling = true;\n      setTimeout(function () {\n        _this.wheeling = false;\n      }, 50);\n      if (event.deltaY) {\n        delta = event.deltaY > 0 ? 1 : -1;\n      } else if (event.wheelDelta) {\n        delta = -event.wheelDelta / 120;\n      } else if (event.detail) {\n        delta = event.detail > 0 ? 1 : -1;\n      }\n      this.zoom(-delta * ratio, event);\n    },\n    cropStart: function cropStart(event) {\n      var buttons = event.buttons,\n        button = event.button;\n      if (this.disabled\n\n      // Handle mouse event and pointer event and ignore touch event\n      || (event.type === 'mousedown' || event.type === 'pointerdown' && event.pointerType === 'mouse') && (\n      // No primary button (Usually the left button)\n      isNumber(buttons) && buttons !== 1 || isNumber(button) && button !== 0\n\n      // Open context menu\n      || event.ctrlKey)) {\n        return;\n      }\n      var options = this.options,\n        pointers = this.pointers;\n      var action;\n      if (event.changedTouches) {\n        // Handle touch event\n        forEach(event.changedTouches, function (touch) {\n          pointers[touch.identifier] = getPointer(touch);\n        });\n      } else {\n        // Handle mouse event and pointer event\n        pointers[event.pointerId || 0] = getPointer(event);\n      }\n      if (Object.keys(pointers).length > 1 && options.zoomable && options.zoomOnTouch) {\n        action = ACTION_ZOOM;\n      } else {\n        action = getData(event.target, DATA_ACTION);\n      }\n      if (!REGEXP_ACTIONS.test(action)) {\n        return;\n      }\n      if (dispatchEvent(this.element, EVENT_CROP_START, {\n        originalEvent: event,\n        action: action\n      }) === false) {\n        return;\n      }\n\n      // This line is required for preventing page zooming in iOS browsers\n      event.preventDefault();\n      this.action = action;\n      this.cropping = false;\n      if (action === ACTION_CROP) {\n        this.cropping = true;\n        addClass(this.dragBox, CLASS_MODAL);\n      }\n    },\n    cropMove: function cropMove(event) {\n      var action = this.action;\n      if (this.disabled || !action) {\n        return;\n      }\n      var pointers = this.pointers;\n      event.preventDefault();\n      if (dispatchEvent(this.element, EVENT_CROP_MOVE, {\n        originalEvent: event,\n        action: action\n      }) === false) {\n        return;\n      }\n      if (event.changedTouches) {\n        forEach(event.changedTouches, function (touch) {\n          // The first parameter should not be undefined (#432)\n          assign(pointers[touch.identifier] || {}, getPointer(touch, true));\n        });\n      } else {\n        assign(pointers[event.pointerId || 0] || {}, getPointer(event, true));\n      }\n      this.change(event);\n    },\n    cropEnd: function cropEnd(event) {\n      if (this.disabled) {\n        return;\n      }\n      var action = this.action,\n        pointers = this.pointers;\n      if (event.changedTouches) {\n        forEach(event.changedTouches, function (touch) {\n          delete pointers[touch.identifier];\n        });\n      } else {\n        delete pointers[event.pointerId || 0];\n      }\n      if (!action) {\n        return;\n      }\n      event.preventDefault();\n      if (!Object.keys(pointers).length) {\n        this.action = '';\n      }\n      if (this.cropping) {\n        this.cropping = false;\n        toggleClass(this.dragBox, CLASS_MODAL, this.cropped && this.options.modal);\n      }\n      dispatchEvent(this.element, EVENT_CROP_END, {\n        originalEvent: event,\n        action: action\n      });\n    }\n  };\n\n  var change = {\n    change: function change(event) {\n      var options = this.options,\n        canvasData = this.canvasData,\n        containerData = this.containerData,\n        cropBoxData = this.cropBoxData,\n        pointers = this.pointers;\n      var action = this.action;\n      var aspectRatio = options.aspectRatio;\n      var left = cropBoxData.left,\n        top = cropBoxData.top,\n        width = cropBoxData.width,\n        height = cropBoxData.height;\n      var right = left + width;\n      var bottom = top + height;\n      var minLeft = 0;\n      var minTop = 0;\n      var maxWidth = containerData.width;\n      var maxHeight = containerData.height;\n      var renderable = true;\n      var offset;\n\n      // Locking aspect ratio in \"free mode\" by holding shift key\n      if (!aspectRatio && event.shiftKey) {\n        aspectRatio = width && height ? width / height : 1;\n      }\n      if (this.limited) {\n        minLeft = cropBoxData.minLeft;\n        minTop = cropBoxData.minTop;\n        maxWidth = minLeft + Math.min(containerData.width, canvasData.width, canvasData.left + canvasData.width);\n        maxHeight = minTop + Math.min(containerData.height, canvasData.height, canvasData.top + canvasData.height);\n      }\n      var pointer = pointers[Object.keys(pointers)[0]];\n      var range = {\n        x: pointer.endX - pointer.startX,\n        y: pointer.endY - pointer.startY\n      };\n      var check = function check(side) {\n        switch (side) {\n          case ACTION_EAST:\n            if (right + range.x > maxWidth) {\n              range.x = maxWidth - right;\n            }\n            break;\n          case ACTION_WEST:\n            if (left + range.x < minLeft) {\n              range.x = minLeft - left;\n            }\n            break;\n          case ACTION_NORTH:\n            if (top + range.y < minTop) {\n              range.y = minTop - top;\n            }\n            break;\n          case ACTION_SOUTH:\n            if (bottom + range.y > maxHeight) {\n              range.y = maxHeight - bottom;\n            }\n            break;\n        }\n      };\n      switch (action) {\n        // Move crop box\n        case ACTION_ALL:\n          left += range.x;\n          top += range.y;\n          break;\n\n        // Resize crop box\n        case ACTION_EAST:\n          if (range.x >= 0 && (right >= maxWidth || aspectRatio && (top <= minTop || bottom >= maxHeight))) {\n            renderable = false;\n            break;\n          }\n          check(ACTION_EAST);\n          width += range.x;\n          if (width < 0) {\n            action = ACTION_WEST;\n            width = -width;\n            left -= width;\n          }\n          if (aspectRatio) {\n            height = width / aspectRatio;\n            top += (cropBoxData.height - height) / 2;\n          }\n          break;\n        case ACTION_NORTH:\n          if (range.y <= 0 && (top <= minTop || aspectRatio && (left <= minLeft || right >= maxWidth))) {\n            renderable = false;\n            break;\n          }\n          check(ACTION_NORTH);\n          height -= range.y;\n          top += range.y;\n          if (height < 0) {\n            action = ACTION_SOUTH;\n            height = -height;\n            top -= height;\n          }\n          if (aspectRatio) {\n            width = height * aspectRatio;\n            left += (cropBoxData.width - width) / 2;\n          }\n          break;\n        case ACTION_WEST:\n          if (range.x <= 0 && (left <= minLeft || aspectRatio && (top <= minTop || bottom >= maxHeight))) {\n            renderable = false;\n            break;\n          }\n          check(ACTION_WEST);\n          width -= range.x;\n          left += range.x;\n          if (width < 0) {\n            action = ACTION_EAST;\n            width = -width;\n            left -= width;\n          }\n          if (aspectRatio) {\n            height = width / aspectRatio;\n            top += (cropBoxData.height - height) / 2;\n          }\n          break;\n        case ACTION_SOUTH:\n          if (range.y >= 0 && (bottom >= maxHeight || aspectRatio && (left <= minLeft || right >= maxWidth))) {\n            renderable = false;\n            break;\n          }\n          check(ACTION_SOUTH);\n          height += range.y;\n          if (height < 0) {\n            action = ACTION_NORTH;\n            height = -height;\n            top -= height;\n          }\n          if (aspectRatio) {\n            width = height * aspectRatio;\n            left += (cropBoxData.width - width) / 2;\n          }\n          break;\n        case ACTION_NORTH_EAST:\n          if (aspectRatio) {\n            if (range.y <= 0 && (top <= minTop || right >= maxWidth)) {\n              renderable = false;\n              break;\n            }\n            check(ACTION_NORTH);\n            height -= range.y;\n            top += range.y;\n            width = height * aspectRatio;\n          } else {\n            check(ACTION_NORTH);\n            check(ACTION_EAST);\n            if (range.x >= 0) {\n              if (right < maxWidth) {\n                width += range.x;\n              } else if (range.y <= 0 && top <= minTop) {\n                renderable = false;\n              }\n            } else {\n              width += range.x;\n            }\n            if (range.y <= 0) {\n              if (top > minTop) {\n                height -= range.y;\n                top += range.y;\n              }\n            } else {\n              height -= range.y;\n              top += range.y;\n            }\n          }\n          if (width < 0 && height < 0) {\n            action = ACTION_SOUTH_WEST;\n            height = -height;\n            width = -width;\n            top -= height;\n            left -= width;\n          } else if (width < 0) {\n            action = ACTION_NORTH_WEST;\n            width = -width;\n            left -= width;\n          } else if (height < 0) {\n            action = ACTION_SOUTH_EAST;\n            height = -height;\n            top -= height;\n          }\n          break;\n        case ACTION_NORTH_WEST:\n          if (aspectRatio) {\n            if (range.y <= 0 && (top <= minTop || left <= minLeft)) {\n              renderable = false;\n              break;\n            }\n            check(ACTION_NORTH);\n            height -= range.y;\n            top += range.y;\n            width = height * aspectRatio;\n            left += cropBoxData.width - width;\n          } else {\n            check(ACTION_NORTH);\n            check(ACTION_WEST);\n            if (range.x <= 0) {\n              if (left > minLeft) {\n                width -= range.x;\n                left += range.x;\n              } else if (range.y <= 0 && top <= minTop) {\n                renderable = false;\n              }\n            } else {\n              width -= range.x;\n              left += range.x;\n            }\n            if (range.y <= 0) {\n              if (top > minTop) {\n                height -= range.y;\n                top += range.y;\n              }\n            } else {\n              height -= range.y;\n              top += range.y;\n            }\n          }\n          if (width < 0 && height < 0) {\n            action = ACTION_SOUTH_EAST;\n            height = -height;\n            width = -width;\n            top -= height;\n            left -= width;\n          } else if (width < 0) {\n            action = ACTION_NORTH_EAST;\n            width = -width;\n            left -= width;\n          } else if (height < 0) {\n            action = ACTION_SOUTH_WEST;\n            height = -height;\n            top -= height;\n          }\n          break;\n        case ACTION_SOUTH_WEST:\n          if (aspectRatio) {\n            if (range.x <= 0 && (left <= minLeft || bottom >= maxHeight)) {\n              renderable = false;\n              break;\n            }\n            check(ACTION_WEST);\n            width -= range.x;\n            left += range.x;\n            height = width / aspectRatio;\n          } else {\n            check(ACTION_SOUTH);\n            check(ACTION_WEST);\n            if (range.x <= 0) {\n              if (left > minLeft) {\n                width -= range.x;\n                left += range.x;\n              } else if (range.y >= 0 && bottom >= maxHeight) {\n                renderable = false;\n              }\n            } else {\n              width -= range.x;\n              left += range.x;\n            }\n            if (range.y >= 0) {\n              if (bottom < maxHeight) {\n                height += range.y;\n              }\n            } else {\n              height += range.y;\n            }\n          }\n          if (width < 0 && height < 0) {\n            action = ACTION_NORTH_EAST;\n            height = -height;\n            width = -width;\n            top -= height;\n            left -= width;\n          } else if (width < 0) {\n            action = ACTION_SOUTH_EAST;\n            width = -width;\n            left -= width;\n          } else if (height < 0) {\n            action = ACTION_NORTH_WEST;\n            height = -height;\n            top -= height;\n          }\n          break;\n        case ACTION_SOUTH_EAST:\n          if (aspectRatio) {\n            if (range.x >= 0 && (right >= maxWidth || bottom >= maxHeight)) {\n              renderable = false;\n              break;\n            }\n            check(ACTION_EAST);\n            width += range.x;\n            height = width / aspectRatio;\n          } else {\n            check(ACTION_SOUTH);\n            check(ACTION_EAST);\n            if (range.x >= 0) {\n              if (right < maxWidth) {\n                width += range.x;\n              } else if (range.y >= 0 && bottom >= maxHeight) {\n                renderable = false;\n              }\n            } else {\n              width += range.x;\n            }\n            if (range.y >= 0) {\n              if (bottom < maxHeight) {\n                height += range.y;\n              }\n            } else {\n              height += range.y;\n            }\n          }\n          if (width < 0 && height < 0) {\n            action = ACTION_NORTH_WEST;\n            height = -height;\n            width = -width;\n            top -= height;\n            left -= width;\n          } else if (width < 0) {\n            action = ACTION_SOUTH_WEST;\n            width = -width;\n            left -= width;\n          } else if (height < 0) {\n            action = ACTION_NORTH_EAST;\n            height = -height;\n            top -= height;\n          }\n          break;\n\n        // Move canvas\n        case ACTION_MOVE:\n          this.move(range.x, range.y);\n          renderable = false;\n          break;\n\n        // Zoom canvas\n        case ACTION_ZOOM:\n          this.zoom(getMaxZoomRatio(pointers), event);\n          renderable = false;\n          break;\n\n        // Create crop box\n        case ACTION_CROP:\n          if (!range.x || !range.y) {\n            renderable = false;\n            break;\n          }\n          offset = getOffset(this.cropper);\n          left = pointer.startX - offset.left;\n          top = pointer.startY - offset.top;\n          width = cropBoxData.minWidth;\n          height = cropBoxData.minHeight;\n          if (range.x > 0) {\n            action = range.y > 0 ? ACTION_SOUTH_EAST : ACTION_NORTH_EAST;\n          } else if (range.x < 0) {\n            left -= width;\n            action = range.y > 0 ? ACTION_SOUTH_WEST : ACTION_NORTH_WEST;\n          }\n          if (range.y < 0) {\n            top -= height;\n          }\n\n          // Show the crop box if is hidden\n          if (!this.cropped) {\n            removeClass(this.cropBox, CLASS_HIDDEN);\n            this.cropped = true;\n            if (this.limited) {\n              this.limitCropBox(true, true);\n            }\n          }\n          break;\n      }\n      if (renderable) {\n        cropBoxData.width = width;\n        cropBoxData.height = height;\n        cropBoxData.left = left;\n        cropBoxData.top = top;\n        this.action = action;\n        this.renderCropBox();\n      }\n\n      // Override\n      forEach(pointers, function (p) {\n        p.startX = p.endX;\n        p.startY = p.endY;\n      });\n    }\n  };\n\n  var methods = {\n    // Show the crop box manually\n    crop: function crop() {\n      if (this.ready && !this.cropped && !this.disabled) {\n        this.cropped = true;\n        this.limitCropBox(true, true);\n        if (this.options.modal) {\n          addClass(this.dragBox, CLASS_MODAL);\n        }\n        removeClass(this.cropBox, CLASS_HIDDEN);\n        this.setCropBoxData(this.initialCropBoxData);\n      }\n      return this;\n    },\n    // Reset the image and crop box to their initial states\n    reset: function reset() {\n      if (this.ready && !this.disabled) {\n        this.imageData = assign({}, this.initialImageData);\n        this.canvasData = assign({}, this.initialCanvasData);\n        this.cropBoxData = assign({}, this.initialCropBoxData);\n        this.renderCanvas();\n        if (this.cropped) {\n          this.renderCropBox();\n        }\n      }\n      return this;\n    },\n    // Clear the crop box\n    clear: function clear() {\n      if (this.cropped && !this.disabled) {\n        assign(this.cropBoxData, {\n          left: 0,\n          top: 0,\n          width: 0,\n          height: 0\n        });\n        this.cropped = false;\n        this.renderCropBox();\n        this.limitCanvas(true, true);\n\n        // Render canvas after crop box rendered\n        this.renderCanvas();\n        removeClass(this.dragBox, CLASS_MODAL);\n        addClass(this.cropBox, CLASS_HIDDEN);\n      }\n      return this;\n    },\n    /**\n     * Replace the image's src and rebuild the cropper\n     * @param {string} url - The new URL.\n     * @param {boolean} [hasSameSize] - Indicate if the new image has the same size as the old one.\n     * @returns {Cropper} this\n     */\n    replace: function replace(url) {\n      var hasSameSize = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!this.disabled && url) {\n        if (this.isImg) {\n          this.element.src = url;\n        }\n        if (hasSameSize) {\n          this.url = url;\n          this.image.src = url;\n          if (this.ready) {\n            this.viewBoxImage.src = url;\n            forEach(this.previews, function (element) {\n              element.getElementsByTagName('img')[0].src = url;\n            });\n          }\n        } else {\n          if (this.isImg) {\n            this.replaced = true;\n          }\n          this.options.data = null;\n          this.uncreate();\n          this.load(url);\n        }\n      }\n      return this;\n    },\n    // Enable (unfreeze) the cropper\n    enable: function enable() {\n      if (this.ready && this.disabled) {\n        this.disabled = false;\n        removeClass(this.cropper, CLASS_DISABLED);\n      }\n      return this;\n    },\n    // Disable (freeze) the cropper\n    disable: function disable() {\n      if (this.ready && !this.disabled) {\n        this.disabled = true;\n        addClass(this.cropper, CLASS_DISABLED);\n      }\n      return this;\n    },\n    /**\n     * Destroy the cropper and remove the instance from the image\n     * @returns {Cropper} this\n     */\n    destroy: function destroy() {\n      var element = this.element;\n      if (!element[NAMESPACE]) {\n        return this;\n      }\n      element[NAMESPACE] = undefined;\n      if (this.isImg && this.replaced) {\n        element.src = this.originalUrl;\n      }\n      this.uncreate();\n      return this;\n    },\n    /**\n     * Move the canvas with relative offsets\n     * @param {number} offsetX - The relative offset distance on the x-axis.\n     * @param {number} [offsetY=offsetX] - The relative offset distance on the y-axis.\n     * @returns {Cropper} this\n     */\n    move: function move(offsetX) {\n      var offsetY = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : offsetX;\n      var _this$canvasData = this.canvasData,\n        left = _this$canvasData.left,\n        top = _this$canvasData.top;\n      return this.moveTo(isUndefined(offsetX) ? offsetX : left + Number(offsetX), isUndefined(offsetY) ? offsetY : top + Number(offsetY));\n    },\n    /**\n     * Move the canvas to an absolute point\n     * @param {number} x - The x-axis coordinate.\n     * @param {number} [y=x] - The y-axis coordinate.\n     * @returns {Cropper} this\n     */\n    moveTo: function moveTo(x) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : x;\n      var canvasData = this.canvasData;\n      var changed = false;\n      x = Number(x);\n      y = Number(y);\n      if (this.ready && !this.disabled && this.options.movable) {\n        if (isNumber(x)) {\n          canvasData.left = x;\n          changed = true;\n        }\n        if (isNumber(y)) {\n          canvasData.top = y;\n          changed = true;\n        }\n        if (changed) {\n          this.renderCanvas(true);\n        }\n      }\n      return this;\n    },\n    /**\n     * Zoom the canvas with a relative ratio\n     * @param {number} ratio - The target ratio.\n     * @param {Event} _originalEvent - The original event if any.\n     * @returns {Cropper} this\n     */\n    zoom: function zoom(ratio, _originalEvent) {\n      var canvasData = this.canvasData;\n      ratio = Number(ratio);\n      if (ratio < 0) {\n        ratio = 1 / (1 - ratio);\n      } else {\n        ratio = 1 + ratio;\n      }\n      return this.zoomTo(canvasData.width * ratio / canvasData.naturalWidth, null, _originalEvent);\n    },\n    /**\n     * Zoom the canvas to an absolute ratio\n     * @param {number} ratio - The target ratio.\n     * @param {Object} pivot - The zoom pivot point coordinate.\n     * @param {Event} _originalEvent - The original event if any.\n     * @returns {Cropper} this\n     */\n    zoomTo: function zoomTo(ratio, pivot, _originalEvent) {\n      var options = this.options,\n        canvasData = this.canvasData;\n      var width = canvasData.width,\n        height = canvasData.height,\n        naturalWidth = canvasData.naturalWidth,\n        naturalHeight = canvasData.naturalHeight;\n      ratio = Number(ratio);\n      if (ratio >= 0 && this.ready && !this.disabled && options.zoomable) {\n        var newWidth = naturalWidth * ratio;\n        var newHeight = naturalHeight * ratio;\n        if (dispatchEvent(this.element, EVENT_ZOOM, {\n          ratio: ratio,\n          oldRatio: width / naturalWidth,\n          originalEvent: _originalEvent\n        }) === false) {\n          return this;\n        }\n        if (_originalEvent) {\n          var pointers = this.pointers;\n          var offset = getOffset(this.cropper);\n          var center = pointers && Object.keys(pointers).length ? getPointersCenter(pointers) : {\n            pageX: _originalEvent.pageX,\n            pageY: _originalEvent.pageY\n          };\n\n          // Zoom from the triggering point of the event\n          canvasData.left -= (newWidth - width) * ((center.pageX - offset.left - canvasData.left) / width);\n          canvasData.top -= (newHeight - height) * ((center.pageY - offset.top - canvasData.top) / height);\n        } else if (isPlainObject(pivot) && isNumber(pivot.x) && isNumber(pivot.y)) {\n          canvasData.left -= (newWidth - width) * ((pivot.x - canvasData.left) / width);\n          canvasData.top -= (newHeight - height) * ((pivot.y - canvasData.top) / height);\n        } else {\n          // Zoom from the center of the canvas\n          canvasData.left -= (newWidth - width) / 2;\n          canvasData.top -= (newHeight - height) / 2;\n        }\n        canvasData.width = newWidth;\n        canvasData.height = newHeight;\n        this.renderCanvas(true);\n      }\n      return this;\n    },\n    /**\n     * Rotate the canvas with a relative degree\n     * @param {number} degree - The rotate degree.\n     * @returns {Cropper} this\n     */\n    rotate: function rotate(degree) {\n      return this.rotateTo((this.imageData.rotate || 0) + Number(degree));\n    },\n    /**\n     * Rotate the canvas to an absolute degree\n     * @param {number} degree - The rotate degree.\n     * @returns {Cropper} this\n     */\n    rotateTo: function rotateTo(degree) {\n      degree = Number(degree);\n      if (isNumber(degree) && this.ready && !this.disabled && this.options.rotatable) {\n        this.imageData.rotate = degree % 360;\n        this.renderCanvas(true, true);\n      }\n      return this;\n    },\n    /**\n     * Scale the image on the x-axis.\n     * @param {number} scaleX - The scale ratio on the x-axis.\n     * @returns {Cropper} this\n     */\n    scaleX: function scaleX(_scaleX) {\n      var scaleY = this.imageData.scaleY;\n      return this.scale(_scaleX, isNumber(scaleY) ? scaleY : 1);\n    },\n    /**\n     * Scale the image on the y-axis.\n     * @param {number} scaleY - The scale ratio on the y-axis.\n     * @returns {Cropper} this\n     */\n    scaleY: function scaleY(_scaleY) {\n      var scaleX = this.imageData.scaleX;\n      return this.scale(isNumber(scaleX) ? scaleX : 1, _scaleY);\n    },\n    /**\n     * Scale the image\n     * @param {number} scaleX - The scale ratio on the x-axis.\n     * @param {number} [scaleY=scaleX] - The scale ratio on the y-axis.\n     * @returns {Cropper} this\n     */\n    scale: function scale(scaleX) {\n      var scaleY = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : scaleX;\n      var imageData = this.imageData;\n      var transformed = false;\n      scaleX = Number(scaleX);\n      scaleY = Number(scaleY);\n      if (this.ready && !this.disabled && this.options.scalable) {\n        if (isNumber(scaleX)) {\n          imageData.scaleX = scaleX;\n          transformed = true;\n        }\n        if (isNumber(scaleY)) {\n          imageData.scaleY = scaleY;\n          transformed = true;\n        }\n        if (transformed) {\n          this.renderCanvas(true, true);\n        }\n      }\n      return this;\n    },\n    /**\n     * Get the cropped area position and size data (base on the original image)\n     * @param {boolean} [rounded=false] - Indicate if round the data values or not.\n     * @returns {Object} The result cropped data.\n     */\n    getData: function getData() {\n      var rounded = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      var options = this.options,\n        imageData = this.imageData,\n        canvasData = this.canvasData,\n        cropBoxData = this.cropBoxData;\n      var data;\n      if (this.ready && this.cropped) {\n        data = {\n          x: cropBoxData.left - canvasData.left,\n          y: cropBoxData.top - canvasData.top,\n          width: cropBoxData.width,\n          height: cropBoxData.height\n        };\n        var ratio = imageData.width / imageData.naturalWidth;\n        forEach(data, function (n, i) {\n          data[i] = n / ratio;\n        });\n        if (rounded) {\n          // In case rounding off leads to extra 1px in right or bottom border\n          // we should round the top-left corner and the dimension (#343).\n          var bottom = Math.round(data.y + data.height);\n          var right = Math.round(data.x + data.width);\n          data.x = Math.round(data.x);\n          data.y = Math.round(data.y);\n          data.width = right - data.x;\n          data.height = bottom - data.y;\n        }\n      } else {\n        data = {\n          x: 0,\n          y: 0,\n          width: 0,\n          height: 0\n        };\n      }\n      if (options.rotatable) {\n        data.rotate = imageData.rotate || 0;\n      }\n      if (options.scalable) {\n        data.scaleX = imageData.scaleX || 1;\n        data.scaleY = imageData.scaleY || 1;\n      }\n      return data;\n    },\n    /**\n     * Set the cropped area position and size with new data\n     * @param {Object} data - The new data.\n     * @returns {Cropper} this\n     */\n    setData: function setData(data) {\n      var options = this.options,\n        imageData = this.imageData,\n        canvasData = this.canvasData;\n      var cropBoxData = {};\n      if (this.ready && !this.disabled && isPlainObject(data)) {\n        var transformed = false;\n        if (options.rotatable) {\n          if (isNumber(data.rotate) && data.rotate !== imageData.rotate) {\n            imageData.rotate = data.rotate;\n            transformed = true;\n          }\n        }\n        if (options.scalable) {\n          if (isNumber(data.scaleX) && data.scaleX !== imageData.scaleX) {\n            imageData.scaleX = data.scaleX;\n            transformed = true;\n          }\n          if (isNumber(data.scaleY) && data.scaleY !== imageData.scaleY) {\n            imageData.scaleY = data.scaleY;\n            transformed = true;\n          }\n        }\n        if (transformed) {\n          this.renderCanvas(true, true);\n        }\n        var ratio = imageData.width / imageData.naturalWidth;\n        if (isNumber(data.x)) {\n          cropBoxData.left = data.x * ratio + canvasData.left;\n        }\n        if (isNumber(data.y)) {\n          cropBoxData.top = data.y * ratio + canvasData.top;\n        }\n        if (isNumber(data.width)) {\n          cropBoxData.width = data.width * ratio;\n        }\n        if (isNumber(data.height)) {\n          cropBoxData.height = data.height * ratio;\n        }\n        this.setCropBoxData(cropBoxData);\n      }\n      return this;\n    },\n    /**\n     * Get the container size data.\n     * @returns {Object} The result container data.\n     */\n    getContainerData: function getContainerData() {\n      return this.ready ? assign({}, this.containerData) : {};\n    },\n    /**\n     * Get the image position and size data.\n     * @returns {Object} The result image data.\n     */\n    getImageData: function getImageData() {\n      return this.sized ? assign({}, this.imageData) : {};\n    },\n    /**\n     * Get the canvas position and size data.\n     * @returns {Object} The result canvas data.\n     */\n    getCanvasData: function getCanvasData() {\n      var canvasData = this.canvasData;\n      var data = {};\n      if (this.ready) {\n        forEach(['left', 'top', 'width', 'height', 'naturalWidth', 'naturalHeight'], function (n) {\n          data[n] = canvasData[n];\n        });\n      }\n      return data;\n    },\n    /**\n     * Set the canvas position and size with new data.\n     * @param {Object} data - The new canvas data.\n     * @returns {Cropper} this\n     */\n    setCanvasData: function setCanvasData(data) {\n      var canvasData = this.canvasData;\n      var aspectRatio = canvasData.aspectRatio;\n      if (this.ready && !this.disabled && isPlainObject(data)) {\n        if (isNumber(data.left)) {\n          canvasData.left = data.left;\n        }\n        if (isNumber(data.top)) {\n          canvasData.top = data.top;\n        }\n        if (isNumber(data.width)) {\n          canvasData.width = data.width;\n          canvasData.height = data.width / aspectRatio;\n        } else if (isNumber(data.height)) {\n          canvasData.height = data.height;\n          canvasData.width = data.height * aspectRatio;\n        }\n        this.renderCanvas(true);\n      }\n      return this;\n    },\n    /**\n     * Get the crop box position and size data.\n     * @returns {Object} The result crop box data.\n     */\n    getCropBoxData: function getCropBoxData() {\n      var cropBoxData = this.cropBoxData;\n      var data;\n      if (this.ready && this.cropped) {\n        data = {\n          left: cropBoxData.left,\n          top: cropBoxData.top,\n          width: cropBoxData.width,\n          height: cropBoxData.height\n        };\n      }\n      return data || {};\n    },\n    /**\n     * Set the crop box position and size with new data.\n     * @param {Object} data - The new crop box data.\n     * @returns {Cropper} this\n     */\n    setCropBoxData: function setCropBoxData(data) {\n      var cropBoxData = this.cropBoxData;\n      var aspectRatio = this.options.aspectRatio;\n      var widthChanged;\n      var heightChanged;\n      if (this.ready && this.cropped && !this.disabled && isPlainObject(data)) {\n        if (isNumber(data.left)) {\n          cropBoxData.left = data.left;\n        }\n        if (isNumber(data.top)) {\n          cropBoxData.top = data.top;\n        }\n        if (isNumber(data.width) && data.width !== cropBoxData.width) {\n          widthChanged = true;\n          cropBoxData.width = data.width;\n        }\n        if (isNumber(data.height) && data.height !== cropBoxData.height) {\n          heightChanged = true;\n          cropBoxData.height = data.height;\n        }\n        if (aspectRatio) {\n          if (widthChanged) {\n            cropBoxData.height = cropBoxData.width / aspectRatio;\n          } else if (heightChanged) {\n            cropBoxData.width = cropBoxData.height * aspectRatio;\n          }\n        }\n        this.renderCropBox();\n      }\n      return this;\n    },\n    /**\n     * Get a canvas drawn the cropped image.\n     * @param {Object} [options={}] - The config options.\n     * @returns {HTMLCanvasElement} - The result canvas.\n     */\n    getCroppedCanvas: function getCroppedCanvas() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (!this.ready || !window.HTMLCanvasElement) {\n        return null;\n      }\n      var canvasData = this.canvasData;\n      var source = getSourceCanvas(this.image, this.imageData, canvasData, options);\n\n      // Returns the source canvas if it is not cropped.\n      if (!this.cropped) {\n        return source;\n      }\n      var _this$getData = this.getData(options.rounded),\n        initialX = _this$getData.x,\n        initialY = _this$getData.y,\n        initialWidth = _this$getData.width,\n        initialHeight = _this$getData.height;\n      var ratio = source.width / Math.floor(canvasData.naturalWidth);\n      if (ratio !== 1) {\n        initialX *= ratio;\n        initialY *= ratio;\n        initialWidth *= ratio;\n        initialHeight *= ratio;\n      }\n      var aspectRatio = initialWidth / initialHeight;\n      var maxSizes = getAdjustedSizes({\n        aspectRatio: aspectRatio,\n        width: options.maxWidth || Infinity,\n        height: options.maxHeight || Infinity\n      });\n      var minSizes = getAdjustedSizes({\n        aspectRatio: aspectRatio,\n        width: options.minWidth || 0,\n        height: options.minHeight || 0\n      }, 'cover');\n      var _getAdjustedSizes = getAdjustedSizes({\n          aspectRatio: aspectRatio,\n          width: options.width || (ratio !== 1 ? source.width : initialWidth),\n          height: options.height || (ratio !== 1 ? source.height : initialHeight)\n        }),\n        width = _getAdjustedSizes.width,\n        height = _getAdjustedSizes.height;\n      width = Math.min(maxSizes.width, Math.max(minSizes.width, width));\n      height = Math.min(maxSizes.height, Math.max(minSizes.height, height));\n      var canvas = document.createElement('canvas');\n      var context = canvas.getContext('2d');\n      canvas.width = normalizeDecimalNumber(width);\n      canvas.height = normalizeDecimalNumber(height);\n      context.fillStyle = options.fillColor || 'transparent';\n      context.fillRect(0, 0, width, height);\n      var _options$imageSmoothi = options.imageSmoothingEnabled,\n        imageSmoothingEnabled = _options$imageSmoothi === void 0 ? true : _options$imageSmoothi,\n        imageSmoothingQuality = options.imageSmoothingQuality;\n      context.imageSmoothingEnabled = imageSmoothingEnabled;\n      if (imageSmoothingQuality) {\n        context.imageSmoothingQuality = imageSmoothingQuality;\n      }\n\n      // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D.drawImage\n      var sourceWidth = source.width;\n      var sourceHeight = source.height;\n\n      // Source canvas parameters\n      var srcX = initialX;\n      var srcY = initialY;\n      var srcWidth;\n      var srcHeight;\n\n      // Destination canvas parameters\n      var dstX;\n      var dstY;\n      var dstWidth;\n      var dstHeight;\n      if (srcX <= -initialWidth || srcX > sourceWidth) {\n        srcX = 0;\n        srcWidth = 0;\n        dstX = 0;\n        dstWidth = 0;\n      } else if (srcX <= 0) {\n        dstX = -srcX;\n        srcX = 0;\n        srcWidth = Math.min(sourceWidth, initialWidth + srcX);\n        dstWidth = srcWidth;\n      } else if (srcX <= sourceWidth) {\n        dstX = 0;\n        srcWidth = Math.min(initialWidth, sourceWidth - srcX);\n        dstWidth = srcWidth;\n      }\n      if (srcWidth <= 0 || srcY <= -initialHeight || srcY > sourceHeight) {\n        srcY = 0;\n        srcHeight = 0;\n        dstY = 0;\n        dstHeight = 0;\n      } else if (srcY <= 0) {\n        dstY = -srcY;\n        srcY = 0;\n        srcHeight = Math.min(sourceHeight, initialHeight + srcY);\n        dstHeight = srcHeight;\n      } else if (srcY <= sourceHeight) {\n        dstY = 0;\n        srcHeight = Math.min(initialHeight, sourceHeight - srcY);\n        dstHeight = srcHeight;\n      }\n      var params = [srcX, srcY, srcWidth, srcHeight];\n\n      // Avoid \"IndexSizeError\"\n      if (dstWidth > 0 && dstHeight > 0) {\n        var scale = width / initialWidth;\n        params.push(dstX * scale, dstY * scale, dstWidth * scale, dstHeight * scale);\n      }\n\n      // All the numerical parameters should be integer for `drawImage`\n      // https://github.com/fengyuanchen/cropper/issues/476\n      context.drawImage.apply(context, [source].concat(_toConsumableArray(params.map(function (param) {\n        return Math.floor(normalizeDecimalNumber(param));\n      }))));\n      return canvas;\n    },\n    /**\n     * Change the aspect ratio of the crop box.\n     * @param {number} aspectRatio - The new aspect ratio.\n     * @returns {Cropper} this\n     */\n    setAspectRatio: function setAspectRatio(aspectRatio) {\n      var options = this.options;\n      if (!this.disabled && !isUndefined(aspectRatio)) {\n        // 0 -> NaN\n        options.aspectRatio = Math.max(0, aspectRatio) || NaN;\n        if (this.ready) {\n          this.initCropBox();\n          if (this.cropped) {\n            this.renderCropBox();\n          }\n        }\n      }\n      return this;\n    },\n    /**\n     * Change the drag mode.\n     * @param {string} mode - The new drag mode.\n     * @returns {Cropper} this\n     */\n    setDragMode: function setDragMode(mode) {\n      var options = this.options,\n        dragBox = this.dragBox,\n        face = this.face;\n      if (this.ready && !this.disabled) {\n        var croppable = mode === DRAG_MODE_CROP;\n        var movable = options.movable && mode === DRAG_MODE_MOVE;\n        mode = croppable || movable ? mode : DRAG_MODE_NONE;\n        options.dragMode = mode;\n        setData(dragBox, DATA_ACTION, mode);\n        toggleClass(dragBox, CLASS_CROP, croppable);\n        toggleClass(dragBox, CLASS_MOVE, movable);\n        if (!options.cropBoxMovable) {\n          // Sync drag mode to crop box when it is not movable\n          setData(face, DATA_ACTION, mode);\n          toggleClass(face, CLASS_CROP, croppable);\n          toggleClass(face, CLASS_MOVE, movable);\n        }\n      }\n      return this;\n    }\n  };\n\n  var AnotherCropper = WINDOW.Cropper;\n  var Cropper = /*#__PURE__*/function () {\n    /**\n     * Create a new Cropper.\n     * @param {Element} element - The target element for cropping.\n     * @param {Object} [options={}] - The configuration options.\n     */\n    function Cropper(element) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      _classCallCheck(this, Cropper);\n      if (!element || !REGEXP_TAG_NAME.test(element.tagName)) {\n        throw new Error('The first argument is required and must be an <img> or <canvas> element.');\n      }\n      this.element = element;\n      this.options = assign({}, DEFAULTS, isPlainObject(options) && options);\n      this.cropped = false;\n      this.disabled = false;\n      this.pointers = {};\n      this.ready = false;\n      this.reloading = false;\n      this.replaced = false;\n      this.sized = false;\n      this.sizing = false;\n      this.init();\n    }\n    _createClass(Cropper, [{\n      key: \"init\",\n      value: function init() {\n        var element = this.element;\n        var tagName = element.tagName.toLowerCase();\n        var url;\n        if (element[NAMESPACE]) {\n          return;\n        }\n        element[NAMESPACE] = this;\n        if (tagName === 'img') {\n          this.isImg = true;\n\n          // e.g.: \"img/picture.jpg\"\n          url = element.getAttribute('src') || '';\n          this.originalUrl = url;\n\n          // Stop when it's a blank image\n          if (!url) {\n            return;\n          }\n\n          // e.g.: \"https://example.com/img/picture.jpg\"\n          url = element.src;\n        } else if (tagName === 'canvas' && window.HTMLCanvasElement) {\n          url = element.toDataURL();\n        }\n        this.load(url);\n      }\n    }, {\n      key: \"load\",\n      value: function load(url) {\n        var _this = this;\n        if (!url) {\n          return;\n        }\n        this.url = url;\n        this.imageData = {};\n        var element = this.element,\n          options = this.options;\n        if (!options.rotatable && !options.scalable) {\n          options.checkOrientation = false;\n        }\n\n        // Only IE10+ supports Typed Arrays\n        if (!options.checkOrientation || !window.ArrayBuffer) {\n          this.clone();\n          return;\n        }\n\n        // Detect the mime type of the image directly if it is a Data URL\n        if (REGEXP_DATA_URL.test(url)) {\n          // Read ArrayBuffer from Data URL of JPEG images directly for better performance\n          if (REGEXP_DATA_URL_JPEG.test(url)) {\n            this.read(dataURLToArrayBuffer(url));\n          } else {\n            // Only a JPEG image may contains Exif Orientation information,\n            // the rest types of Data URLs are not necessary to check orientation at all.\n            this.clone();\n          }\n          return;\n        }\n\n        // 1. Detect the mime type of the image by a XMLHttpRequest.\n        // 2. Load the image as ArrayBuffer for reading orientation if its a JPEG image.\n        var xhr = new XMLHttpRequest();\n        var clone = this.clone.bind(this);\n        this.reloading = true;\n        this.xhr = xhr;\n\n        // 1. Cross origin requests are only supported for protocol schemes:\n        // http, https, data, chrome, chrome-extension.\n        // 2. Access to XMLHttpRequest from a Data URL will be blocked by CORS policy\n        // in some browsers as IE11 and Safari.\n        xhr.onabort = clone;\n        xhr.onerror = clone;\n        xhr.ontimeout = clone;\n        xhr.onprogress = function () {\n          // Abort the request directly if it not a JPEG image for better performance\n          if (xhr.getResponseHeader('content-type') !== MIME_TYPE_JPEG) {\n            xhr.abort();\n          }\n        };\n        xhr.onload = function () {\n          _this.read(xhr.response);\n        };\n        xhr.onloadend = function () {\n          _this.reloading = false;\n          _this.xhr = null;\n        };\n\n        // Bust cache when there is a \"crossOrigin\" property to avoid browser cache error\n        if (options.checkCrossOrigin && isCrossOriginURL(url) && element.crossOrigin) {\n          url = addTimestamp(url);\n        }\n\n        // The third parameter is required for avoiding side-effect (#682)\n        xhr.open('GET', url, true);\n        xhr.responseType = 'arraybuffer';\n        xhr.withCredentials = element.crossOrigin === 'use-credentials';\n        xhr.send();\n      }\n    }, {\n      key: \"read\",\n      value: function read(arrayBuffer) {\n        var options = this.options,\n          imageData = this.imageData;\n\n        // Reset the orientation value to its default value 1\n        // as some iOS browsers will render image with its orientation\n        var orientation = resetAndGetOrientation(arrayBuffer);\n        var rotate = 0;\n        var scaleX = 1;\n        var scaleY = 1;\n        if (orientation > 1) {\n          // Generate a new URL which has the default orientation value\n          this.url = arrayBufferToDataURL(arrayBuffer, MIME_TYPE_JPEG);\n          var _parseOrientation = parseOrientation(orientation);\n          rotate = _parseOrientation.rotate;\n          scaleX = _parseOrientation.scaleX;\n          scaleY = _parseOrientation.scaleY;\n        }\n        if (options.rotatable) {\n          imageData.rotate = rotate;\n        }\n        if (options.scalable) {\n          imageData.scaleX = scaleX;\n          imageData.scaleY = scaleY;\n        }\n        this.clone();\n      }\n    }, {\n      key: \"clone\",\n      value: function clone() {\n        var element = this.element,\n          url = this.url;\n        var crossOrigin = element.crossOrigin;\n        var crossOriginUrl = url;\n        if (this.options.checkCrossOrigin && isCrossOriginURL(url)) {\n          if (!crossOrigin) {\n            crossOrigin = 'anonymous';\n          }\n\n          // Bust cache when there is not a \"crossOrigin\" property (#519)\n          crossOriginUrl = addTimestamp(url);\n        }\n        this.crossOrigin = crossOrigin;\n        this.crossOriginUrl = crossOriginUrl;\n        var image = document.createElement('img');\n        if (crossOrigin) {\n          image.crossOrigin = crossOrigin;\n        }\n        image.src = crossOriginUrl || url;\n        image.alt = element.alt || 'The image to crop';\n        this.image = image;\n        image.onload = this.start.bind(this);\n        image.onerror = this.stop.bind(this);\n        addClass(image, CLASS_HIDE);\n        element.parentNode.insertBefore(image, element.nextSibling);\n      }\n    }, {\n      key: \"start\",\n      value: function start() {\n        var _this2 = this;\n        var image = this.image;\n        image.onload = null;\n        image.onerror = null;\n        this.sizing = true;\n\n        // Match all browsers that use WebKit as the layout engine in iOS devices,\n        // such as Safari for iOS, Chrome for iOS, and in-app browsers.\n        var isIOSWebKit = WINDOW.navigator && /(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent);\n        var done = function done(naturalWidth, naturalHeight) {\n          assign(_this2.imageData, {\n            naturalWidth: naturalWidth,\n            naturalHeight: naturalHeight,\n            aspectRatio: naturalWidth / naturalHeight\n          });\n          _this2.initialImageData = assign({}, _this2.imageData);\n          _this2.sizing = false;\n          _this2.sized = true;\n          _this2.build();\n        };\n\n        // Most modern browsers (excepts iOS WebKit)\n        if (image.naturalWidth && !isIOSWebKit) {\n          done(image.naturalWidth, image.naturalHeight);\n          return;\n        }\n        var sizingImage = document.createElement('img');\n        var body = document.body || document.documentElement;\n        this.sizingImage = sizingImage;\n        sizingImage.onload = function () {\n          done(sizingImage.width, sizingImage.height);\n          if (!isIOSWebKit) {\n            body.removeChild(sizingImage);\n          }\n        };\n        sizingImage.src = image.src;\n\n        // iOS WebKit will convert the image automatically\n        // with its orientation once append it into DOM (#279)\n        if (!isIOSWebKit) {\n          sizingImage.style.cssText = 'left:0;' + 'max-height:none!important;' + 'max-width:none!important;' + 'min-height:0!important;' + 'min-width:0!important;' + 'opacity:0;' + 'position:absolute;' + 'top:0;' + 'z-index:-1;';\n          body.appendChild(sizingImage);\n        }\n      }\n    }, {\n      key: \"stop\",\n      value: function stop() {\n        var image = this.image;\n        image.onload = null;\n        image.onerror = null;\n        image.parentNode.removeChild(image);\n        this.image = null;\n      }\n    }, {\n      key: \"build\",\n      value: function build() {\n        if (!this.sized || this.ready) {\n          return;\n        }\n        var element = this.element,\n          options = this.options,\n          image = this.image;\n\n        // Create cropper elements\n        var container = element.parentNode;\n        var template = document.createElement('div');\n        template.innerHTML = TEMPLATE;\n        var cropper = template.querySelector(\".\".concat(NAMESPACE, \"-container\"));\n        var canvas = cropper.querySelector(\".\".concat(NAMESPACE, \"-canvas\"));\n        var dragBox = cropper.querySelector(\".\".concat(NAMESPACE, \"-drag-box\"));\n        var cropBox = cropper.querySelector(\".\".concat(NAMESPACE, \"-crop-box\"));\n        var face = cropBox.querySelector(\".\".concat(NAMESPACE, \"-face\"));\n        this.container = container;\n        this.cropper = cropper;\n        this.canvas = canvas;\n        this.dragBox = dragBox;\n        this.cropBox = cropBox;\n        this.viewBox = cropper.querySelector(\".\".concat(NAMESPACE, \"-view-box\"));\n        this.face = face;\n        canvas.appendChild(image);\n\n        // Hide the original image\n        addClass(element, CLASS_HIDDEN);\n\n        // Inserts the cropper after to the current image\n        container.insertBefore(cropper, element.nextSibling);\n\n        // Show the hidden image\n        removeClass(image, CLASS_HIDE);\n        this.initPreview();\n        this.bind();\n        options.initialAspectRatio = Math.max(0, options.initialAspectRatio) || NaN;\n        options.aspectRatio = Math.max(0, options.aspectRatio) || NaN;\n        options.viewMode = Math.max(0, Math.min(3, Math.round(options.viewMode))) || 0;\n        addClass(cropBox, CLASS_HIDDEN);\n        if (!options.guides) {\n          addClass(cropBox.getElementsByClassName(\"\".concat(NAMESPACE, \"-dashed\")), CLASS_HIDDEN);\n        }\n        if (!options.center) {\n          addClass(cropBox.getElementsByClassName(\"\".concat(NAMESPACE, \"-center\")), CLASS_HIDDEN);\n        }\n        if (options.background) {\n          addClass(cropper, \"\".concat(NAMESPACE, \"-bg\"));\n        }\n        if (!options.highlight) {\n          addClass(face, CLASS_INVISIBLE);\n        }\n        if (options.cropBoxMovable) {\n          addClass(face, CLASS_MOVE);\n          setData(face, DATA_ACTION, ACTION_ALL);\n        }\n        if (!options.cropBoxResizable) {\n          addClass(cropBox.getElementsByClassName(\"\".concat(NAMESPACE, \"-line\")), CLASS_HIDDEN);\n          addClass(cropBox.getElementsByClassName(\"\".concat(NAMESPACE, \"-point\")), CLASS_HIDDEN);\n        }\n        this.render();\n        this.ready = true;\n        this.setDragMode(options.dragMode);\n        if (options.autoCrop) {\n          this.crop();\n        }\n        this.setData(options.data);\n        if (isFunction(options.ready)) {\n          addListener(element, EVENT_READY, options.ready, {\n            once: true\n          });\n        }\n        dispatchEvent(element, EVENT_READY);\n      }\n    }, {\n      key: \"unbuild\",\n      value: function unbuild() {\n        if (!this.ready) {\n          return;\n        }\n        this.ready = false;\n        this.unbind();\n        this.resetPreview();\n        var parentNode = this.cropper.parentNode;\n        if (parentNode) {\n          parentNode.removeChild(this.cropper);\n        }\n        removeClass(this.element, CLASS_HIDDEN);\n      }\n    }, {\n      key: \"uncreate\",\n      value: function uncreate() {\n        if (this.ready) {\n          this.unbuild();\n          this.ready = false;\n          this.cropped = false;\n        } else if (this.sizing) {\n          this.sizingImage.onload = null;\n          this.sizing = false;\n          this.sized = false;\n        } else if (this.reloading) {\n          this.xhr.onabort = null;\n          this.xhr.abort();\n        } else if (this.image) {\n          this.stop();\n        }\n      }\n\n      /**\n       * Get the no conflict cropper class.\n       * @returns {Cropper} The cropper class.\n       */\n    }], [{\n      key: \"noConflict\",\n      value: function noConflict() {\n        window.Cropper = AnotherCropper;\n        return Cropper;\n      }\n\n      /**\n       * Change the default options.\n       * @param {Object} options - The new default options.\n       */\n    }, {\n      key: \"setDefaults\",\n      value: function setDefaults(options) {\n        assign(DEFAULTS, isPlainObject(options) && options);\n      }\n    }]);\n    return Cropper;\n  }();\n  assign(Cropper.prototype, render, preview, events, handlers, change, methods);\n\n  return Cropper;\n\n}));\n", "/*!\n\npica\nhttps://github.com/nodeca/pica\n\n*/\n\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.pica = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(_dereq_,module,exports){\n// Collection of math functions\n//\n// 1. Combine components together\n// 2. Has async init to load wasm modules\n//\n'use strict';\n\nvar Multimath = _dereq_('multimath');\n\nvar mm_unsharp_mask = _dereq_('./mm_unsharp_mask');\n\nvar mm_resize = _dereq_('./mm_resize');\n\nfunction MathLib(requested_features) {\n  var __requested_features = requested_features || [];\n\n  var features = {\n    js: __requested_features.indexOf('js') >= 0,\n    wasm: __requested_features.indexOf('wasm') >= 0\n  };\n  Multimath.call(this, features);\n  this.features = {\n    js: features.js,\n    wasm: features.wasm && this.has_wasm()\n  };\n  this.use(mm_unsharp_mask);\n  this.use(mm_resize);\n}\n\nMathLib.prototype = Object.create(Multimath.prototype);\nMathLib.prototype.constructor = MathLib;\n\nMathLib.prototype.resizeAndUnsharp = function resizeAndUnsharp(options, cache) {\n  var result = this.resize(options, cache);\n\n  if (options.unsharpAmount) {\n    this.unsharp_mask(result, options.toWidth, options.toHeight, options.unsharpAmount, options.unsharpRadius, options.unsharpThreshold);\n  }\n\n  return result;\n};\n\nmodule.exports = MathLib;\n\n},{\"./mm_resize\":4,\"./mm_unsharp_mask\":9,\"multimath\":19}],2:[function(_dereq_,module,exports){\n// Resize convolvers, pure JS implementation\n//\n'use strict'; // Precision of fixed FP values\n//var FIXED_FRAC_BITS = 14;\n\nfunction clampTo8(i) {\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n}\n\nfunction clampNegative(i) {\n  return i >= 0 ? i : 0;\n} // Convolve image data in horizontal direction. Can be used for:\n//\n// 1. bitmap with premultiplied alpha\n// 2. bitmap without alpha (all values 255)\n//\n// Notes:\n//\n// - output is transposed\n// - output resolution is ~15 bits per channel(for better precision).\n//\n\n\nfunction convolveHor(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Store 15 bits between passes for better precision\n      // Instead of shift to 14 (FIXED_FRAC_BITS), shift to 7 only\n      //\n\n\n      dest[destOffset + 3] = clampNegative(a >> 7);\n      dest[destOffset + 2] = clampNegative(b >> 7);\n      dest[destOffset + 1] = clampNegative(g >> 7);\n      dest[destOffset] = clampNegative(r >> 7);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n} // Supplementary method for `convolveHor()`\n//\n\n\nfunction convolveVert(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Sync with premultiplied version for exact result match\n\n\n      r >>= 7;\n      g >>= 7;\n      b >>= 7;\n      a >>= 7; // Bring this value back in range + round result.\n      //\n\n      dest[destOffset + 3] = clampTo8(a + (1 << 13) >> 14);\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14);\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14);\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n} // Premultiply & convolve image data in horizontal direction. Can be used for:\n//\n// - Any bitmap data, extracted with `.getImageData()` method (with\n//   non-premultiplied alpha)\n//\n// For images without alpha channel this method is slower than `convolveHor()`\n//\n\n\nfunction convolveHorWithPre(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a, alpha;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        alpha = src[srcPtr + 3];\n        a = a + filterVal * alpha | 0;\n        b = b + filterVal * src[srcPtr + 2] * alpha | 0;\n        g = g + filterVal * src[srcPtr + 1] * alpha | 0;\n        r = r + filterVal * src[srcPtr] * alpha | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Premultiply is (* alpha / 255).\n      // Postpone division for better performance\n\n\n      b = b / 255 | 0;\n      g = g / 255 | 0;\n      r = r / 255 | 0; // Store 15 bits between passes for better precision\n      // Instead of shift to 14 (FIXED_FRAC_BITS), shift to 7 only\n      //\n\n      dest[destOffset + 3] = clampNegative(a >> 7);\n      dest[destOffset + 2] = clampNegative(b >> 7);\n      dest[destOffset + 1] = clampNegative(g >> 7);\n      dest[destOffset] = clampNegative(r >> 7);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n} // Supplementary method for `convolveHorWithPre()`\n//\n\n\nfunction convolveVertWithPre(src, dest, srcW, srcH, destW, filters) {\n  var r, g, b, a;\n  var filterPtr, filterShift, filterSize;\n  var srcPtr, srcY, destX, filterVal;\n  var srcOffset = 0,\n      destOffset = 0; // For each row\n\n  for (srcY = 0; srcY < srcH; srcY++) {\n    filterPtr = 0; // Apply precomputed filters to each destination row point\n\n    for (destX = 0; destX < destW; destX++) {\n      // Get the filter that determines the current output pixel.\n      filterShift = filters[filterPtr++];\n      filterSize = filters[filterPtr++];\n      srcPtr = srcOffset + filterShift * 4 | 0;\n      r = g = b = a = 0; // Apply the filter to the row to get the destination pixel r, g, b, a\n\n      for (; filterSize > 0; filterSize--) {\n        filterVal = filters[filterPtr++]; // Use reverse order to workaround deopts in old v8 (node v.10)\n        // Big thanks to @mraleph (Vyacheslav Egorov) for the tip.\n\n        a = a + filterVal * src[srcPtr + 3] | 0;\n        b = b + filterVal * src[srcPtr + 2] | 0;\n        g = g + filterVal * src[srcPtr + 1] | 0;\n        r = r + filterVal * src[srcPtr] | 0;\n        srcPtr = srcPtr + 4 | 0;\n      } // Downscale to leave room for un-premultiply\n\n\n      r >>= 7;\n      g >>= 7;\n      b >>= 7;\n      a >>= 7; // Un-premultiply\n\n      a = clampTo8(a + (1 << 13) >> 14);\n\n      if (a > 0) {\n        r = r * 255 / a | 0;\n        g = g * 255 / a | 0;\n        b = b * 255 / a | 0;\n      } // Bring this value back in range + round result.\n      // Shift value = FIXED_FRAC_BITS + 7\n      //\n\n\n      dest[destOffset + 3] = a;\n      dest[destOffset + 2] = clampTo8(b + (1 << 13) >> 14);\n      dest[destOffset + 1] = clampTo8(g + (1 << 13) >> 14);\n      dest[destOffset] = clampTo8(r + (1 << 13) >> 14);\n      destOffset = destOffset + srcH * 4 | 0;\n    }\n\n    destOffset = (srcY + 1) * 4 | 0;\n    srcOffset = (srcY + 1) * srcW * 4 | 0;\n  }\n}\n\nmodule.exports = {\n  convolveHor: convolveHor,\n  convolveVert: convolveVert,\n  convolveHorWithPre: convolveHorWithPre,\n  convolveVertWithPre: convolveVertWithPre\n};\n\n},{}],3:[function(_dereq_,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n/* eslint-disable max-len */\n\nmodule.exports = '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';\n\n},{}],4:[function(_dereq_,module,exports){\n'use strict';\n\nmodule.exports = {\n  name: 'resize',\n  fn: _dereq_('./resize'),\n  wasm_fn: _dereq_('./resize_wasm'),\n  wasm_src: _dereq_('./convolve_wasm_base64')\n};\n\n},{\"./convolve_wasm_base64\":3,\"./resize\":5,\"./resize_wasm\":8}],5:[function(_dereq_,module,exports){\n'use strict';\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nvar _require = _dereq_('./convolve'),\n    convolveHor = _require.convolveHor,\n    convolveVert = _require.convolveVert,\n    convolveHorWithPre = _require.convolveHorWithPre,\n    convolveVertWithPre = _require.convolveVertWithPre;\n\nfunction hasAlpha(src, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    if (src[ptr] !== 255) return true;\n    ptr = ptr + 4 | 0;\n  }\n\n  return false;\n}\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nmodule.exports = function resize(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0;\n  var offsetY = options.offsetY || 0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var filter = typeof options.filter === 'undefined' ? 'mks2013' : options.filter;\n  var filtersX = createFilters(filter, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(filter, srcH, destH, scaleY, offsetY);\n  var tmp = new Uint16Array(destW * srcH * 4); // Autodetect if alpha channel exists, and use appropriate method\n\n  if (hasAlpha(src, srcW, srcH)) {\n    convolveHorWithPre(src, tmp, srcW, srcH, destW, filtersX);\n    convolveVertWithPre(tmp, dest, srcH, destW, destH, filtersY);\n  } else {\n    convolveHor(src, tmp, srcW, srcH, destW, filtersX);\n    convolveVert(tmp, dest, srcH, destW, destH, filtersY);\n    resetAlpha(dest, destW, destH);\n  }\n\n  return dest;\n};\n\n},{\"./convolve\":2,\"./resize_filter_gen\":6}],6:[function(_dereq_,module,exports){\n// Calculate convolution filters for each destination point,\n// and pack data to Int16Array:\n//\n// [ shift, length, data..., shift2, length2, data..., ... ]\n//\n// - shift - offset in src image\n// - length - filter length (in src points)\n// - data - filter values sequence\n//\n'use strict';\n\nvar FILTER_INFO = _dereq_('./resize_filter_info'); // Precision of fixed FP values\n\n\nvar FIXED_FRAC_BITS = 14;\n\nfunction toFixedPoint(num) {\n  return Math.round(num * ((1 << FIXED_FRAC_BITS) - 1));\n}\n\nmodule.exports = function resizeFilterGen(filter, srcSize, destSize, scale, offset) {\n  var filterFunction = FILTER_INFO.filter[filter].fn;\n  var scaleInverted = 1.0 / scale;\n  var scaleClamped = Math.min(1.0, scale); // For upscale\n  // Filter window (averaging interval), scaled to src image\n\n  var srcWindow = FILTER_INFO.filter[filter].win / scaleClamped;\n  var destPixel, srcPixel, srcFirst, srcLast, filterElementSize, floatFilter, fxpFilter, total, pxl, idx, floatVal, filterTotal, filterVal;\n  var leftNotEmpty, rightNotEmpty, filterShift, filterSize;\n  var maxFilterElementSize = Math.floor((srcWindow + 1) * 2);\n  var packedFilter = new Int16Array((maxFilterElementSize + 2) * destSize);\n  var packedFilterPtr = 0;\n  var slowCopy = !packedFilter.subarray || !packedFilter.set; // For each destination pixel calculate source range and built filter values\n\n  for (destPixel = 0; destPixel < destSize; destPixel++) {\n    // Scaling should be done relative to central pixel point\n    srcPixel = (destPixel + 0.5) * scaleInverted + offset;\n    srcFirst = Math.max(0, Math.floor(srcPixel - srcWindow));\n    srcLast = Math.min(srcSize - 1, Math.ceil(srcPixel + srcWindow));\n    filterElementSize = srcLast - srcFirst + 1;\n    floatFilter = new Float32Array(filterElementSize);\n    fxpFilter = new Int16Array(filterElementSize);\n    total = 0.0; // Fill filter values for calculated range\n\n    for (pxl = srcFirst, idx = 0; pxl <= srcLast; pxl++, idx++) {\n      floatVal = filterFunction((pxl + 0.5 - srcPixel) * scaleClamped);\n      total += floatVal;\n      floatFilter[idx] = floatVal;\n    } // Normalize filter, convert to fixed point and accumulate conversion error\n\n\n    filterTotal = 0;\n\n    for (idx = 0; idx < floatFilter.length; idx++) {\n      filterVal = floatFilter[idx] / total;\n      filterTotal += filterVal;\n      fxpFilter[idx] = toFixedPoint(filterVal);\n    } // Compensate normalization error, to minimize brightness drift\n\n\n    fxpFilter[destSize >> 1] += toFixedPoint(1.0 - filterTotal); //\n    // Now pack filter to useable form\n    //\n    // 1. Trim heading and tailing zero values, and compensate shitf/length\n    // 2. Put all to single array in this format:\n    //\n    //    [ pos shift, data length, value1, value2, value3, ... ]\n    //\n\n    leftNotEmpty = 0;\n\n    while (leftNotEmpty < fxpFilter.length && fxpFilter[leftNotEmpty] === 0) {\n      leftNotEmpty++;\n    }\n\n    if (leftNotEmpty < fxpFilter.length) {\n      rightNotEmpty = fxpFilter.length - 1;\n\n      while (rightNotEmpty > 0 && fxpFilter[rightNotEmpty] === 0) {\n        rightNotEmpty--;\n      }\n\n      filterShift = srcFirst + leftNotEmpty;\n      filterSize = rightNotEmpty - leftNotEmpty + 1;\n      packedFilter[packedFilterPtr++] = filterShift; // shift\n\n      packedFilter[packedFilterPtr++] = filterSize; // size\n\n      if (!slowCopy) {\n        packedFilter.set(fxpFilter.subarray(leftNotEmpty, rightNotEmpty + 1), packedFilterPtr);\n        packedFilterPtr += filterSize;\n      } else {\n        // fallback for old IE < 11, without subarray/set methods\n        for (idx = leftNotEmpty; idx <= rightNotEmpty; idx++) {\n          packedFilter[packedFilterPtr++] = fxpFilter[idx];\n        }\n      }\n    } else {\n      // zero data, write header only\n      packedFilter[packedFilterPtr++] = 0; // shift\n\n      packedFilter[packedFilterPtr++] = 0; // size\n    }\n  }\n\n  return packedFilter;\n};\n\n},{\"./resize_filter_info\":7}],7:[function(_dereq_,module,exports){\n// Filter definitions to build tables for\n// resizing convolvers.\n//\n// Presets for quality 0..3. Filter functions + window size\n//\n'use strict';\n\nvar filter = {\n  // Nearest neibor\n  box: {\n    win: 0.5,\n    fn: function fn(x) {\n      if (x < 0) x = -x;\n      return x < 0.5 ? 1.0 : 0.0;\n    }\n  },\n  // // Hamming\n  hamming: {\n    win: 1.0,\n    fn: function fn(x) {\n      if (x < 0) x = -x;\n\n      if (x >= 1.0) {\n        return 0.0;\n      }\n\n      if (x < 1.19209290E-07) {\n        return 1.0;\n      }\n\n      var xpi = x * Math.PI;\n      return Math.sin(xpi) / xpi * (0.54 + 0.46 * Math.cos(xpi / 1.0));\n    }\n  },\n  // Lanczos, win = 2\n  lanczos2: {\n    win: 2.0,\n    fn: function fn(x) {\n      if (x < 0) x = -x;\n\n      if (x >= 2.0) {\n        return 0.0;\n      }\n\n      if (x < 1.19209290E-07) {\n        return 1.0;\n      }\n\n      var xpi = x * Math.PI;\n      return Math.sin(xpi) / xpi * Math.sin(xpi / 2.0) / (xpi / 2.0);\n    }\n  },\n  // Lanczos, win = 3\n  lanczos3: {\n    win: 3.0,\n    fn: function fn(x) {\n      if (x < 0) x = -x;\n\n      if (x >= 3.0) {\n        return 0.0;\n      }\n\n      if (x < 1.19209290E-07) {\n        return 1.0;\n      }\n\n      var xpi = x * Math.PI;\n      return Math.sin(xpi) / xpi * Math.sin(xpi / 3.0) / (xpi / 3.0);\n    }\n  },\n  // Magic Kernel Sharp 2013, win = 2.5\n  // http://johncostella.com/magic/\n  mks2013: {\n    win: 2.5,\n    fn: function fn(x) {\n      if (x < 0) x = -x;\n\n      if (x >= 2.5) {\n        return 0.0;\n      }\n\n      if (x >= 1.5) {\n        return -0.125 * (x - 2.5) * (x - 2.5);\n      }\n\n      if (x >= 0.5) {\n        return 0.25 * (4 * x * x - 11 * x + 7);\n      }\n\n      return 1.0625 - 1.75 * x * x;\n    }\n  }\n};\nmodule.exports = {\n  filter: filter,\n  // Legacy mapping\n  f2q: {\n    box: 0,\n    hamming: 1,\n    lanczos2: 2,\n    lanczos3: 3\n  },\n  q2f: ['box', 'hamming', 'lanczos2', 'lanczos3']\n};\n\n},{}],8:[function(_dereq_,module,exports){\n'use strict';\n\nvar createFilters = _dereq_('./resize_filter_gen');\n\nfunction hasAlpha(src, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    if (src[ptr] !== 255) return true;\n    ptr = ptr + 4 | 0;\n  }\n\n  return false;\n}\n\nfunction resetAlpha(dst, width, height) {\n  var ptr = 3,\n      len = width * height * 4 | 0;\n\n  while (ptr < len) {\n    dst[ptr] = 0xFF;\n    ptr = ptr + 4 | 0;\n  }\n}\n\nfunction asUint8Array(src) {\n  return new Uint8Array(src.buffer, 0, src.byteLength);\n}\n\nvar IS_LE = true; // should not crash everything on module load in old browsers\n\ntry {\n  IS_LE = new Uint32Array(new Uint8Array([1, 0, 0, 0]).buffer)[0] === 1;\n} catch (__) {}\n\nfunction copyInt16asLE(src, target, target_offset) {\n  if (IS_LE) {\n    target.set(asUint8Array(src), target_offset);\n    return;\n  }\n\n  for (var ptr = target_offset, i = 0; i < src.length; i++) {\n    var data = src[i];\n    target[ptr++] = data & 0xFF;\n    target[ptr++] = data >> 8 & 0xFF;\n  }\n}\n\nmodule.exports = function resize_wasm(options) {\n  var src = options.src;\n  var srcW = options.width;\n  var srcH = options.height;\n  var destW = options.toWidth;\n  var destH = options.toHeight;\n  var scaleX = options.scaleX || options.toWidth / options.width;\n  var scaleY = options.scaleY || options.toHeight / options.height;\n  var offsetX = options.offsetX || 0.0;\n  var offsetY = options.offsetY || 0.0;\n  var dest = options.dest || new Uint8Array(destW * destH * 4);\n  var filter = typeof options.filter === 'undefined' ? 'mks2013' : options.filter;\n  var filtersX = createFilters(filter, srcW, destW, scaleX, offsetX),\n      filtersY = createFilters(filter, srcH, destH, scaleY, offsetY); // destination is 0 too.\n\n  var src_offset = 0;\n  var src_size = Math.max(src.byteLength, dest.byteLength); // buffer between convolve passes\n\n  var tmp_offset = this.__align(src_offset + src_size);\n\n  var tmp_size = srcH * destW * 4 * 2; // 2 bytes per channel\n\n  var filtersX_offset = this.__align(tmp_offset + tmp_size);\n\n  var filtersY_offset = this.__align(filtersX_offset + filtersX.byteLength);\n\n  var alloc_bytes = filtersY_offset + filtersY.byteLength;\n\n  var instance = this.__instance('resize', alloc_bytes); //\n  // Fill memory block with data to process\n  //\n\n\n  var mem = new Uint8Array(this.__memory.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer); // 32-bit copy is much faster in chrome\n\n  var src32 = new Uint32Array(src.buffer);\n  mem32.set(src32); // We should guarantee LE bytes order. Filters are not big, so\n  // speed difference is not significant vs direct .set()\n\n  copyInt16asLE(filtersX, mem, filtersX_offset);\n  copyInt16asLE(filtersY, mem, filtersY_offset); // Now call webassembly method\n  // emsdk does method names with '_'\n\n  var fn = instance.exports.convolveHV || instance.exports._convolveHV;\n\n  if (hasAlpha(src, srcW, srcH)) {\n    fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH, 1);\n  } else {\n    fn(filtersX_offset, filtersY_offset, tmp_offset, srcW, srcH, destW, destH, 0);\n    resetAlpha(dest, destW, destH);\n  } //\n  // Copy data back to typed array\n  //\n  // 32-bit copy is much faster in chrome\n\n\n  var dest32 = new Uint32Array(dest.buffer);\n  dest32.set(new Uint32Array(this.__memory.buffer, 0, destH * destW));\n  return dest;\n};\n\n},{\"./resize_filter_gen\":6}],9:[function(_dereq_,module,exports){\n'use strict';\n\nmodule.exports = {\n  name: 'unsharp_mask',\n  fn: _dereq_('./unsharp_mask'),\n  wasm_fn: _dereq_('./unsharp_mask_wasm'),\n  wasm_src: _dereq_('./unsharp_mask_wasm_base64')\n};\n\n},{\"./unsharp_mask\":10,\"./unsharp_mask_wasm\":11,\"./unsharp_mask_wasm_base64\":12}],10:[function(_dereq_,module,exports){\n// Unsharp mask filter\n//\n// http://stackoverflow.com/a/23322820/1031804\n// USM(O) = O + (2 * (Amount / 100) * (O - GB))\n// GB - gaussian blur.\n//\n// Image is converted from RGB to HSV, unsharp mask is applied to the\n// brightness channel and then image is converted back to RGB.\n//\n'use strict';\n\nvar glur_mono16 = _dereq_('glur/mono16');\n\nfunction hsv_v16(img, width, height) {\n  var size = width * height;\n  var out = new Uint16Array(size);\n  var r, g, b, max;\n\n  for (var i = 0; i < size; i++) {\n    r = img[4 * i];\n    g = img[4 * i + 1];\n    b = img[4 * i + 2];\n    max = r >= g && r >= b ? r : g >= b && g >= r ? g : b;\n    out[i] = max << 8;\n  }\n\n  return out;\n}\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  var v1, v2, vmul;\n  var diff, iTimes4;\n\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var brightness = hsv_v16(img, width, height);\n  var blured = new Uint16Array(brightness); // copy, because blur modify src\n\n  glur_mono16(blured, width, height, radius);\n  var amountFp = amount / 100 * 0x1000 + 0.5 | 0;\n  var thresholdFp = threshold << 8;\n  var size = width * height;\n  /* eslint-disable indent */\n\n  for (var i = 0; i < size; i++) {\n    v1 = brightness[i];\n    diff = v1 - blured[i];\n\n    if (Math.abs(diff) >= thresholdFp) {\n      // add unsharp mask to the brightness channel\n      v2 = v1 + (amountFp * diff + 0x800 >> 12); // Both v1 and v2 are within [0.0 .. 255.0] (0000-FF00) range, never going into\n      // [255.003 .. 255.996] (FF01-FFFF). This allows to round this value as (x+.5)|0\n      // later without overflowing.\n\n      v2 = v2 > 0xff00 ? 0xff00 : v2;\n      v2 = v2 < 0x0000 ? 0x0000 : v2; // Avoid division by 0. V=0 means rgb(0,0,0), unsharp with unsharpAmount>0 cannot\n      // change this value (because diff between colors gets inflated), so no need to verify correctness.\n\n      v1 = v1 !== 0 ? v1 : 1; // Multiplying V in HSV model by a constant is equivalent to multiplying each component\n      // in RGB by the same constant (same for HSL), see also:\n      // https://beesbuzz.biz/code/16-hsv-color-transforms\n\n      vmul = (v2 << 12) / v1 | 0; // Result will be in [0..255] range because:\n      //  - all numbers are positive\n      //  - r,g,b <= (v1/256)\n      //  - r,g,b,(v1/256),(v2/256) <= 255\n      // So highest this number can get is X*255/X+0.5=255.5 which is < 256 and rounds down.\n\n      iTimes4 = i * 4;\n      img[iTimes4] = img[iTimes4] * vmul + 0x800 >> 12; // R\n\n      img[iTimes4 + 1] = img[iTimes4 + 1] * vmul + 0x800 >> 12; // G\n\n      img[iTimes4 + 2] = img[iTimes4 + 2] * vmul + 0x800 >> 12; // B\n    }\n  }\n};\n\n},{\"glur/mono16\":18}],11:[function(_dereq_,module,exports){\n'use strict';\n\nmodule.exports = function unsharp(img, width, height, amount, radius, threshold) {\n  if (amount === 0 || radius < 0.5) {\n    return;\n  }\n\n  if (radius > 2.0) {\n    radius = 2.0;\n  }\n\n  var pixels = width * height;\n  var img_bytes_cnt = pixels * 4;\n  var hsv_bytes_cnt = pixels * 2;\n  var blur_bytes_cnt = pixels * 2;\n  var blur_line_byte_cnt = Math.max(width, height) * 4; // float32 array\n\n  var blur_coeffs_byte_cnt = 8 * 4; // float32 array\n\n  var img_offset = 0;\n  var hsv_offset = img_bytes_cnt;\n  var blur_offset = hsv_offset + hsv_bytes_cnt;\n  var blur_tmp_offset = blur_offset + blur_bytes_cnt;\n  var blur_line_offset = blur_tmp_offset + blur_bytes_cnt;\n  var blur_coeffs_offset = blur_line_offset + blur_line_byte_cnt;\n\n  var instance = this.__instance('unsharp_mask', img_bytes_cnt + hsv_bytes_cnt + blur_bytes_cnt * 2 + blur_line_byte_cnt + blur_coeffs_byte_cnt, {\n    exp: Math.exp\n  }); // 32-bit copy is much faster in chrome\n\n\n  var img32 = new Uint32Array(img.buffer);\n  var mem32 = new Uint32Array(this.__memory.buffer);\n  mem32.set(img32); // HSL\n\n  var fn = instance.exports.hsv_v16 || instance.exports._hsv_v16;\n  fn(img_offset, hsv_offset, width, height); // BLUR\n\n  fn = instance.exports.blurMono16 || instance.exports._blurMono16;\n  fn(hsv_offset, blur_offset, blur_tmp_offset, blur_line_offset, blur_coeffs_offset, width, height, radius); // UNSHARP\n\n  fn = instance.exports.unsharp || instance.exports._unsharp;\n  fn(img_offset, img_offset, hsv_offset, blur_offset, width, height, amount, threshold); // 32-bit copy is much faster in chrome\n\n  img32.set(new Uint32Array(this.__memory.buffer, 0, pixels));\n};\n\n},{}],12:[function(_dereq_,module,exports){\n// This is autogenerated file from math.wasm, don't edit.\n//\n'use strict';\n/* eslint-disable max-len */\n\nmodule.exports = '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';\n\n},{}],13:[function(_dereq_,module,exports){\n'use strict';\n\nvar GC_INTERVAL = 100;\n\nfunction Pool(create, idle) {\n  this.create = create;\n  this.available = [];\n  this.acquired = {};\n  this.lastId = 1;\n  this.timeoutId = 0;\n  this.idle = idle || 2000;\n}\n\nPool.prototype.acquire = function () {\n  var _this = this;\n\n  var resource;\n\n  if (this.available.length !== 0) {\n    resource = this.available.pop();\n  } else {\n    resource = this.create();\n    resource.id = this.lastId++;\n\n    resource.release = function () {\n      return _this.release(resource);\n    };\n  }\n\n  this.acquired[resource.id] = resource;\n  return resource;\n};\n\nPool.prototype.release = function (resource) {\n  var _this2 = this;\n\n  delete this.acquired[resource.id];\n  resource.lastUsed = Date.now();\n  this.available.push(resource);\n\n  if (this.timeoutId === 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this2.gc();\n    }, GC_INTERVAL);\n  }\n};\n\nPool.prototype.gc = function () {\n  var _this3 = this;\n\n  var now = Date.now();\n  this.available = this.available.filter(function (resource) {\n    if (now - resource.lastUsed > _this3.idle) {\n      resource.destroy();\n      return false;\n    }\n\n    return true;\n  });\n\n  if (this.available.length !== 0) {\n    this.timeoutId = setTimeout(function () {\n      return _this3.gc();\n    }, GC_INTERVAL);\n  } else {\n    this.timeoutId = 0;\n  }\n};\n\nmodule.exports = Pool;\n\n},{}],14:[function(_dereq_,module,exports){\n// Add intermediate resizing steps when scaling down by a very large factor.\n//\n// For example, when resizing 10000x10000 down to 10x10, it'll resize it to\n// 300x300 first.\n//\n// It's needed because tiler has issues when the entire tile is scaled down\n// to a few pixels (1024px source tile with border size 3 should result in\n// at least 3+3+2 = 8px target tile, so max scale factor is 128 here).\n//\n// Also, adding intermediate steps can speed up processing if we use lower\n// quality algorithms for first stages.\n//\n'use strict'; // min size = 0 results in infinite loop,\n// min size = 1 can consume large amount of memory\n\nvar MIN_INNER_TILE_SIZE = 2;\n\nmodule.exports = function createStages(fromWidth, fromHeight, toWidth, toHeight, srcTileSize, destTileBorder) {\n  var scaleX = toWidth / fromWidth;\n  var scaleY = toHeight / fromHeight; // derived from createRegions equation:\n  // innerTileWidth = pixelFloor(srcTileSize * scaleX) - 2 * destTileBorder;\n\n  var minScale = (2 * destTileBorder + MIN_INNER_TILE_SIZE + 1) / srcTileSize; // refuse to scale image multiple times by less than twice each time,\n  // it could only happen because of invalid options\n\n  if (minScale > 0.5) return [[toWidth, toHeight]];\n  var stageCount = Math.ceil(Math.log(Math.min(scaleX, scaleY)) / Math.log(minScale)); // no additional resizes are necessary,\n  // stageCount can be zero or be negative when enlarging the image\n\n  if (stageCount <= 1) return [[toWidth, toHeight]];\n  var result = [];\n\n  for (var i = 0; i < stageCount; i++) {\n    var width = Math.round(Math.pow(Math.pow(fromWidth, stageCount - i - 1) * Math.pow(toWidth, i + 1), 1 / stageCount));\n    var height = Math.round(Math.pow(Math.pow(fromHeight, stageCount - i - 1) * Math.pow(toHeight, i + 1), 1 / stageCount));\n    result.push([width, height]);\n  }\n\n  return result;\n};\n\n},{}],15:[function(_dereq_,module,exports){\n// Split original image into multiple 1024x1024 chunks to reduce memory usage\n// (images have to be unpacked into typed arrays for resizing) and allow\n// parallel processing of multiple tiles at a time.\n//\n'use strict';\n/*\n * pixelFloor and pixelCeil are modified versions of Math.floor and Math.ceil\n * functions which take into account floating point arithmetic errors.\n * Those errors can cause undesired increments/decrements of sizes and offsets:\n * Math.ceil(36 / (36 / 500)) = 501\n * pixelCeil(36 / (36 / 500)) = 500\n */\n\nvar PIXEL_EPSILON = 1e-5;\n\nfunction pixelFloor(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.floor(x);\n}\n\nfunction pixelCeil(x) {\n  var nearest = Math.round(x);\n\n  if (Math.abs(x - nearest) < PIXEL_EPSILON) {\n    return nearest;\n  }\n\n  return Math.ceil(x);\n}\n\nmodule.exports = function createRegions(options) {\n  var scaleX = options.toWidth / options.width;\n  var scaleY = options.toHeight / options.height;\n  var innerTileWidth = pixelFloor(options.srcTileSize * scaleX) - 2 * options.destTileBorder;\n  var innerTileHeight = pixelFloor(options.srcTileSize * scaleY) - 2 * options.destTileBorder; // prevent infinite loop, this should never happen\n\n  if (innerTileWidth < 1 || innerTileHeight < 1) {\n    throw new Error('Internal error in pica: target tile width/height is too small.');\n  }\n\n  var x, y;\n  var innerX, innerY, toTileWidth, toTileHeight;\n  var tiles = [];\n  var tile; // we go top-to-down instead of left-to-right to make image displayed from top to\n  // doesn in the browser\n\n  for (innerY = 0; innerY < options.toHeight; innerY += innerTileHeight) {\n    for (innerX = 0; innerX < options.toWidth; innerX += innerTileWidth) {\n      x = innerX - options.destTileBorder;\n\n      if (x < 0) {\n        x = 0;\n      }\n\n      toTileWidth = innerX + innerTileWidth + options.destTileBorder - x;\n\n      if (x + toTileWidth >= options.toWidth) {\n        toTileWidth = options.toWidth - x;\n      }\n\n      y = innerY - options.destTileBorder;\n\n      if (y < 0) {\n        y = 0;\n      }\n\n      toTileHeight = innerY + innerTileHeight + options.destTileBorder - y;\n\n      if (y + toTileHeight >= options.toHeight) {\n        toTileHeight = options.toHeight - y;\n      }\n\n      tile = {\n        toX: x,\n        toY: y,\n        toWidth: toTileWidth,\n        toHeight: toTileHeight,\n        toInnerX: innerX,\n        toInnerY: innerY,\n        toInnerWidth: innerTileWidth,\n        toInnerHeight: innerTileHeight,\n        offsetX: x / scaleX - pixelFloor(x / scaleX),\n        offsetY: y / scaleY - pixelFloor(y / scaleY),\n        scaleX: scaleX,\n        scaleY: scaleY,\n        x: pixelFloor(x / scaleX),\n        y: pixelFloor(y / scaleY),\n        width: pixelCeil(toTileWidth / scaleX),\n        height: pixelCeil(toTileHeight / scaleY)\n      };\n      tiles.push(tile);\n    }\n  }\n\n  return tiles;\n};\n\n},{}],16:[function(_dereq_,module,exports){\n'use strict';\n\nfunction objClass(obj) {\n  return Object.prototype.toString.call(obj);\n}\n\nmodule.exports.isCanvas = function isCanvas(element) {\n  var cname = objClass(element);\n  return cname === '[object HTMLCanvasElement]'\n  /* browser */\n  || cname === '[object OffscreenCanvas]' || cname === '[object Canvas]'\n  /* node-canvas */\n  ;\n};\n\nmodule.exports.isImage = function isImage(element) {\n  return objClass(element) === '[object HTMLImageElement]';\n};\n\nmodule.exports.isImageBitmap = function isImageBitmap(element) {\n  return objClass(element) === '[object ImageBitmap]';\n};\n\nmodule.exports.limiter = function limiter(concurrency) {\n  var active = 0,\n      queue = [];\n\n  function roll() {\n    if (active < concurrency && queue.length) {\n      active++;\n      queue.shift()();\n    }\n  }\n\n  return function limit(fn) {\n    return new Promise(function (resolve, reject) {\n      queue.push(function () {\n        fn().then(function (result) {\n          resolve(result);\n          active--;\n          roll();\n        }, function (err) {\n          reject(err);\n          active--;\n          roll();\n        });\n      });\n      roll();\n    });\n  };\n};\n\nmodule.exports.cib_quality_name = function cib_quality_name(num) {\n  switch (num) {\n    case 0:\n      return 'pixelated';\n\n    case 1:\n      return 'low';\n\n    case 2:\n      return 'medium';\n  }\n\n  return 'high';\n};\n\nmodule.exports.cib_support = function cib_support(createCanvas) {\n  return Promise.resolve().then(function () {\n    if (typeof createImageBitmap === 'undefined') {\n      return false;\n    }\n\n    var c = createCanvas(100, 100);\n    return createImageBitmap(c, 0, 0, 100, 100, {\n      resizeWidth: 10,\n      resizeHeight: 10,\n      resizeQuality: 'high'\n    }).then(function (bitmap) {\n      var status = bitmap.width === 10; // Branch below is filtered on upper level. We do not call resize\n      // detection for basic ImageBitmap.\n      //\n      // https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap\n      // old Crome 51 has ImageBitmap without .close(). Then this code\n      // will throw and return 'false' as expected.\n      //\n\n      bitmap.close();\n      c = null;\n      return status;\n    });\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nmodule.exports.worker_offscreen_canvas_support = function worker_offscreen_canvas_support() {\n  return new Promise(function (resolve, reject) {\n    if (typeof OffscreenCanvas === 'undefined') {\n      // if OffscreenCanvas is present, we assume browser supports Worker and built-in Promise as well\n      resolve(false);\n      return;\n    }\n\n    function workerPayload(self) {\n      if (typeof createImageBitmap === 'undefined') {\n        self.postMessage(false);\n        return;\n      }\n\n      Promise.resolve().then(function () {\n        var canvas = new OffscreenCanvas(10, 10); // test that 2d context can be used in worker\n\n        var ctx = canvas.getContext('2d');\n        ctx.rect(0, 0, 1, 1); // test that cib can be used to return image bitmap from worker\n\n        return createImageBitmap(canvas, 0, 0, 1, 1);\n      }).then(function () {\n        return self.postMessage(true);\n      }, function () {\n        return self.postMessage(false);\n      });\n    }\n\n    var code = btoa(\"(\".concat(workerPayload.toString(), \")(self);\"));\n    var w = new Worker(\"data:text/javascript;base64,\".concat(code));\n\n    w.onmessage = function (ev) {\n      return resolve(ev.data);\n    };\n\n    w.onerror = reject;\n  }).then(function (result) {\n    return result;\n  }, function () {\n    return false;\n  });\n}; // Check if canvas.getContext('2d').getImageData can be used,\n// FireFox randomizes the output of that function in `privacy.resistFingerprinting` mode\n\n\nmodule.exports.can_use_canvas = function can_use_canvas(createCanvas) {\n  var usable = false;\n\n  try {\n    var canvas = createCanvas(2, 1);\n    var ctx = canvas.getContext('2d');\n    var d = ctx.createImageData(2, 1);\n    d.data[0] = 12;\n    d.data[1] = 23;\n    d.data[2] = 34;\n    d.data[3] = 255;\n    d.data[4] = 45;\n    d.data[5] = 56;\n    d.data[6] = 67;\n    d.data[7] = 255;\n    ctx.putImageData(d, 0, 0);\n    d = null;\n    d = ctx.getImageData(0, 0, 2, 1);\n\n    if (d.data[0] === 12 && d.data[1] === 23 && d.data[2] === 34 && d.data[3] === 255 && d.data[4] === 45 && d.data[5] === 56 && d.data[6] === 67 && d.data[7] === 255) {\n      usable = true;\n    }\n  } catch (err) {}\n\n  return usable;\n}; // Check if createImageBitmap(img, sx, sy, sw, sh) signature works correctly\n// with JPEG images oriented with Exif;\n// https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n// TODO: remove after it's fixed in chrome for at least 2 releases\n\n\nmodule.exports.cib_can_use_region = function cib_can_use_region() {\n  return new Promise(function (resolve) {\n    // `Image` check required for use in `ServiceWorker`\n    if (typeof Image === 'undefined' || typeof createImageBitmap === 'undefined') {\n      resolve(false);\n      return;\n    }\n\n    var image = new Image();\n    image.src = 'data:image/jpeg;base64,' + '/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAA' + 'AABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9' + 'sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRc' + 'ZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoa' + 'GhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRA' + 'f/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAA' + 'IQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAA' + 'AAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIB' + 'AT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAA' + 'AAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAA' + 'AAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQ' + 'QAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z';\n\n    image.onload = function () {\n      createImageBitmap(image, 0, 0, image.width, image.height).then(function (bitmap) {\n        if (bitmap.width === image.width && bitmap.height === image.height) {\n          resolve(true);\n        } else {\n          resolve(false);\n        }\n      }, function () {\n        return resolve(false);\n      });\n    };\n\n    image.onerror = function () {\n      return resolve(false);\n    };\n  });\n};\n\n},{}],17:[function(_dereq_,module,exports){\n// Web Worker wrapper for image resize function\n'use strict';\n\nmodule.exports = function () {\n  var MathLib = _dereq_('./mathlib');\n\n  var mathLib;\n  /* eslint-disable no-undef */\n\n  onmessage = function onmessage(ev) {\n    var tileOpts = ev.data.opts;\n    var returnBitmap = false;\n\n    if (!tileOpts.src && tileOpts.srcBitmap) {\n      var canvas = new OffscreenCanvas(tileOpts.width, tileOpts.height);\n      var ctx = canvas.getContext('2d');\n      ctx.drawImage(tileOpts.srcBitmap, 0, 0);\n      tileOpts.src = ctx.getImageData(0, 0, tileOpts.width, tileOpts.height).data;\n      canvas.width = canvas.height = 0;\n      canvas = null;\n      tileOpts.srcBitmap.close();\n      tileOpts.srcBitmap = null; // Temporary force out data to typed array, because Chrome have artefacts\n      // https://github.com/nodeca/pica/issues/223\n      // returnBitmap = true;\n    }\n\n    if (!mathLib) mathLib = new MathLib(ev.data.features); // Use multimath's sync auto-init. Avoid Promise use in old browsers,\n    // because polyfills are not propagated to webworker.\n\n    var data = mathLib.resizeAndUnsharp(tileOpts);\n\n    if (returnBitmap) {\n      var toImageData = new ImageData(new Uint8ClampedArray(data), tileOpts.toWidth, tileOpts.toHeight);\n\n      var _canvas = new OffscreenCanvas(tileOpts.toWidth, tileOpts.toHeight);\n\n      var _ctx = _canvas.getContext('2d');\n\n      _ctx.putImageData(toImageData, 0, 0);\n\n      createImageBitmap(_canvas).then(function (bitmap) {\n        postMessage({\n          bitmap: bitmap\n        }, [bitmap]);\n      });\n    } else {\n      postMessage({\n        data: data\n      }, [data.buffer]);\n    }\n  };\n};\n\n},{\"./mathlib\":1}],18:[function(_dereq_,module,exports){\n// Calculate Gaussian blur of an image using IIR filter\n// The method is taken from Intel's white paper and code example attached to it:\n// https://software.intel.com/en-us/articles/iir-gaussian-blur-filter\n// -implementation-using-intel-advanced-vector-extensions\n\nvar a0, a1, a2, a3, b1, b2, left_corner, right_corner;\n\nfunction gaussCoef(sigma) {\n  if (sigma < 0.5) {\n    sigma = 0.5;\n  }\n\n  var a = Math.exp(0.726 * 0.726) / sigma,\n      g1 = Math.exp(-a),\n      g2 = Math.exp(-2 * a),\n      k = (1 - g1) * (1 - g1) / (1 + 2 * a * g1 - g2);\n\n  a0 = k;\n  a1 = k * (a - 1) * g1;\n  a2 = k * (a + 1) * g1;\n  a3 = -k * g2;\n  b1 = 2 * g1;\n  b2 = -g2;\n  left_corner = (a0 + a1) / (1 - b1 - b2);\n  right_corner = (a2 + a3) / (1 - b1 - b2);\n\n  // Attempt to force type to FP32.\n  return new Float32Array([ a0, a1, a2, a3, b1, b2, left_corner, right_corner ]);\n}\n\nfunction convolveMono16(src, out, line, coeff, width, height) {\n  // takes src image and writes the blurred and transposed result into out\n\n  var prev_src, curr_src, curr_out, prev_out, prev_prev_out;\n  var src_index, out_index, line_index;\n  var i, j;\n  var coeff_a0, coeff_a1, coeff_b1, coeff_b2;\n\n  for (i = 0; i < height; i++) {\n    src_index = i * width;\n    out_index = i;\n    line_index = 0;\n\n    // left to right\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[6];\n    prev_out = prev_prev_out;\n\n    coeff_a0 = coeff[0];\n    coeff_a1 = coeff[1];\n    coeff_b1 = coeff[4];\n    coeff_b2 = coeff[5];\n\n    for (j = 0; j < width; j++) {\n      curr_src = src[src_index];\n\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n      prev_src = curr_src;\n\n      line[line_index] = prev_out;\n      line_index++;\n      src_index++;\n    }\n\n    src_index--;\n    line_index--;\n    out_index += height * (width - 1);\n\n    // right to left\n    prev_src = src[src_index];\n    prev_prev_out = prev_src * coeff[7];\n    prev_out = prev_prev_out;\n    curr_src = prev_src;\n\n    coeff_a0 = coeff[2];\n    coeff_a1 = coeff[3];\n\n    for (j = width - 1; j >= 0; j--) {\n      curr_out = curr_src * coeff_a0 +\n                 prev_src * coeff_a1 +\n                 prev_out * coeff_b1 +\n                 prev_prev_out * coeff_b2;\n\n      prev_prev_out = prev_out;\n      prev_out = curr_out;\n\n      prev_src = curr_src;\n      curr_src = src[src_index];\n\n      out[out_index] = line[line_index] + prev_out;\n\n      src_index--;\n      line_index--;\n      out_index -= height;\n    }\n  }\n}\n\n\nfunction blurMono16(src, width, height, radius) {\n  // Quick exit on zero radius\n  if (!radius) { return; }\n\n  var out      = new Uint16Array(src.length),\n      tmp_line = new Float32Array(Math.max(width, height));\n\n  var coeff = gaussCoef(radius);\n\n  convolveMono16(src, out, tmp_line, coeff, width, height, radius);\n  convolveMono16(out, src, tmp_line, coeff, height, width, radius);\n}\n\nmodule.exports = blurMono16;\n\n},{}],19:[function(_dereq_,module,exports){\n'use strict';\n\n\nvar assign         = _dereq_('object-assign');\nvar base64decode   = _dereq_('./lib/base64decode');\nvar hasWebAssembly = _dereq_('./lib/wa_detect');\n\n\nvar DEFAULT_OPTIONS = {\n  js: true,\n  wasm: true\n};\n\n\nfunction MultiMath(options) {\n  if (!(this instanceof MultiMath)) return new MultiMath(options);\n\n  var opts = assign({}, DEFAULT_OPTIONS, options || {});\n\n  this.options         = opts;\n\n  this.__cache         = {};\n\n  this.__init_promise  = null;\n  this.__modules       = opts.modules || {};\n  this.__memory        = null;\n  this.__wasm          = {};\n\n  this.__isLE = ((new Uint32Array((new Uint8Array([ 1, 0, 0, 0 ])).buffer))[0] === 1);\n\n  if (!this.options.js && !this.options.wasm) {\n    throw new Error('mathlib: at least \"js\" or \"wasm\" should be enabled');\n  }\n}\n\n\nMultiMath.prototype.has_wasm = hasWebAssembly;\n\n\nMultiMath.prototype.use = function (module) {\n  this.__modules[module.name] = module;\n\n  // Pin the best possible implementation\n  if (this.options.wasm && this.has_wasm() && module.wasm_fn) {\n    this[module.name] = module.wasm_fn;\n  } else {\n    this[module.name] = module.fn;\n  }\n\n  return this;\n};\n\n\nMultiMath.prototype.init = function () {\n  if (this.__init_promise) return this.__init_promise;\n\n  if (!this.options.js && this.options.wasm && !this.has_wasm()) {\n    return Promise.reject(new Error('mathlib: only \"wasm\" was enabled, but it\\'s not supported'));\n  }\n\n  var self = this;\n\n  this.__init_promise = Promise.all(Object.keys(self.__modules).map(function (name) {\n    var module = self.__modules[name];\n\n    if (!self.options.wasm || !self.has_wasm() || !module.wasm_fn) return null;\n\n    // If already compiled - exit\n    if (self.__wasm[name]) return null;\n\n    // Compile wasm source\n    return WebAssembly.compile(self.__base64decode(module.wasm_src))\n      .then(function (m) { self.__wasm[name] = m; });\n  }))\n    .then(function () { return self; });\n\n  return this.__init_promise;\n};\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Methods below are for internal use from plugins\n\n\n// Simple decode base64 to typed array. Useful to load embedded webassembly\n// code. You probably don't need to call this method directly.\n//\nMultiMath.prototype.__base64decode = base64decode;\n\n\n// Increase current memory to include specified number of bytes. Do nothing if\n// size is already ok. You probably don't need to call this method directly,\n// because it will be invoked from `.__instance()`.\n//\nMultiMath.prototype.__reallocate = function mem_grow_to(bytes) {\n  if (!this.__memory) {\n    this.__memory = new WebAssembly.Memory({\n      initial: Math.ceil(bytes / (64 * 1024))\n    });\n    return this.__memory;\n  }\n\n  var mem_size = this.__memory.buffer.byteLength;\n\n  if (mem_size < bytes) {\n    this.__memory.grow(Math.ceil((bytes - mem_size) / (64 * 1024)));\n  }\n\n  return this.__memory;\n};\n\n\n// Returns instantinated webassembly item by name, with specified memory size\n// and environment.\n// - use cache if available\n// - do sync module init, if async init was not called earlier\n// - allocate memory if not enougth\n// - can export functions to webassembly via \"env_extra\",\n//   for example, { exp: Math.exp }\n//\nMultiMath.prototype.__instance = function instance(name, memsize, env_extra) {\n  if (memsize) this.__reallocate(memsize);\n\n  // If .init() was not called, do sync compile\n  if (!this.__wasm[name]) {\n    var module = this.__modules[name];\n    this.__wasm[name] = new WebAssembly.Module(this.__base64decode(module.wasm_src));\n  }\n\n  if (!this.__cache[name]) {\n    var env_base = {\n      memoryBase: 0,\n      memory: this.__memory,\n      tableBase: 0,\n      table: new WebAssembly.Table({ initial: 0, element: 'anyfunc' })\n    };\n\n    this.__cache[name] = new WebAssembly.Instance(this.__wasm[name], {\n      env: assign(env_base, env_extra || {})\n    });\n  }\n\n  return this.__cache[name];\n};\n\n\n// Helper to calculate memory aligh for pointers. Webassembly does not require\n// this, but you may wish to experiment. Default base = 8;\n//\nMultiMath.prototype.__align = function align(number, base) {\n  base = base || 8;\n  var reminder = number % base;\n  return number + (reminder ? base - reminder : 0);\n};\n\n\nmodule.exports = MultiMath;\n\n},{\"./lib/base64decode\":20,\"./lib/wa_detect\":21,\"object-assign\":22}],20:[function(_dereq_,module,exports){\n// base64 decode str -> Uint8Array, to load WA modules\n//\n'use strict';\n\n\nvar BASE64_MAP = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n\nmodule.exports = function base64decode(str) {\n  var input = str.replace(/[\\r\\n=]/g, ''), // remove CR/LF & padding to simplify scan\n      max   = input.length;\n\n  var out = new Uint8Array((max * 3) >> 2);\n\n  // Collect by 6*4 bits (3 bytes)\n\n  var bits = 0;\n  var ptr  = 0;\n\n  for (var idx = 0; idx < max; idx++) {\n    if ((idx % 4 === 0) && idx) {\n      out[ptr++] = (bits >> 16) & 0xFF;\n      out[ptr++] = (bits >> 8) & 0xFF;\n      out[ptr++] = bits & 0xFF;\n    }\n\n    bits = (bits << 6) | BASE64_MAP.indexOf(input.charAt(idx));\n  }\n\n  // Dump tail\n\n  var tailbits = (max % 4) * 6;\n\n  if (tailbits === 0) {\n    out[ptr++] = (bits >> 16) & 0xFF;\n    out[ptr++] = (bits >> 8) & 0xFF;\n    out[ptr++] = bits & 0xFF;\n  } else if (tailbits === 18) {\n    out[ptr++] = (bits >> 10) & 0xFF;\n    out[ptr++] = (bits >> 2) & 0xFF;\n  } else if (tailbits === 12) {\n    out[ptr++] = (bits >> 4) & 0xFF;\n  }\n\n  return out;\n};\n\n},{}],21:[function(_dereq_,module,exports){\n// Detect WebAssembly support.\n// - Check global WebAssembly object\n// - Try to load simple module (can be disabled via CSP)\n//\n'use strict';\n\n\nvar wa;\n\n\nmodule.exports = function hasWebAssembly() {\n  // use cache if called before;\n  if (typeof wa !== 'undefined') return wa;\n\n  wa = false;\n\n  if (typeof WebAssembly === 'undefined') return wa;\n\n  // If WebAssenbly is disabled, code can throw on compile\n  try {\n    // https://github.com/brion/min-wasm-fail/blob/master/min-wasm-fail.in.js\n    // Additional check that WA internals are correct\n\n    /* eslint-disable comma-spacing, max-len */\n    var bin      = new Uint8Array([ 0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11 ]);\n    var module   = new WebAssembly.Module(bin);\n    var instance = new WebAssembly.Instance(module, {});\n\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    if (instance.exports.test(4) !== 0) wa = true;\n\n    return wa;\n  } catch (__) {}\n\n  return wa;\n};\n\n},{}],22:[function(_dereq_,module,exports){\n/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n},{}],23:[function(_dereq_,module,exports){\nvar bundleFn = arguments[3];\nvar sources = arguments[4];\nvar cache = arguments[5];\n\nvar stringify = JSON.stringify;\n\nmodule.exports = function (fn, options) {\n    var wkey;\n    var cacheKeys = Object.keys(cache);\n\n    for (var i = 0, l = cacheKeys.length; i < l; i++) {\n        var key = cacheKeys[i];\n        var exp = cache[key].exports;\n        // Using babel as a transpiler to use esmodule, the export will always\n        // be an object with the default export as a property of it. To ensure\n        // the existing api and babel esmodule exports are both supported we\n        // check for both\n        if (exp === fn || exp && exp.default === fn) {\n            wkey = key;\n            break;\n        }\n    }\n\n    if (!wkey) {\n        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n        var wcache = {};\n        for (var i = 0, l = cacheKeys.length; i < l; i++) {\n            var key = cacheKeys[i];\n            wcache[key] = key;\n        }\n        sources[wkey] = [\n            'function(require,module,exports){' + fn + '(self); }',\n            wcache\n        ];\n    }\n    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);\n\n    var scache = {}; scache[wkey] = wkey;\n    sources[skey] = [\n        'function(require,module,exports){' +\n            // try to call default if defined to also support babel esmodule exports\n            'var f = require(' + stringify(wkey) + ');' +\n            '(f.default ? f.default : f)(self);' +\n        '}',\n        scache\n    ];\n\n    var workerSources = {};\n    resolveSources(skey);\n\n    function resolveSources(key) {\n        workerSources[key] = true;\n\n        for (var depPath in sources[key][1]) {\n            var depKey = sources[key][1][depPath];\n            if (!workerSources[depKey]) {\n                resolveSources(depKey);\n            }\n        }\n    }\n\n    var src = '(' + bundleFn + ')({'\n        + Object.keys(workerSources).map(function (key) {\n            return stringify(key) + ':['\n                + sources[key][0]\n                + ',' + stringify(sources[key][1]) + ']'\n            ;\n        }).join(',')\n        + '},{},[' + stringify(skey) + '])'\n    ;\n\n    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n    var blob = new Blob([src], { type: 'text/javascript' });\n    if (options && options.bare) { return blob; }\n    var workerUrl = URL.createObjectURL(blob);\n    var worker = new Worker(workerUrl);\n    worker.objectURL = workerUrl;\n    return worker;\n};\n\n},{}],\"/index.js\":[function(_dereq_,module,exports){\n'use strict';\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nvar assign = _dereq_('object-assign');\n\nvar webworkify = _dereq_('webworkify');\n\nvar MathLib = _dereq_('./lib/mathlib');\n\nvar Pool = _dereq_('./lib/pool');\n\nvar utils = _dereq_('./lib/utils');\n\nvar worker = _dereq_('./lib/worker');\n\nvar createStages = _dereq_('./lib/stepper');\n\nvar createRegions = _dereq_('./lib/tiler');\n\nvar filter_info = _dereq_('./lib/mm_resize/resize_filter_info'); // Deduplicate pools & limiters with the same configs\n// when user creates multiple pica instances.\n\n\nvar singletones = {};\nvar NEED_SAFARI_FIX = false;\n\ntry {\n  if (typeof navigator !== 'undefined' && navigator.userAgent) {\n    NEED_SAFARI_FIX = navigator.userAgent.indexOf('Safari') >= 0;\n  }\n} catch (e) {}\n\nvar concurrency = 1;\n\nif (typeof navigator !== 'undefined') {\n  concurrency = Math.min(navigator.hardwareConcurrency || 1, 4);\n}\n\nvar DEFAULT_PICA_OPTS = {\n  tile: 1024,\n  concurrency: concurrency,\n  features: ['js', 'wasm', 'ww'],\n  idle: 2000,\n  createCanvas: function createCanvas(width, height) {\n    var tmpCanvas = document.createElement('canvas');\n    tmpCanvas.width = width;\n    tmpCanvas.height = height;\n    return tmpCanvas;\n  }\n};\nvar DEFAULT_RESIZE_OPTS = {\n  filter: 'mks2013',\n  unsharpAmount: 0,\n  unsharpRadius: 0.0,\n  unsharpThreshold: 0\n};\nvar CAN_NEW_IMAGE_DATA = false;\nvar CAN_CREATE_IMAGE_BITMAP = false;\nvar CAN_USE_CANVAS_GET_IMAGE_DATA = false;\nvar CAN_USE_OFFSCREEN_CANVAS = false;\nvar CAN_USE_CIB_REGION_FOR_IMAGE = false;\n\nfunction workerFabric() {\n  return {\n    value: webworkify(worker),\n    destroy: function destroy() {\n      this.value.terminate();\n\n      if (typeof window !== 'undefined') {\n        var url = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n        if (url && url.revokeObjectURL && this.value.objectURL) {\n          url.revokeObjectURL(this.value.objectURL);\n        }\n      }\n    }\n  };\n} ////////////////////////////////////////////////////////////////////////////////\n// API methods\n\n\nfunction Pica(options) {\n  if (!(this instanceof Pica)) return new Pica(options);\n  this.options = assign({}, DEFAULT_PICA_OPTS, options || {});\n  var limiter_key = \"lk_\".concat(this.options.concurrency); // Share limiters to avoid multiple parallel workers when user creates\n  // multiple pica instances.\n\n  this.__limit = singletones[limiter_key] || utils.limiter(this.options.concurrency);\n  if (!singletones[limiter_key]) singletones[limiter_key] = this.__limit; // List of supported features, according to options & browser/node.js\n\n  this.features = {\n    js: false,\n    // pure JS implementation, can be disabled for testing\n    wasm: false,\n    // webassembly implementation for heavy functions\n    cib: false,\n    // resize via createImageBitmap (only FF at this moment)\n    ww: false // webworkers\n\n  };\n  this.__workersPool = null; // Store requested features for webworkers\n\n  this.__requested_features = [];\n  this.__mathlib = null;\n}\n\nPica.prototype.init = function () {\n  var _this = this;\n\n  if (this.__initPromise) return this.__initPromise; // Test if we can create ImageData without canvas and memory copy\n\n  if (typeof ImageData !== 'undefined' && typeof Uint8ClampedArray !== 'undefined') {\n    try {\n      /* eslint-disable no-new */\n      new ImageData(new Uint8ClampedArray(400), 10, 10);\n      CAN_NEW_IMAGE_DATA = true;\n    } catch (__) {}\n  } // ImageBitmap can be effective in 2 places:\n  //\n  // 1. Threaded jpeg unpack (basic)\n  // 2. Built-in resize (blocked due problem in chrome, see issue #89)\n  //\n  // For basic use we also need ImageBitmap wo support .close() method,\n  // see https://developer.mozilla.org/ru/docs/Web/API/ImageBitmap\n\n\n  if (typeof ImageBitmap !== 'undefined') {\n    if (ImageBitmap.prototype && ImageBitmap.prototype.close) {\n      CAN_CREATE_IMAGE_BITMAP = true;\n    } else {\n      this.debug('ImageBitmap does not support .close(), disabled');\n    }\n  }\n\n  var features = this.options.features.slice();\n\n  if (features.indexOf('all') >= 0) {\n    features = ['cib', 'wasm', 'js', 'ww'];\n  }\n\n  this.__requested_features = features;\n  this.__mathlib = new MathLib(features); // Check WebWorker support if requested\n\n  if (features.indexOf('ww') >= 0) {\n    if (typeof window !== 'undefined' && 'Worker' in window) {\n      // IE <= 11 don't allow to create webworkers from string. We should check it.\n      // https://connect.microsoft.com/IE/feedback/details/801810/web-workers-from-blob-urls-in-ie-10-and-11\n      try {\n        var wkr = _dereq_('webworkify')(function () {});\n\n        wkr.terminate();\n        this.features.ww = true; // pool uniqueness depends on pool config + webworker config\n\n        var wpool_key = \"wp_\".concat(JSON.stringify(this.options));\n\n        if (singletones[wpool_key]) {\n          this.__workersPool = singletones[wpool_key];\n        } else {\n          this.__workersPool = new Pool(workerFabric, this.options.idle);\n          singletones[wpool_key] = this.__workersPool;\n        }\n      } catch (__) {}\n    }\n  }\n\n  var initMath = this.__mathlib.init().then(function (mathlib) {\n    // Copy detected features\n    assign(_this.features, mathlib.features);\n  });\n\n  var checkCibResize;\n\n  if (!CAN_CREATE_IMAGE_BITMAP) {\n    checkCibResize = Promise.resolve(false);\n  } else {\n    checkCibResize = utils.cib_support(this.options.createCanvas).then(function (status) {\n      if (_this.features.cib && features.indexOf('cib') < 0) {\n        _this.debug('createImageBitmap() resize supported, but disabled by config');\n\n        return;\n      }\n\n      if (features.indexOf('cib') >= 0) _this.features.cib = status;\n    });\n  }\n\n  CAN_USE_CANVAS_GET_IMAGE_DATA = utils.can_use_canvas(this.options.createCanvas);\n  var checkOffscreenCanvas;\n\n  if (CAN_CREATE_IMAGE_BITMAP && CAN_NEW_IMAGE_DATA && features.indexOf('ww') !== -1) {\n    checkOffscreenCanvas = utils.worker_offscreen_canvas_support();\n  } else {\n    checkOffscreenCanvas = Promise.resolve(false);\n  }\n\n  checkOffscreenCanvas = checkOffscreenCanvas.then(function (result) {\n    CAN_USE_OFFSCREEN_CANVAS = result;\n  }); // we use createImageBitmap to crop image data and pass it to workers,\n  // so need to check whether function works correctly;\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n\n  var checkCibRegion = utils.cib_can_use_region().then(function (result) {\n    CAN_USE_CIB_REGION_FOR_IMAGE = result;\n  }); // Init math lib. That's async because can load some\n\n  this.__initPromise = Promise.all([initMath, checkCibResize, checkOffscreenCanvas, checkCibRegion]).then(function () {\n    return _this;\n  });\n  return this.__initPromise;\n}; // Call resizer in webworker or locally, depending on config\n\n\nPica.prototype.__invokeResize = function (tileOpts, opts) {\n  var _this2 = this;\n\n  // Share cache between calls:\n  //\n  // - wasm instance\n  // - wasm memory object\n  //\n  opts.__mathCache = opts.__mathCache || {};\n  return Promise.resolve().then(function () {\n    if (!_this2.features.ww) {\n      // not possible to have ImageBitmap here if user disabled WW\n      return {\n        data: _this2.__mathlib.resizeAndUnsharp(tileOpts, opts.__mathCache)\n      };\n    }\n\n    return new Promise(function (resolve, reject) {\n      var w = _this2.__workersPool.acquire();\n\n      if (opts.cancelToken) opts.cancelToken[\"catch\"](function (err) {\n        return reject(err);\n      });\n\n      w.value.onmessage = function (ev) {\n        w.release();\n        if (ev.data.err) reject(ev.data.err);else resolve(ev.data);\n      };\n\n      var transfer = [];\n      if (tileOpts.src) transfer.push(tileOpts.src.buffer);\n      if (tileOpts.srcBitmap) transfer.push(tileOpts.srcBitmap);\n      w.value.postMessage({\n        opts: tileOpts,\n        features: _this2.__requested_features,\n        preload: {\n          wasm_nodule: _this2.__mathlib.__\n        }\n      }, transfer);\n    });\n  });\n}; // this function can return promise if createImageBitmap is used\n\n\nPica.prototype.__extractTileData = function (tile, from, opts, stageEnv, extractTo) {\n  if (this.features.ww && CAN_USE_OFFSCREEN_CANVAS && ( // createImageBitmap doesn't work for images (Image, ImageBitmap) with Exif orientation in Chrome,\n  // can use canvas because canvas doesn't have orientation;\n  // see https://bugs.chromium.org/p/chromium/issues/detail?id=1220671\n  utils.isCanvas(from) || CAN_USE_CIB_REGION_FOR_IMAGE)) {\n    this.debug('Create tile for OffscreenCanvas');\n    return createImageBitmap(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height).then(function (bitmap) {\n      extractTo.srcBitmap = bitmap;\n      return extractTo;\n    });\n  } // Extract tile RGBA buffer, depending on input type\n\n\n  if (utils.isCanvas(from)) {\n    if (!stageEnv.srcCtx) stageEnv.srcCtx = from.getContext('2d'); // If input is Canvas - extract region data directly\n\n    this.debug('Get tile pixel data');\n    extractTo.src = stageEnv.srcCtx.getImageData(tile.x, tile.y, tile.width, tile.height).data;\n    return extractTo;\n  } // If input is Image or decoded to ImageBitmap,\n  // draw region to temporary canvas and extract data from it\n  //\n  // Note! Attempt to reuse this canvas causes significant slowdown in chrome\n  //\n\n\n  this.debug('Draw tile imageBitmap/image to temporary canvas');\n  var tmpCanvas = this.options.createCanvas(tile.width, tile.height);\n  var tmpCtx = tmpCanvas.getContext('2d');\n  tmpCtx.globalCompositeOperation = 'copy';\n  tmpCtx.drawImage(stageEnv.srcImageBitmap || from, tile.x, tile.y, tile.width, tile.height, 0, 0, tile.width, tile.height);\n  this.debug('Get tile pixel data');\n  extractTo.src = tmpCtx.getImageData(0, 0, tile.width, tile.height).data; // Safari 12 workaround\n  // https://github.com/nodeca/pica/issues/199\n\n  tmpCanvas.width = tmpCanvas.height = 0;\n  return extractTo;\n};\n\nPica.prototype.__landTileData = function (tile, result, stageEnv) {\n  var toImageData;\n  this.debug('Convert raw rgba tile result to ImageData');\n\n  if (result.bitmap) {\n    stageEnv.toCtx.drawImage(result.bitmap, tile.toX, tile.toY);\n    return null;\n  }\n\n  if (CAN_NEW_IMAGE_DATA) {\n    // this branch is for modern browsers\n    // If `new ImageData()` & Uint8ClampedArray suported\n    toImageData = new ImageData(new Uint8ClampedArray(result.data), tile.toWidth, tile.toHeight);\n  } else {\n    // fallback for `node-canvas` and old browsers\n    // (IE11 has ImageData but does not support `new ImageData()`)\n    toImageData = stageEnv.toCtx.createImageData(tile.toWidth, tile.toHeight);\n\n    if (toImageData.data.set) {\n      toImageData.data.set(result.data);\n    } else {\n      // IE9 don't have `.set()`\n      for (var i = toImageData.data.length - 1; i >= 0; i--) {\n        toImageData.data[i] = result.data[i];\n      }\n    }\n  }\n\n  this.debug('Draw tile');\n\n  if (NEED_SAFARI_FIX) {\n    // Safari draws thin white stripes between tiles without this fix\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth + 1e-5, tile.toInnerHeight + 1e-5);\n  } else {\n    stageEnv.toCtx.putImageData(toImageData, tile.toX, tile.toY, tile.toInnerX - tile.toX, tile.toInnerY - tile.toY, tile.toInnerWidth, tile.toInnerHeight);\n  }\n\n  return null;\n};\n\nPica.prototype.__tileAndResize = function (from, to, opts) {\n  var _this3 = this;\n\n  var stageEnv = {\n    srcCtx: null,\n    srcImageBitmap: null,\n    isImageBitmapReused: false,\n    toCtx: null\n  };\n\n  var processTile = function processTile(tile) {\n    return _this3.__limit(function () {\n      if (opts.canceled) return opts.cancelToken;\n      var tileOpts = {\n        width: tile.width,\n        height: tile.height,\n        toWidth: tile.toWidth,\n        toHeight: tile.toHeight,\n        scaleX: tile.scaleX,\n        scaleY: tile.scaleY,\n        offsetX: tile.offsetX,\n        offsetY: tile.offsetY,\n        filter: opts.filter,\n        unsharpAmount: opts.unsharpAmount,\n        unsharpRadius: opts.unsharpRadius,\n        unsharpThreshold: opts.unsharpThreshold\n      };\n\n      _this3.debug('Invoke resize math');\n\n      return Promise.resolve(tileOpts).then(function (tileOpts) {\n        return _this3.__extractTileData(tile, from, opts, stageEnv, tileOpts);\n      }).then(function (tileOpts) {\n        _this3.debug('Invoke resize math');\n\n        return _this3.__invokeResize(tileOpts, opts);\n      }).then(function (result) {\n        if (opts.canceled) return opts.cancelToken;\n        stageEnv.srcImageData = null;\n        return _this3.__landTileData(tile, result, stageEnv);\n      });\n    });\n  }; // Need to normalize data source first. It can be canvas or image.\n  // If image - try to decode in background if possible\n\n\n  return Promise.resolve().then(function () {\n    stageEnv.toCtx = to.getContext('2d');\n    if (utils.isCanvas(from)) return null;\n\n    if (utils.isImageBitmap(from)) {\n      stageEnv.srcImageBitmap = from;\n      stageEnv.isImageBitmapReused = true;\n      return null;\n    }\n\n    if (utils.isImage(from)) {\n      // try do decode image in background for faster next operations;\n      // if we're using offscreen canvas, cib is called per tile, so not needed here\n      if (!CAN_CREATE_IMAGE_BITMAP) return null;\n\n      _this3.debug('Decode image via createImageBitmap');\n\n      return createImageBitmap(from).then(function (imageBitmap) {\n        stageEnv.srcImageBitmap = imageBitmap;\n      }) // Suppress error to use fallback, if method fails\n      // https://github.com/nodeca/pica/issues/190\n\n      /* eslint-disable no-unused-vars */\n      [\"catch\"](function (e) {\n        return null;\n      });\n    }\n\n    throw new Error('Pica: \".from\" should be Image, Canvas or ImageBitmap');\n  }).then(function () {\n    if (opts.canceled) return opts.cancelToken;\n\n    _this3.debug('Calculate tiles'); //\n    // Here we are with \"normalized\" source,\n    // follow to tiling\n    //\n\n\n    var regions = createRegions({\n      width: opts.width,\n      height: opts.height,\n      srcTileSize: _this3.options.tile,\n      toWidth: opts.toWidth,\n      toHeight: opts.toHeight,\n      destTileBorder: opts.__destTileBorder\n    });\n    var jobs = regions.map(function (tile) {\n      return processTile(tile);\n    });\n\n    function cleanup(stageEnv) {\n      if (stageEnv.srcImageBitmap) {\n        if (!stageEnv.isImageBitmapReused) stageEnv.srcImageBitmap.close();\n        stageEnv.srcImageBitmap = null;\n      }\n    }\n\n    _this3.debug('Process tiles');\n\n    return Promise.all(jobs).then(function () {\n      _this3.debug('Finished!');\n\n      cleanup(stageEnv);\n      return to;\n    }, function (err) {\n      cleanup(stageEnv);\n      throw err;\n    });\n  });\n};\n\nPica.prototype.__processStages = function (stages, from, to, opts) {\n  var _this4 = this;\n\n  if (opts.canceled) return opts.cancelToken;\n\n  var _stages$shift = stages.shift(),\n      _stages$shift2 = _slicedToArray(_stages$shift, 2),\n      toWidth = _stages$shift2[0],\n      toHeight = _stages$shift2[1];\n\n  var isLastStage = stages.length === 0; // Optimization for legacy filters -\n  // only use user-defined quality for the last stage,\n  // use simpler (Hamming) filter for the first stages where\n  // scale factor is large enough (more than 2-3)\n  //\n  // For advanced filters (mks2013 and custom) - skip optimization,\n  // because need to apply sharpening every time\n\n  var filter;\n  if (isLastStage || filter_info.q2f.indexOf(opts.filter) < 0) filter = opts.filter;else if (opts.filter === 'box') filter = 'box';else filter = 'hamming';\n  opts = assign({}, opts, {\n    toWidth: toWidth,\n    toHeight: toHeight,\n    filter: filter\n  });\n  var tmpCanvas;\n\n  if (!isLastStage) {\n    // create temporary canvas\n    tmpCanvas = this.options.createCanvas(toWidth, toHeight);\n  }\n\n  return this.__tileAndResize(from, isLastStage ? to : tmpCanvas, opts).then(function () {\n    if (isLastStage) return to;\n    opts.width = toWidth;\n    opts.height = toHeight;\n    return _this4.__processStages(stages, tmpCanvas, to, opts);\n  }).then(function (res) {\n    if (tmpCanvas) {\n      // Safari 12 workaround\n      // https://github.com/nodeca/pica/issues/199\n      tmpCanvas.width = tmpCanvas.height = 0;\n    }\n\n    return res;\n  });\n};\n\nPica.prototype.__resizeViaCreateImageBitmap = function (from, to, opts) {\n  var _this5 = this;\n\n  var toCtx = to.getContext('2d');\n  this.debug('Resize via createImageBitmap()');\n  return createImageBitmap(from, {\n    resizeWidth: opts.toWidth,\n    resizeHeight: opts.toHeight,\n    resizeQuality: utils.cib_quality_name(filter_info.f2q[opts.filter])\n  }).then(function (imageBitmap) {\n    if (opts.canceled) return opts.cancelToken; // if no unsharp - draw directly to output canvas\n\n    if (!opts.unsharpAmount) {\n      toCtx.drawImage(imageBitmap, 0, 0);\n      imageBitmap.close();\n      toCtx = null;\n\n      _this5.debug('Finished!');\n\n      return to;\n    }\n\n    _this5.debug('Unsharp result');\n\n    var tmpCanvas = _this5.options.createCanvas(opts.toWidth, opts.toHeight);\n\n    var tmpCtx = tmpCanvas.getContext('2d');\n    tmpCtx.drawImage(imageBitmap, 0, 0);\n    imageBitmap.close();\n    var iData = tmpCtx.getImageData(0, 0, opts.toWidth, opts.toHeight);\n\n    _this5.__mathlib.unsharp_mask(iData.data, opts.toWidth, opts.toHeight, opts.unsharpAmount, opts.unsharpRadius, opts.unsharpThreshold);\n\n    toCtx.putImageData(iData, 0, 0); // Safari 12 workaround\n    // https://github.com/nodeca/pica/issues/199\n\n    tmpCanvas.width = tmpCanvas.height = 0;\n    iData = tmpCtx = tmpCanvas = toCtx = null;\n\n    _this5.debug('Finished!');\n\n    return to;\n  });\n};\n\nPica.prototype.resize = function (from, to, options) {\n  var _this6 = this;\n\n  this.debug('Start resize...');\n  var opts = assign({}, DEFAULT_RESIZE_OPTS);\n\n  if (!isNaN(options)) {\n    opts = assign(opts, {\n      quality: options\n    });\n  } else if (options) {\n    opts = assign(opts, options);\n  }\n\n  opts.toWidth = to.width;\n  opts.toHeight = to.height;\n  opts.width = from.naturalWidth || from.width;\n  opts.height = from.naturalHeight || from.height; // Legacy `.quality` option\n\n  if (Object.prototype.hasOwnProperty.call(opts, 'quality')) {\n    if (opts.quality < 0 || opts.quality > 3) {\n      throw new Error(\"Pica: .quality should be [0..3], got \".concat(opts.quality));\n    }\n\n    opts.filter = filter_info.q2f[opts.quality];\n  } // Prevent stepper from infinite loop\n\n\n  if (to.width === 0 || to.height === 0) {\n    return Promise.reject(new Error(\"Invalid output size: \".concat(to.width, \"x\").concat(to.height)));\n  }\n\n  if (opts.unsharpRadius > 2) opts.unsharpRadius = 2;\n  opts.canceled = false;\n\n  if (opts.cancelToken) {\n    // Wrap cancelToken to avoid successive resolve & set flag\n    opts.cancelToken = opts.cancelToken.then(function (data) {\n      opts.canceled = true;\n      throw data;\n    }, function (err) {\n      opts.canceled = true;\n      throw err;\n    });\n  }\n\n  var DEST_TILE_BORDER = 3; // Max possible filter window size\n\n  opts.__destTileBorder = Math.ceil(Math.max(DEST_TILE_BORDER, 2.5 * opts.unsharpRadius | 0));\n  return this.init().then(function () {\n    if (opts.canceled) return opts.cancelToken; // if createImageBitmap supports resize, just do it and return\n\n    if (_this6.features.cib) {\n      if (filter_info.q2f.indexOf(opts.filter) >= 0) {\n        return _this6.__resizeViaCreateImageBitmap(from, to, opts);\n      }\n\n      _this6.debug('cib is enabled, but not supports provided filter, fallback to manual math');\n    }\n\n    if (!CAN_USE_CANVAS_GET_IMAGE_DATA) {\n      var err = new Error('Pica: cannot use getImageData on canvas, ' + \"make sure fingerprinting protection isn't enabled\");\n      err.code = 'ERR_GET_IMAGE_DATA';\n      throw err;\n    } //\n    // No easy way, let's resize manually via arrays\n    //\n\n\n    var stages = createStages(opts.width, opts.height, opts.toWidth, opts.toHeight, _this6.options.tile, opts.__destTileBorder);\n    return _this6.__processStages(stages, from, to, opts);\n  });\n}; // RGBA buffer resize\n//\n\n\nPica.prototype.resizeBuffer = function (options) {\n  var _this7 = this;\n\n  var opts = assign({}, DEFAULT_RESIZE_OPTS, options); // Legacy `.quality` option\n\n  if (Object.prototype.hasOwnProperty.call(opts, 'quality')) {\n    if (opts.quality < 0 || opts.quality > 3) {\n      throw new Error(\"Pica: .quality should be [0..3], got \".concat(opts.quality));\n    }\n\n    opts.filter = filter_info.q2f[opts.quality];\n  }\n\n  return this.init().then(function () {\n    return _this7.__mathlib.resizeAndUnsharp(opts);\n  });\n};\n\nPica.prototype.toBlob = function (canvas, mimeType, quality) {\n  mimeType = mimeType || 'image/png';\n  return new Promise(function (resolve) {\n    if (canvas.toBlob) {\n      canvas.toBlob(function (blob) {\n        return resolve(blob);\n      }, mimeType, quality);\n      return;\n    }\n\n    if (canvas.convertToBlob) {\n      resolve(canvas.convertToBlob({\n        type: mimeType,\n        quality: quality\n      }));\n      return;\n    } // Fallback for old browsers\n\n\n    var asString = atob(canvas.toDataURL(mimeType, quality).split(',')[1]);\n    var len = asString.length;\n    var asBuffer = new Uint8Array(len);\n\n    for (var i = 0; i < len; i++) {\n      asBuffer[i] = asString.charCodeAt(i);\n    }\n\n    resolve(new Blob([asBuffer], {\n      type: mimeType\n    }));\n  });\n};\n\nPica.prototype.debug = function () {};\n\nmodule.exports = Pica;\n\n},{\"./lib/mathlib\":1,\"./lib/mm_resize/resize_filter_info\":7,\"./lib/pool\":13,\"./lib/stepper\":14,\"./lib/tiler\":15,\"./lib/utils\":16,\"./lib/worker\":17,\"object-assign\":22,\"webworkify\":23}]},{},[])(\"/index.js\")\n});\n", "/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n", "// PALETTES\n\nexport function RGB(r: number, g: number, b: number) {\n    return ((r & 0xff) << 0) | ((g & 0xff) << 8) | ((b & 0xff) << 16);\n}\n\nexport const MONO_RGB = [\n    RGB(0, 0, 0),\n    RGB(255, 255, 255)\n];\n\nexport const CMYK_RGB = [\n    RGB(0, 0, 0),\n    RGB(255, 128, 64),\n    RGB(64, 255, 128),\n    RGB(128, 64, 255),\n    RGB(255, 255, 255)\n];\n\nexport const VIC_NTSC_RGB = [\n    0x000000,\n    0xFFFFFF,\n    RGB(163, 64, 69),\n    RGB(125, 235, 228),\n    RGB(174, 70, 186),\n    RGB(94, 202, 84),\n    RGB(60, 57, 200),\n    RGB(255, 255, 111),\n    RGB(174, 96, 47),\n    RGB(110, 73, 0),\n    RGB(232, 122, 128),\n    RGB(92, 92, 92),\n    RGB(143, 143, 143),\n    RGB(179, 255, 167),\n    RGB(129, 126, 255),\n    RGB(199, 199, 199)\n];\n\n// https://www.pepto.de/projects/colorvic/\nexport const VIC_PAL_RGB = [\n    RGB(0x00, 0x00, 0x00),\n    RGB(0xff, 0xff, 0xff),\n    RGB(0x81, 0x33, 0x38),\n    RGB(0x75, 0xce, 0xc8),\n    RGB(0x8e, 0x3c, 0x97),\n    RGB(0x56, 0xac, 0x4d),\n    RGB(0x2e, 0x2c, 0x9b),\n    RGB(0xed, 0xf1, 0x71),\n    RGB(0x8e, 0x50, 0x29),\n    RGB(0x55, 0x38, 0x00),\n    RGB(0xc4, 0x6c, 0x71),\n    RGB(0x4a, 0x4a, 0x4a),\n    RGB(0x7b, 0x7b, 0x7b),\n    RGB(0xa9, 0xff, 0x9f),\n    RGB(0x70, 0x6d, 0xeb),\n    RGB(0xb2, 0xb2, 0xb2)\n];\n\n// https://en.wikipedia.org/wiki/List_of_8-bit_computer_hardware_graphics#VIC-20\nexport const VIC20_PAL_RGB = [\n    RGB(0x00,0x00,0x00),\n    RGB(0xff,0xff,0xff),\n    RGB(0x78,0x29,0x22),\n    RGB(0x87,0xd6,0xdd),\n    RGB(0xaa,0x5f,0xb6),\n    RGB(0x55,0xa0,0x49),\n    RGB(0x40,0x31,0x8d),\n    RGB(0xbf,0xce,0x72),\n    RGB(0xaa,0x74,0x49),\n    RGB(0xea,0xb4,0x89),\n    RGB(0xb8,0x69,0x62),\n    RGB(0xc7,0xff,0xff),\n    RGB(0xea,0x9f,0xf6),\n    RGB(0x94,0xe0,0x89),\n    RGB(0x80,0x71,0xcc),\n    RGB(0xff,0xff,0xb2)\n];\n\nexport const TMS9918_RGB = [\n    RGB(0, 0, 0),\n    RGB(0, 0, 0),\n    RGB(33, 200, 66),\n    RGB(94, 220, 120),\n    RGB(84, 85, 237),\n    RGB(125, 118, 252),\n    RGB(212, 82, 77),\n    RGB(66, 235, 245),\n    RGB(252, 85, 84),\n    RGB(255, 121, 120),\n    RGB(212, 193, 84),\n    RGB(230, 206, 128),\n    RGB(33, 176, 59),\n    RGB(201, 91, 186),\n    RGB(204, 204, 204),\n    RGB(255, 255, 255)\n];\n\nexport const NES_RGB = [\n    0x525252, 0xB40000, 0xA00000, 0xB1003D, 0x740069, 0x00005B, 0x00005F, 0x001840, 0x002F10, 0x084A08, 0x006700, 0x124200, 0x6D2800, 0x000000, 0x000000, 0x000000,\n    0xC4D5E7, 0xFF4000, 0xDC0E22, 0xFF476B, 0xD7009F, 0x680AD7, 0x0019BC, 0x0054B1, 0x006A5B, 0x008C03, 0x00AB00, 0x2C8800, 0xA47200, 0x000000, 0x000000, 0x000000,\n    0xF8F8F8, 0xFFAB3C, 0xFF7981, 0xFF5BC5, 0xFF48F2, 0xDF49FF, 0x476DFF, 0x00B4F7, 0x00E0FF, 0x00E375, 0x03F42B, 0x78B82E, 0xE5E218, 0x787878, 0x000000, 0x000000,\n    0xFFFFFF, 0xFFF2BE, 0xF8B8B8, 0xF8B8D8, 0xFFB6FF, 0xFFC3FF, 0xC7D1FF, 0x9ADAFF, 0x88EDF8, 0x83FFDD, 0xB8F8B8, 0xF5F8AC, 0xFFFFB0, 0xF8D8F8, 0x000000, 0x000000\n];\n\nexport const AP2HIRES_RGB = [\n    RGB(0, 0, 0),\n    RGB(255, 68, 253),\n    RGB(20, 245, 60),\n    RGB(20, 207, 253),\n    RGB(255, 106, 60),\n    RGB(255, 255, 255)\n];\n\nexport const AP2LORES_RGB = [\n    RGB(0, 0, 0),\n    RGB(227, 30, 96),\n    RGB(96, 78, 189),\n    RGB(255, 68, 253),\n    RGB(0, 163, 96),\n    RGB(156, 156, 156),\n    RGB(20, 207, 253),\n    RGB(208, 195, 255),\n    RGB(96, 114, 3),\n    RGB(255, 106, 60),\n    RGB(156, 156, 156),\n    RGB(255, 160, 208),\n    RGB(20, 245, 60),\n    RGB(208, 221, 141),\n    RGB(114, 255, 208),\n    RGB(255, 255, 255)\n];\n\nexport const ASTROCADE_RGB = [0, 2368548, 4737096, 7171437, 9539985, 11974326, 14342874, 16777215, 12255269, 14680137, 16716142, 16725394, 16734903, 16744155, 16753663, 16762879, 11534409, 13959277, 16318866, 16721334, 16730842, 16740095, 16749311, 16758783, 10420330, 12779662, 15138995, 16718039, 16727291, 16736767, 16745983, 16755199, 8847495, 11206827, 13631696, 15994612, 16724735, 16733951, 16743423, 16752639, 6946975, 9306307, 11731175, 14092287, 16461055, 16732415, 16741631, 16751103, 4784304, 7143637, 9568505, 11929087, 14297599, 16731647, 16741119, 16750335, 2425019, 4784352, 7209215, 9570047, 12004095, 14372863, 16741375, 16750847, 191, 2359523, 4718847, 7146495, 9515263, 11949311, 14318079, 16752127, 187, 224, 2294015, 4658431, 7092735, 9461247, 11895551, 14264063, 176, 213, 249, 2367999, 4736511, 7105279, 9539327, 11908095, 159, 195, 3303, 209151, 2577919, 4946431, 7380735, 9749247, 135, 171, 7888, 17140, 681983, 3050495, 5484543, 7853311, 106, 3470, 12723, 22231, 31483, 1548031, 3916799, 6285311, 73, 8557, 17810, 27318, 36570, 373759, 2742271, 5176575, 4389, 13641, 23150, 32402, 41911, 51163, 2026495, 4456447, 9472, 18724, 27976, 37485, 46737, 56246, 1834970, 4194303, 14080, 23296, 32803, 42055, 51564, 60816, 2031541, 4456409, 18176, 27648, 36864, 46116, 55624, 392556, 2752401, 5177269, 21760, 30976, 40192, 49667, 58919, 1572683, 3932016, 6291348, 24320, 33536, 43008, 52224, 716810, 3079982, 5504851, 7864183, 25856, 35328, 44544, 250368, 2619136, 4980503, 7405371, 9764703, 26624, 35840, 45312, 2413824, 4782336, 7143173, 9568041, 11927374, 26112, 35584, 2338560, 4707328, 7141376, 9502464, 11927326, 14286659, 24832, 2393344, 4762112, 7196160, 9564928, 11992832, 14352155, 16711487, 2447360, 4815872, 7250176, 9618688, 12052992, 14417664, 16776990, 16777027, 4803328, 7172096, 9606144, 11974912, 14343424, 16776965, 16777001, 16777038, 6962176, 9330688, 11764992, 14133504, 16502272, 16773655, 16777019, 16777055, 8858112, 11226880, 13660928, 16029440, 16759818, 16769070, 16777043, 16777079, 10426112, 12794624, 15163392, 16745475, 16754727, 16764235, 16773488, 16777108, 11534848, 13969152, 16337664, 16740388, 16749640, 16759148, 16768401, 16777141, 12255232, 14684928, 16725795, 16735047, 16744556, 16753808, 16763317, 16772569];\n\nexport const VCS_RGB = [\n    0x000000, 0x000000, 0x404040, 0x404040, 0x6c6c6c, 0x6c6c6c, 0x909090, 0x909090, 0xb0b0b0, 0xb0b0b0, 0xc8c8c8, 0xc8c8c8, 0xdcdcdc, 0xdcdcdc, 0xf4f4f4, 0xf4f4f4,\n    0x004444, 0x004444, 0x106464, 0x106464, 0x248484, 0x248484, 0x34a0a0, 0x34a0a0, 0x40b8b8, 0x40b8b8, 0x50d0d0, 0x50d0d0, 0x5ce8e8, 0x5ce8e8, 0x68fcfc, 0x68fcfc,\n    0x002870, 0x002870, 0x144484, 0x144484, 0x285c98, 0x285c98, 0x3c78ac, 0x3c78ac, 0x4c8cbc, 0x4c8cbc, 0x5ca0cc, 0x5ca0cc, 0x68b4dc, 0x68b4dc, 0x78c8ec, 0x78c8ec,\n    0x001884, 0x001884, 0x183498, 0x183498, 0x3050ac, 0x3050ac, 0x4868c0, 0x4868c0, 0x5c80d0, 0x5c80d0, 0x7094e0, 0x7094e0, 0x80a8ec, 0x80a8ec, 0x94bcfc, 0x94bcfc,\n    0x000088, 0x000088, 0x20209c, 0x20209c, 0x3c3cb0, 0x3c3cb0, 0x5858c0, 0x5858c0, 0x7070d0, 0x7070d0, 0x8888e0, 0x8888e0, 0xa0a0ec, 0xa0a0ec, 0xb4b4fc, 0xb4b4fc,\n    0x5c0078, 0x5c0078, 0x74208c, 0x74208c, 0x883ca0, 0x883ca0, 0x9c58b0, 0x9c58b0, 0xb070c0, 0xb070c0, 0xc084d0, 0xc084d0, 0xd09cdc, 0xd09cdc, 0xe0b0ec, 0xe0b0ec,\n    0x780048, 0x780048, 0x902060, 0x902060, 0xa43c78, 0xa43c78, 0xb8588c, 0xb8588c, 0xcc70a0, 0xcc70a0, 0xdc84b4, 0xdc84b4, 0xec9cc4, 0xec9cc4, 0xfcb0d4, 0xfcb0d4,\n    0x840014, 0x840014, 0x982030, 0x982030, 0xac3c4c, 0xac3c4c, 0xc05868, 0xc05868, 0xd0707c, 0xd0707c, 0xe08894, 0xe08894, 0xeca0a8, 0xeca0a8, 0xfcb4bc, 0xfcb4bc,\n    0x880000, 0x880000, 0x9c201c, 0x9c201c, 0xb04038, 0xb04038, 0xc05c50, 0xc05c50, 0xd07468, 0xd07468, 0xe08c7c, 0xe08c7c, 0xeca490, 0xeca490, 0xfcb8a4, 0xfcb8a4,\n    0x7c1800, 0x7c1800, 0x90381c, 0x90381c, 0xa85438, 0xa85438, 0xbc7050, 0xbc7050, 0xcc8868, 0xcc8868, 0xdc9c7c, 0xdc9c7c, 0xecb490, 0xecb490, 0xfcc8a4, 0xfcc8a4,\n    0x5c2c00, 0x5c2c00, 0x784c1c, 0x784c1c, 0x906838, 0x906838, 0xac8450, 0xac8450, 0xc09c68, 0xc09c68, 0xd4b47c, 0xd4b47c, 0xe8cc90, 0xe8cc90, 0xfce0a4, 0xfce0a4,\n    0x2c3c00, 0x2c3c00, 0x485c1c, 0x485c1c, 0x647c38, 0x647c38, 0x809c50, 0x809c50, 0x94b468, 0x94b468, 0xacd07c, 0xacd07c, 0xc0e490, 0xc0e490, 0xd4fca4, 0xd4fca4,\n    0x003c00, 0x003c00, 0x205c20, 0x205c20, 0x407c40, 0x407c40, 0x5c9c5c, 0x5c9c5c, 0x74b474, 0x74b474, 0x8cd08c, 0x8cd08c, 0xa4e4a4, 0xa4e4a4, 0xb8fcb8, 0xb8fcb8,\n    0x003814, 0x003814, 0x1c5c34, 0x1c5c34, 0x387c50, 0x387c50, 0x50986c, 0x50986c, 0x68b484, 0x68b484, 0x7ccc9c, 0x7ccc9c, 0x90e4b4, 0x90e4b4, 0xa4fcc8, 0xa4fcc8,\n    0x00302c, 0x00302c, 0x1c504c, 0x1c504c, 0x347068, 0x347068, 0x4c8c84, 0x4c8c84, 0x64a89c, 0x64a89c, 0x78c0b4, 0x78c0b4, 0x88d4cc, 0x88d4cc, 0x9cece0, 0x9cece0,\n    0x002844, 0x002844, 0x184864, 0x184864, 0x306884, 0x306884, 0x4484a0, 0x4484a0, 0x589cb8, 0x589cb8, 0x6cb4d0, 0x6cb4d0, 0x7ccce8, 0x7ccce8, 0x8ce0fc, 0x8ce0fc\n];\n\nexport const CGA_RGB = [\n    0x000000, 0xAA0000, 0x00AA00, 0xAAAA00, 0x0000AA, 0xAA00AA, 0x0055AA, 0xAAAAAA,\n    0x555555, 0xFF5555, 0x55FF55, 0xFFFF55, 0x5555FF, 0xFF55FF, 0x55FFFF, 0xFFFFFF,\n];\n\nexport const CGA_RGB_1 = [0x000000, 0x00AA00, 0x0000AA, 0x0055AA];\nexport const CGA_RGB_2 = [0x000000, 0xAAAA00, 0xAA00AA, 0xAAAAAA];\nexport const CGA_RGB_3 = [0x000000, 0xAAAA00, 0x0000AA, 0xAAAAAA];\nexport const CGA_RGB_1H = [0x000000, 0x55FF55, 0x5555FF, 0x55FFFF];\nexport const CGA_RGB_2H = [0x000000, 0xFFFF55, 0xFF55FF, 0xFFFFFF];\nexport const CGA_RGB_3H = [0x000000, 0xFFFF00, 0x5555FF, 0xFFFFFF];\nexport const SMS_RGB = generateRGBPalette(2, 2, 2);\nexport const WILLIAMS_RGB = generateRGBPalette(3, 3, 2);\nexport const ATARIST_RGB = generateRGBPalette(3, 3, 3);\nexport const TELETEXT_RGB = generateRGBPalette(1, 1, 1);\n\nexport const ZXSPECTRUM_RGB = [ // GRB\n    RGB(0x00, 0x00, 0x00),  // 0x00 Black            // dark palette\n    RGB(0x01, 0x00, 0xCE),  // 0x01 Blue\n    RGB(0xCF, 0x01, 0x00),  // 0x02 Red\n    RGB(0xCF, 0x01, 0xCE),  // 0x03 Magenta\n    RGB(0x00, 0xCF, 0x15),  // 0x04 Green\n    RGB(0x01, 0xCF, 0xCF),  // 0x05 Cyan\n    RGB(0xCF, 0xCF, 0x15),  // 0x06 Yellow\n    RGB(0xCF, 0xCF, 0xCF),  // 0x07 White\n\n    RGB(0x00, 0x00, 0x00),  // 0x08 \"Bright\" Black   // bright palette\n    RGB(0x02, 0x00, 0xFD),  // 0x09 Bright Blue\n    RGB(0xFF, 0x02, 0x01),  // 0x0A Bright Red\n    RGB(0xFF, 0x02, 0xFD),  // 0x0B Bright Magenta\n    RGB(0x00, 0xFF, 0x1C),  // 0x0C Bright Green\n    RGB(0x02, 0xFF, 0xFF),  // 0x0D Bright Cyan\n    RGB(0xFF, 0xFF, 0x1D),  // 0x0E Bright Yellow\n    RGB(0xFF, 0xFF, 0xFF),  // 0x0F Bright White\n];\n\n// see https://forums.atariage.com/topic/278354-gfx-palette-flag/\nexport const INTELLIVISION_STIC_RGB = [\n    RGB(  0,  0,  0),   // Black            // primary color set\n    RGB(  0,117,255),   // Blue\n    RGB(255, 76, 57),   // Red\n    RGB(209,185, 81),   // Tan\n    RGB(  9,185,  0),   // Dark Green\n    RGB( 48,223, 16),   // Green\n    RGB(255,229,  1),   // Yellow\n    RGB(255,255,255),   // White\n    RGB(140,140,140),   // Gray             // pastel color set\n    RGB( 40,229,192),   // Cyan\n    RGB(255,160, 46),   // Orange\n    RGB(100,103,  0),   // Brown\n    RGB(255, 41,255),   // Pink\n    RGB(140,143,255),   // Light Blue\n    RGB(124,237,  0),   // Yellow Green\n    RGB(196, 43,252),   // Purple\n];\n\nexport const AMSTRAD_CPC_RGB = [\n    0x000000, 0x800090, 0xFF0000,\n    0x000080, 0x800080, 0xFF0080,\n    0x0000FF, 0x8000FF, 0xFF00FF,\n    0x008000, 0x808000, 0xFF8000,\n    0x008080, 0x808080, 0xFF8080,\n    0x0080FF, 0x8080FF, 0xFF80FF,\n    0x00FF00, 0x80FF00, 0xFFFF00,\n    0x00FF80, 0x80FF80, 0xFFFF80,\n    0x00FFFF, 0x80FFFF, 0xFFFFFF,\n];\n\n// TODO: should these be reversed?\nexport const PICO8_RGB = [\n    0x000000, //0, 0, 0 black\n    0x1D2B53, //29, 43, 83 dark-blue\n    0x7E2553, //126, 37, 83 dark-purple\n    0x008751, //0, 135, 81 dark-green\n    0xAB5236, //171, 82, 54 brown\n    0x5F574F, //95, 87, 79 dark-gray\n    0xC2C3C7, //194, 195, 199 light-gray\n    0xFFF1E8, //255, 241, 232 white\n    0xFF004D, //255, 0, 77 red\n    0xFFA300, //255, 163, 0 orange\n    0xFFEC27, //255, 236, 39 yellow\n    0x00E436, //0, 228, 54 green\n    0x29ADFF, //41, 173, 255 blue\n    0x83769C, //131, 118, 156 indigo\n    0xFF77A8, //255, 119, 168 pink\n    0xFFCCAA, //255, 204, 170 peach\n];\n\nexport const TIC80_RGB = [\n    0x140C1C,\n    0x442434,\n    0x30346D,\n    0x4E4A4F,\n    0x854C30,\n    0x346524,\n    0xD04648,\n    0x757161,\n    0x597DCE,\n    0xD27D2C,\n    0x8595A1,\n    0x6DAA2C,\n    0xD2AA99,\n    0x6DC2CA,\n    0xDAD45E,\n    0xDEEED6,\n];\n\n// TODO: https://geeks-world.github.io/articles/467811/index.html\nexport const CHANNELF_RGB = [\n    // background\n    /*\n    0xe0e0e0,\n    0x101010,\n    0x91ffa6,\n    0xced0ff,\n    */\n    // foreground\n    0xfcfcfc,\n    0xff3153,\n    0x02cc5d,\n    0x4b3ff3,\n];\n\nexport const GAMEBOY_GREEN_RGB = [\n    0x0f380f,\n    0x306230,\n    0x0fac8c,\n    0x0fccac,\n];\n\nexport const GAMEBOY_MONO_RGB = [\n    0x000000,\n    0x555555,\n    0xaaaaaa,\n    0xffffff,\n];\n\nexport const RGB_444 = generateRGBPalette(4, 4, 4);\nexport const GAMEBOY_COLOR_RGB = RGB_444;\nexport const AMIGA_OCS_COLOR_RGB = RGB_444;\nexport const IIGS_COLOR_RGB = RGB_444;\nexport const GAMEGEAR_COLOR_RGB = RGB_444;\nexport const SNES_B5G5R5_RGB = generateSNESB5G5R5();\nexport const SNES_BBPGGGPRRRP = generateSNESDirectColor();\n\nexport const MC6847_PALETTE0 = [\n    RGB(0x30, 0xd2, 0x00),    /* NTSC: RGB( 28, 213,  16), */   // green \n    RGB(0xf5, 0xf5, 0x80),    /* NTSC: RGB(226, 219,  15), */   // yellow\n    RGB(0x4c, 0x3a, 0xb4),    /* NTSC: RGB(  3,  32, 255), */   // blue  \n    RGB(0x9a, 0x32, 0x36),    /* NTSC: RGB(226,  32,  10), */   // red   \n];\n\nexport const MC6847_PALETTE1 = [\n    RGB(0xd8, 0xd8, 0xd8),    /* NTSC: RGB( 205, 219, 224), */  // buff    \n    RGB(0x41, 0xaf, 0x71),    /* NTSC: RGB(  22, 208, 226), */  // cyan    \n    RGB(0xd8, 0x6e, 0xf0),    /* NTSC: RGB( 203,  57, 226), */  // magenta \n    RGB(0xd4, 0x7f, 0x00),    /* NTSC: RGB( 204,  45,  16), */  // orange  \n];\n\nfunction generateRGBPalette(rr: number, gg: number, bb: number) {\n    var n = 1 << (rr + gg + bb);\n    var rs = 255 / ((1 << rr) - 1);\n    var gs = 255 / ((1 << gg) - 1);\n    var bs = 255 / ((1 << bb) - 1);\n    var pal = new Uint32Array(n);\n    for (var i = 0; i < n; i++) {\n        var r = (i & ((1 << rr) - 1));\n        var g = ((i >> rr) & ((1 << gg) - 1));\n        var b = ((i >> (rr + gg)) & ((1 << bb) - 1));\n        pal[i] = RGB(r * rs, g * gs, b * bs);\n    }\n    return pal;\n}\n\nfunction generateSNESB5G5R5() : Uint32Array {\n    let result = new Uint32Array(1 << (5+5+5));\n    let i = 0;\n    for (let r = 0; r < (1 << 5); ++r) {\n        for (let g = 0; g < (1 << 5); ++g) {\n            for (let b = 0; b < (1 << 5); ++b, ++i) {\n                let color = (r << 3) | (g << (3 + 8)) | (b << (3 + 16));\n                color |= ((r & 0b11100) >> 2) | (((g & 0b11100) >> 2) << 8) | (((b & 0b11100) >> 2) << 16);\n                result[i] = color;\n            }\n        }\n    }\n    return result;\n}\n\nfunction generateSNESDirectColor() : Uint32Array {\n\n    let result = new Uint32Array(1 << (4+4+3));\n    let i = 0;\n    for (let r = 0; r < (1 << 4); ++r) {\n        for (let g = 0; g < (1 << 4); ++g) {\n            for (let b = 0; b < (1 << 3); ++b, ++i) {\n                let color = (r << 4) | (g << (4 + 8)) | (b << (5 + 16));\n                result[i] = color;\n            }\n        }\n    }\n    return result;\n}\n", "import { DithertronSettings } from \"../common/types\";\nimport * as palettes from \"./palettes\";\n\nexport const SYSTEMS: (DithertronSettings | null)[] = [\n    {\n        id: 'c64.multi',\n        name: 'C-64 Multi',\n        width: 160,\n        height: 200,\n        scaleX: 0.936 * 2,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w:4, h:8, colors: 4, xb:1, yb:2 },\n        cell: {w: 4, h: 8, msbToLsb: true },\n        paletteChoices:{background: true},        \n        cb: { w: 4, h: 8, xb: 1, yb: 2 },\n        param: { extra: 1 },\n        toNative: 'exportC64Multi',\n    },\n    {\n        id: 'c64.multi.fli',\n        name: 'C-64 Multi FLI (w/o bug)',\n        width: 160,\n        height: 200,\n        scaleX: 0.936 * 2,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 4, h: 1, colors: 4, xb: 1 },\n        paletteChoices:{ background: true },\n        cell: {w: 4, h: 8, msbToLsb: true },\n        cb: { w: 4, h: 8, xb: 1, yb: 2 },\n        param: { extra: 1 },\n        fli: { bug: false, blankLeft: false, blankRight: false, blankColumns: 3 },\n        toNative: 'exportC64Multi',\n    },\n    {\n        id: 'c64.multi.fli.bug',\n        name: 'C-64 Multi FLI (with bug)',\n        width: 160,\n        height: 200,\n        scaleX: 0.936 * 2,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 4, h: 1, colors: 4, xb: 1 },\n        cell: {w: 4, h: 8, msbToLsb: true },\n        paletteChoices: { background: true },\n        cb: { w: 4, h: 8, xb: 1, yb: 2 },\n        param: { extra: 1 },\n        fli: { bug: true, blankLeft: false, blankRight: false, blankColumns: 3 },\n        toNative: 'exportC64Multi',\n    },\n    {\n        id: 'c64.multi.fli.blank.left',\n        name: 'C-64 Multi FLI (Left blank)',\n        width: 160,\n        height: 200,\n        scaleX: 0.936 * 2,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 4, h: 1, colors: 4, xb: 1 },\n        cell: {w: 4, h: 8, msbToLsb: true },\n        paletteChoices: { background: true },\n        cb: { w: 4, h: 8, xb: 1, yb: 2 },\n        param: { extra: 1 },\n        fli: { bug: false, blankLeft: true, blankRight: false, blankColumns: 3 },\n        toNative: 'exportC64Multi',\n    },\n    {\n        id: 'c64.multi.fli.blank',\n        name: 'C-64 Multi FLI (L/R blank)',\n        width: 160,\n        height: 200,\n        scaleX: 0.936 * 2,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 4, h: 1, colors: 4, xb: 1 },\n        cell: {w: 4, h: 8, msbToLsb: true },\n        paletteChoices: { background:true },\n        cb: { w: 4, h: 8, xb: 1, yb: 2 },\n        param: { extra: 1 },\n        fli: { bug: false, blankLeft: true, blankRight: true, blankColumns: 3 },\n        toNative: 'exportC64Multi',\n    },\n    {\n        id: 'c64.hires',\n        name: 'C-64 Hires',\n        width: 320,\n        height: 200,\n        scaleX: 0.936,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: {w: 8, h: 8, msbToLsb: true },\n        param: { extra: 1 },\n        toNative: 'exportC64Hires',\n    },\n    {\n        id: 'c64.hires.fli',\n        name: 'C-64 Hires FLI (w/o bug)',\n        width: 320,\n        height: 200,\n        scaleX: 0.936,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 8, h: 1, colors: 2 },\n        cell: {w: 8, h: 8, msbToLsb: true },\n        param: { extra: 1 },\n        fli: { bug: false, blankLeft: false, blankRight: false, blankColumns: 3 },\n        toNative: 'exportC64Hires',\n    },\n    {\n        id: 'c64.hires.fli.bug',\n        name: 'C-64 Hires FLI (with bug)',\n        width: 320,\n        height: 200,\n        scaleX: 0.936,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 8, h: 1, colors: 2 },\n        cell: {w: 8, h: 8, msbToLsb: true },\n        param: { extra: 1 },\n        fli: { bug: true, blankLeft: false, blankRight: false, blankColumns: 3 },\n        toNative: 'exportC64Hires',\n    },\n    {\n        id: 'c64.hires.fli.blank',\n        name: 'C-64 Hires FLI (L/R blank)',\n        width: 320,\n        height: 200,\n        scaleX: 0.936,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC_PAL_RGB,\n        block: { w: 8, h: 1, colors: 2 },\n        cell: {w: 8, h: 8, msbToLsb: true },\n        param: { extra: 1 },\n        fli: { bug: false, blankLeft: true, blankRight: true, blankColumns: 3 },\n        toNative: 'exportC64Hires',\n    },\n    {\n        id: 'nes',\n        name: 'NES (4 color, 240 tiles)',\n        width: 160,\n        height: 96,\n        scaleX: 8 / 7,\n        conv: 'DitheringCanvas',\n        pal: palettes.NES_RGB,\n        reduce: 4,\n        toNative: 'exportNES',\n    },\n    {\n        id: 'msx',\n        name: 'MSX/Coleco (TMS9918A)',\n        width: 256,\n        height: 192,\n        conv: 'Msx_Canvas',\n        pal: palettes.TMS9918_RGB,\n        block: { w: 8, h: 1, colors: 2 },\n        cell: {w: 8, h: 8, msbToLsb: true },\n        toNative: 'exportTMS9918',\n    },\n    {\n        id: 'apple2.hires',\n        name: 'Apple ][ (Hires)',\n        width: 140,\n        height: 192,\n        scaleX: 2,\n        conv: 'Apple2_Canvas',\n        pal: palettes.AP2HIRES_RGB,\n        block: { w: 7, h: 1, colors: 4 },\n        toNative: 'exportApple2HiresToHGR',\n    },\n    {\n        id: 'atari8.d',\n        name: 'Atari ANTIC (Mode D)',\n        width: 160,\n        height: 96,\n        scaleX: 0.8571,\n        conv: 'DitheringCanvas',\n        pal: palettes.VCS_RGB,\n        reduce: 4,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 2, brev: true },\n    },\n    {\n        id: 'atari8.f.10',\n        name: 'Atari ANTIC (Mode F/10)',\n        width: 80,\n        height: 192,\n        scaleX: 0.8571 * 4,\n        conv: 'DitheringCanvas',\n        pal: palettes.VCS_RGB,\n        reduce: 9,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 4, brev: true },\n    },\n    {\n        id: 'vcs',\n        name: 'Atari VCS',\n        width: 40,\n        height: 192,\n        scaleX: 6,\n        conv: 'DitheringCanvas',\n        pal: palettes.VCS_RGB,\n        reduce: 2,\n        toNative: 'exportVCSPlayfield',\n    },\n    {\n        id: 'vcs.color',\n        name: 'Atari VCS (Color)',\n        width: 40,\n        height: 192,\n        scaleX: 6,\n        conv: 'VCSColorPlayfield_Canvas',\n        pal: palettes.VCS_RGB,\n        toNative: 'exportVCSPlayfield',\n    },\n    {\n        id: 'astrocade',\n        name: 'Bally Astrocade',\n        width: 160,\n        height: 98,\n        scaleX: 1,\n        conv: 'DitheringCanvas',\n        pal: palettes.ASTROCADE_RGB,\n        reduce: 4,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 2, brev: true },\n    },\n    {\n        id: 'zx',\n        name: 'ZX Spectrum',\n        width: 256,\n        height: 192,\n        conv: 'ZXSpectrum_Canvas',\n        pal: palettes.ZXSPECTRUM_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        toNative: 'exportZXSpectrum'\n    },\n    {\n        id: 'zx.dark',\n        name: 'ZX Spectrum (dark only)',\n        width: 256,\n        height: 192,\n        conv: 'ZXSpectrum_Canvas',\n        pal: palettes.ZXSPECTRUM_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: { colorsRange: { min: 0, max: 7 } },\n        toNative: 'exportZXSpectrum'\n    },\n    {\n        id: 'zx.bright',\n        name: 'ZX Spectrum (bright only)',\n        width: 256,\n        height: 192,\n        conv: 'ZXSpectrum_Canvas',\n        pal: palettes.ZXSPECTRUM_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: { colorsRange: { min: 8, max: 15 } },\n        toNative: 'exportZXSpectrum'\n    },\n    {\n        id: 'zx.dark.bright',\n        name: 'ZX Spectrum (dark made bright only)',\n        width: 256,\n        height: 192,\n        conv: 'ZXSpectrum_Canvas',\n        pal: palettes.ZXSPECTRUM_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: { colorsRange: { min: 0, max: 7 } }, // aux is used to signal the special mode\n        customize: { flipPalette: true },\n        toNative: 'exportZXSpectrum'\n    },\n    {\n        id: 'zx.bright.dark',\n        name: 'ZX Spectrum (bright made dark only)',\n        width: 256,\n        height: 192,\n        conv: 'ZXSpectrum_Canvas',\n        pal: palettes.ZXSPECTRUM_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: { colorsRange: { min: 8, max: 15 } }, // aux is used to signal the special mode\n        customize: { flipPalette: true },\n        toNative: 'exportZXSpectrum'\n    },\n    {\n        id: 'cpc.mode0',\n        name: 'Amstrad CPC (mode 0)',\n        width: 160,\n        height: 200,\n        scaleX: 2,\n        conv: 'DitheringCanvas',\n        pal: palettes.AMSTRAD_CPC_RGB,\n        reduce: 16,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 4, yremap: [3, 80, 2048], bitremap: [7, 3, 5, 1, 6, 2, 4, 0] }\n    },\n    {\n        id: 'cpc.mode1',\n        name: 'Amstrad CPC (mode 1)',\n        width: 320,\n        height: 200,\n        scaleX: 1,\n        conv: 'DitheringCanvas',\n        pal: palettes.AMSTRAD_CPC_RGB,\n        reduce: 4,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 2, yremap: [3, 80, 2048], bitremap: [7, 3, 6, 2, 5, 1, 4, 0] }\n    },\n\n    // null == separator, systems with runnable source code are above\n    null,\n\n    {\n        id: 'vic20.hires',\n        name: 'VIC-20 Hires',\n        width: 160,\n        height: 160,\n        scaleX: 1.5,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC20_PAL_RGB,\n        block: { w: 8, h: 8, colors: 2 },               // can choose the background, or one foreground color\n        cell: {w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            background: true,                           // pixels can choose the background color\n            backgroundRange: { min: 0, max: 7 },        // (but with a reduced color palette)\n            colorsRange: { min: 0, max: 7 }             // pixels can only choose from a reduced color palette\n        },\n        toNative:'exportVicHires',\n    },\n    {\n        id: 'vic20.multi',\n        name: 'VIC-20 Multi',\n        width: 80,\n        height: 160,\n        scaleX: 3,\n        conv: 'VICII_Canvas',\n        pal: palettes.VIC20_PAL_RGB,\n        block: { w: 4, h: 8, colors: 4 },               // can choose background, aux, border and one foreground color\n        cell: {w: 4, h: 8, msbToLsb: true },    \n        paletteChoices: {\n            background: true,                           // pixels can choose the background color\n            backgroundRange: { min: 0, max: 15 },\n            aux: true,                                  // pixels can choose the aux color\n            auxRange: { min: 0, max: 15},\n            border: true,                               // pixels can choose the border color\n            borderRange: { min: 0, max: 7 },            // (but with a reduced palette)\n            colorsRange: { min: 0, max: 7 }             // a reduced palette applies to the pixel colors\n        },\n        toNative:'exportVicMulti',\n    },\n    {\n        id: 'nes.1bpp',\n        name: 'NES (1bpp) (8x8) (32x32) Planar',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 2, msbToLsb: false },  // bit plane colors are stored LSB to MSB\n        cell: { w: 8, h: 8, msbToLsb: true },                // cell pixels are stored MSB to LSB\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 1 },\n            auxRange: { min: 0, max: 1 },\n            borderRange: { min: 0, max: 1 },\n            colorsRange: { min: 0, max: 1 }\n        },\n        reduce: 2,\n        customize: { outputTileset: false, outputPalette: true },\n        toNative:'exportSNES'\n    },\n    {\n        id: 'nes.2bpp',\n        name: 'NES (2bpp) (8x8) (32x32) Planar',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 4, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 3 },\n            auxRange: { min: 0, max: 3 },\n            borderRange: { min: 0, max: 3 },\n            colorsRange: { min: 0, max: 3 }\n        },\n        reduce: 4,\n        customize: { outputTileset: false, outputPalette: true },\n        toNative:'exportSNES'\n    },\n    {\n        id: 'snes.2bpp',\n        name: 'SNES (+Gameboy/GBC) (2bpp) (8x8) (32x32) Planar',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 4, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 3 },\n            auxRange: { min: 0, max: 3 },\n            borderRange: { min: 0, max: 3 },\n            colorsRange: { min: 0, max: 3 }\n        },\n        customize: { outputTileset: false, outputPalette: false, planeToMemory: 'interleaved' },\n        reduce: 4,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'snes.3bpp',\n        name: 'SNES (3bpp) (8x8) (32x32) Planar',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 8, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 7 },\n            auxRange: { min: 0, max: 7 },\n            borderRange: { min: 0, max: 7 },\n            colorsRange: { min: 0, max: 7 }\n        },\n        reduce: 8,\n        customize: { planeToMemory: 'interleaved' },\n        toNative:'exportSNES'\n    },\n    {\n        id: 'snes.4bpp',\n        name: 'SNES (4bpp) (8x8) (32x32) Planar',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 16, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 15 },\n            auxRange: { min: 0, max: 15},\n            borderRange: { min: 0, max: 15 },\n            colorsRange: { min: 0, max: 15 }\n        },\n        customize: { planeToMemory: 'interleaved' },\n        reduce: 16,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'snes.8bpp',\n        name: 'SNES (8bpp) (8x8) (32x32) Planar',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 256, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 255 },\n            auxRange: { min: 0, max: 255 },\n            borderRange: { min: 0, max: 255 },\n            colorsRange: { min: 0, max: 255 }\n        },\n        customize: { planeToMemory: 'interleaved' },\n        reduce: 256,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'snes.mode7',\n        name: 'SNES (Mode 7) (8bpp) (8x8) (32x32)',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 256, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 255 },\n            auxRange: { min: 0, max: 255 },\n            borderRange: { min: 0, max: 255 },\n            colorsRange: { min: 0, max: 255 }\n        },\n        customize: { bitsInPlane: 8, planes: 1 },\n        reduce: 256,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'neo.geopocket',\n        name: 'NEO Geo Pocket Color (2pp) (8x8) (32x32)',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 256, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 255 },\n            auxRange: { min: 0, max: 255 },\n            borderRange: { min: 0, max: 255 },\n            colorsRange: { min: 0, max: 255 }\n        },\n        customize: { outputTileset: false, outputPalette: false, bitsInPlane: 2, planes: 1, planeLittleEndian: false },\n        reduce: 256,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'virtualboy',\n        name: 'Virtual Boy (2pp) (8x8) (32x32)',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 4, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 3 },\n            auxRange: { min: 0, max: 3 },\n            borderRange: { min: 0, max: 3 },\n            colorsRange: { min: 0, max: 3 }\n        },\n        customize: { outputTileset: false, outputPalette: false, bitsInPlane: 2, planes: 1, planeLittleEndian: true },\n        reduce: 4,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'gg.4pp',\n        name: 'Game Gear (+Sega Master Systems/Wonder Color) (4bpp) (8x8) (32x32) Linear',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 16, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 15 },\n            auxRange: { min: 0, max: 15 },\n            borderRange: { min: 0, max: 15 },\n            colorsRange: { min: 0, max: 15 }\n        },\n        customize: { outputTileset: false, outputPalette: false, planeToMemory: 'linear' },\n        reduce: 16,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'genesis',\n        name: 'Genesis/x68k (4pp) (8x8) (32x32)',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas',\n        pal: palettes.SNES_B5G5R5_RGB,\n        block: { w: 8, h: 8, colors: 16, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 15 },\n            auxRange: { min: 0, max: 15 },\n            borderRange: { min: 0, max: 15 },\n            colorsRange: { min: 0, max: 15 }\n        },\n        customize: { outputTileset: false, outputPalette: false, bitsInPlane: 4, planes: 1, planeLittleEndian: true },\n        reduce: 16,\n        toNative:'exportSNES'\n    },\n    {\n        id: 'snes.8bpp.direct',\n        name: 'SNES (8bpp) (8x8) (32x32) Direct Color',\n        width: 32*8,\n        height: 32*8,\n        scaleX: 1,\n        conv: 'SNES_Canvas_Direct',\n        pal: palettes.SNES_BBPGGGPRRRP,\n        block: { w: 8, h: 8, colors: 2048, msbToLsb: false },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: {\n            backgroundRange: { min: 0, max: 2047 },\n            auxRange: { min: 0, max: 2047 },\n            borderRange: { min: 0, max: 2047 },\n            colorsRange: { min: 0, max: 2047 }\n        },\n        customize: { outputTileset: true, outputPalette: false, transformColor: 'bbgggrrr', planes: 8 },\n        toNative:'exportSNES'\n    },\n    {\n        id: 'stic',\n        name: 'Intellivision STIC (GRAM/GROM) (FGBG)',\n        width: 8*8,    // actual is 20x12 but the gram only allows for 64 gram cards\n        height: 8*8,\n        conv: 'Stic_Fgbg_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        paletteChoices: { backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 7 } },\n        toNative: 'exportSticFgbg'\n    },\n    {\n        id: 'stic.stack.grom',\n        name: 'Intellivision STIC (GROM only) (Color Stack Mode)',\n        width: 20*8,\n        height: 12*8,\n        conv: 'Stic_ColorStack_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        cb: { w: 8, h: 8, xb: 0, yb: 0 },   // important to leave xb/yb as 0 (so no color bleeding happens in scoring of stack colors)\n        param: { extra: 4 },\n        paletteChoices: { colors: 1, backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 7 } },\n        toNative: 'exportSticColorStack'\n    },\n    {\n        id: 'stic.stack.gram',\n        name: 'Intellivision STIC (GRAM only) (Color Stack Mode)',\n        width: 8*8,    // actual is 20x12 but the gram only allows for 64 gram cards\n        height: 8*8,\n        conv: 'Stic_ColorStack_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        cb: { w: 8, h: 8 },\n        param: { extra: 4 },\n        paletteChoices: { colors: 1, backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 15 } },\n        toNative: 'exportSticColorStack'\n    },\n    {\n        id: 'stic.stack.gromram',\n        name: 'Intellivision STIC (GROM+GRAM) (Color Stack Mode)',\n        width: 20*8,\n        height: 12*8,\n        conv: 'Stic_ColorStack_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true, xb: 0, yb: 0 }, // important that xb/yb are 0 (so no color bleeding happens in scoring)\n        cb: { w: 8, h: 8 },\n        // the cell params will carry the array of which cells will use the gram (instead of the grom)\n        param: { cell: true, extra: 4 },\n        paletteChoices: { colors: 1, backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 7 } },\n        toNative: 'exportSticColorStack'\n    },\n    {\n        id: 'stic.stack.grom.single',\n        name: 'Intellivision STIC (GROM only) (Single BG Color Stack)',\n        width: 20*8,\n        height: 12*8,\n        conv: 'Stic_ColorStack_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        cb: { w: 8, h: 8, xb: 0, yb: 0 },   // important to leave xb/yb as 0 (so no color bleeding happens in scoring of stack colors)\n        param: { extra: 4 },\n        paletteChoices: { colors: 1, backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 7 } },\n        customize: { singleColor: true },\n        toNative: 'exportSticColorStack'\n    },\n    {\n        id: 'stic.stack.gram.single',\n        name: 'Intellivision STIC (GRAM only) (Single BG Color Stack)',\n        width: 8*8,    // actual is 20x12 but the gram only allows for 64 gram cards\n        height: 8*8,\n        conv: 'Stic_ColorStack_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true },\n        cb: { w: 8, h: 8 },\n        param: { extra: 4 },\n        paletteChoices: { colors: 1, backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 15 } },\n        customize: { singleColor: true },\n        toNative: 'exportSticColorStack'\n    },    \n    {\n        id: 'stic.stack.gromram.single',\n        name: 'Intellivision STIC (GROM+GRAM) (Single BG Color Stack)',\n        width: 20*8,\n        height: 12*8,\n        conv: 'Stic_ColorStack_Canvas',\n        pal: palettes.INTELLIVISION_STIC_RGB,\n        block: { w: 8, h: 8, colors: 2 },\n        cell: { w: 8, h: 8, msbToLsb: true, xb: 0, yb: 0 }, // important that xb/yb are 0 (so no color bleeding happens in scoring)\n        cb: { w: 8, h: 8 },\n        // the cell params will carry the array of which cells will use the gram (instead of the grom)\n        param: { cell: true, extra: 4 },\n        paletteChoices: { colors: 1, backgroundRange: { min: 0, max: 15 }, colorsRange: { min: 0, max: 7 } },\n        customize: { singleColor: true },\n        toNative: 'exportSticColorStack'\n    },\n    {\n        id: 'nes4f',\n        name: 'NES (4 color, full screen)',\n        width: 256,\n        height: 240,\n        scaleX: 8 / 7,\n        conv: 'DitheringCanvas',\n        pal: palettes.NES_RGB,\n        reduce: 4,\n        toNative: 'exportNES',\n    },\n    {\n        id: 'nes5f',\n        name: 'NES (5 color, full screen)',\n        width: 256,\n        height: 240,\n        scaleX: 8 / 7,\n        conv: 'NES_Canvas',\n        pal: palettes.NES_RGB,\n        reduce: 5,\n        toNative: 'exportNES',\n    },\n    {\n        id: 'atari7800.160a',\n        name: 'Atari 7800 (160A)',\n        width: 160,\n        height: 240,\n        scaleX: 2,\n        conv: 'DitheringCanvas',\n        pal: palettes.VCS_RGB,\n        reduce: 4,\n    },\n    {\n        id: 'atari7800.160b',\n        name: 'Atari 7800 (160B)',\n        width: 160,\n        height: 240,\n        scaleX: 2,\n        conv: 'DitheringCanvas',\n        pal: palettes.VCS_RGB,\n        reduce: 12,\n    },\n    {\n        id: 'sms',\n        name: 'Sega Master System',\n        width: 176, // only 488 unique tiles max, otherwise 256x240\n        height: 144,\n        scaleX: 8 / 7,\n        conv: 'DitheringCanvas',\n        pal: palettes.SMS_RGB,\n        reduce: 16,\n    },\n    {\n        id: 'sms-gg',\n        name: 'Sega GameGear',\n        width: 160,\n        height: 144,\n        scaleX: 1.2,\n        conv: 'DitheringCanvas',\n        pal: palettes.GAMEGEAR_COLOR_RGB,\n        reduce: 16,\n    },\n    {\n        id: 'bbcmicro.mode2',\n        name: 'BBC Micro (mode 2)',\n        width: 160,\n        height: 256,\n        scaleX: 2,\n        conv: 'DitheringCanvas',\n        pal: palettes.TELETEXT_RGB,\n    },\n    {\n        id: 'apple2.lores',\n        name: 'Apple ][ (Lores)',\n        width: 40,\n        height: 48,\n        scaleX: 1.5,\n        conv: 'DitheringCanvas',\n        pal: palettes.AP2LORES_RGB,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 4 },\n    },\n    {\n        id: 'apple2.dblhires',\n        name: 'Apple ][ (Double-Hires)',\n        width: 140,\n        height: 192,\n        scaleX: 2,\n        conv: 'DitheringCanvas',\n        pal: palettes.AP2LORES_RGB,\n    },\n    {\n        id: 'appleiigs.320.16',\n        name: 'Apple IIGS (16 colors)',\n        width: 320,\n        height: 200,\n        conv: 'DitheringCanvas',\n        pal: palettes.IIGS_COLOR_RGB,\n        reduce: 16,\n    },\n    {\n        id: 'channelf',\n        name: 'Fairchild Channel F',\n        width: 102,\n        height: 58,\n        conv: 'DitheringCanvas',\n        pal: palettes.CHANNELF_RGB,\n        reduce: 4, // TODO: https://geeks-world.github.io/articles/467811/index.html\n    },\n    {\n        id: 'mac',\n        name: 'Mac 128K',\n        width: 512,\n        height: 342,\n        conv: 'DitheringCanvas',\n        pal: palettes.MONO_RGB,\n    },\n    {\n        id: 'x86.cga.04h.1',\n        name: 'PC CGA (Mode 04h, palette 1)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB_1,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 2 },\n    },\n    {\n        id: 'x86.cga.04h.1B',\n        name: 'PC CGA (Mode 04h, bright 1)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB_1H,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 2 },\n    },\n    {\n        id: 'x86.cga.04h.2',\n        name: 'PC CGA (Mode 04h, palette 2)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB_2,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 2 },\n    },\n    {\n        id: 'x86.cga.04h.2B',\n        name: 'PC CGA (Mode 04h, bright 2)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB_2H,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 2 },\n    },\n    {\n        id: 'x86.cga.05h',\n        name: 'PC CGA (Mode 05h)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB_3,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 2 },\n    },\n    {\n        id: 'x86.cga.05h.B',\n        name: 'PC CGA (Mode 05h, bright)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB_3H,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 2 },\n    },\n    {\n        id: 'x86.ega.0dh',\n        name: 'PC EGA (Mode 0Dh)',\n        width: 320,\n        height: 200,\n        scaleX: 200 / 320 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 4 },\n    },\n    {\n        id: 'x86.ega.10h',\n        name: 'PC EGA (Mode 10h)',\n        width: 640,\n        height: 350,\n        scaleX: 350 / 640 * 1.37,\n        conv: 'DitheringCanvas',\n        pal: palettes.CGA_RGB,\n        toNative: 'exportFrameBuffer',\n        exportFormat: { bpp: 1, np: 4 },\n    },\n    {\n        id: 'williams',\n        name: 'Williams Arcade',\n        width: 304,\n        height: 256,\n        conv: 'DitheringCanvas',\n        pal: palettes.WILLIAMS_RGB,\n        reduce: 16,\n    },\n    {\n        id: 'pico8',\n        name: 'PICO-8',\n        width: 128,\n        height: 128,\n        conv: 'DitheringCanvas',\n        pal: palettes.PICO8_RGB,\n    },\n    {\n        id: 'tic80',\n        name: 'TIC-80',\n        width: 240,\n        height: 136,\n        conv: 'DitheringCanvas',\n        pal: palettes.TIC80_RGB,\n    },\n    {\n        id: 'gb',\n        name: 'Game Boy Classic',\n        width: 160,\n        height: 144,\n        scaleX: 10 / 9,\n        conv: 'DitheringCanvas',\n        pal: palettes.GAMEBOY_GREEN_RGB,\n    },\n    /*\n    {\n        id:'gbc',\n        name:'Game Boy Color',\n        width:160,\n        height:144,\n        aspect:1,\n        conv:'DitheringCanvas',\n        pal:GAMEBOY_COLOR_RGB,\n        reduce:32,\n    },\n    */\n    {\n        id: 'amiga.lores',\n        name: 'Amiga (Lores)',\n        width: 320,\n        height: 256,\n        conv: 'DitheringCanvas',\n        pal: palettes.AMIGA_OCS_COLOR_RGB,\n        reduce: 32,\n        //toNative:'exportFrameBuffer',\n        //exportFormat:{bpp:1,brev:true,np:5},\n    },\n    {\n        id: 'amiga.lores.ham6',\n        name: 'Amiga (Lores, HAM6)',\n        width: 320,\n        height: 256,\n        conv: 'HAM6_Canvas',\n        pal: palettes.AMIGA_OCS_COLOR_RGB,\n        reduce: 16,\n        extraColors: 48,\n        //toNative:'exportFrameBuffer',\n        //exportFormat:{bpp:1,brev:true,np:6},\n    },\n    {\n        id: 'cx16.lores',\n        name: 'Commander X16 (Lores)',\n        width: 320,\n        height: 240,\n        scaleX: 1,\n        conv: 'DitheringCanvas',\n        pal: palettes.AMIGA_OCS_COLOR_RGB,\n        reduce: 256\n    },\n    {\n        id: 'cx16.hires',\n        name: 'Commander X16 (Hires, cropped)',\n        width: 640,\n        height: 400,\n        scaleX: 1,\n        conv: 'DitheringCanvas',\n        pal: palettes.AMIGA_OCS_COLOR_RGB,\n        reduce: 16\n    },\n    {\n        id: 'compucolor',\n        name: 'Compucolor',\n        width: 160,\n        height: 192,\n        scaleX: 1.6,\n        conv: 'Compucolor_Canvas',\n        pal: palettes.ZXSPECTRUM_RGB,\n        block: { w: 2, h: 4, colors: 2 },\n    },\n    // https://www.bighole.nl//pub/mirror/homepage.ntlworld.com/kryten_droid/teletext/spec/teletext_spec_1974.htm\n    {\n        id: 'teletext',\n        name: 'Teletext',\n        width: 40 * 2,\n        height: 24 * 3,\n        scaleX: 4 / 3,\n        conv: 'Teletext_Canvas',\n        pal: palettes.TELETEXT_RGB,\n        block: { w: 2, h: 3, colors: 2 },\n    },\n    {\n        id: 'atarist',\n        name: 'Atari ST',\n        width: 320,\n        height: 200,\n        scaleX: 1,\n        conv: 'DitheringCanvas',\n        pal: palettes.ATARIST_RGB,\n        reduce: 16\n    },\n    {\n        id: 'MC6847.CG2.palette0',\n        name: 'MC6847 (CG2, palette 0)',\n        width: 128,\n        height: 64,\n        scaleX: 1 / 1.3,\n        conv: 'DitheringCanvas',\n        pal: palettes.MC6847_PALETTE0,\n        reduce: 4,\n        toNative: 'exportMC6847'\n    },\n    {\n        id: 'MC6847.CG2.palette1',\n        name: 'MC6847 (CG2, palette 1)',\n        width: 128,\n        height: 64,\n        scaleX: 1 / 1.3,\n        conv: 'DitheringCanvas',\n        pal: palettes.MC6847_PALETTE1,\n        reduce: 4,\n        toNative: 'exportMC6847'\n    },\n    {\n        id: 'MC6847.CG3.palette0',\n        name: 'MC6847 (CG3, palette 0)',\n        width: 128,\n        height: 96,\n        scaleX: 1 / 1.3 * 96 / 64,\n        conv: 'DitheringCanvas',\n        pal: palettes.MC6847_PALETTE0,\n        reduce: 4,\n        toNative: 'exportMC6847'\n    },\n    {\n        id: 'MC6847.CG3.palette1',\n        name: 'MC6847 (CG3, palette 1)',\n        width: 128,\n        height: 96,\n        scaleX: 1 / 1.3 * 96 / 64,\n        conv: 'DitheringCanvas',\n        pal: palettes.MC6847_PALETTE1,\n        reduce: 4,\n        toNative: 'exportMC6847'\n    },\n    {\n        id: 'MC6847.CG6.palette0',\n        name: 'MC6847 (CG6, palette 0)',\n        width: 128,\n        height: 192,\n        scaleX: 1 / 1.3 * 192 / 64,\n        conv: 'DitheringCanvas',\n        pal: palettes.MC6847_PALETTE0,\n        reduce: 4,\n        toNative: 'exportMC6847'\n    },\n    {\n        id: 'MC6847.CG6.palette1',\n        name: 'MC6847 (CG6, palette 1)',\n        width: 128,\n        height: 192,\n        scaleX: 1 / 1.3 * 192 / 64,\n        conv: 'DitheringCanvas',\n        pal: palettes.MC6847_PALETTE1,\n        reduce: 4,\n        toNative: 'exportMC6847'\n    },\n    {\n        id: 'vcs.48',\n        name: 'Atari VCS (48x48 bitmap)',\n        width: 48,\n        height: 48,\n        conv: 'DitheringCanvas',\n        pal: palettes.VCS_RGB,\n        reduce: 2,\n    },\n    {\n        id: 'pce.256x240',\n        name: 'PC Engine (256x240)',\n        width: 256,\n        height: 240,\n        scaleX: 5 / 4,\n        conv: 'DitheringCanvas',\n        pal: palettes.ATARIST_RGB,\n        reduce: 16,\n    },\n];\n\nexport var SYSTEM_LOOKUP: { [id: string]: DithertronSettings } = {};\nSYSTEMS.forEach((sys) => { if (sys) SYSTEM_LOOKUP[sys.id || sys.name] = sys; });\n\n", "import { DithertronSettings, PixelEditorImageFormat, PixelsAvailableMessage } from \"../common/types\";\nimport { ParamsContent, BlockParamDitherCanvasContent, extractColorsFromParams, extractColorsFromParamContent, extractColorsFromParamsContent, extractColorsFromParam } from \"../dither/basecanvas\";\n\nimport { runtime_assert } from \"../common/util\";\n\nimport { hex } from \"../common/util\";\n\nfunction remapBits(x: number, arr?: number[]): number {\n    if (!arr) return x;\n    var y = 0;\n    for (var i = 0; i < arr.length; i++) {\n        var s = arr[i];\n        if (s < 0) {\n            s = -s - 1;\n            y ^= 1 << s;\n        }\n        if (x & (1 << i)) {\n            y ^= 1 << s;\n        }\n    }\n    return y;\n}\n\nfunction convertImagesToWords(images: Uint32Array[], fmt: PixelEditorImageFormat): ArrayLike<number> {\n    if (fmt.destfmt) fmt = fmt.destfmt;\n    var width = fmt.w;\n    var height = fmt.h;\n    var count = fmt.count || 1;\n    var bpp = fmt.bpp || 1;\n    var nplanes = fmt.np || 1;\n    var bitsperword = fmt.bpw || 8;\n    var wordsperline = fmt.sl || Math.ceil(fmt.w * bpp / bitsperword);\n    var mask = (1 << bpp) - 1;\n    var pofs = fmt.pofs || wordsperline * height * count;\n    var skip = fmt.skip || 0;\n    var words;\n    if (nplanes > 0 && fmt.sl) // TODO?\n        words = new Uint8Array(wordsperline * height * count);\n    else if (fmt.yremap)\n        words = new Uint8Array(count * ((height >> fmt.yremap[0]) * fmt.yremap[1] + (((1 << fmt.yremap[0]) - 1) * fmt.yremap[2])));\n    else if (bitsperword <= 8)\n        words = new Uint8Array(wordsperline * height * count * nplanes);\n    else\n        words = new Uint32Array(wordsperline * height * count * nplanes);\n    for (var n = 0; n < count; n++) {\n        var imgdata = images[n];\n        var i = 0;\n        for (var y = 0; y < height; y++) {\n            var yp = fmt.flip ? height - 1 - y : y;\n            var ofs0 = n * wordsperline * height + yp * wordsperline;\n            if (fmt.yremap) { ofs0 = ((y >> fmt.yremap[0]) * fmt.yremap[1]) + ((y & (1 << fmt.yremap[0]) - 1) * fmt.yremap[2]) }\n            var shift = 0;\n            for (var x = 0; x < width; x++) {\n                var color = (imgdata[i++]) & 0xff;\n                var ofs = remapBits(ofs0, fmt.remap);\n                if (fmt.bitremap) {\n                    for (var p = 0; p < (fmt.bpp || 1); p++) {\n                        if (color & (1 << p))\n                            words[ofs] |= 1 << fmt.bitremap[shift + p];\n                    }\n                } else {\n                    for (var p = 0; p < nplanes; p++) {\n                        var c = (color >> (p * bpp)) & mask;\n                        words[ofs + p * pofs + skip] |= (fmt.brev ? (c << (bitsperword - shift - bpp)) : (c << shift));\n                    }\n                }\n                shift += bpp;\n                if (shift >= bitsperword) {\n                    ofs0 += 1;\n                    shift = 0;\n                }\n            }\n        }\n    }\n    return words;\n}\n\nfunction concatArrays(arrays: Uint8Array[]): Uint8Array {\n    var total = 0;\n    arrays.forEach((a) => { total += a.length });\n    var dest = new Uint8Array(total);\n    total = 0;\n    arrays.forEach((a) => { dest.set(a, total); total += a.length });\n    return dest;\n}\n\nexport function exportFrameBuffer(img: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    var fmt = settings.exportFormat;\n    if (!fmt) throw \"No export format\";\n    fmt.w = img.width;\n    fmt.h = img.height;\n    return new Uint8Array(convertImagesToWords([img.indexed], fmt));\n}\n\nexport function exportApple2HiresToHGR(img: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    // TODO: handle other dimensions\n    var data = new Uint8Array(0x2000);\n    var srcofs = 0;\n    for (var y = 0; y < img.height; y++) {\n        var destofs = (y & 7) * 0x400 + ((y >> 3) & 7) * 0x80 + (y >> 6) * 0x28;\n        for (var x = 0; x < img.width; x += 7) {\n            var z = 0;\n            var hibit = 0;\n            for (var i = 0; i < 7; i++) {\n                var col = (img.indexed[srcofs++]) & 0xff;\n                if (col == 3 || col == 4) hibit |= 0x80;\n                if (col >= 3) col -= 2;\n                z |= (col << i * 2);\n            }\n            data[destofs++] = (z & 0x7f) | hibit;\n            data[destofs++] = ((z >> 7) & 0x7f) | hibit;\n        }\n    }\n    return data;\n}\n\nexport function bitOverlayUint8Array(\n    array: Uint8Array,\n    offset: number,\n    bitPattern: number,\n    bitShift: number,\n    bitCount: number,\n    littleEndian?: boolean): void {\n\n    // This routine is capable of overlaying bit patterns onto a memory\n    // buffer. The routine handles small or large bit patterns (so long as the\n    // bit pattern can reasonably fit within the \"number\" type, including any\n    // bit shifting that may be needed).\n    //\n    // The endianness of the pattern only applies if the pixel may cross the byte\n    // boundary, in which case the routine will factor the byte direction when\n    // overlaying the bit pattern onto the memory buffer.\n\n    littleEndian = littleEndian === undefined ? true : littleEndian;\n\n    let bitFilter = (1 << bitCount) - 1;\n    let pattern = (bitPattern & bitFilter);\n\n    let bitOverlay = pattern << bitShift;\n    bitFilter <<= bitShift;\n\n    offset += (littleEndian ? 0 : ((bitCount + bitShift - 1) / 8));\n    let direction = littleEndian ? 1 : -1;\n\n    for (let bitsRemaining = bitCount + bitShift; bitsRemaining > 0; bitsRemaining -= 8, offset += direction) {\n        let complimentFilter = (~0) ^ bitFilter;\n\n        let complimentByte = complimentFilter & 0xff;\n        let overlayByte = bitOverlay & 0xff;\n\n        runtime_assert(offset < array.length);\n        array[offset] = (array[offset] & complimentByte) | overlayByte;\n\n        bitOverlay >>= 8;\n        bitFilter >>= 8;\n    }\n}\n\nexport interface BitInfo {\n    offset: number;\n    bitShift: number;\n    bitCount: number;\n};\n\nexport interface ParamBitInfo extends BitInfo {\n    paramOffset: number;\n};\n\nexport interface PrepareInfo {\n    data: Uint8Array;\n    littleEndian?: boolean;\n};\n\ninterface DataMapper {\n    data(): Uint8Array;\n}\n\ninterface CommonMapperBasics {\n    prefill(array: Uint8Array): void;\n    iterate(array: Uint8Array): void;\n    commit(array: Uint8Array): void;\n    finalize(iteration: number, cellImage: Uint8Array, colors: Uint8Array, colorBlock: Uint8Array, cellBlock: Uint8Array, extra: Uint8Array): boolean;    \n}\n\ninterface CommonMapper extends Partial<CommonMapperBasics> {\n    prepare(): PrepareInfo;    \n}\n\ninterface CellExporterMapper_Iterate_Values {\n    width: number;                                                                  // the width to use for the image\n    height: number;                                                                 // the height to use for the image\n    params: Uint32Array;                                                            // the color parameters (aka block parameters) to use for the image\n    indexed: Uint32Array;                                                           // the palette indexed image array\n    colors: number;                                                                 // how many colors to extract from the color params\n    fullPaletteMode: boolean;                                                       // the image directly contains the index of the palette (without a color block translation)\n    paletteBitFilter: number;                                                       // the filter to apply to the palette value\n    paletteBits: number;                                                            // how many palette bits are needing to be extracted\n}\n\ninterface CellExporterMapper_Iterate_BitPattern {\n    paramToBitPattern(param: number, paletteIndex: number, info: ParamBitInfo): number; // used to convert the block parameter into a value to be encoded at the encoding bit info\n}\n\ninterface CellExporterMapper_Iterate_XYToBitInfo extends CellExporterMapper_Iterate_BitPattern {\n    xyToBitInfo(x: number, y: number): ParamBitInfo;\n}\n\ninterface CellExporterMapper_Iterate_GlobalColorsBitPattern {\n    globalColorsBitPattern: { paletteIndex: number, bitPattern: number }[];                             // used with defaulted paramToBitPattern to map global colors onto a bit pattern\n};\n\ninterface CellExporterMapper_Iterate_GlobalColorToBitPattern {\n    globalColorToBitPattern(param: number, paletteIndex: number, info: ParamBitInfo): number | undefined;    // used with defaulted paramToBitPattern to map global colors onto a bit pattern\n};\n\ninterface CellExporterMapper_Iterate_GlobalColors extends Partial<CellExporterMapper_Iterate_GlobalColorsBitPattern>, Partial<CellExporterMapper_Iterate_GlobalColorToBitPattern> {\n};\n\ninterface CellExporterMapper_Iterate_ColorsBitPattern {\n    colorsBitPattern: number[];                                                                         // an array equal to the size the number of extracted param colors mapping to each related bit pattern\n}\n\ninterface CellExporterMapper_Iterate_ColorToBitPattern {\n    colorToBitPattern(param: number, paletteIndex: number, info: ParamBitInfo): number | undefined;         // used with defaulted paramToBitPattern to map image colors onto a bit pattern\n}\n\ninterface CellExporterMapper_Iterate_Colors extends Partial<CellExporterMapper_Iterate_ColorsBitPattern>, Partial<CellExporterMapper_Iterate_ColorToBitPattern> {\n};\n\ninterface CellExporterMapper_Iterate extends CellExporterMapper_Iterate_Values, CellExporterMapper_Iterate_XYToBitInfo, CellExporterMapper_Iterate_GlobalColors, CellExporterMapper_Iterate_Colors {\n}\n\ninterface CellExporterMapper extends CommonMapper, Partial<CellExporterMapper_Iterate> {\n}\n\ninterface ParamExporterMapper_Iterate_Values {\n    params: Uint32Array;                                                            // if specified, what params are used in the iteration over the params\n}\n\ninterface ParamExporterMapper_Iterate_ParamToBitInfo {\n    paramToBitPattern(param: number, info: ParamBitInfo): number;                   // if specified, used to convert the block parameter into a value to be encoded at the encoding bit info\n}\n\ninterface ParamExporterMapper_Iterate_ParamToBitPattern extends ParamExporterMapper_Iterate_ParamToBitInfo {\n    paramToBitInfo(paramOffset: number): ParamBitInfo;                              // if specified, used to map a parameter offset into encoding bit info, and paramToBitPattern must be specified\n}\n\ninterface ParamExporterMapper_Iterate extends ParamExporterMapper_Iterate_Values, ParamExporterMapper_Iterate_ParamToBitPattern {\n}\n\ninterface ParamExporterMapper extends CommonMapper, Partial<ParamExporterMapper_Iterate> {\n}\n\nfunction getDefaultedCellExporterMapper(\n    values: CellExporterMapper_Iterate_Values,\n    mapper?: CellExporterMapper): CellExporterMapper | undefined {\n\n    let fullPaletteMode = mapper.fullPaletteMode === undefined ? values.fullPaletteMode : mapper.fullPaletteMode;\n\n    if (mapper === undefined)\n        return undefined;\n\n    if (mapper.prepare === undefined)\n        throw 'The \"prepare\" method is required.';\n\n    let setup: PrepareInfo;\n\n    let prepare = () => {\n        setup = mapper.prepare();\n        setup.littleEndian = setup.littleEndian === undefined ? true : setup.littleEndian;\n        return setup;\n    };\n\n    let paramToBitPattern = (mapper.paramToBitPattern !== undefined ? mapper.paramToBitPattern : (param: number, paletteIndex: number, info: ParamBitInfo) => {\n\n        if (fullPaletteMode)\n            return paletteIndex;\n\n        let colors = extractColorsFromParam(\n            param,\n            mapper.colors === undefined ? values.colors : mapper.colors,\n            mapper.paletteBitFilter === undefined ? values.paletteBitFilter : mapper.paletteBitFilter,\n            mapper.paletteBits === undefined ? values.paletteBits : mapper.paletteBits);\n\n        // first can the global colors for a match\n        if (mapper.globalColorsBitPattern !== undefined) {\n            for (let i = 0; i < mapper.globalColorsBitPattern.length; ++i) {\n                if (paletteIndex == mapper.globalColorsBitPattern[i].paletteIndex)\n                    return mapper.globalColorsBitPattern[i].bitPattern;\n            }\n        }\n\n        if (mapper.globalColorToBitPattern !== undefined) {\n            let pattern = mapper.globalColorToBitPattern(param, paletteIndex, info);\n            if (pattern !== undefined)\n                return pattern;\n        }\n\n        if (mapper.colorToBitPattern !== undefined) {\n            let pattern = mapper.colorToBitPattern(param, paletteIndex, info);\n            if (pattern !== undefined)\n                return pattern;\n        }\n\n        // next scan the color choices for a match\n        for (let i = 0; (i < colors.length) && (i < mapper.colorsBitPattern.length) ; ++i) {\n            if (paletteIndex != colors[i])\n                continue;\n            return mapper.colorsBitPattern[i];\n        }\n\n        console.log('global nor param color does not contain color from image', values, mapper, param, paletteIndex, info);\n        runtime_assert(false);  // something went wrong as palette could not be mapped\n        return 0;\n    });\n\n    let iterate = (mapper.iterate !== undefined ? mapper.iterate : (array: Uint8Array) => {\n\n        let params = mapper.params === undefined ? values.params : mapper.params;\n        let indexed = mapper.indexed === undefined ? values.indexed : mapper.indexed;\n\n        if (mapper.xyToBitInfo === undefined)\n            return;\n\n        if ((indexed === undefined) || ((params === undefined) && (!fullPaletteMode)))\n            throw 'Both \"params\" and \"indexed\" must be defined.';\n\n        for (let i = 0, y = 0; y < (mapper.height === undefined? values.height : mapper.height); ++y) {\n            for (let x = 0; x < (mapper.width === undefined ? values.width : mapper.width); ++x, ++i) {\n                let info = mapper.xyToBitInfo(x, y);\n                runtime_assert((params === undefined) || (info.paramOffset < params.length));    // must be within the bounds of the param array\n                let bitPattern = paramToBitPattern(params === undefined ? 0 : (params[info.paramOffset]), indexed[i], info);\n                bitOverlayUint8Array(array, info.offset, bitPattern, info.bitShift, info.bitCount, setup.littleEndian);\n            }\n        }\n\n    });\n\n    let defaultedMapper: CellExporterMapper = {\n\n        prepare: prepare,\n        prefill: mapper.prefill,\n        iterate: mapper.iterate === undefined ? iterate : mapper.iterate,\n        commit: mapper.commit,\n        finalize: mapper.finalize,\n\n        xyToBitInfo: mapper.xyToBitInfo,\n        paramToBitPattern: paramToBitPattern,\n\n        globalColorsBitPattern: mapper.globalColorsBitPattern === undefined ? [] : mapper.globalColorsBitPattern,\n        globalColorToBitPattern: mapper.globalColorToBitPattern,\n        colorsBitPattern: mapper.colorsBitPattern,\n        colorToBitPattern: mapper.colorToBitPattern\n    };\n\n    return defaultedMapper;\n}\n\nfunction getDefaultedCellExporterMapperOrFromDataMapper(\n    values: CellExporterMapper_Iterate_Values,\n    mapper?: CellExporterMapper | DataMapper): CellExporterMapper | undefined {\n\n    if (\"prepare\" in mapper) {\n        return getDefaultedCellExporterMapper(values, mapper);\n    }\n\n    if (\"data\" in mapper) {\n\n        let defaultedMapper: CellExporterMapper = {\n            prepare(): PrepareInfo {\n                return { data: mapper.data() };\n            },\n        }\n        return defaultedMapper;\n    }\n\n    throw 'Either \"prepare\" or \"data\" on a \"CellExporterMapper\" or \"DataMapper\" must be defined.';\n}\n\nfunction getDefaultedParamMapper(\n    isUsing: boolean,\n    values: ParamExporterMapper_Iterate_Values,\n    mapper?: ParamExporterMapper): ParamExporterMapper | undefined {\n\n    if ((mapper === undefined) || (!isUsing))\n        return undefined;\n\n    let setup: PrepareInfo;\n\n    if (mapper.prepare === undefined)\n        throw 'The \"prepare\" method is required.';\n\n    let prepare = () => {\n        setup = mapper.prepare();\n        setup.littleEndian = setup.littleEndian === undefined ? true : setup.littleEndian;\n        return setup;\n    };\n\n    let iterate = () => {\n        let params = (mapper.params === undefined ? values.params : mapper.params);\n\n        if ((mapper.paramToBitInfo === undefined) && (mapper.paramToBitPattern === undefined))\n            return;\n\n        if ((mapper.paramToBitInfo === undefined) || (mapper.paramToBitPattern === undefined) || (params === undefined))\n            throw 'All of \"paramToBitInfo\" and \"paramToBitPattern\" and \"params\" must be defined.';\n\n        for (let i = 0; i < params.length; i++) {\n            // The color block ram is split out from the normal param area\n            // to stored extra color block choices shared across\n            // multiple pixels. The color block area is an extra shared\n            // color ram that is independent of the \"screen\" color ram.\n\n            let p = params[i];\n            let info = mapper.paramToBitInfo(i);\n            let bitPattern = mapper.paramToBitPattern(p, info);\n            bitOverlayUint8Array(setup.data, info.offset, bitPattern, info.bitShift, info.bitCount, setup.littleEndian);\n        }\n    }\n    \n    let defaultedMapper: ParamExporterMapper = {\n\n        prepare: prepare,\n        prefill: mapper.prefill,\n        iterate: mapper.iterate === undefined ? iterate : mapper.iterate,\n        commit: mapper.commit,\n        finalize: mapper.finalize,\n\n        params: mapper.params === undefined ? values.params : mapper.params,\n        paramToBitInfo: mapper.paramToBitInfo,\n        paramToBitPattern: mapper.paramToBitPattern\n    };\n\n    return defaultedMapper;\n}\n\nfunction getDefaultedParamMapperOrFromDataMapper(\n    isUsing: boolean,\n    values: ParamExporterMapper_Iterate_Values,\n    mapper?: ParamExporterMapper | DataMapper): ParamExporterMapper | undefined {\n\n    if ((!isUsing) || (mapper === undefined))\n        return undefined;\n\n    if (\"prepare\" in mapper) {\n        return getDefaultedParamMapper(isUsing, values, mapper);\n    }\n\n    if (\"data\" in mapper) {\n        let defaultedMapper: ParamExporterMapper = {\n            prepare(): PrepareInfo {\n                return { data: mapper.data() };\n            }\n        }\n\n        return defaultedMapper;\n    }\n\n    throw 'Either \"prepare\" or \"data\" on a \"ParamExporterMapper\" or \"DataMapper\" must be defined.';\n}\n\n\ninterface ExportCombinedImageAndColorCellBuffer {\n    message: PixelsAvailableMessage;\n    content: BlockParamDitherCanvasContent;\n    cellMapper?: CellExporterMapper | DataMapper;                       // if specified, use to map out the image pattern onto a buffer\n    colorParamMapper?: ParamExporterMapper | DataMapper,                // if specified, used to map the colors (block params) onto a buffer\n    colorBlockParamMapper?: ParamExporterMapper | DataMapper,           // if specified, used to map the color block params onto a  buffer\n    cellParamMapper?: ParamExporterMapper | DataMapper,                 // if specified, used to map the cell params onto a buffer\n    extraParamMapper?: ParamExporterMapper | DataMapper,                // if specified, used to map the extra params onto a buffer\n    reorderArrays?(arrays: Uint8Array[]): Uint8Array[];\n}\n\nexport function exportCombinedImageAndColorCellBuffer(options: ExportCombinedImageAndColorCellBuffer): Uint8Array {\n\n    let cellMapper = getDefaultedCellExporterMapperOrFromDataMapper(\n        {\n            width: options.content.width,\n            height: options.content.height,\n            params: options.content.blockParams,\n            indexed: options.message.indexed,\n            colors: options.content.block.colors,\n            fullPaletteMode: options.content.fullPaletteMode,\n            paletteBitFilter: options.content.paletteBitFilter,\n            paletteBits: options.content.paletteBits\n        },\n        options.cellMapper);\n    let colorParamMapper = getDefaultedParamMapperOrFromDataMapper(options.colorParamMapper !== undefined, { params: options.content.blockParams }, options.colorParamMapper);\n    let colorBlockParamMapper = getDefaultedParamMapperOrFromDataMapper(options.content.paramInfo.cb, { params: options.content.cbParams }, options.colorBlockParamMapper);\n    let cellParamMapper = getDefaultedParamMapperOrFromDataMapper(options.content.paramInfo.cell, { params: options.content.cellParams }, options.cellParamMapper);\n    let extraParamMapper = getDefaultedParamMapperOrFromDataMapper(options.content.paramInfo.extra > 0, { params: options.content.extraParams }, options.extraParamMapper);\n\n    let allMappers: (CommonMapper | undefined)[] = [cellMapper, colorParamMapper, colorBlockParamMapper, cellParamMapper, extraParamMapper];\n    let allMappersFiltered = allMappers.filter((x) => x !== undefined);\n\n    let setup: PrepareInfo[] = [];\n    let data: Uint8Array[] = [];\n\n    // prepare the mappers\n    for (let i = 0; i < allMappers.length; ++i) {\n        if (allMappers[i] === undefined) {\n            data.push(undefined);\n            continue;\n        }\n\n        let info = allMappers[i].prepare();\n        setup.push(info);\n        data.push(info.data);\n    }\n\n    // prefill the mappers\n    for (let i = 0; i < allMappersFiltered.length; ++i) {\n        if (allMappersFiltered[i].prefill === undefined)\n            continue;\n\n        allMappersFiltered[i].prefill(setup[i].data);\n    }\n\n    // iterator the mappers\n    for (let i = 0; i < allMappersFiltered.length; ++i) {\n        if (allMappersFiltered[i].iterate === undefined)\n            continue;\n\n        allMappersFiltered[i].iterate(setup[i].data);\n    }\n\n    // commit the mappers\n    for (let i = 0; i < allMappersFiltered.length; ++i) {\n        if (allMappersFiltered[i].commit === undefined)\n            continue;\n\n        allMappersFiltered[i].commit(setup[i].data);\n    }\n\n    // finalize the mappers\n    let continueFinalize = true;\n    for (let i = 0; continueFinalize; ++i) {\n\n        continueFinalize = false;\n\n        for (let i = 0; i < allMappersFiltered.length; ++i) {\n            if (allMappersFiltered[i].finalize === undefined)\n                continue;\n\n            continueFinalize = allMappersFiltered[i].finalize(i, data[0], data[1], data[2], data[3], data[4]) || continueFinalize;\n        }\n    }\n\n    // make sure the array was in use\n    let mergeArrays = data.filter((x) => x !== undefined);\n    if (options.reorderArrays !== undefined) {\n        mergeArrays = options.reorderArrays(mergeArrays);\n    }\n\n    return concatArrays(mergeArrays);\n}\n\nfunction getVicCellMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper?: CellExporterMapper | Partial<CellExporterMapper_Iterate>): CellExporterMapper {\n\n    let bpp = content.bitsPerColor;\n    let bitsPerCellWidth = (content.cell.w * bpp);\n    let bitsPerCell = content.cell.h * bitsPerCellWidth;\n    let bytesPerCell = Math.ceil(bitsPerCell / 8);\n    let cellBytesPerRow = 0;\n\n    let exporter: CellExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n            cellBytesPerRow = content.block.columns * bytesPerCell;\n            return { data: new Uint8Array(content.width * content.height * bpp / 8) };\n        },\n\n        xyToBitInfo(x: number, y: number): ParamBitInfo {\n\n            let col = Math.floor(x / content.block.w);\n\n            // which cell is being filled\n            let cellCol = Math.floor(x / content.cell.w);\n            let cellRow = Math.floor(y / content.cell.h);\n\n            let paramOffset = (Math.floor(y / content.block.h) * content.block.columns) + col;\n\n            // where is the start of the cell being filled located in the byte array\n            let cellColOffset = bytesPerCell * cellCol;\n            let cellRowOffset = cellBytesPerRow * cellRow;\n\n            // which particular byte of the cell is being filled now\n            let cellXOffset = Math.floor(((x % content.cell.w) * bpp) / 8);\n            let cellYOffset = Math.floor(((y % content.cell.h) * bitsPerCellWidth) / 8);\n\n            // how much of a bit offset is required for this particular pixel\n            let bitShift = (content.cell.msbToLsb ? (bitsPerCellWidth - (((x % content.cell.w) + 1) * bpp)) : (x % content.cell.w) * bpp);\n\n            return {\n                offset: cellRowOffset + cellColOffset + cellYOffset + cellXOffset,\n                bitShift: bitShift,\n                bitCount: bpp,\n                paramOffset: paramOffset\n            };\n        }\n    };\n\n    return exporter;\n}\n\nfunction getVicColorMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper: ParamExporterMapper | Partial<ParamExporterMapper_Iterate>): ParamExporterMapper {\n\n    let isUsingFli = content.fliMode;\n\n    let bpp = content.bitsPerColor;\n\n    let colorAlignedBytes: number = 0;\n\n    let exporter: ParamExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n\n            let colorBytes = (content.cell.columns * content.cell.rows);\n            colorAlignedBytes = (1 << Math.ceil(Math.log2(colorBytes)));\n\n            return { data: new Uint8Array(isUsingFli ? (colorAlignedBytes * content.cell.h) : (content.cell.columns * content.cell.rows)) };\n        },\n\n        paramToBitInfo(paramOffset: number): ParamBitInfo {\n\n            let offset: number = 0;\n\n            // Normally in graphics mode each screen pixel in a 4x8 or 8x8 block chooses from\n            // cell colors dedicated for the entire block (stored in \"screen\" color ram).\n            // However, in FLI mode each pixel row gets a new choice of colors since on\n            // each scan line special code swaps the \"screen\" color ram pointer location to\n            // a new location in memory thus allowing for independent values per row.\n            if (isUsingFli) {\n                offset = (Math.floor(paramOffset / content.cell.columns) & (content.cell.h - 1)) * colorAlignedBytes + (Math.floor(paramOffset / (bpp * content.width)) * content.cell.columns) + (paramOffset % content.cell.columns);\n            } else {\n                offset = paramOffset;\n            }\n\n            return {\n                offset: offset,\n                bitShift: 0,\n                bitCount: 8,\n                paramOffset: paramOffset\n            };\n        }\n    };\n\n    return exporter;\n}\n\nfunction getVicColorBlockMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper: ParamExporterMapper | Partial<ParamExporterMapper_Iterate>): ParamExporterMapper {\n\n    let exporter: ParamExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n            return { data: new Uint8Array(content.cb.columns * content.cb.rows) };\n        },\n        paramToBitInfo(paramOffset: number): ParamBitInfo {\n            return {\n                offset: paramOffset,\n                bitShift: 0,\n                bitCount: 8,\n                paramOffset: paramOffset\n            };\n        }\n    };\n\n    return exporter;\n}\n\nexport function exportC64Multi(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getVicCellMapper(\n            content,\n            {\n                // background for bit pattern %00\n                // lower nybble for bit pattern %10\n                // upper nybble for bit pattern %01\n                // color block nybble for bit pattern %11\n                globalColorsBitPattern: [{ paletteIndex: content.backgroundColor & 0xf, bitPattern: 0x00 }],\n                colorsBitPattern: [ 0x02, 0x01, 0x03 ]\n            }\n        ),\n        colorParamMapper: getVicColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 2, content);\n                    return colors[0] | colors[1] << 4;\n                }\n            }\n        ),\n        colorBlockParamMapper: getVicColorBlockMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 1, content);\n                    return colors[0];\n                }\n            }\n        ),\n        extraParamMapper: {\n            data(): Uint8Array {\n                let array = new Uint8Array(2);\n                array[0] = (content.backgroundColor & 0x0f) | ((content.auxColor & 0x0f) << 4);\n                array[1] = (content.borderColor & 0x0f);\n                return array;\n            }\n        }\n    });\n}\n\nexport function exportC64Hires(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getVicCellMapper(\n            content,\n            {\n                // lower nybble for bit pattern %0\n                // upper nybble for bit pattern %1\n                colorsBitPattern: [ 0x01, 0x00 ]\n            }\n        ),\n        colorParamMapper: getVicColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 2, content);\n                    return (colors[0] << 4) | (colors[1]);\n                }\n            }\n        ),\n        extraParamMapper: {\n            data(): Uint8Array {\n                let array = new Uint8Array(2);\n                array[0] = (content.backgroundColor & 0x0f) | ((content.auxColor & 0x0f) << 4);\n                array[1] = (content.borderColor & 0x0f);\n                return array;\n            }\n        }\n    });\n}\n\nexport function exportVicHires(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    // From wiki entry that best describes:\n    // The VIC-20 lacks any true graphic mode, but a 22\u00D711 text mode with 200 definable characters of\n    // 8\u00D716 bits each arranged as a matrix of 20\u00D710 characters is usually used instead,\n    // giving a 3:2(NTSC)/5:3(PAL) pixel aspect ratio, 160\u00D7160 pixels, 8-color \"high-res mode\" or\n    // a 3:1(NTSC)/10:3(PAL) pixel aspect ratio, 80\u00D7160 pixels, 10-color \"multicolor mode\".\n    //\n    // In the 8-color high-res mode, every 8\u00D78 pixels can have the background color (shared for the\n    // entire screen) or a free foreground color, both selectable among the first eight colors of the\n    // palette.\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getVicCellMapper(\n            content,\n            {\n                // Each possible one-bit value corresponds to a specific selectable color:\n                // %0 = screen color\n                // %1 = character/cell color\n                globalColorsBitPattern: [{ paletteIndex: content.backgroundColor, bitPattern: 0x00 }],\n                colorsBitPattern: [ 0x01 ]\n            }\n        ),\n        colorParamMapper: getVicColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 1, content);\n                    return colors[0];\n                }\n            }\n        ),\n        extraParamMapper: {\n            data(): Uint8Array {\n                let array = new Uint8Array(3);\n                array[0] = content.backgroundColor;\n                array[1] = content.borderColor;\n                array[2] = content.auxColor;\n                return array;\n            }\n        }\n    });\n}\n\nexport function exportVicMulti(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    // In the 10-color multicolor mode, a single pixel of every 4\u00D78 block (a character cell)\n    // may have any of four colors: the background color, the auxiliary color (both shared for the\n    // entire screen and selectable among the entire palette), the same color as the overscan border\n    // (also a shared color) or a free foreground color, both selectable among the first eight colors\n    // of the palette.\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getVicCellMapper(\n            content,\n            {\n                // Each possible two-bit value corresponds to a specific selectable color:\n                // %00 = screen color\n                // %01 = border color\n                // %10 = character/cell color\n                // %11 = auxiliary color\n                globalColorsBitPattern: [\n                    { paletteIndex: content.backgroundColor, bitPattern: 0x00 },\n                    { paletteIndex: content.borderColor, bitPattern: 0x01 },\n                    { paletteIndex: content.auxColor, bitPattern: 0x03 }\n                ],\n                colorsBitPattern: [ 0x02 ]\n            }\n        ),\n        colorParamMapper: getVicColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 1, content);\n                    return colors[0];\n                }\n            }\n        ),\n        extraParamMapper: {\n            data(): Uint8Array {\n                let array = new Uint8Array(3);\n                array[0] = content.backgroundColor;\n                array[1] = content.borderColor;\n                array[2] = content.auxColor;\n                return array;\n            }\n        }\n    });\n}\n\nfunction getZxCellMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper?: CellExporterMapper | Partial<CellExporterMapper_Iterate>): CellExporterMapper {\n\n    let bpp = content.bitsPerColor;\n    let bitsPerCellWidth = (content.cell.w * bpp);\n\n    let exporter: CellExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n            return { data: new Uint8Array(content.width * content.height * content.bitsPerColor / 8) };\n        },\n\n        xyToBitInfo(x: number, y: number): ParamBitInfo {\n\n            let column = Math.floor(x / content.block.w);\n            let paramOffset = (Math.floor(y / content.block.h) * content.block.columns) + column;\n\n            let xInBytes = Math.floor(x / content.block.w);\n\n            // see http://www.breakintoprogram.co.uk/hardware/computers/zx-spectrum/screen-memory-layout\n            //\n            // To calculate the screen address of a byte, you encode the address as follows:\n            //              HIGH              |              LOW\n            // -------------------------------+-------------------------------\n            //  15| 14| 13| 12| 11| 10| 9 | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 \n            // ---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---\n            //  x | x | x | Y7| Y6| Y2| Y1| Y0| Y5| Y4| Y3| X4| X3| X2| X1| X0\n            //\n            // Where:\n            //\n            // The base address of screen memory (0x4000) is provided by setting bits 15 to 13 to 010.\n            // Y0 to Y7 is the Y coordinate (in pixels)\n            // X0 to X4 is the X coordinate (in bytes)\n            //\n            // The 0x4000 address (x values) are set to 0 since this is an array offset not a memory offset.\n\n            let strangeOffset = (((y & 0b11000000) >> 6) << 11) |\n                                (((y & 0b00000111) >> 0) << 8) |\n                                (((y & 0b00111000) >> 3) << 5) |\n                                (((xInBytes & 0b00011111) >> 0) << 0);\n\n            let bitShift = (content.cell.msbToLsb ? (bitsPerCellWidth - (((x % content.cell.w) + 1) * bpp)) : (x % content.cell.w) * bpp);\n\n            return {\n                offset: strangeOffset,\n                bitShift: bitShift,\n                bitCount: bpp,\n                paramOffset: paramOffset\n            };\n        }\n    };\n\n    return exporter;\n}\n\nexport function exportZXSpectrum(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    \n    let content: BlockParamDitherCanvasContent = message.content;\n\n    // from http://www.breakintoprogram.co.uk/hardware/computers/zx-spectrum/screen-memory-layout\n    //\n    // %0 = paper\n    // %1 = ink\n    // intensity = high bit of either paper or ink (since both palette choices MUST share the same intensity)\n\n    // Each attribute cell is as follows:\n    //  7 | 6 | 5 | 4 | 3 | 2 | 1 | 0\n    // ---+---+---+---+---+---+---+---\n    //  F | B | P2| P1| P0| I2| I1| I0\n    //\n    // Where:\n    // F sets the attribute FLASH mode\n    // B sets the attribute BRIGHTNESS mode\n    // P2 to P0 is the PAPER color (index 0-7)\n    // I2 to I0 is the INK color (index 0-7)\n\n    // The B bit is taken from the either chosen palette color since both are chosen as\n    // dark (thus will have a B of \"0\") or both will be chosen bright (thus will have\n    // a B of \"1\"). Since the B is taken from the high-bit of the 0x00 -> 0x0F palette\n    // where indexes 0x08 -> 0x0F are \"bright\", the B bit will always be set correctly.\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getZxCellMapper(\n            content,\n            {\n                colorsBitPattern: [ 0x00, 0x01 ]\n            }\n        ),\n        colorParamMapper: getVicColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 2, content);\n                    return ((colors[0] & 0x07) << 3) | (colors[1] & 0x7) | (((colors[0] & 0x08) >> 3) << 6);\n                }\n            }\n        )\n    });\n}\n\nfunction getSticColorMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper: ParamExporterMapper | Partial<ParamExporterMapper_Iterate>): ParamExporterMapper {\n\n    let exporter: ParamExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n            let columns = 20;\n            let rows = 12;\n\n            // the color ram maps to the BACKTAB, the CP1600 is a 16 bit CPU and the\n            // byte order is stored in little endian when serialized as binary\n            return { data: new Uint8Array((columns * rows) * 2), littleEndian: true };\n        },\n        prefill(array: Uint8Array): void {\n            let c1 = 7;         // white on black\n            let c2 = 0;\n            let gromCard = 0;   // use a blank space\n            let grom = 0;       // use the rom character (not the ram)\n            let result = c1 | ((c2 & 0b11) << 9) | (((c2 & 0b100) >> 2) << 13) | (((c2 & 0b1000) >> 3) << 12) | (gromCard << 3) << (grom << 11);\n\n            let lowByte = result & 0xff;\n            let highByte = (result & 0xff00) >> 8;\n\n            for (let i = 0; i < array.length; ++i) {\n                if (i % 2 == 0) {\n                    array[i] = lowByte;\n                } else {\n                    array[i] = highByte;\n                }\n            }\n\n            // insert the stamp into the BACKTAB\n            let offset = (9 * 20) * 2;  // 0-7th row is gram bitmap, 8th row left blank, 9th row\n            const stamp: number[] = [0x2D, 0x41, 0x44, 0x45, 0x00, 0x42, 0x59, 0x00, 0x24, 0x49, 0x54, 0x48, 0x45, 0x52, 0x54, 0x53, 0x4F, 0x4e];\n            for (let x = 0; x < stamp.length; ++x) {\n                let result = c1 | ((c2 & 0b11) << 9) | (((c2 & 0b100) >> 2) << 13) | (((c2 & 0b1000) >> 3) << 12) | (stamp[x] << 3) << (grom << 11);\n\n                let lowByte = result & 0xff;\n                let highByte = (result & 0xff00) >> 8;\n                array[offset + (x *2)] = lowByte;\n                array[offset + (x *2) + 1] = highByte;\n            }\n        },\n        paramToBitInfo(paramOffset: number): ParamBitInfo {\n\n            // picture is arranged 8x8 grid for gram, or 20x12 grid for grom of 8x8 pixels despite\n            // but layout is always 20 x 12\n\n            // figure out the param's y\n            let y = Math.floor(paramOffset / Math.floor(content.width / content.block.w));\n\n            // figure out the param's x\n            let x = paramOffset % Math.floor(content.width / content.block.w);\n\n            // recalculate a new offset\n            let offset = (y * 20) + x;\n\n            return {\n                offset: offset * 2, // the values are 16 bits\n                bitShift: 0,\n                bitCount: 16,\n                paramOffset: paramOffset\n            };\n        }\n    };\n\n    return exporter;\n}\n\nexport function exportSticFgbg(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getVicCellMapper(\n            content,\n            {\n                colorsBitPattern: [ 0x00, 0x01 ]\n            }\n        ),\n        colorParamMapper: getSticColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n\n                    //\n                    // 15 | 14 | 13 | 12 | 11 | 10 | 09 | 08 | 07 | 06 | 05 | 04 | 03 | 02 | 01 | 00\n                    // ---+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----\n                    //  x |  x | B2 | B3 | GR | B1 | B0 | G5 | G4 | G3 | G2 | G1 | G0 | F2 | F1 | F0\n                    //\n                    // x = unused\n                    // B = Background\n                    // F = Foreground\n                    // G = Graphic Card\n                    // GR = 1 for GRAM, 0 for GROM (GRAM 0...63 GROM 0...255)\n                    //\n\n                    let colors = extractColorsFromParamContent(param, 2, content);\n\n                    let c1 = colors[0];    // foreground color (3-bit)\n                    let c2 = colors[1];    // background color (4-bit)\n\n                    let gram = 0b1;\n                    let gramCard = (info.paramOffset & 0b111111);\n\n                    let result = c1 | ((c2 & 0b11) << 9) | (((c2 & 0b100) >> 2) << 13) | (((c2 & 0b1000) >> 3) << 12) | (gramCard << 3) << (gram << 11);\n                    //console.log('BACKTAB', hex(result), result, c1, c2, gram, gramCard);\n                    return result;\n                }\n            }\n        ),\n    });\n}\n\nfunction getSticCellMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper?: ParamExporterMapper | Partial<ParamExporterMapper_Iterate>): ParamExporterMapper {\n\n    const bytesPerImage = 8;\n\n    let exporter: ParamExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n            let columns = 8;\n            let rows = 8;\n\n            // the color ram maps to the BACKTAB, the CP1600 is a 16 bit CPU and the\n            // byte order is stored in little endian when serialized as binary\n            return { data: new Uint8Array((columns * rows) * bytesPerImage), littleEndian: true };\n        },\n        finalize(iteration, cellImage, colors, colorBlock, cellBlock, extra): boolean {\n\n            for (let cellParamOffset = 0; cellParamOffset < content.cellParams.length; ++cellParamOffset) {\n                let extracted = extractColorsFromParams(cellParamOffset, content.cellParams, 2, 0xff, 8);\n                // extracted[0] == 1 when using the gram, extracted[1] is the gram block being used\n                if (extracted[0] == 0)\n                    continue;\n\n                // the destination is an 8x8 grid of 8 bytes each, starting where the cell param indicates\n                let dest = (extracted[1] * bytesPerImage);\n\n                // the source is a 20x12 rom grid of 8 bytes each\n                // translate the cell param offset into the source position\n                let column = (cellParamOffset % content.cell.columns);\n                let row = Math.floor(cellParamOffset / content.cell.columns);\n\n                let source = (row * content.cell.columns * bytesPerImage) + (column * 8);\n\n                for (let i = 0; i < bytesPerImage; ++i) {\n                    // copy the 8 bytes from grom to gram\n                    cellBlock[dest + i] = cellImage[source + i];\n                }\n            }\n            return false;\n        },\n    };\n\n    return exporter;\n}\n\nexport function exportSticColorStack(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    let cellColorsBitPattern = [ 0x00, 0x01 ];\n\n    let cellMapper = getVicCellMapper(\n        content, \n        {\n            paramToBitPattern(param: number, paletteIndex: number, info: ParamBitInfo): number {\n\n                let colors = extractColorsFromParamContent(param, content.paletteChoices.colors, content);\n\n                for (let i = 0; i < content.paletteChoices.colors; ++i) {\n                    if (colors[i] == paletteIndex)\n                        return cellColorsBitPattern[1 + i];\n                }\n\n                let cbColor = extractColorsFromParamsContent(info.paramOffset, content.cbParams, 1, content)[0];\n                if (cbColor == paletteIndex)\n                    return cellColorsBitPattern[0];\n\n                console.log('cb nor param color does not contain color from image', param, paletteIndex, colors, info, cbColor);\n                runtime_assert(false);  // something went wrong as palette could not be mapped\n                return 0;\n            }\n        }\n    );\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: cellMapper,\n        colorParamMapper: getSticColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n\n                    //\n                    // GRAM CARD:\n                    //\n                    // 15 | 14 | 13 | 12 | 11 | 10 | 09 | 08 | 07 | 06 | 05 | 04 | 03 | 02 | 01 | 00\n                    // ---+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----\n                    //  x |  x | AC | F3 |  1 |  x |  x | G5 | G4 | G3 | G2 | G1 | G0 | F2 | F1 | F0\n                    //\n                    // x = unused\n                    // AC = Advance color stack\n                    // F = Foreground (0-7)\n                    // G = Graphic Card (0-63)\n                    //\n                    //\n                    // GROM CARD:\n                    //\n                    // 15 | 14 | 13 | 12 | 11 | 10 | 09 | 08 | 07 | 06 | 05 | 04 | 03 | 02 | 01 | 00\n                    // ---+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----\n                    //  x |  x | AC |  0 |  0 | G7 | G6 | G5 | G4 | G3 | G2 | G1 | G0 | F2 | F1 | F0\n                    //\n                    // x = unused\n                    // AC = Advance color stack\n                    // F = Foreground (0-15)\n                    // G = Graphic Card (0-255)\n                    //\n        \n                    let colors = extractColorsFromParamContent(param, 2, content);\n        \n                    let c1 = colors[0];         // foreground color (3-bit)\n                    let advance = colors[1];    // should the color stack be advanced\n        \n                    let gramMode = content.block.size = (8*8*8);    // this size must mean it's in gram only mode\n        \n                    let usingExtendedColor = ((c1 & 0b1000) != 0);\n                    let cellInfo = (content.paramInfo.cell ? extractColorsFromParams(info.paramOffset, content.cellParams, 2, 0xff, 8) : [gramMode ? 1 : 0, gramMode ? (info.paramOffset & 0b111111) : 0]);\n                    let usingGram = (cellInfo[0] != 0);\n                    runtime_assert((!usingExtendedColor) || ((usingExtendedColor) && (usingGram)));\n        \n                    let gramOrRom = usingGram ? 0b1 : 0b0;\n                    let gramOrRomCard = usingGram ? (cellInfo[1] & 0b111111) : (info.paramOffset & 0b11111111);\n        \n                    let result = (c1 & 0b111) | (((c1 & 0b1000) >> 3) << 12) | ((advance & 0b1) << 13) | (gramOrRomCard << 3) << (gramOrRom << 11);\n                    //console.log('BACKTAB', hex(result), result, c1, advance, gramOrRom, gramOrRomCard, usingExtendedColor, cellInfo);\n                    return result;\n                }\n            }\n        ),\n        cellParamMapper: (content.paramInfo.cell ? getSticCellMapper(content) : undefined),\n        extraParamMapper: {\n            data(): Uint8Array {\n                let result = new Uint8Array(content.paramInfo.extra);\n                for (let i = 0; i < content.paramInfo.extra; ++i) {\n                    result[i] = extractColorsFromParamsContent(i, content.extraParams, 1, content)[0];\n                }\n                return result;\n            }\n        }\n    });\n}\n\nfunction getTMS9918ColorMapper(\n    content: BlockParamDitherCanvasContent,\n    mapper?: ParamExporterMapper | Partial<ParamExporterMapper_Iterate>): ParamExporterMapper {\n\n    let exporter: ParamExporterMapper = {\n        ...mapper,\n\n        prepare(): PrepareInfo {\n            return { data: new Uint8Array(content.block.size) };\n        },\n        paramToBitInfo(paramOffset: number): ParamBitInfo {\n            let x = paramOffset & 31;\n            let y = paramOffset >> 5;\n\n            let offset = (y & 7) | (x << 3) | ((y >> 3) << 8);\n\n            return {\n                offset: offset,\n                bitShift: 0,\n                bitCount: 8,\n                paramOffset: paramOffset\n            };\n        }\n    };\n\n    return exporter;\n}\n\nexport function exportTMS9918(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getVicCellMapper(\n            content,\n            {\n                colorsBitPattern: [ 0x00, 0x01 ]\n            }\n        ),\n        colorParamMapper: getTMS9918ColorMapper(\n            content,\n            {\n                paramToBitPattern(param: number, info: ParamBitInfo): number {\n                    let colors = extractColorsFromParamContent(param, 2, content);\n        \n                    // a special transparency pixel color exists \"0x00\" which is defined\n                    // as black in the palette, thus choose to remap the transparent\n                    // pixel color choice as TMS9918's black \"0x01\".\n                    colors[0] = (colors[0] == 0x00) ? 0x01 : colors[0];\n                    colors[1] = (colors[1] == 0x00) ? 0x01 : colors[1];\n        \n                    return colors[0] | (colors[1] << 4);\n                }\n            }\n        ),\n    });\n}\n\ntype PlaneToMemoryLocationFunc = (\n    plane: number,\n    planes: number,\n    pixelCellColumn: number,\n    pixelCellRow: number,\n    bitsInPlane: number,\n    bitPlaneByteOrderLE: boolean,\n    content: BlockParamDitherCanvasContent) => BitInfo;\n\nfunction snesDefautPlaneToMemoryLocationFunc(\n    plane: number,\n    planes: number,\n    pixelCellColumn: number,\n    pixelCellRow: number,\n    bitsInPlane: number,\n    bitPlaneByteOrderLE: boolean,\n    content: BlockParamDitherCanvasContent): BitInfo {\n\n    // see: https://mrclick.zophar.net/TilEd/download/consolegfx.txt\n    //\n    // should handle:\n    //\n    // 2. 1BPP NES/Monochrome\n    // [r0, bp1], [r1, bp1], [r2, bp1], [r3, bp1], [r4, bp1], [r5, bp1], [r6, bp1], [r7, bp1]\n    //\n    // 3. 2BPP NES\n    // [r0, bp1], [r1, bp1], [r2, bp1], [r3, bp1], [r4, bp1], [r5, bp1], [r6, bp1], [r7, bp1]\n    // [r0, bp2], [r1, bp2], [r2, bp2], [r3, bp2], [r4, bp2], [r5, bp2], [r6, bp2], [r7, bp2]\n    //\n    // 8. Mode 7 SNES (bits in plane = 8, planes = 1)\n    // [p0 r0: bp!], [p1 r0: bp!], [p2 r0: bp!], [p3 r0: bp!]\n    // [p4 r0: bp!], [p5 r0: bp!], [p6 r0: bp!], [p7 r0: bp!]\n    // [p0 r1: bp!], [p1 r1: bp!], [p2 r1: bp!], [p3 r1: bp!]\n    // [p4 r1: bp!], [p5 r1: bp!], [p6 r1: bp!], [p7 r1: bp!]\n    // ...\n    // [p0 r7: bp!], [p1 r7: bp!], [p2 r7: bp!], [p3 r7: bp!]\n    // [p4 r7: bp!], [p5 r7: bp!], [p6 r7: bp!], [p7 r7: bp!]\n    //\n    // 9. 2BPP Neo Geo Pocket Color (bits in plane = 2, planes = 1, LE = false)\n    // [p4-7 r0: bp*], [p0-3 r0: bp*], [p4-7 r1: bp*], [p0-3 r1: bp*]\n    // [p4-7 r2: bp*], [p0-3 r2: bp*], [p4-7 r3: bp*], [p0-3 r3: bp*]\n    // [p4-7 r4: bp*], [p0-3 r4: bp*], [p4-7 r5: bp*], [p0-3 r5: bp*]\n    // [p4-7 r6: bp*], [p0-3 r6: bp*], [p4-7 r7: bp*], [p0-3 r7: bp*]\n    //\n    // 10. 2BPP Virtual Boy (bits in plane = 2, planes = 1, LE = true)\n    // [p0-3 r0: bp*], [p4-7 r0: bp*], [p0-3 r1: bp*], [p4-7 r1: bp*]\n    // [p0-3 r2: bp*], [p4-7 r2: bp*], [p0-3 r3: bp*], [p4-7 r3: bp*]\n    // [p0-3 r4: bp*], [p4-7 r4: bp*], [p0-3 r5: bp*], [p4-7 r5: bp*]\n    // [p0-3 r6: bp*], [p4-7 r6: bp*], [p0-3 r7: bp*], [p4-7 r7: bp*]\n    //\n    // 12. 4BPP Genesis/x68k (bits in plane = 4, planes = 1, LE = true)\n    // [p1-2 r0: bp*], [p2-3 r0: bp*], [p4-5 r1: bp*], [p6-7 r1: bp*]\n    // [p1-2 r2: bp*], [p2-3 r2: bp*], [p4-5 r3: bp*], [p6-7 r3: bp*]\n    // [p1-2 r4: bp*], [p2-3 r4: bp*], [p4-5 r5: bp*], [p6-7 r5: bp*]\n    // [p1-2 r6: bp*], [p2-3 r6: bp*], [p4-5 r7: bp*], [p6-7 r7: bp*]\n\n    // Other: Direct color (bits in plane = 8, planes = 1) [TBD, need to verify this is true]\n    // [p0 r0: bp!], [p1 r0: bp!], [p2 r0: bp!], [p3 r0: bp!]\n    // [p4 r0: bp!], [p5 r0: bp!], [p6 r0: bp!], [p7 r0: bp!]\n    // [p0 r1: bp!], [p1 r1: bp!], [p2 r1: bp!], [p3 r1: bp!]\n    // [p4 r1: bp!], [p5 r1: bp!], [p6 r1: bp!], [p7 r1: bp!]\n    // ...\n    // [p0 r7: bp!], [p1 r7: bp!], [p2 r7: bp!], [p3 r7: bp!]\n    // [p4 r7: bp!], [p5 r7: bp!], [p6 r7: bp!], [p7 r7: bp!]\n\n    // the width of an entire row for a bit plane (in bits)\n    let bitPlaneRowWidth = bitsInPlane * content.block.w;\n\n    // offset in bytes where planes are written 0 ... planes, inside each row is written, and inside that each pixel column is written\n    let bitPlaneOffset = Math.floor((bitPlaneRowWidth * content.block.h * plane) + (bitPlaneRowWidth * pixelCellRow)) / 8;\n\n    let shiftedBitInPlane = content.cell.msbToLsb ?\n        (content.block.w - (pixelCellColumn + 1)) * bitsInPlane :\n        pixelCellColumn * bitsInPlane;\n\n    let whichByteInPlane = Math.floor(shiftedBitInPlane / 8);\n    whichByteInPlane = bitPlaneByteOrderLE ? whichByteInPlane : Math.floor(bitPlaneRowWidth / 8) - whichByteInPlane - 1;\n\n    shiftedBitInPlane = shiftedBitInPlane % 8;\n\n    runtime_assert((bitPlaneOffset + whichByteInPlane) * 8 < (planes * bitPlaneRowWidth * content.block.h));\n    return { offset: bitPlaneOffset + whichByteInPlane, bitShift: shiftedBitInPlane, bitCount: bitsInPlane };\n}\n\n\nfunction snesInterleavedPlaneToMemoryLocationFunc(\n    plane: number,\n    planes: number,\n    pixelCellColumn: number,\n    pixelCellRow: number,\n    bitsInPlane: number,\n    bitPlaneByteOrderLE: boolean,\n    content: BlockParamDitherCanvasContent): BitInfo {\n\n    // see: https://mrclick.zophar.net/TilEd/download/consolegfx.txt\n    //\n    // should handle:\n    //\n    // 4. 2BPP SNES/Gameboy/GBC\n    //\n    // [r0, bp1], [r0, bp2], [r1, bp1], [r1, bp2], [r2, bp1], [r2, bp2], [r3, bp1], [r3, bp2]\n    // [r4, bp1], [r4, bp2], [r5, bp1], [r5, bp2], [r6, bp1], [r6, bp2], [r7, bp1], [r7, bp2]\n    //\n    // 5. 3BPP SNES\n    // [r0, bp1], [r0, bp2], [r1, bp1], [r1, bp2], [r2, bp1], [r2, bp2], [r3, bp1], [r3, bp2]\n    // [r4, bp1], [r4, bp2], [r5, bp1], [r5, bp2], [r6, bp1], [r6, bp2], [r7, bp1], [r7, bp2]\n    // [r0, bp3], [r1, bp3], [r2, bp3], [r3, bp3], [r4, bp3], [r5, bp3], [r6, bp3], [r7, bp3]\n    //\n    // 6.4BPP SNES/PC Engine\n    // [r0, bp1], [r0, bp2], [r1, bp1], [r1, bp2], [r2, bp1], [r2, bp2], [r3, bp1], [r3, bp2]\n    // [r4, bp1], [r4, bp2], [r5, bp1], [r5, bp2], [r6, bp1], [r6, bp2], [r7, bp1], [r7, bp2]\n    // [r0, bp3], [r0, bp4], [r1, bp3], [r1, bp4], [r2, bp3], [r2, bp4], [r3, bp3], [r3, bp4]\n    // [r4, bp3], [r4, bp4], [r5, bp3], [r5, bp4], [r6, bp3], [r6, bp4], [r7, bp3], [r7, bp4]\n    //\n    // 7. 8BPP SNES\n    // [r0, bp1], [r0, bp2], [r1, bp1], [r1, bp2], [r2, bp1], [r2, bp2], [r3, bp1], [r3, bp2]\n    // [r4, bp1], [r4, bp2], [r5, bp1], [r5, bp2], [r6, bp1], [r6, bp2], [r7, bp1], [r7, bp2]\n    // [r0, bp3], [r0, bp4], [r1, bp3], [r1, bp4], [r2, bp3], [r2, bp4], [r3, bp3], [r3, bp4]\n    // [r4, bp3], [r4, bp4], [r5, bp3], [r5, bp4], [r6, bp3], [r6, bp4], [r7, bp3], [r7, bp4]\n    // [r0, bp5], [r0, bp6], [r1, bp5], [r1, bp6], [r2, bp5], [r2, bp6], [r3, bp5], [r3, bp6]\n    // [r4, bp5], [r4, bp6], [r5, bp5], [r5, bp6], [r6, bp5], [r6, bp6], [r7, bp5], [r7, bp6]\n    // [r0, bp7], [r0, bp8], [r1, bp7], [r1, bp8], [r2, bp7], [r2, bp8], [r3, bp7], [r3, bp8]\n    // [r4, bp7], [r4, bp8], [r5, bp7], [r5, bp8], [r6, bp7], [r6, bp8], [r7, bp7], [r7, bp8]\n    //\n\n    // the width of an entire row for a bit plane (in bits)\n    let bitPlaneRowWidth = bitsInPlane * content.block.w;\n\n    let onOddRow = ((pixelCellRow & 0b1) != 0);\n\n    // offset in bytes where planes are written 0 ... planes, skipping to 2nd plane,\n    // where inside each row is written, and inside each plane is written for the even and odd interleaved pair,\n    // and inside that each pixel column is written\n    let bitPlaneOffset = Math.floor((((bitPlaneRowWidth * content.block.h * (plane >> 1)) << 1) +\n                                     ((bitPlaneRowWidth * pixelCellRow)) * (onOddRow ? 1 : 0)) / 8);\n\n    let shiftedBitInPlane = content.cell.msbToLsb ?\n        (content.block.w - (pixelCellColumn + 1)) * bitsInPlane :\n        pixelCellColumn * bitsInPlane;\n\n    let whichByteInPlane = Math.floor(shiftedBitInPlane / 8);\n    whichByteInPlane = bitPlaneByteOrderLE ? whichByteInPlane : Math.floor(bitPlaneRowWidth / 8) - whichByteInPlane - 1;\n\n    shiftedBitInPlane = shiftedBitInPlane % 8;\n\n    runtime_assert((bitPlaneOffset + whichByteInPlane) * 8 < (planes * bitPlaneRowWidth * content.block.h));\n    return { offset: bitPlaneOffset + whichByteInPlane, bitShift: shiftedBitInPlane, bitCount: bitsInPlane };\n}\n\n\nfunction snesLinearPlaneToMemoryLocationFunc(\n    plane: number,\n    planes: number,\n    pixelCellColumn: number,\n    pixelCellRow: number,\n    bitsInPlane: number,\n    bitPlaneByteOrderLE: boolean,\n    content: BlockParamDitherCanvasContent): BitInfo {\n\n    // see: https://mrclick.zophar.net/TilEd/download/consolegfx.txt\n    //\n    // should handle:\n    //\n    // 11. 4BPP Game Gear/Sega Master System/Wonderswan Color\n    // [r0, bp1], [r0, bp2], [r0, bp3], [r0, bp4], [r1, bp1], [r1, bp2], [r1, bp3], [r1, bp4]\n    // [r2, bp1], [r2, bp2], [r2, bp3], [r2, bp4], [r3, bp1], [r3, bp2], [r3, bp3], [r3, bp4]\n    // [r4, bp1], [r4, bp2], [r4, bp3], [r4, bp4], [r5, bp1], [r5, bp2], [r5, bp3], [r5, bp4]\n    // [r6, bp1], [r6, bp2], [r6, bp3], [r6, bp4], [r7, bp1], [r7, bp2], [r7, bp3], [r7, bp4]\n\n    // the width of an entire row for a bit plane (in bits)\n    let bitPlaneRowWidth = bitsInPlane * content.block.w;\n\n    // offset in bytes where rows are written 0 ... rows, inside each row planes are written, and inside that each pixel column is written\n    let bitPlaneOffset = Math.floor((bitPlaneRowWidth * planes * pixelCellRow) + (bitPlaneRowWidth * plane)) / 8;\n\n    let shiftedBitInPlane = content.cell.msbToLsb ?\n        (content.block.w - (pixelCellColumn + 1)) * bitsInPlane :\n        pixelCellColumn * bitsInPlane;\n\n    let whichByteInPlane = Math.floor(shiftedBitInPlane / 8);\n    whichByteInPlane = bitPlaneByteOrderLE ? whichByteInPlane : Math.floor(bitPlaneRowWidth / 8) - whichByteInPlane - 1;\n\n    shiftedBitInPlane = shiftedBitInPlane % 8;\n\n    runtime_assert((bitPlaneOffset + whichByteInPlane) * 8 < (planes * bitPlaneRowWidth * content.block.h));\n    return { offset: bitPlaneOffset + whichByteInPlane, bitShift: shiftedBitInPlane, bitCount: bitsInPlane };\n}\n\nconst snesPlaneToMemoryLocations: { [K: string]: PlaneToMemoryLocationFunc } =\n{\n    Default: snesDefautPlaneToMemoryLocationFunc,\n    interleaved: snesInterleavedPlaneToMemoryLocationFunc,\n    linear: snesLinearPlaneToMemoryLocationFunc\n};\n\n\ntype TransformColorFunc = (\n    color: number,\n    palette: Uint32Array | number[]) => number;\n\n    const snesTransformColor: { [K: string]: TransformColorFunc } =\n{\n    Default: snesTransformNoop,\n    bbgggrrr: snesTransformBBGGGRRR\n};\n\nfunction snesTransformNoop(\n    color: number,\n    palette: Uint32Array | number[]): number\n{\n    return color;\n}\n\nfunction snesTransformBBGGGRRR(\n    color: number,\n    palette: Uint32Array | number[]): number\n{\n    let rgb = palette[color];\n\n    let r = (rgb & 0xff);\n    let g = (rgb >> 8) & 0xff;\n    let b = (rgb >> 16) & 0xff;\n\n    return (((b & 0b11000000) >> 6) << 6) | (((g & 0b11100000) >> 5) << 3) | (((r & 0b11100000) >> 5) << 0);\n}\n\nexport function getSnesBitplanCellMapper(\n    message: PixelsAvailableMessage,\n    content: BlockParamDitherCanvasContent,\n    settings: DithertronSettings,\n    mapper: Partial<CellExporterMapper>): CellExporterMapper\n{\n    let indexed = message.indexed;\n\n    // how many bit planes are required to represent the chosen color\n    let planes: number = 0;\n\n    // how many pixels are in a cell\n    let pixelsInCell: number = 0;;\n\n    // how many cells are in the image\n    let cellsInImage: number = 0;\n\n    // how many color bits are in each plane\n    let bitsInPlane: number = 0;\n\n    const tilesetWidth: number = 32;\n    const tilesetHeight: number = 32;\n\n    let exporter: CellExporterMapper = {\n        ...mapper,\n        prepare(): PrepareInfo {\n            // how many bit planes are required to represent the chosen color\n            planes = (settings.customize === undefined ?\n                Math.ceil(Math.log2(content.block.colors)) :\n                (\"planes\" in settings.customize ? settings.customize.planes : Math.ceil(Math.log2(content.block.colors))));\n\n            // how many pixels are in a cell\n            pixelsInCell = content.block.w * content.block.h;\n\n            // how many cells are in the image\n            cellsInImage = content.block.columns * content.block.rows;\n            \n            bitsInPlane = (settings.customize === undefined ?\n                1 :\n                (\"bitsInPlane\" in settings.customize ? settings.customize.bitsInPlane : 1 ));\n\n            return { data: new Uint8Array(Math.floor((planes * bitsInPlane * pixelsInCell * cellsInImage) / 8)) };\n        },\n        iterate(data: Uint8Array): void {\n            let tilesetsWide = Math.floor(content.block.columns / tilesetWidth);\n            let tilesetsHigh = Math.floor(content.block.rows / tilesetHeight);\n\n            let totalTilesetBytes = Math.floor((planes * bitsInPlane * pixelsInCell * tilesetWidth * tilesetHeight) / 8);\n            let bytesInCell = Math.floor((planes * bitsInPlane * pixelsInCell) / 8);\n            let bytesInTilesetRow = bytesInCell * tilesetWidth;\n\n            let planeToMemoryLocationFunc = (settings.customize === undefined ?\n                snesPlaneToMemoryLocations.Default :\n                (\"planeToMemory\" in settings.customize ? snesPlaneToMemoryLocations[settings.customize.planeToMemory] : snesPlaneToMemoryLocations.Default ));\n\n            let transformColorFunc = (settings.customize === undefined ?\n                snesTransformColor.Default :\n                (\"transformColor\" in settings.customize ? snesTransformColor[settings.customize.transformColor] : snesTransformColor.Default));\n\n            let filterBits = (1 << bitsInPlane) - 1;\n\n            let bitPlaneByteOrderLE: boolean = (settings.customize === undefined ?\n                true :\n                ('planeLittleEndian' in settings.customize ? settings.customize.littleEndian : true));\n\n            let filterColorBit = content.block.msbToLsb ?\n                (plane: number, color: number) => {\n                    let shifted = (planes - (plane + 1)) * bitsInPlane;\n                    let extractedBits = color & (filterBits << shifted);\n                    return { extractedBits: extractedBits >> shifted, filteredColor: color ^ extractedBits };\n                } :\n                (plane: number, color: number) => {\n                    let shifted = plane * bitsInPlane;\n                    let extractedBits = color & (filterBits << shifted);\n                    return { extractedBits: extractedBits, filteredColor: color ^ extractedBits };\n                };\n\n            // iterate over the image and fill the bit-plane data\n            for (let i = 0; i < indexed.length; ++i) {\n                // which cell is being read\n                let column = Math.floor(i / content.block.w) % content.block.columns;                \n                let row = Math.floor(i / (content.width * content.block.h));\n\n                let inTilesetW = Math.floor(column / tilesetWidth);\n                let inTilesetH = Math.floor(row / tilesetHeight);\n\n                // the SNES stores each 32x32 block into a quadrant of 4 tilesets, making possible combinations of 32x32, 64x32, 32x64 and 64x64\n                let tilesetMemoryQuadrant = (inTilesetH * tilesetsWide) + inTilesetW;\n\n                // where is the tileset cell relative to in memory\n                let tilesetMemoryOffset = (tilesetMemoryQuadrant * totalTilesetBytes);\n\n                // need to normalize the tileset to the quadrant since the memory offset is relative to the quadrant\n                let tilesetColumn = column % tilesetWidth;\n                let tilesetRow = row % tilesetHeight;\n\n                let color = transformColorFunc(indexed[i], settings.pal);\n\n                // which is the (typically) 8x8 pixel of the cell is being consumed\n                let pc = (i % content.block.w);                             // pixel column (typically 0-7, or 0-15)\n                let pr = Math.floor(i / content.width) % content.block.h;   // pixel row (typically 0-7, or 0-15)\n\n                // the starting byte offset for the defined cell\n                let cellOffset = (bytesInTilesetRow * tilesetRow) + (bytesInCell * tilesetColumn);\n\n                // consume one plane at a time from the pixel\n                for (let plane = 0; (plane < planes) /* && (color != 0) */; ++plane) {\n                    let { extractedBits, filteredColor } = filterColorBit(plane, color);\n                    let bitInfo = planeToMemoryLocationFunc(plane, planes, pc, pr, bitsInPlane, bitPlaneByteOrderLE, content);\n                    color = filteredColor;\n\n                    let finalOffset = tilesetMemoryOffset + cellOffset + bitInfo.offset;\n                    bitOverlayUint8Array(data, finalOffset, extractedBits, bitInfo.bitShift, bitInfo.bitCount, bitPlaneByteOrderLE);\n                    // console.log(\n                    //     'bit-overlay',\n                    //     'tsw', tilesetsWide,\n                    //     'tsh', tilesetsHigh,\n                    //     'itw', inTilesetW,\n                    //     'itw', inTilesetH,\n                    //     'c', column,\n                    //     'r', row,\n                    //     'pc', pc,\n                    //     'pr', pr,\n                    //     'q', tilesetMemoryQuadrant,\n                    //     'mo', tilesetMemoryOffset,\n                    //     'co', cellOffset,\n                    //     'p', plane,\n                    //     'tp', planes,\n                    //     'i', i,\n                    //     'c', indexed[i],\n                    //     'e', extractedBits,\n                    //     'b', bitInfo,\n                    //     'f', finalOffset);\n                }\n            }\n        }\n    };\n\n    return exporter;\n}\n\nexport function getSnesTilemapMapper(\n    message: PixelsAvailableMessage,\n    content: BlockParamDitherCanvasContent,\n    settings: DithertronSettings,\n    mapper: Partial<ParamExporterMapper>): ParamExporterMapper\n{\n    // how many cells are in the image\n    let cellsInImage: number = 0;\n\n    const tilesetWidth: number = 32;\n    const tilesetHeight: number = 32;\n\n    let outputTileset: boolean = (settings.customize === undefined ?\n        true :\n        ('outputTileset' in settings.customize ? settings.customize.littleEndian : true));\n\n    let outputPalette: boolean = (settings.customize === undefined ?\n        true :\n        ('outputPalette' in settings.customize ? settings.customize.littleEndian : true));\n\n    if ((!outputTileset) &&\n        (!outputPalette))\n        return undefined;\n\n    let exporter: ParamExporterMapper = {\n        ...mapper,\n        prepare(): PrepareInfo {\n\n            // how many cells are in the image\n            cellsInImage = content.block.columns * content.block.rows;\n\n            return { data: new Uint8Array(((2 * cellsInImage) * (outputTileset ? 1 : 0)) + (outputPalette ? content.block.colors : 0)) };\n        },\n        iterate(data: Uint8Array): void {\n            let tilesetByteOrderLE: boolean = (settings.customize === undefined ?\n                false :\n                ('tilesetLittleEndian' in settings.customize ? settings.customize.littleEndian : false));\n\n        if (outputTileset) {\n                let tilesetsWide = Math.floor(content.block.columns / tilesetWidth);\n                let tilesetsHigh = Math.floor(content.block.rows / tilesetHeight);\n\n                let totalTilesetBytes = Math.floor((tilesetWidth * tilesetHeight) * 2); // 2 bytes per tile in tilemap\n\n                for (let row = 0; row < content.block.rows; ++row) {\n                    for (let column = 0; column < content.block.columns; ++column) {\n                        let inTilesetW = Math.floor(column / tilesetWidth);\n                        let inTilesetH = Math.floor(row / tilesetHeight);\n        \n                        // the SNES stores each 32x32 block into a quadrant of 4 tilesets, making possible combinations of 32x32, 64x32, 32x64 and 64x64\n                        let tilesetMemoryQuadrant = (inTilesetH * tilesetsWide) + inTilesetW;\n\n                        // where is the tileset cell relative to in memory\n                        let tilesetMemoryOffset = (tilesetMemoryQuadrant * totalTilesetBytes);\n\n                        let tilesetColumn = column % tilesetWidth;\n                        let tilesetRow = row % tilesetHeight;\n        \n                        let offset = ((tilesetRow * content.block.columns) + tilesetColumn) * 2;  // 2 bytes per tile in tileset\n\n                        let finalOffset = tilesetMemoryOffset + offset;\n\n                        let ppp = extractColorsFromParam(content.blockParams[(row *column) + column], 1, 0x3, 2);\n\n                        let v = 0 & 0b1;\n                        let h = 0 & 0b1;\n                        let p = ppp[0] & 0b111;\n                        let c = ((tilesetRow * tilesetWidth) + tilesetColumn) & 0b1111111111;\n                        let tile = (v << 15) | (h << 14) | (p << 10) | c;\n\n                        bitOverlayUint8Array(data, finalOffset, tile, 0, 16, tilesetByteOrderLE);\n                        //console.log('tileset', 'r', row, 'c', column, 'values', v, h, p, c, tile);\n                    }\n                }\n            }\n\n            if (outputPalette) {\n                let paletteOffset = outputTileset ? 0 : (Math.floor((2 * cellsInImage) / 8));\n\n                for (let p = 0; p < content.block.colors; ++p) {\n                    let rgb = message.pal[p];\n\n                    let r = (rgb & 0xff);\n                    let g = ((rgb >> 8) & 0xff);\n                    let b = ((rgb >> 16) & 0xff);\n\n                    let b5g5r5 = ((r >> 3) & 0b11111) | (((g >> 3) & 0b11111) << 5) | (((b >> 3) & 0b11111) << 10);\n\n                    bitOverlayUint8Array(data, paletteOffset + (p * 2), b5g5r5, 0, 16, tilesetByteOrderLE);\n                    //console.log('palette', p, rgb, r, g, g, b5g5r5);\n                }\n            }\n        }\n    };\n\n    return exporter;\n}\n\nexport function exportSNES(message: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    let content: BlockParamDitherCanvasContent = message.content;\n\n    return exportCombinedImageAndColorCellBuffer({\n        message: message,\n        content: content,\n        cellMapper: getSnesBitplanCellMapper(message, content, settings, {}),\n        colorParamMapper: getSnesTilemapMapper(message, content, settings, {})\n    });\n}\n\nexport function exportNES(img: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    var i = 0;\n    var cols = img.width / 8;\n    var rows = img.height / 8;\n    var char = new Uint8Array(img.width * img.height * 2 / 8);\n    for (var y = 0; y < img.height; y++) {\n        for (var x = 0; x < img.width; x++) {\n            var charofs = Math.floor(x / 8) + Math.floor(y / 8) * cols;\n            var ofs = charofs * 16 + (y & 7);\n            var shift = 7 - (x & 7);\n            var idx = (img.indexed[i]) & 0xff;\n            char[ofs] |= (idx & 1) << shift;\n            char[ofs + 8] |= ((idx >> 1) & 1) << shift;\n            i++;\n        }\n    }\n    return char;\n}\n\nexport function exportNES5Color(img: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    if (!settings.block) throw \"No block size\";\n    var char = exportFrameBuffer(img, settings);\n    // TODO: attr block format\n    var fmt = { w: settings.block.w, h: settings.block.h, bpp: 2 };\n    var attr = new Uint8Array(convertImagesToWords([img.indexed], fmt));\n    return concatArrays([char, attr]);\n}\n\nexport function exportVCSPlayfield(img: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    // must be == 40 pixels wide\n    var char = new Uint8Array(6 * img.height);\n    const pfmap = [\n        3, 2, 1, 0, -1, -1, -1, -1,\n        4, 5, 6, 7, 8, 9, 10, 11,\n        19, 18, 17, 16, 15, 14, 13, 12,\n        23, 22, 21, 20, -1, -1, -1, -1,\n        24, 25, 26, 27, 28, 29, 30, 31,\n        39, 38, 37, 36, 35, 34, 33, 32,\n    ];\n    for (var y = 0; y < img.height; y++) {\n        for (var x = 0; x < 48; x++) {\n            var srcofs = pfmap[x];\n            if (srcofs >= 0) {\n                srcofs += y * img.width;\n                if (img.indexed[srcofs]) {\n                    var destofs = (x >> 3) * img.height + img.height - y - 1;\n                    char[destofs] |= 128 >> (x & 7);\n                }\n            }\n        }\n    }\n    return char;\n}\n\nexport function exportMC6847(img: PixelsAvailableMessage, settings: DithertronSettings): Uint8Array {\n    var char = new Uint8Array(img.width * img.height / 4);\n    let dptr = 0;\n    let sptr = 0;\n    for (var y = 0; y < img.height; y++) {\n        for (var x = 0; x < img.width; x += 4, sptr += 4) {\n            char[dptr++] = ((img.indexed[sptr + 0] & 0b11) << 6) +\n                ((img.indexed[sptr + 1] & 0b11) << 4) +\n                ((img.indexed[sptr + 2] & 0b11) << 2) +\n                ((img.indexed[sptr + 3] & 0b11) << 0);\n        }\n    }\n    console.log(char);\n    return char;\n}\n\n", "\nexport function hex(v: number, nd?: number) {\n    if (!nd) nd = 2;\n    return toradix(v, nd, 16);\n}\n\nexport function toradix(v: number, nd: number, radix: number) {\n    try {\n        var s = v.toString(radix).toUpperCase();\n        while (s.length < nd)\n            s = \"0\" + s;\n        return s;\n    } catch (e) {\n        return v + \"\";\n    }\n}\n\nexport function sqr(x: number) { return x * x; }\n\nexport function range(start: number, end: number): number[] {\n    let result: number[] = new Array<number>(end - start);\n    for (let i = start; i < end; i++) { result[i - start] = i; }\n    return result;\n}\n\nexport function stringToByteArray(s: string): Uint8Array {\n    var a = new Uint8Array(s.length);\n    for (var i = 0; i < s.length; i++)\n        a[i] = s.charCodeAt(i);\n    return a;\n}\n\nexport type Only<T, U> = {\n    [P in keyof T]: T[P];\n  } & {\n    [P in keyof U]?: never;\n  };\n  \nexport type Either<T, U> = Only<T, U> | Only<U, T>;\n\nexport type static_assert<T extends true> = never;\n\nexport function runtime_assert(condition: boolean, message?: any): void {\n    // test condition outside of a lock (tests use extremely slow global lock)\n    if (condition)\n        return;\n\n    if (message == undefined)\n        console.assert(condition);\n    else\n        console.assert(condition, message);\n}\n", "import { RGBDistanceFunction } from \"./types\";\nimport { range, sqr } from \"./util\";\n\nexport interface ColorChoice {\n    ind: number;\n    count: number;\n}\n\nexport class Centroid {\n    r: number = 0;\n    g: number = 0;\n    b: number = 0;\n    n: number = 0;\n    add(rgb: number) {\n        this.r += (rgb >> 0) & 0xff;\n        this.g += (rgb >> 8) & 0xff;\n        this.b += (rgb >> 16) & 0xff;\n        this.n++;\n    }\n    getAvgRGB(k: number) {\n        var r = Math.max(0, Math.min(255, this.r * k / this.n));\n        var g = Math.max(0, Math.min(255, this.g * k / this.n));\n        var b = Math.max(0, Math.min(255, this.b * k / this.n));\n        return (r << 0) | (g << 8) | (b << 16);\n    }\n}\n\nexport function reducePaletteChoices(\n    imageData: Uint32Array, \n    colors: Uint32Array, \n    count: number, \n    diversity: number,\n    distfn: RGBDistanceFunction) : ColorChoice[] \n{\n    var histo = new Int32Array(colors.length);\n    var err = new Int32Array(4);\n    var tmp = new Uint8ClampedArray(4);\n    var tmp2 = new Uint32Array(tmp.buffer);\n    var bias = diversity*0.5 + 0.5;\n    let decay = diversity*0.25 + 0.65;\n    // choose initial centroids from palette\n    var centroids : Centroid[] = [];\n    var inds : number[] = [];\n    for (let i=0; i<count; i++) {\n        inds.push(Math.floor(i * (colors.length-1) / count));\n        centroids.push(new Centroid());\n    }\n    // iterate over the frame a max. number of items\n    for (let iter=0; iter<10; iter++) {\n        // iterate over pixels, skipping some for performance\n        for (let i=iter; i<imageData.length; i+=(i&15)+1) {\n            let rgbref = imageData[i];\n            err[0] += rgbref & 0xff;\n            err[1] += (rgbref >> 8) & 0xff;\n            err[2] += (rgbref >> 16) & 0xff;\n            tmp[0] = err[0];\n            tmp[1] = err[1];\n            tmp[2] = err[2];\n            let ind1 = getClosestRGB(tmp2[0], inds, colors, distfn);\n            let alt = colors[ind1];\n            centroids[inds.indexOf(ind1)].add(tmp2[0]);\n            let score = distfn(tmp2[0], alt);\n            histo[ind1] += Math.max(0, 256 - score);\n            err[0] -= (alt & 0xff);\n            err[1] -= ((alt >> 8) & 0xff);\n            err[2] -= ((alt >> 16) & 0xff);\n            err[0] *= decay;\n            err[1] *= decay;\n            err[2] *= decay;\n        }\n        // move colors if the new one is better\n        var allinds = range(0, colors.length);\n        var nchanged = 0;\n        for (let i=0; i<count; i++) {\n            // find closest palette color to centroid mean\n            let cent = centroids[i];\n            let current = colors[inds[i]];\n            let ind2 = getClosestRGB(cent.getAvgRGB(bias), allinds, colors, distfn);\n            let better = colors[ind2];\n            // if it's different, update the color\n            if (better != current) {\n                inds[i] = ind2;\n                nchanged++;\n                //console.log(iter, i, inds[i], ind2, score);\n            }\n            // don't use this color again\n            for (let j=0; j<colors.length; j++) {\n                if (colors[j] == better) { allinds[j] = -1; }\n            }\n        }\n        if (nchanged == 0) break;\n    }\n    // sort resulting colors by intensity\n    var result = inds.map((ind) => { return {ind, count:histo[ind]} });\n    result.sort((a,b) => intensity(colors[a.ind]) - intensity(colors[b.ind]));\n    return result;\n}\n\nexport function reducePalette(\n    imageData: Uint32Array,\n    colors: Uint32Array,\n    count: number,\n    diversity: number,\n    distfn : RGBDistanceFunction) : Uint32Array \n{\n    if (colors.length == count) return new Uint32Array(colors);\n    var choices = reducePaletteChoices(imageData, colors, count, diversity, distfn);\n    console.log('reducePalette', colors.length, 'to', choices.length);\n    return new Uint32Array(choices.map((x) => colors[x.ind]));\n}\n\n//\n\nexport function getRGBADiff(rgbref: number, rgbimg: number) {\n    var err = [0,0,0];\n    for (var i=0; i<3; i++) {\n        var d = (rgbref & 0xff) - (rgbimg & 0xff);\n        err[i] = d;\n        rgbref >>= 8;\n        rgbimg >>= 8;\n    }\n    return err;\n}\n\nexport function getRGBAErrorAbsolute(rgbref: number, rgbimg: number) {\n    var mag = 0;\n    for (var i=0; i<3; i++) {\n        var d = (rgbref & 0xff) - (rgbimg & 0xff);\n        mag += sqr(d);\n        rgbref >>= 8;\n        rgbimg >>= 8;\n    }\n    return Math.sqrt(mag);\n}\n\n// TODO???\nexport function getRGBAErrorHue(rgbref: number, rgbimg: number) {\n    var r1 = ((rgbref>>0) & 0xff);\n    var g1 = ((rgbref>>8) & 0xff);\n    var b1 = ((rgbref>>16) & 0xff);\n    var r2 = ((rgbimg>>0) & 0xff);\n    var g2 = ((rgbimg>>8) & 0xff);\n    var b2 = ((rgbimg>>16) & 0xff);\n    var b = 256;\n    var avg1 = (r1+g1+b1)/3 + b;\n    var avg2 = (r2+g2+b2)/3 + b;\n    r1 /= avg1;\n    g1 /= avg1;\n    b1 /= avg1;\n    r2 /= avg2;\n    g2 /= avg2;\n    b2 /= avg2;\n    //var mag2 = Math.sqrt(sqr(r1-r2)*9 + sqr(g1-g2)*25 + sqr(b1-b2)*4);\n    //var mag2 = Math.sqrt(sqr(r1-r2)*3 + sqr(g1-g2)*5 + sqr(b1-b2)*3);\n    var mag2 = Math.sqrt(sqr(r1-r2) + sqr(g1-g2) + sqr(b1-b2))*256;\n    return mag2;\n}\n\nexport function getRGBAErrorPerceptual(rgbref: number, rgbimg: number) {\n    var r1 = ((rgbref>>0) & 0xff);\n    var g1 = ((rgbref>>8) & 0xff);\n    var b1 = ((rgbref>>16) & 0xff);\n    var r2 = ((rgbimg>>0) & 0xff);\n    var g2 = ((rgbimg>>8) & 0xff);\n    var b2 = ((rgbimg>>16) & 0xff);\n    var rmean = (r1 + r2) / 2;\n    var r = r1 - r2;\n    var g = g1 - g2;\n    var b = b1 - b2;\n    return Math.sqrt((((512+rmean)*r*r)/256) + 4*g*g + (((767-rmean)*b*b)/256));\n}\n\nexport function getRGBAErrorMax(rgbref: number, rgbimg: number) {\n    var r1 = ((rgbref>>0) & 0xff);\n    var g1 = ((rgbref>>8) & 0xff);\n    var b1 = ((rgbref>>16) & 0xff);\n    var r2 = ((rgbimg>>0) & 0xff);\n    var g2 = ((rgbimg>>8) & 0xff);\n    var b2 = ((rgbimg>>16) & 0xff);\n    return Math.max(Math.abs(r1-r2), Math.abs(g1-g2), Math.abs(b1-b2));\n}\n\nexport function intensity(rgb: number) {\n    return getRGBAErrorPerceptual(0, rgb);\n}\n\nexport const ERROR_FUNCTIONS = {\n    'perceptual': getRGBAErrorPerceptual,\n    'hue': getRGBAErrorHue,\n    'dist': getRGBAErrorAbsolute,\n    'max': getRGBAErrorMax,\n}\n\nexport function getRGBAErrorArr(a: number, b: number) {\n    var err = [0,0,0];\n    for (var i=0; i<3; i++) {\n        err[i] = ((a & 0xff) - (b & 0xff));\n        a >>= 8;\n        b >>= 8;\n    }\n    return err;\n}\n\nexport function getClosestRGB(rgb:number, inds:number[], pal:Uint32Array, distfn:RGBDistanceFunction) {\n    var best = 9999999;\n    var bestidx = -1;\n    for (var i=0; i<inds.length; i++) {\n        let ind = inds[i];\n        if (ind >= 0) {\n            var col = pal[inds[i]];\n            var score = distfn(rgb, col);\n            if (score < best) {\n                best = score;\n                bestidx = inds[i];\n            }\n        }\n    }\n    return bestidx;\n}\n\nexport function scoreRGBDistances(rgb:number, inds:number[], pal:Uint32Array, distfn:RGBDistanceFunction) {\n    let scores = [];\n    for (let i=0; i<inds.length; i++) {\n        var col = pal[inds[i]];\n        var score = distfn(rgb, col);\n        scores[i] = {i, ind:inds[i], rgb, col, score};\n    }\n    return scores;\n}\n\n//\n\nexport function getHistogram(inds: number[]) {\n    var histo = new Uint32Array(256);\n    inds.forEach((x) => histo[x]++);\n    return getChoices(histo);\n}\n\nexport function getChoices(histo: Uint32Array) {\n    var choices : {count:number,ind:number}[] = [];\n    for (var i=0; i<histo.length; i++) {\n        if (histo[i] > 0) {\n            choices.push({count:histo[i], ind:i});\n        }\n    }\n    choices.sort((a,b) => b.count - a.count);\n    return choices;\n}\n\nexport function rgb2tuple(arr: number[]) {\n    return arr.map((x) => [(x>>0) & 0xff, (x>>8) & 0xff, (x>>16) & 0xff]);\n}\n\nexport function convertToSystemPalette(pal: Uint32Array, syspal: Uint32Array | number[]) {\n    return pal.map((rgba) => syspal.indexOf(rgba & 0xffffff));\n}\n\n", "import { support } from \"jquery\";\nimport { getChoices, getClosestRGB, getRGBADiff, getRGBAErrorPerceptual, reducePaletteChoices, ColorChoice } from \"../common/color\";\nimport {\n    DitherKernel,\n    DithertronSettings,\n    RGBDistanceFunction,\n    PaletteChoices,\n    PaletteRange,\n    BlockBasics,\n    BlockColors,\n    BlockSizing,\n    BlockBitOrder,\n    BlockColorBleed,\n    Param\n} from \"../common/types\";\nimport { range, runtime_assert } from \"../common/util\";\n\nconst THRESHOLD_MAP_4X4 = [\n    0, 8, 2, 10,\n    12, 4, 14, 6,\n    3, 11, 1, 9,\n    15, 7, 13, 5,\n];\n\nexport class BaseDitheringCanvas {\n    sys: DithertronSettings;\n    pal: Uint32Array;\n    img: Uint32Array;\n    ref: Uint32Array;\n    alt: Uint32Array;\n    err: Float32Array; // (n*3)\n    indexed: Uint32Array;\n    width: number; // integer\n    height: number;\n    tmp: Uint8ClampedArray;\n    tmp2: Uint32Array;\n    changes: number;\n    noise: number = 0;\n    diffuse: number = 0.8;\n    ordered: number = 0.0;\n    ditherfn: DitherKernel = [];\n    errfn: RGBDistanceFunction = getRGBAErrorPerceptual;\n    errorThreshold = 0;\n    iterateCount: number = 0;\n    params: Uint32Array;\n    content(): any { return { params: this.params }; };\n\n    constructor(img: Uint32Array, width: number, pal: Uint32Array) {\n        this.img = img;\n        for (var i = 0; i < pal.length; i++)\n            pal[i] |= 0xff000000;\n        this.pal = new Uint32Array(pal);\n        this.width = width;\n        this.height = Math.floor(img.length / width);\n        this.tmp = new Uint8ClampedArray(4);\n        this.tmp2 = new Uint32Array(this.tmp.buffer);\n        this.ref = new Uint32Array(img);\n        this.alt = new Uint32Array(this.ref);\n        this.err = new Float32Array(this.ref.length * 3);\n        this.indexed = new Uint32Array(this.ref.length);\n        this.changes = 0;\n        this.reset();\n    }\n    reset() {\n        this.img = new Uint32Array(this.ref);\n        this.alt.set(this.ref);\n        this.err.fill(0);\n        this.indexed.fill(0);\n        this.changes = 0;\n    }\n    init() : void {\n    }\n    update(offset: number) {\n        var errofs = offset * 3;\n        var rgbref = this.ref[offset];\n        // add cumulative error to pixel color, store into a clamped R,G, and B values (0-255) array\n        var ko = 1;\n        if (this.ordered > 0) {\n            let x = (offset % this.width) & 3;\n            let y = (offset / this.width) & 3;\n            ko = 1 + (THRESHOLD_MAP_4X4[x + y * 4] / 15 - 0.5) * this.ordered;\n        }\n        this.tmp[0] = (rgbref & 0xff) * ko + this.err[errofs];\n        this.tmp[1] = ((rgbref >> 8) & 0xff) * ko + this.err[errofs + 1];\n        this.tmp[2] = ((rgbref >> 16) & 0xff) * ko + this.err[errofs + 2];\n        // store the error-modified color\n        this.alt[offset] = this.tmp2[0];\n        // find closest palette color\n        var valid = this.getValidColors(offset);\n        var palidx = this.getClosest(this.tmp2[0], valid);\n        var rgbimg = this.pal[palidx];\n        // compute error and distribute to neighbors\n        var err = getRGBADiff(rgbref, rgbimg);\n        for (var i = 0; i < 3; i++) {\n            var k = (this.err[errofs + i] + err[i]) * this.diffuse;\n            // TODO: don't wrap off right edge?\n            this.ditherfn.forEach((df) => {\n                this.err[errofs + i + (df[0] + df[1] * this.width) * 3] += k * df[2];\n            });\n            this.err[errofs + i] = 0; // reset this pixel's error\n        }\n        // set new pixel rgb\n        const errmag = (Math.abs(err[0]) + Math.abs(err[1]*2) + Math.abs(err[2])) / (256 * 4);\n        if (this.indexed[offset] != palidx) {\n            let shouldChange = (errmag >= this.errorThreshold);\n            if (!shouldChange) {\n                let existingValue = this.indexed[offset];\n                // double check the old value is still legal since changing the value is not desired\n                shouldChange = (valid.find((x) => existingValue === x) === undefined);\n            }\n            if (shouldChange) {\n                this.indexed[offset] = palidx;\n                this.changes++;\n            }\n        }\n        this.img[offset] = rgbimg;\n        //this.img[offset] = this.tmp2[0] | 0xff000000;\n    }\n    getClosest(rgb: number, inds: number[]) {\n        return getClosestRGB(rgb, inds, this.pal, this.errfn);\n    }\n    iterate() {\n        this.changes = 0;\n        // WARNING: commit must be called prior to update otherwise the\n        // update can happen without the image reflecting the new color\n        // choices. Not only is the image seen potentially out of sync for\n        // the user, but this can also cause some cell bitmap patterns to\n        // fail on some pixels as these pixel chose a color that is not\n        // present in the color params.\n        this.commit();\n        for (var i = 0; i < this.img.length; i++) {\n            this.update(i);\n        }\n        this.iterateCount++;\n    }\n    commit() {\n        //\n    }\n    getValidColors(imageIndex: number): number[] {\n        return range(0, this.pal.length);\n    }\n}\n\nexport interface ParamsContent {\n    params: Uint32Array;\n};\n\nexport abstract class ParamDitherCanvas extends BaseDitheringCanvas {\n    params: Uint32Array = new Uint32Array(0);\n\n    abstract guessParam(paramIndex: number): void;\n\n    abstract init(): void;\n\n    override commit(): void {\n        for (var i = 0; i < this.params.length; i++) {\n            this.guessParam(i);\n        }\n    }\n\n    override content() : ParamsContent {\n        return {\n            params: this.params\n        };\n    }\n}\n\nexport abstract class BasicParamDitherCanvas extends ParamDitherCanvas {\n    abstract w: number;\n    abstract h: number;\n\n    override init(): void {\n        this.params = new Uint32Array(this.width * this.height / this.w);\n        for (var i = 0; i < this.params.length; i++) {\n            this.guessParam(i);\n        }\n    }\n}\n\n// TODO: both colors affected by bright bit\nexport abstract class TwoColor_Canvas extends BasicParamDitherCanvas {\n    ncols: number = 0;\n    nrows: number = 0;\n    border: number = 0;\n    allColors: number[] | null = null;\n\n    init() {\n        if (!this.allColors) this.allColors = range(0, this.pal.length);\n        this.indexed.fill(this.allColors[0]);\n        this.ncols = this.width / this.w;\n        this.nrows = this.height / this.h;\n        this.params = new Uint32Array(this.ncols * this.nrows);\n        for (var i = 0; i < this.params.length; i++) {\n            this.guessParam(i);\n        }\n    }\n    override getValidColors(imageIndex: number) {\n        var col = Math.floor(imageIndex / this.w) % this.ncols;\n        var row = Math.floor(imageIndex / (this.width * this.h));\n        var i = col + row * this.ncols;\n        var c1 = this.params[i] & 0xff;\n        var c2 = (this.params[i] >> 8) & 0xff;\n        return [c1, c2];\n    }\n    guessParam(p: number) {\n        var col = p % this.ncols;\n        var row = Math.floor(p / this.ncols);\n        var offset = col * this.w + row * (this.width * this.h);\n        var colors = this.allColors!;\n        var histo = new Uint32Array(256);\n        // pixel overlap in 8x8 window\n        var b = this.border; // border\n        for (var y = -b; y < this.h + b; y++) {\n            var o = offset + y * this.width;\n            for (var x = -b; x < this.w + b; x++) {\n                var c1 = this.indexed[o + x] | 0;\n                histo[c1] += 100;\n                var c2 = this.getClosest(this.alt[o + x] | 0, colors);\n                histo[c2] += 1 + this.noise;\n            }\n        }\n        var choices = getChoices(histo);\n        this.updateParams(p, choices);\n    }\n    updateParams(p: number, choices: { ind: number }[]) {\n        var ind1 = choices[0].ind;\n        var ind2 = choices[1] ? choices[1].ind : ind1;\n        if (ind1 > ind2) {\n            var tmp = ind1;\n            ind1 = ind2;\n            ind2 = tmp;\n        }\n        this.params[p] = ind1 + (ind2 << 8);\n    }\n}\n\nexport abstract class OneColor_Canvas extends TwoColor_Canvas {\n    bgColor: number = 0;\n\n    init() {\n        /*\n        var choices = reducePaletteChoices(this.ref, this.pal, 2, 1, this.errfn);\n        this.bgColor = choices[choices.length-1].ind;\n        this.allColors = [1,2,3,4,5,6,7].filter(x => x != this.bgColor);\n        console.log(this.bgColor, this.allColors);\n        */\n        this.bgColor = 0;\n        super.init();\n    }\n    override getValidColors(imageIndex: number) {\n        return [this.bgColor, super.getValidColors(imageIndex)[0]];\n    }\n    updateParams(p: number, choices: { ind: number }[]) {\n        for (let c of choices) {\n            if (c.ind != this.bgColor) {\n                this.params[p] = c.ind;\n                break;\n            }\n        }\n    }\n}\n\nexport interface BlockParamDitherCanvasContent {\n    width: number;\n    height: number;\n\n    block: BlockBasics & BlockColors & BlockSizing & BlockBitOrder;\n    cb: BlockBasics & BlockSizing & BlockBitOrder;\n    cell: BlockBasics & BlockSizing & BlockBitOrder;\n\n    fliMode: boolean;\n    fullPaletteMode: boolean;\n\n    paramInfo: Required<Param>;\n    \n    bitsPerColor: number;\n    pixelsPerByte: number;\n\n    // values chosen base on image\n    backgroundColor: number;\n    auxColor: number;\n    borderColor: number;\n \n    paletteChoices: PaletteChoices;\n    paletteBits: number;\n    paletteBitFilter: number;\n\n    blockParams: Uint32Array;\n    cbParams: Uint32Array;\n    cellParams: Uint32Array;\n    extraParams: Uint32Array;\n}\n\nexport type AddToHistogramFromCurrentColorAtHandler = (x: number, y: number, color: number | undefined, histogram: Uint32Array) => void;\nexport type AddToHistogramFromClosestAtHandler = (x: number, y: number, closest: ClosestScore | undefined, histogram: Uint32Array) => void;\n\nexport abstract class BlockParamDitherCanvas extends BaseDitheringCanvas {\n    blockParams: Uint32Array = new Uint32Array(0);\n    cbParams: Uint32Array = new Uint32Array(0);\n    cellParams: Uint32Array = new Uint32Array(0);\n    extraParams: Uint32Array = new Uint32Array(0);\n\n    block: BlockBasics & BlockColors & BlockSizing & BlockColorBleed & BlockBitOrder;\n    cb: BlockBasics & BlockSizing & BlockColorBleed & BlockBitOrder;\n    cell: BlockBasics & BlockSizing  & BlockColorBleed & BlockBitOrder;\n\n    fliMode: boolean = false;\n    fullPaletteMode: boolean = false;\n\n    paramInfo: Required<Param>;\n    \n    bitsPerColor: number;\n    pixelsPerByte: number;\n\n    paletteChoices: PaletteChoices;\n    paletteBits = Math.ceil(Math.log2(this.pal.length));\n    paletteBitFilter = ((1 << this.paletteBits) - 1);\n\n    // values chosen base on image\n    backgroundColor: number = 0;\n    auxColor: number = 0;\n    borderColor: number = 0;\n\n    content(): BlockParamDitherCanvasContent {\n        return {\n            width: this.width,\n            height: this.height,\n\n            block: this.block,\n            cb: this.cb,\n            cell: this.cell,\n\n            fullPaletteMode: this.fullPaletteMode,\n\n            fliMode: this.fliMode,\n            paramInfo: this.paramInfo,\n\n            bitsPerColor: this.bitsPerColor,\n            pixelsPerByte: this.pixelsPerByte,\n\n            backgroundColor: this.backgroundColor,\n            borderColor: this.borderColor,\n            auxColor: this.auxColor,\n            \n            paletteChoices: this.paletteChoices,\n            paletteBits: this.paletteBits,\n            paletteBitFilter: this.paletteBitFilter,\n\n            blockParams: this.blockParams,\n            cbParams: this.cbParams,\n            cellParams: this.cellParams,\n            extraParams: this.extraParams,\n        }\n    }\n\n    // functions that are designed to be overridden\n    override init(): void {\n        super.init();        \n    }\n    abstract prepare(): void;\n\n    abstract prepareDefaults(): void;\n    abstract prepareGlobalColorChoices(): void;\n    abstract allocateParams(): void;\n\n    abstract currentColorAtXY(x: number, y: number, orColor?: number): number;\n    abstract addToHistogramAtXYFromCurrentColor(x: number, y: number, color: number | undefined, histogram: Uint32Array);\n    abstract addToHistogramFromClosestAtXY(x: number, y: number, closest: ClosestScore | undefined, histogram: Uint32Array, scores: Uint32Array): void;\n\n    override commit(): void {\n        super.commit();\n    }\n\n    override getValidColors(imageIndex: number): number[] {\n        return super.getValidColors(imageIndex);\n    }\n\n    abstract guessBlockParams(): void;\n    abstract guessCbParams(): void;\n    abstract guessCellParams(): void;\n    abstract guessExtraParams(): void;\n\n    abstract guessBlockParam(offset: number): void;\n    abstract guessCbParam(offset: number): void;\n    abstract guessCellParam(offset: number): void;\n    abstract guessExtraParam(offset: number): void;\n};\n\nexport interface ScoredColorChoice extends ColorChoice {\n    score: number\n};\n\nexport interface BlockInfo extends BlockBasics, BlockSizing {\n};\n\nexport interface ExtendedBlockInfo extends BlockBasics, BlockSizing, Required<BlockColorBleed> {\n};\n\nexport interface ClosestScore {\n    closestColor: number,\n    closestScore: number\n};\n\nexport function extractColorsFromParam(param: number, totalToExtract: number, paletteBitFilter: number, paletteBits: number): number[] {\n    if (0 == totalToExtract)\n        return [];\n\n    let value = param;\n\n    let result: number[] = [];\n    while (totalToExtract > 0) {\n        result.push(value & paletteBitFilter);\n        value >>= paletteBits;\n        --totalToExtract;\n    }\n    return result;\n}\n\nexport function extractColorsFromParamContent(param: number, totalToExtract: number, content: { paletteBitFilter: number, paletteBits: number}): number[] {\n    return extractColorsFromParam(param, totalToExtract, content.paletteBitFilter, content.paletteBits);\n}\n\nexport function extractColorsFromParams(offset: number, params: Uint32Array, totalToExtract: number, paletteBitFilter: number, paletteBits: number): number[] {\n    if (0 == totalToExtract)\n        return [];\n    runtime_assert(offset < params.length);\n    return extractColorsFromParam(params[offset], totalToExtract, paletteBitFilter, paletteBits);\n}\n\nexport function extractColorsFromParamsContent(offset: number, params: Uint32Array, totalToExtract: number, content: { paletteBitFilter: number, paletteBits: number}): number[] {\n    return extractColorsFromParams(offset, params, totalToExtract, content.paletteBitFilter, content.paletteBits);\n}\n\nexport abstract class CommonBlockParamDitherCanvas extends BlockParamDitherCanvas {\n\n    paletteChoices: Required<PaletteChoices>;\n    pixelPaletteChoices: number[];\n\n    // legal color indices for various ranges\n    allColors: number[];            // colors for the entire palette range\n    backgroundColors: number[];     // colors legal for the background color\n    auxColors: number[];            // colors legal for the aux color\n    borderColors: number[];         // colors legal for the border color\n    blockColors: number[];          // colors legal for block colors (excluding any selectable background, border, aux colors)\n\n    globalValid: number[] = [];     // an array of selectable global colors\n\n    foundColorsByUsage: ColorChoice[] = [];             // which colors best represent the entire image\n    foundColorsByColorIntensity: ColorChoice[] = [];    // which colors are most compatible ranked by intensity\n\n    histogramScoreCurrent: number = 100;\n\n    histogram = new Uint32Array(this.pal.length);   // temporary scratch histogram buffer\n    scores = new Uint32Array(this.pal.length);      // temporary scratch scores buffer\n\n    firstCommit = false;\n\n    override init() : void {\n        this.prepare();\n    }\n    override prepare() : void {\n        super.init();\n        this.prepareDefaults();\n        this.prepareGlobalColorChoices();\n        this.allocateParams();\n\n        let bestPrefill = () => {\n            if (this.pixelPaletteChoices.length > 0)\n                return this.pixelPaletteChoices[0];\n            if (this.allColors.length > 0)\n                return this.allColors[0];\n            return this.backgroundColor;\n        };\n\n        this.indexed.fill(bestPrefill());\n    }\n    override prepareDefaults(): void {\n        this.block = {\n            w: (this.sys.block === undefined ?\n                    (this.sys.cell === undefined ? this.sys.cb.w : this.sys.cell.w) :\n                    this.sys.block.w),\n            h: (this.sys.block === undefined ?\n                    (this.sys.cell === undefined ? this.sys.cb.h : this.sys.cell.h) :\n                    this.sys.block.h),\n            colors: (this.sys.block === undefined ? 2 : this.sys.block.colors ),\n            xb: (this.sys.block === undefined ?\n                    (this.sys.cb === undefined ? 0 :\n                        (this.sys.cb.xb === undefined ? 0 : this.sys.cb.xb)) :\n                    (this.sys.block.xb === undefined ? 0 : this.sys.block.xb)),\n            yb: (this.sys.block === undefined ?\n                    (this.sys.cb === undefined ? 0 :\n                        (this.sys.cb.yb === undefined ? 0 : this.sys.cb.yb)) :\n                    (this.sys.block.yb === undefined ? 0 : this.sys.block.yb)),\n            columns: 0,\n            rows: 0,\n            size: 0,\n            msbToLsb: (this.sys.block === undefined ? true : (this.sys.block.msbToLsb === undefined ? true : this.sys.block.msbToLsb))\n        };\n        this.block.columns = Math.ceil(this.width / this.block.w);\n        this.block.rows = Math.ceil(this.height / this.block.h);\n        this.block.size = this.block.columns * this.block.rows;\n\n        this.cb = {\n            w: (this.sys.cb === undefined ? this.block.w : this.sys.cb.w),\n            h: (this.sys.cb === undefined ? this.block.h : this.sys.cb.h),\n            xb: (this.sys.cb === undefined ?\n                    this.block.xb :\n                    (this.sys.cb.xb === undefined ? this.block.xb : this.sys.cb.xb)),\n            yb: (this.sys.cb === undefined ?\n                    this.block.yb :\n                    (this.sys.cb.yb === undefined ? this.block.yb : this.sys.cb.yb)),\n            columns: 0,\n            rows: 0,\n            size: 0,\n            msbToLsb: (this.sys.cb === undefined ? true : (this.sys.cb.msbToLsb === undefined ? true : this.sys.cb.msbToLsb))\n        };\n        this.cb.columns = Math.ceil(this.width / this.cb.w);\n        this.cb.rows = Math.ceil(this.height / this.cb.h);\n        this.cb.size = this.cb.columns * this.cb.rows;\n\n        this.cell = {\n            w: (this.sys.cell === undefined ? this.cb.w : this.sys.cell.w),\n            h: (this.sys.cell === undefined ? this.cb.h : this.sys.cell.h),\n            xb: (this.sys.cell === undefined ?\n                    this.block.xb :\n                    (this.sys.cell.xb === undefined ? this.block.xb : this.sys.cell.xb)),\n            yb: (this.sys.cell === undefined ?\n                    this.block.yb :\n                    (this.sys.cell.yb === undefined ? this.block.yb : this.sys.cell.yb)),\n            columns: 0,\n            rows: 0,\n            size: 0,\n            msbToLsb: (this.sys.cell === undefined ? true : this.sys.cell.msbToLsb)\n        };\n        this.cell.columns = Math.ceil(this.width / this.cell.w);\n        this.cell.rows = Math.ceil(this.height / this.cell.h);\n        this.cell.size = this.cell.rows * this.cell.columns;\n\n        this.fliMode = (this.sys.fli !== undefined);\n        this.paramInfo = {\n            block: (this.sys.param === undefined ? (this.sys.block !== undefined) : (this.sys.param.block === undefined ? this.sys.block !== undefined : this.sys.param.block)),\n            cb: (this.sys.param === undefined ? (this.sys.cb !== undefined) : (this.sys.param.cb === undefined ? this.sys.cb !== undefined : this.sys.param.cb)),\n            cell: (this.sys.param === undefined ? false : (this.sys.param.cell === undefined ? false : this.sys.param.cell)),\n            extra: (this.sys.param === undefined ? 0 : this.sys.param.extra)\n        };\n\n        this.bitsPerColor = Math.ceil(Math.log2(this.block.colors));\n        this.pixelsPerByte = Math.floor(8 / this.bitsPerColor);\n\n        runtime_assert(this.paletteBits > 0);\n\n        this.preparePaletteChoices(this.sys.paletteChoices);\n\n        // if the number of chosen colors is greater than the palette size there's no need to store color choices\n        this.fullPaletteMode = (this.paletteChoices.colors >= this.pal.length);\n        this.firstCommit = this.paletteChoices.prefillReference;\n    }\n    spliceColor(color: number, colors: number[]): number[] {\n        let found = colors.findIndex((x) => x == color);\n        if (found < 0)\n            return colors;\n        return [... colors.slice(0, found), ... colors.slice(found+1) ];\n    }\n    preparePixelPaletteChoices(): void {\n        let count : number = this.paletteChoices.colorsRange.max - this.paletteChoices.colorsRange.min + 1;\n        this.pixelPaletteChoices = range(this.paletteChoices.colorsRange.min, this.paletteChoices.colorsRange.max + 1);\n\n        this.allColors = range(0, this.pal.length);\n        this.backgroundColors = range(this.paletteChoices.backgroundRange.min, this.paletteChoices.backgroundRange.max+1);\n        this.auxColors = range(this.paletteChoices.auxRange.min, this.paletteChoices.auxRange.max+1);\n        this.borderColors = range(this.paletteChoices.borderRange.min, this.paletteChoices.borderRange.max+1);\n        this.blockColors = range(this.paletteChoices.colorsRange.min, this.paletteChoices.colorsRange.max+1);\n    }\n    preparePaletteChoices(options?: Partial<PaletteChoices>):void {\n        runtime_assert(this.pal.length > 0);\n        if (options === undefined) {\n            this.paletteChoices = {\n                prefillReference: false,\n                background: false,\n                aux: false,\n                border:  false,\n                backgroundRange: { min: 0, max: this.pal.length - 1 },\n                auxRange: { min: 0, max: this.pal.length - 1 },\n                borderRange: { min: 0, max: this.pal.length - 1 },\n                colors: this.block.colors,\n                colorsRange: { min: 0, max: this.pal.length - 1 }\n            };\n            this.preparePixelPaletteChoices();\n            return;\n        }\n        this.paletteChoices = {\n            prefillReference: options.prefillReference === undefined ? false : options.prefillReference,\n            background: options.background === undefined ? false : options.background,\n            aux: options.aux === undefined ? false : options.aux,\n            border:  options.aux === undefined ? false : options.border,\n            backgroundRange: options.backgroundRange === undefined ? { min: 0, max: this.pal.length - 1 } : options.backgroundRange,\n            auxRange: options.auxRange === undefined ? { min: 0, max: this.pal.length - 1 } : options.auxRange,\n            borderRange: options.borderRange === undefined ? { min: 0, max: this.pal.length - 1 } : options.borderRange,\n            colors: this.block.colors,\n            colorsRange: options.colorsRange === undefined ? { min: 0, max: this.pal.length - 1 } : options.colorsRange\n        };\n\n        this.paletteChoices.colors = options.colors === undefined ?\n            (this.block.colors - (this.paletteChoices.background ? 1 : 0) - (this.paletteChoices.aux ? 1 : 0) - (this.paletteChoices.border ? 1 : 0)) :\n            options.colors;\n        this.preparePixelPaletteChoices();\n\n        // some basic sanity checks\n        runtime_assert(this.pal.length > this.paletteChoices.backgroundRange.max - this.paletteChoices.backgroundRange.min);\n        runtime_assert(this.pal.length > this.paletteChoices.auxRange.max - this.paletteChoices.auxRange.min);\n        runtime_assert(this.pal.length > this.paletteChoices.borderRange.max - this.paletteChoices.borderRange.min);\n    }\n    chooseMin(available: boolean, range: PaletteRange, current?: number): number {\n        if (!available)\n            return current;\n        if (current === undefined)\n            return range.min;\n        return Math.min(current, range.min);\n    }\n    chooseMax(available: boolean, range: PaletteRange, current?: number): number {\n        if (!available)\n            return current;\n        if (current === undefined)\n            return range.max;\n        return Math.max(current, range.max);\n    }\n    prepareMinMax(background: boolean, aux: boolean, border: boolean): PaletteRange {\n        let chosenMin: number | undefined = this.chooseMin(background, this.paletteChoices.backgroundRange);\n        chosenMin = this.chooseMin(aux, this.paletteChoices.auxRange, chosenMin);\n        chosenMin = this.chooseMin(border, this.paletteChoices.borderRange, chosenMin);\n        //chosenMin = this.chooseMin(true, this.paletteChoices.colorsRange, chosenMin); // do not include pixel choices in this range\n        chosenMin = chosenMin === undefined ? 0 : chosenMin;\n\n        let chosenMax: number | undefined = this.chooseMax(background, this.paletteChoices.backgroundRange);\n        chosenMax = this.chooseMax(aux, this.paletteChoices.auxRange, chosenMax);\n        chosenMax = this.chooseMax(border, this.paletteChoices.borderRange, chosenMax);\n        //chosenMax = this.chooseMax(true, this.paletteChoices.colorsRange, chosenMax); // do not include pixel choices in this range\n        chosenMax = chosenMax === undefined ? (this.pal.length - 1) : chosenMax;\n\n        return {min: chosenMin, max: chosenMax};\n    }\n    override prepareGlobalColorChoices(): void {\n        let range = this.prepareMinMax(true, true, true);\n        let palSubset = this.pal.slice(range.min, range.max + 1);\n\n        // by default the choices result is ranked by color intensity\n        let choices = reducePaletteChoices(\n            this.ref,\n            palSubset,\n            palSubset.length,  // rank the entire palette subset (because restricted palettes may have to fallback)\n            1,\n            this.errfn);\n\n        // Need a ranking based on color usage, because if the color\n        // is selectable by a pixel then the most prominent selectable\n        // color should be chosen (to not waste a color for intensity\n        // reasons when a color is most useful as a pixel color choice);\n        // but if the color is not selectable by the color then fallback\n        // to color intensity (based on which top N colors are the\n        // most likely to be compatible with the picture);\n        let histoRankedChoices = choices.slice(0, choices.length);\n        histoRankedChoices.sort((a,b) => b.count - a.count);\n\n        this.foundColorsByUsage = histoRankedChoices.slice(0, histoRankedChoices.length);\n        this.foundColorsByColorIntensity = choices.slice(0, choices.length);\n\n        // these are the possible choices for colors\n        let ranges: { id: number, selectable: boolean, range: PaletteRange }[] = [\n            { id: 0, selectable: this.paletteChoices.background, range: this.paletteChoices.backgroundRange },\n            { id: 1, selectable: this.paletteChoices.aux, range: this.paletteChoices.auxRange },\n            { id: 2, selectable: this.paletteChoices.border, range: this.paletteChoices.borderRange }\n        ];\n\n        // sort by the follow criteria:\n        // 1. colors that can be selected by pixels have priority over those that do not\n        // 2. colors that have the most restricted palettes\n        // 3. by id (if all other choices are equal)\n        ranges.sort((a,b) =>\n            (a.selectable == b.selectable) ? \n                (((a.range.max - a.range.min) == (b.range.max - b.range.min)) ?\n                    a.id - b.id :\n                    (a.range.max - a.range.min) - (b.range.max - b.range.min)) :\n                (a.selectable ? -1 : 1));\n\n        let assignId = (choice: ColorChoice, option: { id: number, selectable: boolean, range: PaletteRange }) => {\n            let index = choice.ind + range.min; // palette might be a subset\n\n            // do not select the choice if the palette range restrictions do not allow it\n            if ((index < option.range.min) || (index > option.range.max))\n                return false;\n\n            switch (option.id) {\n                case 0: this.backgroundColor = index; break;\n                case 1: this.auxColor = index; break;\n                case 2: this.borderColor = index; break;\n            }\n            return true;\n        };\n\n        let findBestChoice = (searchList: ColorChoice[], altList: ColorChoice[], option: { id: number, selectable: boolean, range: PaletteRange }) => {\n            // based on the priority of the ranges, pick/assign a choice color to each\n            // option in the range, starting with the most important first (as\n            // defined by the sort order)\n            for (let c = 0; c < searchList.length; ++c) {\n                let choice = searchList[c];\n\n                // attempt to assign the choice to the color option\n                if (!assignId(choice, option))\n                    continue;   // if didn't get used, try next color\n\n                // find this color choice in the alternative array (so it can be removed)\n                let found = altList.findIndex((x) => x.ind == choice.ind);\n\n                // remove the entry from the alternatively ranked list\n                runtime_assert(found >= 0);\n                altList.splice(found, 1);\n\n                // prevent this choice from being used again\n                searchList.splice(c, 1);\n                break;\n            }\n        };\n\n        let firstNonSelectableColorFound = false;\n\n        // try to match a color choice with the options available\n        for (let i = 0; i < ranges.length; ++i) {\n            let option = ranges[i];\n\n            if ((!option.selectable) && (!firstNonSelectableColorFound)) {\n                // found all the required colors that can be chosen by a\n                // pixel so now re-rank the remaining color choices, putting\n                // the top N \"compatible\" based on picture histo usage at the\n                // top of the array, but sorted by intensity\n                // (where N is the number of remaining \"other\" colors to choose);\n                let topNChoices : { priority: number, choice: ColorChoice }[] = []\n                for (let c = 0; c < ranges.length - i; ++c) {\n                    if (c >= histoRankedChoices.length)\n                        continue; // make sure the colors are not exhausted\n\n                    // this color is high priority to pick\n                    let topChoice = histoRankedChoices[c];\n                    let priority = choices.findIndex((x) => x.ind == topChoice.ind);\n                    runtime_assert(priority >= 0);\n                    topNChoices.push({priority, choice: topChoice});\n                    // removing the choice from the list is okay because it's going to be\n                    // re-inserted at the top of the new choices list\n                    choices.splice(priority, 1);\n                }\n\n                // sort the top choices by intensity\n                topNChoices.sort((a,b) => a.priority - b.priority);\n\n                // put the top N at the front of the choices list\n                choices = (topNChoices.map((x) => x.choice)).concat(choices);\n                firstNonSelectableColorFound = true;\n            }\n\n            findBestChoice((option.selectable ? histoRankedChoices : choices), (option.selectable ? choices : histoRankedChoices), option);\n            // console.log(\"findBestChoice\", i, option, histoRankedChoices, choices);\n        }\n\n        if (this.paletteChoices.background)\n            this.globalValid.push(this.backgroundColor);\n        if (this.paletteChoices.aux)\n            this.globalValid.push(this.auxColor);\n        if (this.paletteChoices.border)\n            this.globalValid.push(this.borderColor);\n\n        if (this.paletteChoices.background)\n            this.pixelPaletteChoices = this.spliceColor(this.backgroundColor, this.pixelPaletteChoices);\n        if (this.paletteChoices.aux)\n            this.pixelPaletteChoices = this.spliceColor(this.auxColor, this.pixelPaletteChoices);\n        if (this.paletteChoices.border)\n            this.pixelPaletteChoices = this.spliceColor(this.borderColor, this.pixelPaletteChoices);\n    }\n    override allocateParams(): void {\n        this.blockParams = new Uint32Array(this.paramInfo.block ? this.block.size : 0);\n        this.cbParams = new Uint32Array(this.paramInfo.cb ? this.cb.size : 0);\n        this.cellParams = new Uint32Array(this.paramInfo.cell ? this.cell.size : 0);\n        this.extraParams = new  Uint32Array(this.paramInfo.extra);\n\n        // make the default params refer to the block params\n        this.params = this.blockParams;\n    }\n\n    imageIndexToInfo(index: number, info: BlockInfo): { column: number, row: number } {\n        let column = Math.floor(index / info.w) % info.columns;\n        let row = Math.floor(index / (this.width * info.h));\n        return { column, row };\n    }\n    imageIndexToBlockInfo(index: number): { column: number, row: number } {\n        return this.imageIndexToInfo(index, this.block);\n    }\n    imageIndexToCbInfo(index: number): { column: number, row: number } {\n        return this.imageIndexToInfo(index, this.cb);\n    }\n    imageIndexToCellInfo(index: number): { column: number, row: number } {\n        return this.imageIndexToInfo(index, this.cell);\n    }\n    imageIndexToOffset(index: number, info: BlockInfo): number {\n        let { column, row } = this.imageIndexToInfo(index, info);\n        let offset = row * info.columns + column;\n        return offset;\n    }\n\n    imageIndexToBlockOffset(index: number): number {\n        return this.imageIndexToOffset(index, this.block);\n    }\n    imageIndexToCbOffset(index: number): number {\n        return this.imageIndexToOffset(index, this.cb);\n    }\n    imageIndexToCellOffset(index: number): number {\n        return this.imageIndexToOffset(index, this.cell);\n    }\n\n    imageIndexToXY(index: number): { x: number, y: number} {\n        return { x: index % this.width, y: Math.floor(index / this.width) };\n    }\n    xyToImageIndex(x: number, y: number): number | undefined {\n        if ((x < 0) || (y < 0))\n            return undefined;\n        if ((x >= this.width) || (y >= this.height))\n            return undefined;\n        return y * this.width + x;\n    }\n\n    offsetToInfo(offset: number, info: BlockInfo): { column: number, row: number } {\n        let column = offset % info.columns;\n        let row = Math.floor(offset / info.columns);\n        return { column, row };\n    }\n    offsetToBlockInfo(offset: number): { column: number, row: number } {\n        return this.offsetToInfo(offset, this.block);\n    }\n    offsetToCbInfo(offset: number): { column: number, row: number } {\n        return this.offsetToInfo(offset, this.cb);\n    }\n    offsetToCellInfo(offset: number): { column: number, row: number } {\n        return this.offsetToInfo(offset, this.cell);\n    }\n\n    offsetToImageIndex(offset: number, info: BlockInfo): number {\n        let { column, row } = this.offsetToInfo(offset, info);\n        let index = (row * this.width * info.h) + (column * info.w);\n        return index;\n    }\n    blockOffsetToImageIndex(offset: number): number {\n        return this.offsetToImageIndex(offset, this.block);\n    }\n    cbOffsetToImageIndex(offset: number): number {\n        return this.offsetToImageIndex(offset, this.cb);\n    }\n    cellOffsetToImageIndex(offset: number): number {\n        return this.offsetToImageIndex(offset, this.cell);\n    }\n\n    override currentColorAtXY(x: number, y: number, orColor?: number): number | undefined {\n        let imageIndex = this.xyToImageIndex(x, y);\n        return (imageIndex === undefined ? orColor : this.indexed[imageIndex]);\n    }\n\n    addToHistogramFromCurrentColor(color: number, histogram: Uint32Array) : void {\n        runtime_assert(color < histogram.length);\n        histogram[color] += this.histogramScoreCurrent;\n    }\n\n    override addToHistogramAtXYFromCurrentColor(x: number, y: number, color: number | undefined, histogram: Uint32Array): void {\n        if (color === undefined)\n            return;\n        this.addToHistogramFromCurrentColor(color, histogram);\n    }\n\n    addToHistogramAtOffsetFromCurrentColor(offset: number, info: ExtendedBlockInfo, histogram: Uint32Array, colors?: number[], orColor?: number, fnAddToHistogram?: AddToHistogramFromCurrentColorAtHandler): void {\n        let imageIndex = this.offsetToImageIndex(offset, info);\n        let start = this.imageIndexToXY(imageIndex);\n\n        for (let y = start.y - info.yb; y < start.y + info.h + info.yb; ++y) {\n            for (let x = start.x - info.xb; x < start.x + info.w + info.xb; ++x) {\n                let color = this.currentColorAtXY(x, y, orColor);\n                if (colors !== undefined) {\n                    if (colors.find((x) => x == color) === undefined)\n                        continue;\n                }\n\n                if (fnAddToHistogram === undefined)\n                    this.addToHistogramAtXYFromCurrentColor(x, y, color, histogram);\n                else\n                    fnAddToHistogram(x, y, color, histogram);\n            }\n        }\n    }\n    addToBlockHistogramFromCurrentColor(offset: number, histogram: Uint32Array, colors?: number[], orColor?: number, fnAddToHistogram?: AddToHistogramFromCurrentColorAtHandler): void {\n        return this.addToHistogramAtOffsetFromCurrentColor(offset, this.block, histogram, colors, orColor, fnAddToHistogram);\n    }\n    addToCbHistogramFromCurrentColor(offset: number, histogram: Uint32Array, colors?: number[], orColor?: number, fnAddToHistogram?: AddToHistogramFromCurrentColorAtHandler): void {\n        return this.addToHistogramAtOffsetFromCurrentColor(offset, this.cb, histogram, colors, orColor, fnAddToHistogram);\n    }\n    addToCellHistogramFromCurrentColor(offset: number, histogram: Uint32Array, colors?: number[], orColor?: number, fnAddToHistogram?: AddToHistogramFromCurrentColorAtHandler): void {\n        return this.addToHistogramAtOffsetFromCurrentColor(offset, this.cell, histogram, colors, orColor, fnAddToHistogram);\n    }\n\n    scoreColorAtXYFrom(x: number, y: number, scores: Uint32Array, colors: number[] | undefined, from: Uint32Array): ClosestScore | undefined {\n        let imageIndex = this.xyToImageIndex(x, y);\n\n        if (imageIndex === undefined)\n            return undefined;\n\n        let rgb = from[imageIndex];\n\n        let colorToPalIndex = (i: number) => {\n            return colors === undefined ? i : colors[i];\n        };\n\n        let closestColor = NaN;\n        let closestScore = NaN;\n        for (let i = 0; i < (colors === undefined ? scores.length : colors.length); ++i) {\n            let rgbPalette = this.pal[colorToPalIndex(i)];\n            let score = this.errfn(rgb, rgbPalette);\n            runtime_assert(colorToPalIndex(i) < scores.length);\n            scores[colorToPalIndex(i)] += score;\n            if ((score < closestScore) || (Number.isNaN(closestScore))) {\n                closestScore = score;\n                closestColor = colorToPalIndex(i);\n            }\n        }\n\n        return (Number.isNaN(closestColor) ? undefined : { closestColor: closestColor, closestScore: closestScore });\n    }\n    scoreColorAtXYFromAlt(x: number, y: number, scores: Uint32Array, colors?: number[]): ClosestScore | undefined {\n        return this.scoreColorAtXYFrom(x, y, scores, colors, this.alt);\n    }\n    scoreColorAtXYFromRef(x: number, y: number, scores: Uint32Array, colors?: number[]): ClosestScore | undefined {\n        return this.scoreColorAtXYFrom(x, y, scores, colors, this.ref);\n    }\n\n    mergeHistogram(dest: Uint32Array, source1: Uint32Array, source2: Uint32Array, colors?: number[]): void {\n        runtime_assert(source1.length == source2.length);\n        runtime_assert(dest.length == source1.length);\n\n        if (colors === undefined) {\n            for (let i = 0; i < dest.length; ++i) {\n                dest[i] = source1[i] + source2[i];\n            }\n            return;\n        }\n\n        for (let i = 0; i < colors.length; ++i) {\n            dest[colors[i]] = source1[colors[i]] + source2[colors[i]];\n        }\n    }\n\n    addToHistogramFromClosest(closest: ClosestScore, histogram: Uint32Array): void {\n        histogram[closest.closestColor] += 1 + this.noise;\n    }\n\n    override addToHistogramFromClosestAtXY(x: number, y: number, closest: ClosestScore | undefined, histogram: Uint32Array): void {\n        if (closest === undefined)\n            return;\n        return this.addToHistogramFromClosest(closest, histogram);\n    }\n\n    addToHistogramAtOffsetFrom(\n        offset: number,\n        info: ExtendedBlockInfo,\n        histogram: Uint32Array,\n        scores: Uint32Array,\n        colors: number[] | undefined,\n        from: Uint32Array,\n        fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n\n        let total = 0;\n\n        let imageIndex = this.offsetToImageIndex(offset, info);\n        let start = this.imageIndexToXY(imageIndex);\n\n        for (let y = start.y - info.yb; y < start.y + info.h + info.yb; ++y) {\n            for (let x = start.x - info.xb; x < start.x + info.w + info.xb; ++x) {\n                let closest = this.scoreColorAtXYFrom(x, y, scores, colors, from);\n                if (fnAddToHistogram === undefined)\n                    this.addToHistogramFromClosestAtXY(x, y, closest, histogram);\n                else\n                    fnAddToHistogram(x, y, closest, histogram);\n            }\n        }\n\n        let scored = (colors === undefined ? (range(0, scores.length).map((x) => { return { ind: x, score: scores[x], count: histogram[x] }; })) : (colors.map((x) => { return { ind: x, score: scores[x], count: histogram[x] }; })));\n        return scored;\n    }\n\n    addToBlockHistogramFrom(offset: number, histogram: Uint32Array, scores: Uint32Array, colors: number[] | undefined, from: Uint32Array, fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.block, histogram, scores, colors, from, fnAddToHistogram);\n    }\n    addToCbHistogramFrom(offset: number, histogram: Uint32Array, scores: Uint32Array, colors: number[] | undefined, from: Uint32Array, fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.cb, histogram, scores, colors, from, fnAddToHistogram);\n    }\n    addToCellHistogramFrom(offset: number, histogram: Uint32Array, scores: Uint32Array, colors: number[] | undefined, from: Uint32Array, fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.cell, histogram, scores, colors, from, fnAddToHistogram);\n    }\n\n    addToBlockHistogramFromAlt(offset: number, histogram: Uint32Array, scores: Uint32Array, colors?: number[], fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.block, histogram, scores, colors, this.alt, fnAddToHistogram);\n    }\n    addToCbHistogramFromAlt(offset: number, histogram: Uint32Array, scores: Uint32Array, colors?: number[], fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.cb, histogram, scores, colors, this.alt, fnAddToHistogram);\n    }\n    addToCellHistogramFromAlt(offset: number, histogram: Uint32Array, scores: Uint32Array, colors?: number[], fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.cell, histogram, scores, colors, this.alt, fnAddToHistogram);\n    }\n\n    addToBlockHistogramFromRef(offset: number, histogram: Uint32Array, scores: Uint32Array, colors?: number[], fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset,  this.block, histogram, scores, colors,this.ref, fnAddToHistogram);\n    }\n    addToCbHistogramFromRef(offset: number, histogram: Uint32Array, scores: Uint32Array, colors?: number[], fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.cb, histogram, scores, colors, this.ref, fnAddToHistogram);\n    }\n    addToCellHistogramFromRef(offset: number, histogram: Uint32Array, scores: Uint32Array, colors?: number[], fnAddToHistogram?: AddToHistogramFromClosestAtHandler) : ScoredColorChoice[] {\n        return this.addToHistogramAtOffsetFrom(offset, this.cell, histogram, scores, colors, this.ref, fnAddToHistogram);\n    }\n\n    getScoredChoicesByCount(scored: ScoredColorChoice[]): ScoredColorChoice[] {\n        let result = scored.filter((x) => x.count > 0);\n        result.sort((a, b) => b.count - a.count);\n        return result;\n    }\n    getScoredChoicesByScore(scored: ScoredColorChoice[]): ScoredColorChoice[] {\n        let result = scored.filter((x) => x.count > 0);\n        result.sort((a, b) => a.score - b.score);\n        return result;\n    }\n\n    updateColorParam(offset: number, params: Uint32Array, colorChoices: number[], overrideFilter?: number, overrideBits?: number): void {\n        runtime_assert(offset < params.length);\n\n        if (colorChoices.length < 1) {\n            params[offset] = 0;\n            return;\n        }\n\n        let value = 0;\n        for (let i = colorChoices.length - 1; i >= 0; --i) {\n            value <<= (overrideBits === undefined ? this.paletteBits : overrideBits);\n            value |= colorChoices[i] & (overrideFilter === undefined ? this.paletteBitFilter : overrideFilter);\n        }\n        params[offset] = value;\n    }\n    updateBlockColorParam(offset: number, colorChoices: number[], overrideFilter?: number, overrideBits?: number): void {\n        this.updateColorParam(offset, this.blockParams, colorChoices, overrideFilter, overrideBits);\n    }\n    updateCbColorParam(offset: number, colorChoices: number[], overrideFilter?: number, overrideBits?: number): void {\n        this.updateColorParam(offset, this.cbParams, colorChoices, overrideFilter, overrideBits);\n    }\n    updateCellColorParam(offset: number, colorChoices: number[], overrideFilter?: number, overrideBits?: number): void {\n        this.updateColorParam(offset, this.cellParams, colorChoices, overrideFilter, overrideBits);\n    }\n\n    extractColorsFromParams(offset: number, params: Uint32Array, totalToExtract: number, overrideFilter?: number, overrideBits?: number): number[] {\n        return extractColorsFromParams(offset, params, totalToExtract, overrideFilter === undefined ? this.paletteBitFilter : overrideFilter, overrideBits === undefined ? this.paletteBits : overrideBits);\n    }\n    extractColorsFromBlockParams(offset: number, totalToExtract: number, overrideFilter?: number, overrideBits?: number): number[] {\n        return extractColorsFromParams(offset, this.blockParams, totalToExtract, overrideFilter === undefined ? this.paletteBitFilter : overrideFilter, overrideBits === undefined ? this.paletteBits : overrideBits);\n    }\n    extractColorsFromCbParams(offset: number, totalToExtract: number, overrideFilter?: number, overrideBits?: number): number[] {\n        return extractColorsFromParams(offset, this.cbParams, totalToExtract, overrideFilter === undefined ? this.paletteBitFilter : overrideFilter, overrideBits === undefined ? this.paletteBits : overrideBits);\n    }\n    extractColorsFromCellParams(offset: number, totalToExtract: number, overrideFilter?: number, overrideBits?: number): number[] {\n        return extractColorsFromParams(offset, this.cellParams, totalToExtract, overrideFilter === undefined ? this.paletteBitFilter : overrideFilter, overrideBits === undefined ? this.paletteBits : overrideBits);\n    }\n\n    override commit(): void {\n        // default is to reverse order of the guessing as some grander choices\n        // may affect subsequent fine-grain choices\n        this.guessExtraParams();\n        this.guessCellParams();\n        this.guessCbParams();\n        this.guessBlockParams();\n        this.firstCommit = false;\n    }\n\n    override getValidColors(imageIndex: number): number[] {\n        let offset = this.imageIndexToBlockOffset(imageIndex);\n\n        if (this.fullPaletteMode)\n            return this.pixelPaletteChoices;\n\n        let extracted = this.extractColorsFromBlockParams(offset, this.paletteChoices.colors);\n        if ((this.globalValid.length == 0) && (extracted.length <= this.paletteChoices.colors))\n            return extracted;\n\n        let valid: number[] = this.globalValid.slice(0, this.globalValid.length);\n        valid.push(...extracted);\n        valid = valid.slice(0, this.globalValid.length + this.paletteChoices.colors);\n        return valid;\n    }\n\n    override guessBlockParams(): void {\n        for (let i = 0; i < this.blockParams.length; ++i) {\n            this.guessBlockParam(i);\n        }\n    }\n    override guessCbParams(): void {\n        for (let i = 0; i < this.cbParams.length; ++i) {\n            this.guessCbParam(i);\n        }\n    }\n    override guessCellParams(): void {\n        for (let i = 0; i < this.cellParams.length; ++i) {\n            this.guessCellParam(i);\n        }\n    }\n    override guessExtraParams(): void {\n        for (let i = 0; i < this.extraParams.length; ++i) {\n            this.guessExtraParam(i);\n        }\n    }\n\n    override guessBlockParam(offset: number): void {\n\n        // nothing to store if the pixel can store the direct palette value\n        if (this.fullPaletteMode)\n            return;\n\n        // reset histogram values\n        this.histogram.fill(0);\n        this.scores.fill(0);\n\n        // rank all colors within the size of the block (and bordering values)\n        if (!this.firstCommit)\n            this.addToBlockHistogramFromCurrentColor(offset, this.histogram, this.pixelPaletteChoices);\n        let scored = this.addToBlockHistogramFrom(offset, this.histogram, this.scores, this.pixelPaletteChoices, this.firstCommit ? this.ref : this.alt);\n\n        // never choose the colors that are always valid and available\n        // for every pixel (i.e. why waste the screen ram or color block\n        // ram on a color that is always available everywhere)\n\n        // get best choices for sub-block\n        let choices = this.getScoredChoicesByCount(scored);\n\n        let colors = (choices.map((x) => { return x.ind; } )).slice(0, (this.block.colors - this.globalValid.length));\n\n        while (colors.length < (this.block.colors - this.globalValid.length)) {\n            colors.push( this.pixelPaletteChoices[0] || this.backgroundColor );\n        }\n\n        colors = colors.sort((a, b) => a - b);\n        this.updateBlockColorParam(offset, colors);\n    }\n    override guessCbParam(offset: number): void {\n    }\n    override guessCellParam(offset: number): void {\n    }\n    override guessExtraParam(offset: number): void {\n    }\n}\n", "\n// file imports for esbuild\n\n// @ts-ignore\nimport asm_c64_multi from \"./asm/c64_multi.asm\";\n// @ts-ignore\nimport asm_apple2_hires from \"./asm/apple2_hires.asm\";\n// @ts-ignore\nimport asm_nes from \"./asm/nes.asm\";\n// @ts-ignore\nimport asm_msx from \"./asm/msx.asm\";\n// @ts-ignore\nimport asm_vcs from \"./asm/vcs.asm\";\n// @ts-ignore\nimport asm_astrocade from \"./asm/astrocade.asm\";\n// @ts-ignore\nimport asm_atari8_d from \"./asm/atari8_d.asm\";\n// @ts-ignore\nimport asm_zx from \"./asm/zx.asm\";\n// @ts-ignore\nimport asm_cpc from \"./asm/cpc.asm\";\n// @ts-ignore\nimport asm_c64_fli from \"./asm/c64_fli.asm\";\n\nimport { dithertron } from \"../ui/ui\";\nimport { hex } from \"../common/util\";\nimport { convertToSystemPalette } from \"../common/color\";\n\n///\n\nexport function getFileViewerCode_c64_multi(): string {\n    var code = asm_c64_multi;\n    code = code.replace('$USE_MULTI_MODE', '1');\n    return code;\n}\n\nexport function getFileViewerCode_c64_hires(): string {\n    var code = asm_c64_multi;\n    code = code.replace('$USE_MULTI_MODE', '0');\n    return code;\n}\n\nexport function getFileViewerCode_apple2_hires(): string {\n    return asm_apple2_hires;\n}\n\nexport function getFileViewerCode_nes(): string {\n    var code = asm_nes;\n    var palinds = convertToSystemPalette(dithertron.lastPixels.pal, dithertron.settings.pal);\n    code = code.replace('hex 1f;screen color', 'hex ' + hex(palinds[0]));\n    code = code.replace('hex 01112100;background 0', 'hex ' + hex(palinds[1]) + hex(palinds[2]) + hex(palinds[3]) + hex(0));\n    return code;\n}\n\nexport function getFileViewerCode_msx(): string {\n    return asm_msx;\n}\n\nexport function getFileViewerCode_vcs(): string {\n    var code = asm_vcs;\n    var palinds = convertToSystemPalette(dithertron.lastPixels.pal, dithertron.settings.pal);\n    code = code.replace('#$F6', '#$' + hex(palinds[0]));\n    code = code.replace('#$F7', '#$' + hex(palinds[1]));\n    return code;\n}\n\nexport function getFileViewerCode_astrocade(): string {\n    var code = asm_astrocade;\n    var palinds = convertToSystemPalette(dithertron.lastPixels.pal, dithertron.settings.pal);\n    code = code.replace('$b0', '$' + hex(palinds[0]));\n    code = code.replace('$b1', '$' + hex(palinds[1]));\n    code = code.replace('$b2', '$' + hex(palinds[2]));\n    code = code.replace('$b3', '$' + hex(palinds[3]));\n    return code;\n}\n\nexport function getFileViewerCode_atari8_d() {\n    var code = asm_atari8_d;\n    var palinds = convertToSystemPalette(dithertron.lastPixels.pal, dithertron.settings.pal);\n    for (var i = 0; i < palinds.length; i++)\n        code = code.replace('$00;PF' + i, '$' + hex(palinds[i]));\n    return code;\n}\n\nexport function getFileViewerCode_atari8_f_10() {\n    let code = getFileViewerCode_atari8_d();\n    code = code.replace('.byte $4d', '.byte $4f');\n    code = code.replace('.byte $0d', '.byte $0f');\n    code = code.replace('#$00;PRIOR', '#$80');\n    code = code.replace('COLOR0+4', 'PCOLR0+0');\n    code = code.replace('COLOR0+0', 'PCOLR0+1');\n    code = code.replace('COLOR0+1', 'PCOLR0+2');\n    code = code.replace('COLOR0+2', 'PCOLR0+3');\n    code = code.replace(';GPIOMODE equ 1', 'GPIOMODE equ 1');\n    return code;\n}\n\nexport function getFileViewerCode_zx() {\n    var code = asm_zx;\n    return code;\n}\n\nexport function getFileViewerCode_zx_dark() {\n    return getFileViewerCode_zx(); \n}\n\nexport function getFileViewerCode_zx_bright() {\n    return getFileViewerCode_zx(); \n}\n\nexport function getFileViewerCode_zx_dark_bright() {\n    return getFileViewerCode_zx(); \n}\n\nexport function getFileViewerCode_zx_bright_dark() {\n    return getFileViewerCode_zx(); \n}\n\n\n\n// https://www.cpcwiki.eu/index.php/BIOS_Screen_Functions\n// http://www.cpcmania.com/Docs/Programming/Painting_pixels_introduction_to_video_memory.htm\n// https://www.cpcwiki.eu/index.php/CPC_Palette\nexport function getFileViewerCode_cpc(mode: number) {\n    var code = asm_cpc;\n    var palinds = convertToSystemPalette(dithertron.lastPixels.pal, dithertron.settings.pal);\n    code = code.replace('$MODE', mode + \"\");\n    for (var i = 0; i < 16; i++)\n        code = code.replace('$c' + i, '$' + hex(palinds[i] || 0));\n    return code;\n}\n\nexport function getFileViewerCode_cpc_mode0(mode: number) {\n    return getFileViewerCode_cpc(0);\n}\n\nexport function getFileViewerCode_cpc_mode1(mode: number) {\n    return getFileViewerCode_cpc(1);\n}\n\nexport function getFileViewerCode_c64_fli(): string {\n    var code = asm_c64_fli;\n    return code;\n}\n\n\nexport function getFileViewerCode_c64_hires_fli(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"0\");\n    return code;\n}\n\nexport function getFileViewerCode_c64_hires_fli_bug(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"0\");\n    return code;\n}\n\nexport function getFileViewerCode_c64_hires_fli_blank(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"0\");\n    return code;\n}\n\nexport function getFileViewerCode_c64_multi_fli(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"1\");\n    return code;\n}\n\nexport function getFileViewerCode_c64_multi_fli_bug(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"1\");\n    return code;\n}\n\nexport function getFileViewerCode_c64_multi_fli_blank(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"1\");\n    return code;\n}\n\nexport function getFileViewerCode_c64_multi_fli_blank_left(): string {\n    let code = getFileViewerCode_c64_fli();\n    code = code.replace(\"$USE_MULTI_MODE\", \"1\");\n    return code;\n}\n", "\n    processor 6502\n    include \"basicheader.dasm\"\n\nSrc equ $02\nDest equ $04\n\n; This code is extremely similar between multi-color\n; graphics mode and hires graphics mode. Setting\n; to 1 enables the multi-color graphics code, otherwise\n; set to 0 for hires graphics mode.\nUseMultiColorGraphics equ $USE_MULTI_MODE\n\nStart:\n    lda #$3B   ; 25 rows, on, bitmap\n    sta $d011  ; VIC control #1\n#if UseMultiColorGraphics\n    lda #$18   ; 40 column, multicolor\n#else\n    lda #$08   ; 40 column, two-color hires\n#endif\n    sta $d016  ; VIC control #2\n    lda #$02\n    sta $dd00  ; set VIC bank ($4000-$7FFF)\n    lda #$80\n    sta $d018  ; set VIC screen to $6000\n    lda XtraData+1\n    sta $d020  ; border\n    lda XtraData+0\n    sta $d021  ; background\n    lda #0\n    sta Dest\n; copy char memory\n    lda #<CharData\n    sta Src\n    lda #>CharData\n    sta Src+1\n    lda #$40\n    sta Dest+1\n    ldx #$20\n    jsr CopyMem\n; copy screen memory\n    lda #<ScreenData\n    sta Src\n    lda #>ScreenData\n    sta Src+1\n    lda #$60\n    sta Dest+1\n    ldx #$04\n    jsr CopyMem\n\n#if UseMultiColorGraphics\n; copy color RAM\n    lda #<ColorData\n    sta Src\n    lda #>ColorData\n    sta Src+1\n    lda #$d8\n    sta Dest+1\n    ldx #4\n    jsr CopyMem\n#endif\n\n; infinite loop\n    jmp .\n\n; copy data from Src to Dest\n; X = number of bytes * 256\nCopyMem\n    ldy #0\n.Loop\n    lda (Src),y\n    sta (Dest),y\n    iny\n    bne .Loop\n    inc Src+1\n    inc Dest+1\n    dex\n    bne .Loop\n    rts\n\n; bitmap data\nCharData equ .\nScreenData equ CharData+8000\n#if UseMultiColorGraphics\nColorData equ ScreenData+1000\nXtraData equ ColorData+1000\n#else\nXtraData equ ScreenData+1000\n#endif\n\n    incbin \"$DATAFILE\"\n", "\n    processor 6502\n    seg Code\n    org $803\t; start of program\nStart:\n    sta $c050\t; set graphics\n    sta $c052\t; no mixed mode\n    sta $c057\t; set hires\n    jmp Start\t; infinite loop\n\n    org $2000\t; start of hires page 1\n    incbin \"$DATAFILE\"\n", "\n    include \"nesdefs.dasm\"\n\n;;;;; VARIABLES\n\n    seg.u ZEROPAGE\n    org $0\n\n;;;;; NES CARTRIDGE HEADER\n\n    NES_HEADER 0,2,1,0 ; mapper 0, 2 PRGs, 1 CHR, horiz. mirror\n\n;;;;; START OF CODE\nStart:\n; wait for PPU warmup; clear CPU RAM\n; byte $02\n    NES_INIT\t; set up stack pointer, turn off PPU\n    jsr WaitSync\t; wait for VSYNC\n    jsr ClearRAM\t; clear RAM\n    jsr WaitSync\t; wait for VSYNC (and PPU warmup)\n; set palette and nametable VRAM\n    jsr SetPalette\t; set palette colors\n    jsr FillVRAM\t; print message in name table\n; reset PPU address and scroll registers\n    lda #0\n    sta PPU_ADDR\n    sta PPU_ADDR\t; PPU addr = $0000\n    sta PPU_SCROLL\n    sta PPU_SCROLL  ; PPU scroll = $0000\n; activate PPU graphics\n    lda #MASK_BG\n    sta PPU_MASK \t; enable rendering\n    lda #CTRL_NMI\n    sta PPU_CTRL\t; enable NMI\n.endless\n    jmp .endless\t; endless loop\n\n; set palette colors\nSetPalette: subroutine\n; set PPU address to palette start\n    PPU_SETADDR $3f00\n    ldy #0\n.loop:\n    lda Palette,y\t; lookup byte in ROM\n    sta PPU_DATA\t; store byte to PPU data\n    iny\t\t; Y = Y + 1\n    cpy #4\t\t; is Y equal to max colors?\n    bne .loop\t; not yet, loop\n    rts\t\t; return to caller\n\n; fill video RAM with \"Hello World\" msg\nFillVRAM: subroutine\n; set PPU address to name table A\n    PPU_SETADDR $2106  ; row 8, col 6\n    ldy #12\t\t; # of rows\n    lda #1\t\t; first tile index\n.nextrow\n    ldx #20\t\t; # of columns\n.loop:\n    sta PPU_DATA\t; store+advance PPU\n    clc\n    adc #1\n    dex\n    bne .loop\n    pha\n    lda #$00\t; blank\n    REPEAT 12\t; 32 - 20 = 12 cols/row\n    sta PPU_DATA\t; store+advance PPU\n    REPEND\n    pla\n    dey\n    bne .nextrow\n.end\n    rts\t\t; return to caller\n\n;;;;; COMMON SUBROUTINES\n\n    include \"nesppu.dasm\"\n\n;;;;; INTERRUPT HANDLERS\n\nNMIHandler:\n    rti\t\t; return from interrupt\n\n;;;;; CONSTANT DATA\n\nPalette:\n    hex 1f;screen color\n    hex 01112100;background 0\n\n;;;;; CPU VECTORS\n\n    NES_VECTORS\n\n;;;;; TILE SETS\n\n    org $10000\n    ds 16\t; blanks\n    incbin \"$DATAFILE\"\n", "\n    ORG     04000H\n\n; MSX cartridge header @ 0x4000 - 0x400f\n    dw 0x4241\n    dw Start\n    dw Start\n    dw 0,0,0,0,0\n\nCHMOD   EQU   05fh\nWRTVRM  EQU   04dh\nLDIRVM  EQU   05ch\n\nPATTERN equ 0h\nNAME    equ 1800h\nCOLOR   equ 2000h\n\nStart:\nData:\n    ld a,2\n    call CHMOD  ; screen mode 2\n    ld bc,1800h\n    ld hl,ImageData\n    ld de,PATTERN\n    call LDIRVM ; copy pattern table\n    ld bc,1800h\n    ld hl,ImageData+1800h\n    ld de,COLOR\n    call LDIRVM ; copy color table\nInfinite:\n    jmp Infinite ; loop forever\n\nImageData:\n    incbin \"$DATAFILE\"\n", "\n    processor 6502\n    include \"vcs.h\"\n    include \"macro.h\"\n    include \"xmacro.h\"\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n    seg.u Variables\n    org $80\n\n    seg Code\n    org $f000\n\nStart\n    CLEAN_START\n\nNextFrame\n    VERTICAL_SYNC\n\n    TIMER_SETUP 37\n; Set playfield foreground and background\n    lda #$F6\n    sta COLUBK\n    lda #$F7\n    sta COLUPF\n    TIMER_WAIT\n\n    ldy #192\nScanLoop\n; WSYNC and store playfield registers\n    sta WSYNC\n    lda PFBitmap0,y\n    sta PF0\t\t; store first playfield byte\n    lda PFBitmap1,y\n    sta PF1\t\t; store 2nd byte\n    lda PFBitmap2,y\n    sta PF2\t\t; store 3rd byte\n; Here's the asymmetric part -- by this time the TIA clock\n; is far enough that we can rewrite the same PF registers\n; and display new data on the right side of the screen\n    nop\n    nop\n    nop\t\t; pause to let playfield finish drawing\n    lda PFBitmap3,y\n    sta PF0\t\t; store 4th byte\n    lda PFBitmap4,y\n    sta PF1\t\t; store 5th byte\n    lda PFBitmap5,y\n    sta PF2\t\t; store 6th byte\n    dey \n    bne ScanLoop\t; repeat until all scanlines drawn\n; Reset playfield\n    SLEEP 14\t; give time to finish drawing scanline\n    lda #0\n    sta PF0\n    sta PF1\n    sta PF2\t\t; clear playfield\n\n    TIMER_SETUP 28\n    TIMER_WAIT\n    jmp NextFrame\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n; BITMAP DATA\n\nPFBitmap0 equ .+192*0\nPFBitmap1 equ .+192*1\nPFBitmap2 equ .+192*2\nPFBitmap3 equ .+192*3\nPFBitmap4 equ .+192*4\nPFBitmap5 equ .+192*5\n    incbin \"$DATAFILE\"\n\n; Epilogue\n    org $fffc\n    .word Start\n    .word Start\n", "\n    INCLUDE \"hvglib.h\"      ; Include HVGLIB library\n    ORG     FIRSTC          ; Initialize at beginning of cartridge ROM area\n    DB      $55             ; ... with the code for a normal menued cartridge\n    DW      MENUST          ; Initialize menu\n    DW      PrgName         ; ... with string at PrgName\n    DW      PrgStart        ; ... such that selecting the program enters PrgStart\nPrgName:    DB      \"BITMAP VIEWER\" ; String\n    DB      0               ; ... which must be followed by 0\nPrgStart:   DI                      ; Disable interrupts\n    SYSTEM  INTPC           ; Begin interpreter mode\n    DO      SETOUT          ; Set output ports\n    DB      98*2            ; ... with VBLANK line set to line 98\n    DB      160/4           ; ... with color boundary\n    DB      00001000b       ; ... with screen interrupts reenabled \n    DO      COLSET          ; Set color palettes\n    DW      Palettes        ; ... with the values at Palettes\n    DO      MOVE            ; Move memory\n    DW      NORMEM          ; ... destination start of screen\n    DW      40*98           ; ... number of bytes\n    DW      BitmapData      ; ... source in ROM\n    EXIT                    ; Exit interpreter mode\nLoop:\n    JP      Loop            ; Play infinite loop\nPalettes:\n    DB      $b3,$b2,$b1,$b0 ; Left color palette (11b, 10b, 01b, 00b)\n    DB      $c3,$c2,$c1,$c0 ; Right color palette (11b, 10b, 01b, 00b)\nBitmapData:\n    incbin \"$DATAFILE\"\n", "\n    processor 6502    \n    include \"atari.inc\"\n\n;GPIOMODE equ 1\n    org     $a000           ;Start of left cartridge area\nStart:\n ifconst GPIOMODE\n    lda     #$80\n    sta     GPRIOR\n; set GTIA mode colors\n    lda     #$00;PF4\n    sta     COLOR0 + 0\n    lda     #$00;PF5\n    sta     COLOR0 + 1\n    lda     #$00;PF6\n    sta     COLOR0 + 2\n    lda     #$00;PF7\n    sta     COLOR0 + 3\n    lda     #$00;PF8\n    sta     COLOR0 + 4\n endif\n; set non-GTIA mode colors\n    lda     #$00;PF0\n    sta     COLOR0+4\n    lda     #$00;PF1\n    sta     COLOR0+0\n    lda     #$00;PF2\n    sta     COLOR0+1\n    lda     #$00;PF3\n    sta     COLOR0+2\n; set display list\n    lda     #<dlist            ;Set Display list pointer\n    sta     SDLSTL\n    lda     #>dlist\n    sta     SDLSTH\n; enable DMI\n    lda     #$22            ;Enable DMA\n    sta     SDMCTL\n; infinite loop\nwait\n    nop\n    jmp     wait\n\n;Graphics data\n    align $100   ; ANTIC can only count to $FFF\nImgData1:\nImgData2 equ ImgData1+40*96\n    incbin \"$DATAFILE\"\n\n;Display list data\ndlist\n    .byte $70,$70,$70\n    .byte $4d,#<ImgData1,#>ImgData1\n    REPEAT 95\n    .byte $0d\n    REPEND\n    ifconst GPIOMODE\n    .byte $4f,#<ImgData2,#>ImgData2\n    REPEAT 95\n    .byte $0f\n    REPEND\n    endif\n    .byte $41,$00,$10\ndlistend equ .\n\n;Cartridge footer\n    org     CARTCS\n    .word \tStart\t; cold start address\n    .byte\t$00\t; 0 == cart exists\n    .byte\t$04\t; boot cartridge\n    .word\tStart\t; start\n", "\n    org  0x5ccb     ; start of code\n\nStart\n    ld\tde,0x4000   ; DE = screen\n    ld\thl,ImgData  ; HL = image data\n    ld \tbc,0x1b00   ; 6144 bytes bitmap, 768 bytes attributes\n    ldir            ; copy\nLoop\n    jp\tloop        ; infinite loop\n\nImgData             ; data file\n    incbin \"$DATAFILE\"\n\n    org 0xff57\n    defb 00h        ; end of ROM\n", "\n    org  0x4000     ; start of code\nStart:\n    ld  a,$MODE\t\t; graphics mode\n    call 0xbc0e\t\t; SCR_SET_MODE\n; set border color\n    ld  hl,PalData\n    ld  b,(hl)\n    ld  c,b\n    call 0xbc38\t\t; SCR_SET_BORDER\n    ld  b,0x10\t\t; loop counter\n; read palette from memory\n    ld  hl,PalData+15\nLoop1:\n    push hl\n    push bc\n    ld  a,b\n    dec a\n    and a,0x0f\n    ld  b,(hl)\n    ld  c,b\n    call 0xbc32\t\t; SCR_SET_INK\n    pop bc\n    pop hl\n    dec hl\n    djnz Loop1\n; set image bytes\n    ld\tde,0xc000   ; DE = screen\n    ld\thl,ImgData  ; HL = image data\n    ld \tbc,0x4000   ; BC = # of bytes   \n    ldir            ; copy\nLoop:\n    jp\tloop        ; infinite loop\nPalData:\n    db $c0,$c1,$c2,$c3,$c4,$c5,$c6,$c7\n    db $c8,$c9,$c10,$c11,$c12,$c13,$c14,$c15\nImgData:            ; data file\n    incbin \"$DATAFILE\"\n", "\n    processor 6502\n    include \"basicheader.dasm\"\n    \n; credit to https://codebase64.org/doku.php?id=base:fli_displayer\n\n; The chips emulator has a VIC graphics timing bug which\n; differs from other emulators (such as VICE). Setting\n; this value to 1 allows the emulator bug to be worked\n; around while 0 allows other systems to work.\nUse8BitWorkshopEmulator equ 1\n\n; Use the repeat command to generate the lookup\n; tables instead of using a code generator by\n; specifying 0. Using 1 will include table generation\n; code.\nUseInitTables equ 0\n\n; This code is extremely similar between multi-color\n; graphics mode and hires graphics mode. Setting\n; to 1 enables the multi-color graphics code, otherwise\n; set to 0 for hires graphics mode.\nUseMultiColorGraphics equ $USE_MULTI_MODE\n\n#if Use8BitWorkshopEmulator\nTweakD018 equ -1\nTweakD011 equ 7\nLastRasterLine equ 201\nFinalRowPatch equ 0\n#else\nTweakD018 equ 1\nTweakD011 equ 1\nLastRasterLine equ 199\nFinalRowPatch equ 1\n#endif\n\nIrq0AtRaster equ $2d\n\n    ; temporary CopyMem storage variables in\n    ; zero page\n\nSrc equ $02\nDest equ $04\n\nSys2062:\n    jmp Start   ; entry point from basic\n\n    ;-------------------------------------------------\n    ; Start of code that must be within the\n    ; same page boundary $nn00 -> $nnFF\n    ; otherwise some instructions may become\n    ; cycle inaccurate.\n    \n    .align $100\n    \n    ;\n    ; Two IRQs are used to create a stable raster\n    ; line start point free from issues caused by\n    ; interrupts, inconsistent mid-instruction\n    ; triggers, or other concerns.\n    ;\n    ; The first IRQ's job is to setup the second IRQ.\n    ; While the first IRQ is triggers based on a\n    ; raster line it's timing is not said to be as\n    ; accurate because the CPU might be processing\n    ; any possible cycle timed 1-7 clock cycle\n    ; instructions, whereas the second IRQ is\n    ; triggered only during a 2 clock cycle \"nop\"\n    ; instruction ensuring the second IRQ is accurate\n    ; within 0 or 1 clock cycle count.\n    ; \n    ; The second IRQ further has logic to detect this\n    ; 0 or 1 clock cycle count offset and correct the\n    ; timing so the entry point into the raster\n    ; routine is 100% accurate creating an accurate\n    ; and stable raster-timed loop.\n    ;\n    \nIrq0:\n    pha\n    lda $d019\n    sta $d019\n    inc $d012\n    lda #<Irq1\n    sta $fffe   ; set up 2nd IRQ to get a stable IRQ\n    cli\n\n    ;\n    ; These \"nop\"s are not an accident, or in need\n    ; of optimization. They allow the 2nd IRQ\n    ; to be triggered with an off-by 0 or 1 clock\n    ; cycle delay resulting in an \"almost\" stable IRQ.\n    ;\n\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n    nop\n        \n    ; The \"rti\" of the first Irq0 is not needed as\n    ; these \"nop\" instructions never fall-through.\n    ; The stack is re-arranged so that the second Irq1\n    ; (which triggers while the first Irq0 is being\n    ; serviced) returns to the interrupt point where\n    ; the first trigger IRQ happened bypassing the\n    ; need for a \"rti\" from the first Irq0 entirely.\n\nIrq1:\nNtsc1:\n    ; PAL raster at 9 or 10/46\n    lda #$ea    ; modified to NOP NOP on NTSC\n    lda #$80\n    sta $d018   ; setup first color RAM address early\n    lda #$38\n    sta $d011   ; setup first DMA access early\n    pla\n    pla\n    pla\n    lda $d019\n    sta $d019\n    lda #Irq0AtRaster\n    sta $d012\n    lda #<Irq0\n    sta $fffe   ; switch IRQ back to first stabilizer IRQ\n    lda $d012   ; PAL raster at 55 or 56/46\n    cmp $d012   ; stabilize last jittering cycle\n    beq Delay   ; PAL raster at 0 or 1/47; if equal, 2 cycles delay. else 3 cycles delay\n\nDelay:\n    stx SaveX+1 ; PAL raster stable at 3/47 (no more fluctuations)\n    ldx #$0d\n\nWait:\n    dex\n    bne Wait\n\nNtsc2:\n    ; PAL raster at 10/48\n    lda #$ea    ; modified to NOP NOP on NTSC\nNtsc3:\n    lda #$ea    ; modified to NOP NOP on NTSC\n\n    ;\n    ; Following here is the main FLI loop which forces\n    ; the VIC-II to read new color data each\n    ; rasterline. The loop is exactly 23 clock cycles\n    ; long so together with 40 cycles of color DMA this\n    ; will result in the 63 clock cycles which is exactly\n    ; the length of a PAL C64 rasterline.\n    ;\n\n    nop\n    nop\nL0:\n    ; PAL raster at 61/48, 61/49, 61/50, ...\n    lda LookupD018+TweakD018,x\n    sta $d018   ; set new color RAM address\n    lda LookupD011+TweakD011,x\n    sta $d011   ; force new color DMA\n    inx         ; FLI bug $D800 color = 8 (orange)\n    cpx #LastRasterLine    ; last rasterline?\nNtsc4:\n    bne L0      ; branches to L0-1 on NTSC for 2 extra cycles per rasterline\n\n    ; lda $d016\n    ; eor #$01    ; IFLI: 1 hires pixel shift every 2nd frame\n    ; sta $d016\n    ; lda $dd00\n    ; eor #$02    ; IFLI: flip between banks $4000 and $C000 every frame\n    ; sta $dd00\n\nSaveX:\n    ldx #$00\n    pla\nNmi:\n    rti\n\n    ;\n    ; End of code that must be within the\n    ; same page boundary $nn00 -> $nnFF\n    ; otherwise some instructions may become\n    ; cycle inaccurate.\n    ;-------------------------------------------------\n\nStart:\n    sei\n\n    jsr CopyData\n    jsr InitGfx\n    jsr InitTables\n    jsr NtscFix\n    \n    ; Patch the table as the last line needs to\n    ; perform the \"open borders\" trick. This trick\n    ; involves an undocumented \"feature\" where multi\n    ; color mode graphics is enabled with extended\n    ; background mode. While documented as not a\n    ; legal combination, this combination causes the\n    ; borders to be open to writing during the\n    ; raster scroll process (otherwise some of the\n    ; rows would be shifted an \"off\"). This patching\n    ; needs to be done within the timing of the final\n    ; scan line otherwise the normal background is\n    ; disturbed and the drawing is not correct. The\n    ; screen needs to be turned off to ensure the\n    ; background is painted during the final scene.\n    ; Unfortunately the final row is cut-off\n    ; for a 319 instead of 320 pixel count height.\n    ; A fix is welcomed for this issue.\n\n#if FinalRowPatch\n    lda LookupD011+LastRasterLine\n    and #$07\n    ora #$70\n    sta LookupD011+LastRasterLine\n#endif\n\n    ; The VIC chip doesn't care if ram or rom is\n    ; selected (with an exception), but the IRQs\n    ; cannot be overridden later unless ram is loaded.\n    ; Thus the kernal routines are not available while\n    ; the picture is being displayed, and if the\n    ; kernal rom is to be used, the IRQs must first be\n    ; uninstalled prior to accessing the kernal\n    ; functions and rom restored.\n    \n    lda #$35    ; %x01: RAM visible at $A000-$BFFF and $E000-$FFFF.\n                ; %1xx: I/O area visible at $D000-$DFFF. (Except for the value %100, see above.)\n    sta $01     ; disable ROMs %xxxxx101 (rest are default values)\n    lda #$7f\n    sta $dc0d   ; no CIA #1 timer IRQs\n    lda $dc0d   ; clear CIA #1 timer IRQ flags\n\n    lda #$2b\n    sta $d011   ; %00101011 - neutral scroll, 25 rows, screen off, bitmap mode, raster IRQ high bit zero\n    lda #Irq0AtRaster\n    sta $d012   ; interrupt at raster line 45\n\n    ; Even though these IRQ values overwrite screen\n    ; color choice area of the picture data, this\n    ; does not affect the picture in any way\n    ; because the color choices end at 1000 bytes,\n    ; not 1024 bytes leaving the extra few bytes\n    ; unused by the VIC chip, which is fortunately\n    ; exactly where IRQ vectors need to be installed.\n    ;\n    ; However, care must be taken that if a new\n    ; picture is loaded into this memory area then the\n    ; IRQ table needs to be re-initialized to these\n    ; default values and interrupts (including NMIs)\n    ; must be disabled during the picture copying\n    ; process. NMIs cannot technically be disabled,\n    ; but a trick can be used where a NMI can be\n    ; intentionally triggered without acknowledgement\n    ; thus preventing a second NMI from happening.\n    \n    lda #<Nmi\n    sta $fffa\n    lda #>Nmi\n    sta $fffb   ; dummy NMI to avoid crashing due to RESTORE\n    lda #<Irq0\n    sta $fffe\n    lda #>Irq0\n    sta $ffff   ; Irq0 is the default interrupt handler\n    lda #$01\n    sta $d01a   ; enable raster IRQs (no other IRQs)\n\n                ; dec op reads the value, writes the value back\n                ; \"as is\" unmodified, then writes the value back\n                ; modified guaranteeing bit 0 is cleared\n    dec $d019   ; clear raster IRQ flag (so it can trigger)\n    cli\n    jmp *       ; that's it, no more action needed\n    \nCopyData:\n\n    ; The VIC always reads the bitmap and screen color\n    ; choices from RAM regardless if the ram or roms\n    ; are active (with the exception of %xxxxx0xx and\n    ; the exception to the exception being %xxxxx000).\n    ; The color block data always is read from\n    ; I/O $d800 area.\n    \n                ; %x00: RAM visible in all three areas.\n                ; %x00: RAM visible in all three areas.\n    lda #$30    ; %00110000\n    sta $01     ; enable HIMEM RAM\n    \n    ; copy char memory\n    lda #<CharData\n    sta Src\n    lda #>CharData\n    sta Src+1\n    lda #0\n    sta Dest\n    lda #$c0\n    sta Dest+1\n    ldx #$20\n    jsr CopyMem\n    \n    ; copy screen memory\n    lda #<ScreenData\n    sta Src\n    lda #>ScreenData\n    sta Src+1\n    lda #0\n    sta Dest\n    lda #$e0\n    sta Dest+1\n    ldx #$20\n    jsr CopyMem\n    \n    lda #$07   ; %x11: BASIC ROM visible at $A000-$BFFF; KERNAL ROM visible at $E000-$FFFF.\n               ; %1xx: I/O area visible at $D000-$DFFF.\n    sta $01    ; enable ROM and $D000 I/O\n    \n#if UseMultiColorGraphics\n    ; copy color block RAM to the VIC's color block area\n    lda #<ColorData\n    sta Src\n    lda #>ColorData\n    sta Src+1\n    lda #$d8\n    sta Dest+1\n    ldx #4\n    jsr CopyMem\n#endif\n    rts\n\nInitGfx:\n    lda #$00\n    sta $d015   ; disable sprites\n\n    lda XtraData+1\n    sta $d020   ; border\n    lda XtraData+0\n    sta $d021   ; background\n\n#if UseMultiColorGraphics\n    lda #$D8    ; multi-color mode on\n#else\n    lda #$C8    ; multi-color mode off\n#endif\n    sta $d016   ; %00011000 ; no horizontal scroll, 40 columns, multi-mode on or off, defaulted high bits\n    lda #$80\n    sta $d018   ; %10000000 ; bitmap data %0xx, 0: +$0000-$1FFF, 0-8191; screen color choices +$2000-$23FF, 8192-9215.\n    lda #$00\n    sta $dd00   ; %00, 0: Bank #3, $C000-$FFFF, 49152-65535.\n    rts\n\n    ; The InitTables routine can be removed if your\n    ; assembler supports a .repeat-style macro.\n    ; The code is only included as an example of how\n    ; to initialize the tables in the event your\n    ; assembler does not have a suitable substitute.\n\nInitTables:\n#if UseInitTables\n    ldx #$00\nL2:\n    txa\n    asl\n    asl\n    asl\n    asl\n    and #$70    ; color RAMs at $E000\n    ora #$80    ; bitmap data at $C000\n    sta LookupD018,x ; calculate $D018 table\n    txa\n    and #$07\n    ora #$38    ; bitmap\n    sta LookupD011,x ; calculate $D011 table\n    inx\n    bne L2\n#endif\n    rts\n        \nNtscFix:\n    bit $d011\n    bmi *-3\n    bit $d011   ; wait for rasterline 256\n    bpl *-3\n    lda #$00\nTest:\n    cmp $d012\n    bcs Nt\n    lda $d012   ; get rasterline low byte\nNt:\n    bit $d011\n    bmi Test\n    cmp #$20    ; PAL: $37, NTSC: $05 or $06\n    bcs Pal\n\n    ; \n    ; This code self-patches to support NTSC mode\n    ; which means this code must be copied to RAM\n    ; if the code is originally located in ROM.\n    ; If this code must run from ROM then the code\n    ; needs to be duplicated with a PAL and an\n    ; NTSC version where the test routine installs\n    ; one or the other versions for usage.\n    ;\n\n    ; \n    ; The value \"#$ea\" as a literal is the op\n    ; code for \"nop\", so when the instruction\n    ; \"lda #$ea\" is patched, it becomes the values\n    ; \"$ea $ea\" (i.e. \"nop\" and \"nop\").\n    ;\n    ; In such a patch, the clock cycle count\n    ; changes from a 2-clock cycle \"lda\" immediate\n    ; mode instruction into a 4-clock cycle timed\n    ; instructions\n    ;\n\n    lda #$ea\n    sta Ntsc1\n    sta Ntsc2\n    sta Ntsc3\n    dec Ntsc4+1\nPal:\n    rts\n\n; copy data from Src to Dest\n; X = number of bytes * 256 bytes at a time\nCopyMem:\n    ldy #0\n.Loop:\n    lda (Src),y\n    sta (Dest),y\n    iny\n    bne .Loop\n    inc Src+1\n    inc Dest+1\n    dex\n    bne .Loop\n    rts\n\n    .align $100\n\n; lookup table for $d011\nLookupD011:\n#if UseInitTables\n    .ds 256\n#else\n    .repeat 256/8\n    .byte $38,$39,$3a,$3b,$3c,$3d,$3e,$3f\n    .repend\n#endif\n    \n; lookup table for $d018\nLookupD018:\n#if UseInitTables\n    .ds 256\n#else\n    .repeat 256/8\n    .byte $80,$90,$a0,$b0,$c0,$d0,$e0,$f0\n    .repend\n#endif\n\n    .align $100\nCharData equ .\nScreenData equ CharData+8000\n#if UseMultiColorGraphics\nColorData equ ScreenData+$2000\nXtraData equ ColorData+1000\n#else\nXtraData equ ScreenData+$2000\n#endif\n\n    ; link a demo picture\n    incbin \"$DATAFILE\"\n", "\nexport const FLOYD = [[1, 0, 7 / 16], [-1, 1, 3 / 16], [0, 1, 5 / 16], [1, 1, 1 / 16]];\nexport const FALSEFLOYD = [[1, 0, 3 / 8], [0, 1, 3 / 8], [1, 1, 2 / 8]];\nexport const ATKINSON = [[1, 0, 1 / 6], [2, 0, 1 / 6], [-1, 1, 1 / 6], [0, 1, 1 / 6], [1, 1, 1 / 6], [0, 2, 1 / 6]];\nexport const SIERRA2 = [[1, 0, 4 / 16], [2, 0, 3 / 16], [-2, 1, 1 / 16], [-1, 1, 2 / 16], [0, 1, 3 / 16], [1, 1, 2 / 16], [2, 1, 1 / 16]];\nexport const SIERRALITE = [[1, 0, 2 / 4], [-1, 1, 1 / 4], [0, 1, 1 / 4]];\nexport const STUCKI = [[1, 0, 8 / 42], [2, 0, 4 / 42], [-2, 1, 2 / 42], [1, -1, 4 / 42], [0, 1, 8 / 42], [1, 1, 4 / 42], [2, 1, 2 / 42], [-2, 2, 1 / 42], [-1, 2, 2 / 42], [0, 2, 4 / 42], [1, 2, 2 / 42], [2, 2, 1 / 42]];\nexport const TWOD = [[1, 0, 0.5], [0, 1, 0.5]];\nexport const RIGHT = [[1, 0, 1.0]];\nexport const DOWN = [[0, 1, 1.0]];\nexport const DOUBLE_DOWN = [[0, 1, 2 / 4], [0, 2, 1 / 4], [1, 2, 1 / 4]];\nexport const DIAG = [[1, 1, 1.0]];\nexport const VDIAMOND = [[0, 1, 6 / 16], [-1, 1, 3 / 16], [1, 1, 3 / 16], [-2, 2, 1 / 16], [0, 2, 2 / 16], [2, 2, 1 / 16]];\n", "import { SYSTEMS, SYSTEM_LOOKUP } from \"../settings/systems\";\nimport { DitherSetting, DithertronSettings, PixelsAvailableMessage } from \"../common/types\";\n\nimport * as exportfuncs from \"../export/exportfuncs\";\nimport * as fileviewers from \"../export/fileviewers\";\nimport * as kernels from \"../dither/kernels\";\n\nimport Cropper from 'cropperjs';\nimport pica from 'pica';\nimport { saveAs } from 'file-saver';\nimport { EXAMPLE_IMAGES } from \"./sampleimages\";\n\nvar cropper : Cropper;\n\nvar brightSlider = document.getElementById('brightSlider') as HTMLInputElement;\nvar contrastSlider = document.getElementById('contrastSlider') as HTMLInputElement;\nvar saturationSlider = document.getElementById('saturationSlider') as HTMLInputElement;\nvar noiseSlider = document.getElementById('noiseSlider') as HTMLInputElement;\nvar diffuseSlider = document.getElementById('diffuseSlider') as HTMLInputElement;\nvar orderedSlider = document.getElementById('orderedSlider') as HTMLInputElement;\nvar diversitySlider = document.getElementById('diversitySlider') as HTMLInputElement;\nvar imageUpload = document.getElementById(\"imageUpload\") as HTMLInputElement;\nconst sourceImage = document.getElementById('srcimage') as HTMLImageElement;\nconst resizeCanvas = document.getElementById('resizecanvas') as HTMLCanvasElement;\nconst destCanvas = document.getElementById('destcanvas') as HTMLCanvasElement;\n//const cmdline = document.getElementById('cmdline');\n\nclass ProxyDithertron {\n    worker: Worker;\n    settings: DithertronSettings;\n    lastPixels: PixelsAvailableMessage;\n\n    constructor() {\n        this.newWorker();\n    }\n    newWorker() {\n        // disable old worker\n        if (this.worker) this.worker.onmessage = () => {};\n        // create a new worker\n        this.worker = new Worker(\"./gen/worker.js\");\n        this.worker.onmessage = (ev) => {\n            var data = ev.data;\n            if (data != null) {\n                //console.log('recv',data);\n                if (data.img != null && this.pixelsAvailable != null) {\n                    this.pixelsAvailable(data);\n                    this.lastPixels = data;\n                }\n            }\n        };\n    }\n    setSettings(settings: DithertronSettings) {\n        this.settings = settings;\n        this.worker.postMessage({ cmd: \"setSettings\", data: settings });\n    }\n    setSourceImage(img: Uint32Array) {\n        this.worker.postMessage({ cmd: \"setSourceImage\", data: img });\n    }\n    restart() {\n        this.worker.postMessage({ cmd: \"restart\" });\n    }\n    pixelsAvailable: (msg: PixelsAvailableMessage) => void;\n}\n\nexport const dithertron = new ProxyDithertron();\n\nvar filenameLoaded: string;\nvar presetLoaded: string;\n\nconst ALL_DITHER_SETTINGS: DitherSetting[] = [\n    { name: \"Floyd-Steinberg\", kernel: kernels.FLOYD },\n    { name: \"False Floyd\", kernel: kernels.FALSEFLOYD },\n    { name: \"Atkinson\", kernel: kernels.ATKINSON },\n    { name: \"Sierra 2\", kernel: kernels.SIERRA2 },\n    { name: \"Sierra Lite\", kernel: kernels.SIERRALITE },\n    { name: \"Stucki\", kernel: kernels.STUCKI },\n    { name: \"Two-D\", kernel: kernels.TWOD },\n    { name: \"Right\", kernel: kernels.RIGHT },\n    { name: \"Down\", kernel: kernels.DOWN },\n    { name: \"Double Down\", kernel: kernels.DOUBLE_DOWN },\n    { name: \"Diagonal\", kernel: kernels.DIAG },\n    { name: \"Diamond\", kernel: kernels.VDIAMOND },\n];\n\nconst ERROR_FUNCS = [\n    { id: 'perceptual', name: \"Perceptual\" },\n    { id: 'hue', name: \"Hue-Based\" },\n    { id: 'dist', name: \"Distance\" },\n    { id: 'max', name: \"Maximum\" },\n];\n\n//\n\nfunction getCanvasImageData(canvas: HTMLCanvasElement) {\n    return new Uint32Array(canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height).data.buffer);\n}\nfunction drawRGBA(dest: HTMLCanvasElement, arr: Uint32Array) {\n    var ctx = dest.getContext('2d');\n    var imageData = ctx.createImageData(dest.width, dest.height);\n    var datau32 = new Uint32Array(imageData.data.buffer);\n    if (datau32.length == arr.length) {\n        datau32.set(arr);\n        ctx.putImageData(imageData, 0, 0);\n    } else {\n        console.log(\"drawRGBA(): array length mismatch\");\n        // TODO: source array is too long when switching\n    }\n}\nfunction applyBrightness(imageData: Uint32Array, bright: number, bias: number, sat: number, gamma: number) {\n    bright *= 1;\n    bias *= 1;\n    var u8arr = new Uint8ClampedArray(imageData.buffer);\n    for (var i = 0; i < u8arr.length; i += 4) {\n        var r = u8arr[i];\n        var g = u8arr[i + 1];\n        var b = u8arr[i + 2];\n        if (sat != 1.0) {\n            var gray = 0.2989 * r + 0.5870 * g + 0.1140 * b; //weights from CCIR 601 spec\n            r = gray * (1 - sat) + r * sat;\n            g = gray * (1 - sat) + g * sat;\n            b = gray * (1 - sat) + b * sat;\n        }\n        u8arr[i] = Math.pow(r * bright, gamma) + bias;\n        u8arr[i + 1] = Math.pow(g * bright, gamma) + bias;\n        u8arr[i + 2] = Math.pow(b * bright, gamma) + bias;\n    }\n}\n\nfunction reprocessImage() {\n    var resizeImageData = getCanvasImageData(resizeCanvas);\n    let bright = (parseFloat(contrastSlider.value) - 50) / 100 + 1.0; // middle = 1.0, range = 0.5-1.5\n    let bias = (parseFloat(brightSlider.value) - bright * 50) * (128 / 50);\n    let sat = (parseFloat(saturationSlider.value) - 50) / 50 + 1.0; // middle = 1.0, range = 0-2\n    let gamma = 1;\n    applyBrightness(resizeImageData, bright, bias, sat, gamma);\n    dithertron.setSourceImage(resizeImageData);\n    resetImage();\n}\n\nfunction resetImage() {\n    var opt = ($(\"#diffuseTypeSelect\")[0] as HTMLSelectElement).selectedOptions[0];\n    // TODO: what if settings not yet set?\n    if (opt) {\n        dithertron.settings.ditherfn = ALL_DITHER_SETTINGS[parseInt(opt.value)].kernel;\n    }\n    var opt = ($(\"#errorFuncSelect\")[0] as HTMLSelectElement).selectedOptions[0];\n    if (opt) {\n        dithertron.settings.errfn = opt.value;\n    }\n    dithertron.settings.diffuse = parseFloat(diffuseSlider.value) / 100;\n    dithertron.settings.ordered = parseFloat(orderedSlider.value) / 100;\n    dithertron.settings.noise = parseFloat(noiseSlider.value);\n    dithertron.settings.paletteDiversity = parseFloat(diversitySlider.value) / 200 + 0.75;\n    dithertron.setSettings(dithertron.settings);\n    dithertron.restart();\n}\n\nfunction convertImage() {\n    let cropCanvas = cropper?.getCroppedCanvas();\n    // avoid \"Failed to execute 'createImageBitmap' on 'Window': The crop rect height is 0.\"\n    if (!cropCanvas?.width || !cropCanvas?.height) return;\n    pica().resize(cropCanvas, resizeCanvas, {\n        /*\n        unsharpAmount: 50,\n        unsharpRadius: 0.5,\n        unsharpThreshold: 2\n        */\n    }).then(() => {\n        reprocessImage();\n    });\n}\n\nfunction getSystemInfo(sys: DithertronSettings) {\n    var s = sys.width + \" x \" + sys.height;\n    if (sys.reduce) s += \", \" + sys.reduce + \" out of \" + sys.pal.length + \" colors\";\n    else if (sys.pal) s += \", \" + sys.pal.length + \" colors\";\n    if (sys.block) {\n        s += \", \";\n        s += sys.block.colors + \" colors per \";\n        s += sys.block.w + \"x\" + sys.block.h + \" block\";\n    }\n    return s;\n}\n\nfunction showSystemInfo(sys: DithertronSettings) {\n    $(\"#targetFormatInfo\").text(getSystemInfo(sys));\n}\n\nfunction updatePaletteSwatches(pal: Uint32Array) {\n    var swat = $(\"#paletteSwatches\");\n    swat.empty();\n    if (pal && pal.length < 64) {\n        pal.forEach((col, index) => {\n            var rgb = \"rgb(\" + (col & 0xff) + \",\" + ((col >> 8) & 0xff) + \",\" + ((col >> 16) & 0xff) + \")\";\n            var sq = $('<span style=\"width:2em\">&nbsp;</span>').css(\"background-color\", rgb);\n            swat.append(sq);\n        });\n    }\n}\n\nfunction isExactMatch(imageData: Cropper.ImageData) {\n    const settings = dithertron.settings;\n    return imageData?.naturalWidth == settings.width\n        && imageData?.naturalHeight == settings.height;\n}\n\nfunction processImageDirectly() {\n    console.log(\"Width and height exact match!\");\n    cropper.clear();\n    cropper.disable();\n    // copy the image to resizeCanvas\n    const ctx = resizeCanvas.getContext('2d');\n    ctx.drawImage(sourceImage, 0, 0);\n    reprocessImage();\n}\n\nfunction loadSourceImage(url: string) {\n    // https://github.com/fengyuanchen/cropperjs/blob/master/README.md\n    if (cropper) cropper.destroy();\n    const settings = dithertron.settings;\n    let aspect = (settings.width * (settings.scaleX || 1) / settings.height) || (4 / 3);\n    cropper = new Cropper(sourceImage, {\n        viewMode: 1,\n        autoCropArea: 1.0,\n        initialAspectRatio: aspect,\n        crop(event) {\n            if (isExactMatch(cropper.getImageData())) {\n                processImageDirectly();\n            } else {\n                convertImage();\n            }\n        },\n    });\n    cropper.replace(url);\n    updateURL();\n}\n\nfunction setTargetSystem(sys: DithertronSettings) {\n    var showNoise = sys.conv != 'DitheringCanvas';\n    dithertron.newWorker();\n    dithertron.setSettings(sys);\n    dithertron.restart();\n    showSystemInfo(sys);\n    resizeCanvas.width = destCanvas.width = sys.width;\n    resizeCanvas.height = destCanvas.height = sys.height;\n    let pixelAspect = sys.scaleX || 1;\n    (destCanvas.style as any).aspectRatio = (sys.width * pixelAspect / sys.height).toString();\n    $(\"#noiseSection\").css('display', showNoise ? 'flex' : 'none');\n    $(\"#diversitySection\").css('display', sys.reduce ? 'flex' : 'none');\n    $(\"#downloadNativeBtn\").css('display', sys.toNative ? 'inline' : 'none');\n    $(\"#gotoIDE\").css('display', getCodeConvertFunction() ? 'inline' : 'none');\n    if (cropper) {\n        loadSourceImage((cropper as any).url); // TODO?\n    }\n    updateURL();\n    repopulateSystemSelector(sys);\n}\n\nfunction getFilenamePrefix() {\n    var fn = filenameLoaded || \"image\";\n    try { fn = fn.split('.').shift() || \"image\"; } catch (e) { } // remove extension\n    return fn + \"-\" + dithertron.settings.id;\n}\n\nfunction getNativeFormatData() {\n    var img = dithertron.lastPixels;\n    let funcname = dithertron.settings.toNative;\n    if (!funcname) return null;\n    var fn = exportfuncs[funcname];\n    return img && fn && fn(img, dithertron.settings);\n}\n\nfunction downloadNativeFormat() {\n    var data = getNativeFormatData();\n    if (data != null) {\n        var blob = new Blob([data], { type: \"application/octet-stream\" });\n        saveAs(blob, getFilenamePrefix() + \".bin\");\n    }\n}\nfunction downloadImageFormat() {\n    destCanvas.toBlob((blob) => {\n        saveAs(blob, getFilenamePrefix() + \".png\");\n    }, \"image/png\");\n}\nfunction byteArrayToString(data: number[] | Uint8Array): string {\n    var str = \"\";\n    if (data != null) {\n        var charLUT = new Array();\n        for (var i = 0; i < 256; ++i)\n            charLUT[i] = String.fromCharCode(i);\n        var len = data.length;\n        for (var i = 0; i < len; i++)\n            str += charLUT[data[i]];\n    }\n    return str;\n}\nfunction getCodeConvertFunction(): () => string {\n    var convertFuncName = 'getFileViewerCode_' + dithertron.settings.id.replace(/[^a-z0-9]/g, '_');\n    var convertFunc = fileviewers[convertFuncName];\n    return convertFunc;\n}\n\nasync function gotoIDE() {\n    function addHiddenField(form: any, name: any, val: any) {\n        $('<input type=\"hidden\"/>').attr('name', name).val(val).appendTo(form);\n    }\n    if (confirm(\"Open code sample with image in 8bitworkshop?\")) {\n        //e.target.disabled = true;\n        var platform_id = dithertron.settings.id.split('.')[0];\n        var form = $((document.forms as any)['ideForm'] as HTMLFormElement);\n        form.empty();\n        if (platform_id == 'atari8') platform_id = 'atari8-800'; // TODO\n        if (platform_id == 'cpc') platform_id = 'cpc.6128'; // TODO\n        addHiddenField(form, \"platform\", platform_id);\n        // TODO\n        var codeFilename = \"viewer-\" + getFilenamePrefix() + \".asm\";\n        var dataFilename = getFilenamePrefix() + \".bin\";\n        addHiddenField(form, \"file0_name\", codeFilename);\n        var code = getCodeConvertFunction()();\n        code = code.replace(\"$DATAFILE\", getFilenamePrefix() + \".bin\");\n        addHiddenField(form, \"file0_data\", code);\n        addHiddenField(form, \"file0_type\", \"utf8\");\n        addHiddenField(form, \"file1_name\", dataFilename);\n        addHiddenField(form, \"file1_data\", btoa(byteArrayToString(getNativeFormatData())));\n        addHiddenField(form, \"file1_type\", \"binary\");\n        form.submit();\n    }\n}\n\n\nfunction updateURL() {\n    let qs = {\n        sys: dithertron.settings.id,\n        image: presetLoaded,\n    };\n    window.location.hash = '#' + $.param(qs);\n}\n\nfunction decodeQueryString(qs: string) {\n    if (qs.startsWith('?')) qs = qs.substr(1);\n    var a = qs.split('&');\n    if (!a || a.length == 0)\n        return {};\n    var b: { [name: string]: string } = {};\n    for (var i = 0; i < a.length; ++i) {\n        var p = a[i].split('=', 2);\n        if (p.length == 1)\n            b[p[0]] = \"\";\n        else\n            b[p[0]] = decodeURIComponent(p[1].replace(/\\+/g, \" \"));\n    }\n    return b;\n}\n\nfunction repopulateSystemSelector(currentSystem: DithertronSettings) {\n    const sel = $(\"#targetFormatSelect\");\n    sel.empty();\n    let [currentParentName, currentSubtypeName] = currentSystem.name.split(' (');\n    let allParents = new Set<String>();\n    let optgroup = null;\n    SYSTEMS.forEach(sys => {\n        if (sys == null) {\n            sel.append($(\"<option disabled></option>\"));\n        } else {\n            // does it have a subtype?\n            let [parentName, subtypeName] = sys.name.split(' (');\n            let opt = $(\"<option />\").text(sys.name).val(sys.id);\n            if (parentName == currentParentName) {\n                if (!optgroup) {\n                    optgroup = $(\"<optgroup />\").attr(\"label\", currentParentName);\n                    sel.append(optgroup);\n                }\n                optgroup.append(opt);\n            } else if (!allParents.has(parentName)) {\n                let opt = $(\"<option />\").text(parentName).val(sys.id);\n                sel.append(opt);\n            }\n            allParents.add(parentName);\n        }\n    });\n    sel.val(currentSystem.id);\n}\n\nexport function startUI() {\n\n    window.addEventListener('load', function () {\n        document.querySelector('input[type=\"file\"]').addEventListener('change', function (event) {\n            var inputElement = event.target as HTMLInputElement;\n            var file = inputElement.files && inputElement.files[0];\n            if (file) {\n                filenameLoaded = file.name;\n                presetLoaded = \"\";\n                var url = URL.createObjectURL(file);\n                loadSourceImage(url);\n            }\n        });\n\n        EXAMPLE_IMAGES.forEach((filename) => {\n            $('<a class=\"dropdown-item\" href=\"#\"></a>').text(filename).appendTo(\"#examplesMenu\");\n        });\n\n        $(\"#examplesMenu\").click((e) => {\n            var filename = $(e.target).text();\n            filenameLoaded = presetLoaded = filename;\n            loadSourceImage(\"images/\" + filename);\n            imageUpload.value = \"\";\n        });\n\n        ALL_DITHER_SETTINGS.forEach((dset, index) => {\n            var opt = $(\"<option />\").text(dset.name).val(index);\n            $(\"#diffuseTypeSelect\").append(opt);\n        });\n        ERROR_FUNCS.forEach((dset, index) => {\n            var opt = $(\"<option />\").text(dset.name).val(dset.id);\n            $(\"#errorFuncSelect\").append(opt);\n        });\n\n        dithertron.pixelsAvailable = (msg) => {\n            // TODO: resize canvas?\n            drawRGBA(destCanvas, msg.img);\n            updatePaletteSwatches(msg.pal);\n            /*\n            if (msg.final) {\n                dest.toBlob((blob) => {\n                    $(\"#pngBytes\").text(blob.size+\"\");\n                }, 'image/png');\n            }\n            */\n        }\n\n        const qs = decodeQueryString(window.location.hash.substring(1));\n        const currentSystemId = qs['sys'] || SYSTEMS[0].id;\n        const currentSystem = SYSTEM_LOOKUP[currentSystemId];\n        setTargetSystem(currentSystem);\n\n        filenameLoaded = presetLoaded = qs['image'] || \"seurat.jpg\";\n        loadSourceImage(\"images/\" + filenameLoaded);\n\n        $(\"#diffuseSlider\").on('change', resetImage);\n        $(\"#orderedSlider\").on('change', resetImage);\n        $(\"#noiseSlider\").on('change', resetImage);\n        $(\"#diversitySlider\").on('change', reprocessImage);\n        $(\"#brightSlider\").on('change', reprocessImage);\n        $(\"#contrastSlider\").on('change', reprocessImage);\n        $(\"#saturationSlider\").on('change', reprocessImage);\n        $(\"#resetButton\").on('click', resetImage);\n        $(\"#diffuseTypeSelect\").on('change', resetImage);\n        $(\"#targetFormatSelect\").change((e) => {\n            var opt = (e.target as HTMLSelectElement).selectedOptions[0];\n            if (opt) {\n                setTargetSystem(SYSTEM_LOOKUP[opt.value]);\n            }\n        });\n        $(\"#errorFuncSelect\").on('change', resetImage);\n        $(\"#downloadImageBtn\").click(downloadImageFormat);\n        $(\"#downloadNativeBtn\").click(downloadNativeFormat);\n        $(\"#gotoIDE\").click(gotoIDE);\n    });\n\n    // print diags (TODO: generate markdown table)\n    if (window.location.search == '?printmeta') {\n        function printSystems() {\n            var s = \"\";\n            SYSTEMS.forEach((sys) => {\n                if (sys) s += \"* \" + sys.name + \" - \" + getSystemInfo(sys) + \"\\n\";\n            });\n            console.log(s);\n        }\n        printSystems();\n    }\n\n}\n\nstartUI();\n", "\nexport const EXAMPLE_IMAGES = [\n    'benbenn.jpg',\n    'cezanne2.jpg',\n    'colorroses.jpg',\n    'colorswirls.jpg',\n    'coolcar.jpg',\n    'darkbrewery.jpg',\n    'dhuku.jpg',\n    'greentruck.jpg',\n    'frida.jpg',\n    'homer.jpg',\n    'keyssunset.jpg',\n    'lobsterpot.jpg',\n    'myersflat.jpg',\n    'myrtle.jpg',\n    'parrot.jpg',\n    'redrose.jpg',\n    'robert_s_duncanson.jpg',\n    'seurat.jpg',\n    'vangogh.jpg',\n];\n\n"],
  "mappings": "utCAAA,IAAAA,GAAAC,GAAA,CAAAC,GAAAC,KAAA,EAUC,SAAUC,EAAQC,EAAS,CAC1B,OAAOH,IAAY,UAAY,OAAOC,IAAW,YAAcA,GAAO,QAAUE,EAAQ,EACxF,OAAO,QAAW,YAAc,OAAO,IAAM,OAAOA,CAAO,GAC1DD,EAAS,OAAO,YAAe,YAAc,WAAaA,GAAU,KAAMA,EAAO,QAAUC,EAAQ,EACtG,GAAGH,GAAO,UAAY,CAAE,aAEtB,SAASI,EAAQC,EAAGC,EAAG,CACrB,IAAIC,EAAI,OAAO,KAAKF,CAAC,EACrB,GAAI,OAAO,sBAAuB,CAChC,IAAIG,EAAI,OAAO,sBAAsBH,CAAC,EACtCC,IAAME,EAAIA,EAAE,OAAO,SAAUF,EAAG,CAC9B,OAAO,OAAO,yBAAyBD,EAAGC,CAAC,EAAE,UAC/C,CAAC,GAAIC,EAAE,KAAK,MAAMA,EAAGC,CAAC,CACxB,CACA,OAAOD,CACT,CACA,SAASE,EAAeJ,EAAG,CACzB,QAASC,EAAI,EAAGA,EAAI,UAAU,OAAQA,IAAK,CACzC,IAAIC,EAAY,UAAUD,CAAC,GAAnB,KAAuB,UAAUA,CAAC,EAAI,CAAC,EAC/CA,EAAI,EAAIF,EAAQ,OAAOG,CAAC,EAAG,EAAE,EAAE,QAAQ,SAAU,EAAG,CAClDG,EAAgBL,EAAG,EAAGE,EAAE,CAAC,CAAC,CAC5B,CAAC,EAAI,OAAO,0BAA4B,OAAO,iBAAiBF,EAAG,OAAO,0BAA0BE,CAAC,CAAC,EAAIH,EAAQ,OAAOG,CAAC,CAAC,EAAE,QAAQ,SAAU,EAAG,CAChJ,OAAO,eAAeF,EAAG,EAAG,OAAO,yBAAyBE,EAAG,CAAC,CAAC,CACnE,CAAC,CACH,CACA,OAAOF,CACT,CACA,SAASM,EAAQH,EAAG,CAClB,0BAEA,OAAOG,EAAwB,OAAO,QAArB,YAA2C,OAAO,OAAO,UAA1B,SAAqC,SAAUH,EAAG,CAChG,OAAO,OAAOA,CAChB,EAAI,SAAUA,EAAG,CACf,OAAOA,GAAmB,OAAO,QAArB,YAA+BA,EAAE,cAAgB,QAAUA,IAAM,OAAO,UAAY,SAAW,OAAOA,CACpH,EAAGG,EAAQH,CAAC,CACd,CACA,SAASI,EAAgBC,EAAUC,EAAa,CAC9C,GAAI,EAAED,aAAoBC,GACxB,MAAM,IAAI,UAAU,mCAAmC,CAE3D,CACA,SAASC,EAAkBC,EAAQC,EAAO,CACxC,QAAS,EAAI,EAAG,EAAIA,EAAM,OAAQ,IAAK,CACrC,IAAIC,EAAaD,EAAM,CAAC,EACxBC,EAAW,WAAaA,EAAW,YAAc,GACjDA,EAAW,aAAe,GACtB,UAAWA,IAAYA,EAAW,SAAW,IACjD,OAAO,eAAeF,EAAQG,EAAeD,EAAW,GAAG,EAAGA,CAAU,CAC1E,CACF,CACA,SAASE,EAAaN,EAAaO,EAAYC,EAAa,CAC1D,OAAID,GAAYN,EAAkBD,EAAY,UAAWO,CAAU,EAC/DC,GAAaP,EAAkBD,EAAaQ,CAAW,EAC3D,OAAO,eAAeR,EAAa,YAAa,CAC9C,SAAU,EACZ,CAAC,EACMA,CACT,CACA,SAASJ,EAAgBa,EAAKC,EAAKC,EAAO,CACxC,OAAAD,EAAML,EAAeK,CAAG,EACpBA,KAAOD,EACT,OAAO,eAAeA,EAAKC,EAAK,CAC9B,MAAOC,EACP,WAAY,GACZ,aAAc,GACd,SAAU,EACZ,CAAC,EAEDF,EAAIC,CAAG,EAAIC,EAENF,CACT,CACA,SAASG,EAAmBC,EAAK,CAC/B,OAAOC,EAAmBD,CAAG,GAAKE,EAAiBF,CAAG,GAAKG,EAA4BH,CAAG,GAAKI,EAAmB,CACpH,CACA,SAASH,EAAmBD,EAAK,CAC/B,GAAI,MAAM,QAAQA,CAAG,EAAG,OAAOK,EAAkBL,CAAG,CACtD,CACA,SAASE,EAAiBI,EAAM,CAC9B,GAAI,OAAO,QAAW,aAAeA,EAAK,OAAO,QAAQ,GAAK,MAAQA,EAAK,YAAY,GAAK,KAAM,OAAO,MAAM,KAAKA,CAAI,CAC1H,CACA,SAASH,EAA4BtB,EAAG0B,EAAQ,CAC9C,GAAK1B,EACL,IAAI,OAAOA,GAAM,SAAU,OAAOwB,EAAkBxB,EAAG0B,CAAM,EAC7D,IAAIC,EAAI,OAAO,UAAU,SAAS,KAAK3B,CAAC,EAAE,MAAM,EAAG,EAAE,EAErD,GADI2B,IAAM,UAAY3B,EAAE,cAAa2B,EAAI3B,EAAE,YAAY,MACnD2B,IAAM,OAASA,IAAM,MAAO,OAAO,MAAM,KAAK3B,CAAC,EACnD,GAAI2B,IAAM,aAAe,2CAA2C,KAAKA,CAAC,EAAG,OAAOH,EAAkBxB,EAAG0B,CAAM,EACjH,CACA,SAASF,EAAkBL,EAAKS,EAAK,EAC/BA,GAAO,MAAQA,EAAMT,EAAI,UAAQS,EAAMT,EAAI,QAC/C,QAAS,EAAI,EAAGU,EAAO,IAAI,MAAMD,CAAG,EAAG,EAAIA,EAAK,IAAKC,EAAK,CAAC,EAAIV,EAAI,CAAC,EACpE,OAAOU,CACT,CACA,SAASN,GAAqB,CAC5B,MAAM,IAAI,UAAU;AAAA,mFAAsI,CAC5J,CACA,SAASO,EAAaC,EAAOC,EAAM,CACjC,GAAI,OAAOD,GAAU,UAAYA,IAAU,KAAM,OAAOA,EACxD,IAAIE,EAAOF,EAAM,OAAO,WAAW,EACnC,GAAIE,IAAS,OAAW,CACtB,IAAIC,EAAMD,EAAK,KAAKF,EAAOC,GAAQ,SAAS,EAC5C,GAAI,OAAOE,GAAQ,SAAU,OAAOA,EACpC,MAAM,IAAI,UAAU,8CAA8C,CACpE,CACA,OAAQF,IAAS,SAAW,OAAS,QAAQD,CAAK,CACpD,CACA,SAASpB,EAAewB,EAAK,CAC3B,IAAInB,EAAMc,EAAaK,EAAK,QAAQ,EACpC,OAAO,OAAOnB,GAAQ,SAAWA,EAAM,OAAOA,CAAG,CACnD,CAEA,IAAIoB,EAAa,OAAO,QAAW,aAAe,OAAO,OAAO,UAAa,YACzEC,EAASD,EAAa,OAAS,CAAC,EAChCE,EAAkBF,GAAcC,EAAO,SAAS,gBAAkB,iBAAkBA,EAAO,SAAS,gBAAkB,GACtHE,EAAoBH,EAAa,iBAAkBC,EAAS,GAC5DG,EAAY,UAGZC,EAAa,MACbC,EAAc,OACdC,EAAc,OACdC,EAAc,OACdC,EAAc,IACdC,EAAc,IACdC,EAAe,IACfC,EAAe,IACfC,EAAoB,KACpBC,EAAoB,KACpBC,EAAoB,KACpBC,GAAoB,KAGpBC,GAAa,GAAG,OAAOb,EAAW,OAAO,EACzCc,EAAiB,GAAG,OAAOd,EAAW,WAAW,EACjDe,EAAe,GAAG,OAAOf,EAAW,SAAS,EAC7CgB,EAAa,GAAG,OAAOhB,EAAW,OAAO,EACzCiB,EAAkB,GAAG,OAAOjB,EAAW,YAAY,EACnDkB,EAAc,GAAG,OAAOlB,EAAW,QAAQ,EAC3CmB,GAAa,GAAG,OAAOnB,EAAW,OAAO,EAGzCoB,EAAc,GAAG,OAAOpB,EAAW,QAAQ,EAC3CqB,EAAe,GAAG,OAAOrB,EAAW,SAAS,EAG7CsB,GAAiB,OACjBC,GAAiB,OACjBC,GAAiB,OAGjBC,GAAa,OACbC,GAAiB,UACjBC,GAAkB,WAClBC,GAAmB,YACnBC,GAAiB,WACjBC,GAAoBhC,EAAkB,aAAe,YACrDiC,GAAmBjC,EAAkB,YAAc,YACnDkC,GAAkBlC,EAAkB,uBAAyB,UAC7DmC,GAAqBlC,EAAoB,cAAgB+B,GACzDI,GAAqBnC,EAAoB,cAAgBgC,GACzDI,GAAmBpC,EAAoB,0BAA4BiC,GACnEI,GAAc,QACdC,GAAe,SACfC,GAAc,QACdC,GAAa,OAGbC,GAAiB,aAGjBC,GAAiB,2CACjBC,GAAkB,SAClBC,GAAuB,4BACvBC,GAAkB,gBAIlBC,GAAsB,IACtBC,GAAuB,IAEvBC,GAAW,CAEb,SAAU,EAIV,SAAUzB,GAIV,mBAAoB,IAEpB,YAAa,IAEb,KAAM,KAEN,QAAS,GAET,WAAY,GAEZ,QAAS,GAET,iBAAkB,GAElB,iBAAkB,GAElB,MAAO,GAEP,OAAQ,GAER,OAAQ,GAER,UAAW,GAEX,WAAY,GAEZ,SAAU,GAEV,aAAc,GAEd,QAAS,GAET,UAAW,GAEX,SAAU,GAEV,SAAU,GAEV,YAAa,GAEb,YAAa,GAEb,eAAgB,GAEhB,eAAgB,GAEhB,iBAAkB,GAElB,yBAA0B,GAE1B,eAAgB,EAChB,gBAAiB,EACjB,gBAAiB,EACjB,iBAAkB,EAClB,kBAAmBuB,GACnB,mBAAoBC,GAEpB,MAAO,KACP,UAAW,KACX,SAAU,KACV,QAAS,KACT,KAAM,KACN,KAAM,IACR,EAEIE,GAAW,orCAKXC,GAAQ,OAAO,OAASpD,EAAO,MAOnC,SAASqD,GAASzE,EAAO,CACvB,OAAO,OAAOA,GAAU,UAAY,CAACwE,GAAMxE,CAAK,CAClD,CAOA,IAAI0E,GAAmB,SAA0B1E,EAAO,CACtD,OAAOA,EAAQ,GAAKA,EAAQ,GAC9B,EAOA,SAAS2E,GAAY3E,EAAO,CAC1B,OAAO,OAAOA,GAAU,WAC1B,CAOA,SAAS4E,GAAS5E,EAAO,CACvB,OAAOd,EAAQc,CAAK,IAAM,UAAYA,IAAU,IAClD,CACA,IAAI6E,GAAiB,OAAO,UAAU,eAOtC,SAASC,GAAc9E,EAAO,CAC5B,GAAI,CAAC4E,GAAS5E,CAAK,EACjB,MAAO,GAET,GAAI,CACF,IAAI+E,EAAe/E,EAAM,YACrBgF,EAAYD,EAAa,UAC7B,OAAOA,GAAgBC,GAAaH,GAAe,KAAKG,EAAW,eAAe,CACpF,OAASC,EAAO,CACd,MAAO,EACT,CACF,CAOA,SAASC,GAAWlF,EAAO,CACzB,OAAO,OAAOA,GAAU,UAC1B,CACA,IAAImF,GAAQ,MAAM,UAAU,MAO5B,SAASC,GAAQpF,EAAO,CACtB,OAAO,MAAM,KAAO,MAAM,KAAKA,CAAK,EAAImF,GAAM,KAAKnF,CAAK,CAC1D,CAQA,SAASqF,GAAQC,EAAMC,EAAU,CAC/B,OAAID,GAAQJ,GAAWK,CAAQ,IACzB,MAAM,QAAQD,CAAI,GAAKb,GAASa,EAAK,MAAM,EAC7CF,GAAQE,CAAI,EAAE,QAAQ,SAAUtF,EAAOD,EAAK,CAC1CwF,EAAS,KAAKD,EAAMtF,EAAOD,EAAKuF,CAAI,CACtC,CAAC,EACQV,GAASU,CAAI,GACtB,OAAO,KAAKA,CAAI,EAAE,QAAQ,SAAUvF,EAAK,CACvCwF,EAAS,KAAKD,EAAMA,EAAKvF,CAAG,EAAGA,EAAKuF,CAAI,CAC1C,CAAC,GAGEA,CACT,CAQA,IAAIE,GAAS,OAAO,QAAU,SAAgBjG,EAAQ,CACpD,QAASkG,EAAO,UAAU,OAAQC,EAAO,IAAI,MAAMD,EAAO,EAAIA,EAAO,EAAI,CAAC,EAAGE,EAAO,EAAGA,EAAOF,EAAME,IAClGD,EAAKC,EAAO,CAAC,EAAI,UAAUA,CAAI,EAEjC,OAAIf,GAASrF,CAAM,GAAKmG,EAAK,OAAS,GACpCA,EAAK,QAAQ,SAAUxE,EAAK,CACtB0D,GAAS1D,CAAG,GACd,OAAO,KAAKA,CAAG,EAAE,QAAQ,SAAUnB,EAAK,CACtCR,EAAOQ,CAAG,EAAImB,EAAInB,CAAG,CACvB,CAAC,CAEL,CAAC,EAEIR,CACT,EACIqG,GAAkB,uBAStB,SAASC,GAAuB7F,EAAO,CACrC,IAAI8F,EAAQ,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,KAChF,OAAOF,GAAgB,KAAK5F,CAAK,EAAI,KAAK,MAAMA,EAAQ8F,CAAK,EAAIA,EAAQ9F,CAC3E,CACA,IAAI+F,GAAgB,+CAOpB,SAASC,GAASC,EAASC,EAAQ,CACjC,IAAIC,EAAQF,EAAQ,MACpBZ,GAAQa,EAAQ,SAAUlG,EAAOoG,EAAU,CACrCL,GAAc,KAAKK,CAAQ,GAAK3B,GAASzE,CAAK,IAChDA,EAAQ,GAAG,OAAOA,EAAO,IAAI,GAE/BmG,EAAMC,CAAQ,EAAIpG,CACpB,CAAC,CACH,CAQA,SAASqG,GAASJ,EAASjG,EAAO,CAChC,OAAOiG,EAAQ,UAAYA,EAAQ,UAAU,SAASjG,CAAK,EAAIiG,EAAQ,UAAU,QAAQjG,CAAK,EAAI,EACpG,CAOA,SAASsG,GAASL,EAASjG,EAAO,CAChC,GAAKA,EAGL,IAAIyE,GAASwB,EAAQ,MAAM,EAAG,CAC5BZ,GAAQY,EAAS,SAAUM,EAAM,CAC/BD,GAASC,EAAMvG,CAAK,CACtB,CAAC,EACD,MACF,CACA,GAAIiG,EAAQ,UAAW,CACrBA,EAAQ,UAAU,IAAIjG,CAAK,EAC3B,MACF,CACA,IAAIwG,EAAYP,EAAQ,UAAU,KAAK,EAClCO,EAEMA,EAAU,QAAQxG,CAAK,EAAI,IACpCiG,EAAQ,UAAY,GAAG,OAAOO,EAAW,GAAG,EAAE,OAAOxG,CAAK,GAF1DiG,EAAQ,UAAYjG,EAIxB,CAOA,SAASyG,GAAYR,EAASjG,EAAO,CACnC,GAAKA,EAGL,IAAIyE,GAASwB,EAAQ,MAAM,EAAG,CAC5BZ,GAAQY,EAAS,SAAUM,EAAM,CAC/BE,GAAYF,EAAMvG,CAAK,CACzB,CAAC,EACD,MACF,CACA,GAAIiG,EAAQ,UAAW,CACrBA,EAAQ,UAAU,OAAOjG,CAAK,EAC9B,MACF,CACIiG,EAAQ,UAAU,QAAQjG,CAAK,GAAK,IACtCiG,EAAQ,UAAYA,EAAQ,UAAU,QAAQjG,EAAO,EAAE,GAE3D,CAQA,SAAS0G,GAAYT,EAASjG,EAAO2G,EAAO,CAC1C,GAAK3G,EAGL,IAAIyE,GAASwB,EAAQ,MAAM,EAAG,CAC5BZ,GAAQY,EAAS,SAAUM,EAAM,CAC/BG,GAAYH,EAAMvG,EAAO2G,CAAK,CAChC,CAAC,EACD,MACF,CAGIA,EACFL,GAASL,EAASjG,CAAK,EAEvByG,GAAYR,EAASjG,CAAK,EAE9B,CACA,IAAI4G,GAAoB,oBAOxB,SAASC,GAAY7G,EAAO,CAC1B,OAAOA,EAAM,QAAQ4G,GAAmB,OAAO,EAAE,YAAY,CAC/D,CAQA,SAASE,GAAQb,EAASc,EAAM,CAC9B,OAAInC,GAASqB,EAAQc,CAAI,CAAC,EACjBd,EAAQc,CAAI,EAEjBd,EAAQ,QACHA,EAAQ,QAAQc,CAAI,EAEtBd,EAAQ,aAAa,QAAQ,OAAOY,GAAYE,CAAI,CAAC,CAAC,CAC/D,CAQA,SAASC,GAAQf,EAASc,EAAMzB,EAAM,CAChCV,GAASU,CAAI,EACfW,EAAQc,CAAI,EAAIzB,EACPW,EAAQ,QACjBA,EAAQ,QAAQc,CAAI,EAAIzB,EAExBW,EAAQ,aAAa,QAAQ,OAAOY,GAAYE,CAAI,CAAC,EAAGzB,CAAI,CAEhE,CAOA,SAAS2B,GAAWhB,EAASc,EAAM,CACjC,GAAInC,GAASqB,EAAQc,CAAI,CAAC,EACxB,GAAI,CACF,OAAOd,EAAQc,CAAI,CACrB,OAAS9B,EAAO,CACdgB,EAAQc,CAAI,EAAI,MAClB,SACSd,EAAQ,QAEjB,GAAI,CACF,OAAOA,EAAQ,QAAQc,CAAI,CAC7B,OAAS9B,EAAO,CACdgB,EAAQ,QAAQc,CAAI,EAAI,MAC1B,MAEAd,EAAQ,gBAAgB,QAAQ,OAAOY,GAAYE,CAAI,CAAC,CAAC,CAE7D,CACA,IAAIG,GAAgB,QAChBC,GAAgB,UAAY,CAC9B,IAAIC,EAAY,GAChB,GAAIjG,EAAY,CACd,IAAIkG,EAAO,GACPC,EAAW,UAAoB,CAAC,EAChCC,EAAU,OAAO,eAAe,CAAC,EAAG,OAAQ,CAC9C,IAAK,UAAe,CAClB,OAAAH,EAAY,GACLC,CACT,EAMA,IAAK,SAAarH,EAAO,CACvBqH,EAAOrH,CACT,CACF,CAAC,EACDoB,EAAO,iBAAiB,OAAQkG,EAAUC,CAAO,EACjDnG,EAAO,oBAAoB,OAAQkG,EAAUC,CAAO,CACtD,CACA,OAAOH,CACT,EAAE,EASF,SAASI,GAAevB,EAASwB,EAAMH,EAAU,CAC/C,IAAIC,EAAU,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,CAAC,EAC/EG,EAAUJ,EACdG,EAAK,KAAK,EAAE,MAAMP,EAAa,EAAE,QAAQ,SAAUS,EAAO,CACxD,GAAI,CAACR,GAAe,CAClB,IAAIS,EAAY3B,EAAQ,UACpB2B,GAAaA,EAAUD,CAAK,GAAKC,EAAUD,CAAK,EAAEL,CAAQ,IAC5DI,EAAUE,EAAUD,CAAK,EAAEL,CAAQ,EACnC,OAAOM,EAAUD,CAAK,EAAEL,CAAQ,EAC5B,OAAO,KAAKM,EAAUD,CAAK,CAAC,EAAE,SAAW,GAC3C,OAAOC,EAAUD,CAAK,EAEpB,OAAO,KAAKC,CAAS,EAAE,SAAW,GACpC,OAAO3B,EAAQ,UAGrB,CACAA,EAAQ,oBAAoB0B,EAAOD,EAASH,CAAO,CACrD,CAAC,CACH,CASA,SAASM,GAAY5B,EAASwB,EAAMH,EAAU,CAC5C,IAAIC,EAAU,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,CAAC,EAC/EO,EAAWR,EACfG,EAAK,KAAK,EAAE,MAAMP,EAAa,EAAE,QAAQ,SAAUS,EAAO,CACxD,GAAIJ,EAAQ,MAAQ,CAACJ,GAAe,CAClC,IAAIY,EAAqB9B,EAAQ,UAC/B2B,EAAYG,IAAuB,OAAS,CAAC,EAAIA,EACnDD,EAAW,UAAmB,CAC5B,OAAOF,EAAUD,CAAK,EAAEL,CAAQ,EAChCrB,EAAQ,oBAAoB0B,EAAOG,EAAUP,CAAO,EACpD,QAASS,EAAQ,UAAU,OAAQtC,EAAO,IAAI,MAAMsC,CAAK,EAAGC,EAAQ,EAAGA,EAAQD,EAAOC,IACpFvC,EAAKuC,CAAK,EAAI,UAAUA,CAAK,EAE/BX,EAAS,MAAMrB,EAASP,CAAI,CAC9B,EACKkC,EAAUD,CAAK,IAClBC,EAAUD,CAAK,EAAI,CAAC,GAElBC,EAAUD,CAAK,EAAEL,CAAQ,GAC3BrB,EAAQ,oBAAoB0B,EAAOC,EAAUD,CAAK,EAAEL,CAAQ,EAAGC,CAAO,EAExEK,EAAUD,CAAK,EAAEL,CAAQ,EAAIQ,EAC7B7B,EAAQ,UAAY2B,CACtB,CACA3B,EAAQ,iBAAiB0B,EAAOG,EAAUP,CAAO,CACnD,CAAC,CACH,CASA,SAASW,GAAcjC,EAASwB,EAAMnC,EAAM,CAC1C,IAAIqC,EAGJ,OAAIzC,GAAW,KAAK,GAAKA,GAAW,WAAW,EAC7CyC,EAAQ,IAAI,YAAYF,EAAM,CAC5B,OAAQnC,EACR,QAAS,GACT,WAAY,EACd,CAAC,GAEDqC,EAAQ,SAAS,YAAY,aAAa,EAC1CA,EAAM,gBAAgBF,EAAM,GAAM,GAAMnC,CAAI,GAEvCW,EAAQ,cAAc0B,CAAK,CACpC,CAOA,SAASQ,GAAUlC,EAAS,CAC1B,IAAImC,EAAMnC,EAAQ,sBAAsB,EACxC,MAAO,CACL,KAAMmC,EAAI,MAAQ,OAAO,YAAc,SAAS,gBAAgB,YAChE,IAAKA,EAAI,KAAO,OAAO,YAAc,SAAS,gBAAgB,UAChE,CACF,CACA,IAAIC,GAAWjH,EAAO,SAClBkH,GAAiB,gCAOrB,SAASC,GAAiBC,EAAK,CAC7B,IAAIC,EAAQD,EAAI,MAAMF,EAAc,EACpC,OAAOG,IAAU,OAASA,EAAM,CAAC,IAAMJ,GAAS,UAAYI,EAAM,CAAC,IAAMJ,GAAS,UAAYI,EAAM,CAAC,IAAMJ,GAAS,KACtH,CAOA,SAASK,GAAaF,EAAK,CACzB,IAAIG,EAAY,aAAa,OAAO,IAAI,KAAK,EAAE,QAAQ,CAAC,EACxD,OAAOH,GAAOA,EAAI,QAAQ,GAAG,IAAM,GAAK,IAAM,KAAOG,CACvD,CAOA,SAASC,GAAcC,EAAM,CAC3B,IAAIC,EAASD,EAAK,OAChBE,EAASF,EAAK,OACdG,EAASH,EAAK,OACdI,EAAaJ,EAAK,WAClBK,EAAaL,EAAK,WAChBM,EAAS,CAAC,EACV1E,GAASwE,CAAU,GAAKA,IAAe,GACzCE,EAAO,KAAK,cAAc,OAAOF,EAAY,KAAK,CAAC,EAEjDxE,GAASyE,CAAU,GAAKA,IAAe,GACzCC,EAAO,KAAK,cAAc,OAAOD,EAAY,KAAK,CAAC,EAIjDzE,GAASqE,CAAM,GAAKA,IAAW,GACjCK,EAAO,KAAK,UAAU,OAAOL,EAAQ,MAAM,CAAC,EAE1CrE,GAASsE,CAAM,GAAKA,IAAW,GACjCI,EAAO,KAAK,UAAU,OAAOJ,EAAQ,GAAG,CAAC,EAEvCtE,GAASuE,CAAM,GAAKA,IAAW,GACjCG,EAAO,KAAK,UAAU,OAAOH,EAAQ,GAAG,CAAC,EAE3C,IAAII,EAAYD,EAAO,OAASA,EAAO,KAAK,GAAG,EAAI,OACnD,MAAO,CACL,gBAAiBC,EACjB,YAAaA,EACb,UAAWA,CACb,CACF,CAOA,SAASC,GAAgBC,EAAU,CACjC,IAAIC,EAAYvK,EAAe,CAAC,EAAGsK,CAAQ,EACvCE,EAAW,EACf,OAAAnE,GAAQiE,EAAU,SAAUG,EAASC,EAAW,CAC9C,OAAOH,EAAUG,CAAS,EAC1BrE,GAAQkE,EAAW,SAAUI,EAAU,CACrC,IAAIC,EAAK,KAAK,IAAIH,EAAQ,OAASE,EAAS,MAAM,EAC9CE,EAAK,KAAK,IAAIJ,EAAQ,OAASE,EAAS,MAAM,EAC9CG,EAAK,KAAK,IAAIL,EAAQ,KAAOE,EAAS,IAAI,EAC1CI,EAAK,KAAK,IAAIN,EAAQ,KAAOE,EAAS,IAAI,EAC1CK,EAAK,KAAK,KAAKJ,EAAKA,EAAKC,EAAKA,CAAE,EAChCI,EAAK,KAAK,KAAKH,EAAKA,EAAKC,EAAKA,CAAE,EAChCG,GAASD,EAAKD,GAAMA,EACpB,KAAK,IAAIE,CAAK,EAAI,KAAK,IAAIV,CAAQ,IACrCA,EAAWU,EAEf,CAAC,CACH,CAAC,EACMV,CACT,CAQA,SAASW,GAAWC,EAAOC,EAAS,CAClC,IAAIC,EAAQF,EAAM,MAChBG,EAAQH,EAAM,MACZI,EAAM,CACR,KAAMF,EACN,KAAMC,CACR,EACA,OAAOF,EAAUG,EAAMxL,EAAe,CACpC,OAAQsL,EACR,OAAQC,CACV,EAAGC,CAAG,CACR,CAOA,SAASC,GAAkBnB,EAAU,CACnC,IAAIgB,EAAQ,EACRC,EAAQ,EACRG,EAAQ,EACZ,OAAArF,GAAQiE,EAAU,SAAUqB,EAAO,CACjC,IAAIC,EAASD,EAAM,OACjBE,EAASF,EAAM,OACjBL,GAASM,EACTL,GAASM,EACTH,GAAS,CACX,CAAC,EACDJ,GAASI,EACTH,GAASG,EACF,CACL,MAAOJ,EACP,MAAOC,CACT,CACF,CAQA,SAASO,GAAiBC,EAAO,CAC/B,IAAIC,EAAcD,EAAM,YACtBE,EAASF,EAAM,OACfG,EAAQH,EAAM,MACZtD,EAAO,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,UAC3E0D,EAAezG,GAAiBwG,CAAK,EACrCE,EAAgB1G,GAAiBuG,CAAM,EAC3C,GAAIE,GAAgBC,EAAe,CACjC,IAAIC,EAAgBJ,EAASD,EACzBvD,IAAS,WAAa4D,EAAgBH,GAASzD,IAAS,SAAW4D,EAAgBH,EACrFD,EAASC,EAAQF,EAEjBE,EAAQD,EAASD,CAErB,MAAWG,EACTF,EAASC,EAAQF,EACRI,IACTF,EAAQD,EAASD,GAEnB,MAAO,CACL,MAAOE,EACP,OAAQD,CACV,CACF,CAOA,SAASK,GAAgBC,EAAO,CAC9B,IAAIL,EAAQK,EAAM,MAChBN,EAASM,EAAM,OACfC,EAASD,EAAM,OAEjB,GADAC,EAAS,KAAK,IAAIA,CAAM,EAAI,IACxBA,IAAW,GACb,MAAO,CACL,MAAOP,EACP,OAAQC,CACV,EAEF,IAAIO,EAAMD,EAAS,GAAK,KAAK,GAAK,IAC9BE,EAAS,KAAK,IAAID,CAAG,EACrBE,EAAS,KAAK,IAAIF,CAAG,EACrBG,EAAWV,EAAQS,EAASV,EAASS,EACrCG,EAAYX,EAAQQ,EAAST,EAASU,EAC1C,OAAOH,EAAS,GAAK,CACnB,MAAOK,EACP,OAAQD,CACV,EAAI,CACF,MAAOA,EACP,OAAQC,CACV,CACF,CAUA,SAASC,GAAgBC,EAAOC,EAAOC,EAAOC,EAAO,CACnD,IAAIC,EAAmBH,EAAM,YAC3BI,EAAoBJ,EAAM,aAC1BK,EAAqBL,EAAM,cAC3BM,EAAeN,EAAM,OACrBlD,EAASwD,IAAiB,OAAS,EAAIA,EACvCC,EAAeP,EAAM,OACrBjD,EAASwD,IAAiB,OAAS,EAAIA,EACvCC,EAAeR,EAAM,OACrBhD,EAASwD,IAAiB,OAAS,EAAIA,EACrCxB,GAAciB,EAAM,YACtBQ,GAAeR,EAAM,aACrBS,GAAgBT,EAAM,cACpBU,GAAkBT,EAAM,UAC1BU,GAAYD,KAAoB,OAAS,cAAgBA,GACzDE,GAAwBX,EAAM,sBAC9BY,GAAwBD,KAA0B,OAAS,GAAOA,GAClEE,GAAwBb,EAAM,sBAC9Bc,GAAwBD,KAA0B,OAAS,MAAQA,GACnEE,EAAiBf,EAAM,SACvBgB,GAAWD,IAAmB,OAAS,IAAWA,EAClDE,GAAkBjB,EAAM,UACxBkB,GAAYD,KAAoB,OAAS,IAAWA,GACpDE,GAAiBnB,EAAM,SACvBoB,GAAWD,KAAmB,OAAS,EAAIA,GAC3CE,GAAkBrB,EAAM,UACxBsB,GAAYD,KAAoB,OAAS,EAAIA,GAC3CE,GAAS,SAAS,cAAc,QAAQ,EACxCC,GAAUD,GAAO,WAAW,IAAI,EAChCE,GAAW7C,GAAiB,CAC9B,YAAaE,GACb,MAAOkC,GACP,OAAQE,EACV,CAAC,EACGQ,GAAW9C,GAAiB,CAC9B,YAAaE,GACb,MAAOsC,GACP,OAAQE,EACV,EAAG,OAAO,EACNtC,GAAQ,KAAK,IAAIyC,GAAS,MAAO,KAAK,IAAIC,GAAS,MAAOnB,EAAY,CAAC,EACvExB,GAAS,KAAK,IAAI0C,GAAS,OAAQ,KAAK,IAAIC,GAAS,OAAQlB,EAAa,CAAC,EAI3EmB,GAAe/C,GAAiB,CAClC,YAAaqB,EACb,MAAOe,GACP,OAAQE,EACV,CAAC,EACGU,GAAehD,GAAiB,CAClC,YAAaqB,EACb,MAAOmB,GACP,OAAQE,EACV,EAAG,OAAO,EACNO,GAAY,KAAK,IAAIF,GAAa,MAAO,KAAK,IAAIC,GAAa,MAAO1B,CAAiB,CAAC,EACxF4B,GAAa,KAAK,IAAIH,GAAa,OAAQ,KAAK,IAAIC,GAAa,OAAQzB,CAAkB,CAAC,EAC5F4B,GAAS,CAAC,CAACF,GAAY,EAAG,CAACC,GAAa,EAAGD,GAAWC,EAAU,EACpE,OAAAP,GAAO,MAAQ5H,GAAuBqF,EAAK,EAC3CuC,GAAO,OAAS5H,GAAuBoF,EAAM,EAC7CyC,GAAQ,UAAYd,GACpBc,GAAQ,SAAS,EAAG,EAAGxC,GAAOD,EAAM,EACpCyC,GAAQ,KAAK,EACbA,GAAQ,UAAUxC,GAAQ,EAAGD,GAAS,CAAC,EACvCyC,GAAQ,OAAO5E,EAAS,KAAK,GAAK,GAAG,EACrC4E,GAAQ,MAAM3E,EAAQC,CAAM,EAC5B0E,GAAQ,sBAAwBZ,GAChCY,GAAQ,sBAAwBV,GAChCU,GAAQ,UAAU,MAAMA,GAAS,CAAC3B,CAAK,EAAE,OAAO9L,EAAmBgO,GAAO,IAAI,SAAUC,GAAO,CAC7F,OAAO,KAAK,MAAMrI,GAAuBqI,EAAK,CAAC,CACjD,CAAC,CAAC,CAAC,CAAC,EACJR,GAAQ,QAAQ,EACTD,EACT,CACA,IAAIU,GAAe,OAAO,aAS1B,SAASC,GAAsBC,EAAUC,EAAOC,EAAQ,CACtD,IAAIC,EAAM,GACVD,GAAUD,EACV,QAASG,EAAIH,EAAOG,EAAIF,EAAQE,GAAK,EACnCD,GAAOL,GAAaE,EAAS,SAASI,CAAC,CAAC,EAE1C,OAAOD,CACT,CACA,IAAIE,GAAuB,YAO3B,SAASC,GAAqBC,EAAS,CACrC,IAAIC,EAASD,EAAQ,QAAQF,GAAsB,EAAE,EACjDI,EAAS,KAAKD,CAAM,EACpBE,EAAc,IAAI,YAAYD,EAAO,MAAM,EAC3CE,EAAQ,IAAI,WAAWD,CAAW,EACtC,OAAA1J,GAAQ2J,EAAO,SAAUhP,EAAOyO,EAAG,CACjCO,EAAMP,CAAC,EAAIK,EAAO,WAAWL,CAAC,CAChC,CAAC,EACMM,CACT,CAQA,SAASE,GAAqBF,EAAaG,EAAU,CAMnD,QALIC,EAAS,CAAC,EAGVC,EAAY,KACZJ,EAAQ,IAAI,WAAWD,CAAW,EAC/BC,EAAM,OAAS,GAGpBG,EAAO,KAAKhB,GAAa,MAAM,KAAM/I,GAAQ4J,EAAM,SAAS,EAAGI,CAAS,CAAC,CAAC,CAAC,EAC3EJ,EAAQA,EAAM,SAASI,CAAS,EAElC,MAAO,QAAQ,OAAOF,EAAU,UAAU,EAAE,OAAO,KAAKC,EAAO,KAAK,EAAE,CAAC,CAAC,CAC1E,CAOA,SAASE,GAAuBN,EAAa,CAC3C,IAAIV,EAAW,IAAI,SAASU,CAAW,EACnCO,EAGJ,GAAI,CACF,IAAIC,EACAC,EACAC,EAGJ,GAAIpB,EAAS,SAAS,CAAC,IAAM,KAAQA,EAAS,SAAS,CAAC,IAAM,IAG5D,QAFIE,EAASF,EAAS,WAClBqB,EAAS,EACNA,EAAS,EAAInB,GAAQ,CAC1B,GAAIF,EAAS,SAASqB,CAAM,IAAM,KAAQrB,EAAS,SAASqB,EAAS,CAAC,IAAM,IAAM,CAChFF,EAAYE,EACZ,KACF,CACAA,GAAU,CACZ,CAEF,GAAIF,EAAW,CACb,IAAIG,EAAaH,EAAY,EACzBI,EAAaJ,EAAY,GAC7B,GAAIpB,GAAsBC,EAAUsB,EAAY,CAAC,IAAM,OAAQ,CAC7D,IAAIE,EAAaxB,EAAS,UAAUuB,CAAU,EAE9C,GADAL,EAAeM,IAAe,OAC1BN,GAAgBM,IAAe,QAC7BxB,EAAS,UAAUuB,EAAa,EAAGL,CAAY,IAAM,GAAQ,CAC/D,IAAIO,EAAiBzB,EAAS,UAAUuB,EAAa,EAAGL,CAAY,EAChEO,GAAkB,IACpBL,EAAWG,EAAaE,EAE5B,CAEJ,CACF,CACA,GAAIL,EAAU,CACZ,IAAIM,EAAU1B,EAAS,UAAUoB,EAAUF,CAAY,EACnDS,GACAvB,GACJ,IAAKA,GAAI,EAAGA,GAAIsB,EAAStB,IAAK,EAE5B,GADAuB,GAAUP,EAAWhB,GAAI,GAAK,EAC1BJ,EAAS,UAAU2B,GAAST,CAAY,IAAM,IAA0B,CAE1ES,IAAW,EAGXV,EAAcjB,EAAS,UAAU2B,GAAST,CAAY,EAGtDlB,EAAS,UAAU2B,GAAS,EAAGT,CAAY,EAC3C,KACF,CAEJ,CACF,OAAStK,GAAO,CACdqK,EAAc,CAChB,CACA,OAAOA,CACT,CAOA,SAASW,GAAiBX,EAAa,CACrC,IAAIxG,EAAS,EACTC,EAAS,EACTC,EAAS,EACb,OAAQsG,EAAa,CAEnB,IAAK,GACHvG,EAAS,GACT,MAGF,IAAK,GACHD,EAAS,KACT,MAGF,IAAK,GACHE,EAAS,GACT,MAGF,IAAK,GACHF,EAAS,GACTE,EAAS,GACT,MAGF,IAAK,GACHF,EAAS,GACT,MAGF,IAAK,GACHA,EAAS,GACTC,EAAS,GACT,MAGF,IAAK,GACHD,EAAS,IACT,KACJ,CACA,MAAO,CACL,OAAQA,EACR,OAAQC,EACR,OAAQC,CACV,CACF,CAEA,IAAIkH,GAAS,CACX,OAAQ,UAAkB,CACxB,KAAK,cAAc,EACnB,KAAK,WAAW,EAChB,KAAK,YAAY,EACjB,KAAK,aAAa,EACd,KAAK,SACP,KAAK,cAAc,CAEvB,EACA,cAAe,UAAyB,CACtC,IAAIjK,EAAU,KAAK,QACjBsB,EAAU,KAAK,QACf4I,EAAY,KAAK,UACjBC,EAAU,KAAK,QACb9C,EAAW,OAAO/F,EAAQ,iBAAiB,EAC3CiG,EAAY,OAAOjG,EAAQ,kBAAkB,EACjDjB,GAAS8J,EAAS9N,CAAY,EAC9BmE,GAAYR,EAAS3D,CAAY,EACjC,IAAI+N,EAAgB,CAClB,MAAO,KAAK,IAAIF,EAAU,YAAa7C,GAAY,EAAIA,EAAWlJ,EAAmB,EACrF,OAAQ,KAAK,IAAI+L,EAAU,aAAc3C,GAAa,EAAIA,EAAYnJ,EAAoB,CAC5F,EACA,KAAK,cAAgBgM,EACrBrK,GAASoK,EAAS,CAChB,MAAOC,EAAc,MACrB,OAAQA,EAAc,MACxB,CAAC,EACD/J,GAASL,EAAS3D,CAAY,EAC9BmE,GAAY2J,EAAS9N,CAAY,CACnC,EAEA,WAAY,UAAsB,CAChC,IAAI+N,EAAgB,KAAK,cACvBC,EAAY,KAAK,UACfC,EAAW,KAAK,QAAQ,SACxBC,EAAU,KAAK,IAAIF,EAAU,MAAM,EAAI,MAAQ,GAC/C7D,EAAe+D,EAAUF,EAAU,cAAgBA,EAAU,aAC7D5D,EAAgB8D,EAAUF,EAAU,aAAeA,EAAU,cAC7DtF,EAAcyB,EAAeC,EAC7B+D,EAAcJ,EAAc,MAC5BK,EAAeL,EAAc,OAC7BA,EAAc,OAASrF,EAAcqF,EAAc,MACjDE,IAAa,EACfE,EAAcJ,EAAc,OAASrF,EAErC0F,EAAeL,EAAc,MAAQrF,EAE9BuF,IAAa,EACtBG,EAAeL,EAAc,MAAQrF,EAErCyF,EAAcJ,EAAc,OAASrF,EAEvC,IAAI2F,EAAa,CACf,YAAa3F,EACb,aAAcyB,EACd,cAAeC,EACf,MAAO+D,EACP,OAAQC,CACV,EACA,KAAK,WAAaC,EAClB,KAAK,QAAUJ,IAAa,GAAKA,IAAa,EAC9C,KAAK,YAAY,GAAM,EAAI,EAC3BI,EAAW,MAAQ,KAAK,IAAI,KAAK,IAAIA,EAAW,MAAOA,EAAW,QAAQ,EAAGA,EAAW,QAAQ,EAChGA,EAAW,OAAS,KAAK,IAAI,KAAK,IAAIA,EAAW,OAAQA,EAAW,SAAS,EAAGA,EAAW,SAAS,EACpGA,EAAW,MAAQN,EAAc,MAAQM,EAAW,OAAS,EAC7DA,EAAW,KAAON,EAAc,OAASM,EAAW,QAAU,EAC9DA,EAAW,QAAUA,EAAW,KAChCA,EAAW,OAASA,EAAW,IAC/B,KAAK,kBAAoBnL,GAAO,CAAC,EAAGmL,CAAU,CAChD,EACA,YAAa,SAAqBC,EAAaC,EAAiB,CAC9D,IAAItJ,EAAU,KAAK,QACjB8I,EAAgB,KAAK,cACrBM,EAAa,KAAK,WAClBG,EAAc,KAAK,YACjBP,EAAWhJ,EAAQ,SACnByD,EAAc2F,EAAW,YACzBI,EAAU,KAAK,SAAWD,EAC9B,GAAIF,EAAa,CACf,IAAII,EAAiB,OAAOzJ,EAAQ,cAAc,GAAK,EACnD0J,EAAkB,OAAO1J,EAAQ,eAAe,GAAK,EACrDgJ,EAAW,GACbS,EAAiB,KAAK,IAAIA,EAAgBX,EAAc,KAAK,EAC7DY,EAAkB,KAAK,IAAIA,EAAiBZ,EAAc,MAAM,EAC5DE,IAAa,IACXU,EAAkBjG,EAAcgG,EAClCA,EAAiBC,EAAkBjG,EAEnCiG,EAAkBD,EAAiBhG,IAG9BuF,EAAW,IAChBS,EACFA,EAAiB,KAAK,IAAIA,EAAgBD,EAAUD,EAAY,MAAQ,CAAC,EAChEG,EACTA,EAAkB,KAAK,IAAIA,EAAiBF,EAAUD,EAAY,OAAS,CAAC,EACnEC,IACTC,EAAiBF,EAAY,MAC7BG,EAAkBH,EAAY,OAC1BG,EAAkBjG,EAAcgG,EAClCA,EAAiBC,EAAkBjG,EAEnCiG,EAAkBD,EAAiBhG,IAIzC,IAAIkG,EAAoBpG,GAAiB,CACvC,YAAaE,EACb,MAAOgG,EACP,OAAQC,CACV,CAAC,EACDD,EAAiBE,EAAkB,MACnCD,EAAkBC,EAAkB,OACpCP,EAAW,SAAWK,EACtBL,EAAW,UAAYM,EACvBN,EAAW,SAAW,IACtBA,EAAW,UAAY,GACzB,CACA,GAAIE,EACF,GAAIN,GAAYQ,EAAU,EAAI,GAAI,CAChC,IAAII,GAAgBd,EAAc,MAAQM,EAAW,MACjDS,GAAef,EAAc,OAASM,EAAW,OACrDA,EAAW,QAAU,KAAK,IAAI,EAAGQ,EAAa,EAC9CR,EAAW,OAAS,KAAK,IAAI,EAAGS,EAAY,EAC5CT,EAAW,QAAU,KAAK,IAAI,EAAGQ,EAAa,EAC9CR,EAAW,OAAS,KAAK,IAAI,EAAGS,EAAY,EACxCL,GAAW,KAAK,UAClBJ,EAAW,QAAU,KAAK,IAAIG,EAAY,KAAMA,EAAY,MAAQA,EAAY,MAAQH,EAAW,MAAM,EACzGA,EAAW,OAAS,KAAK,IAAIG,EAAY,IAAKA,EAAY,KAAOA,EAAY,OAASH,EAAW,OAAO,EACxGA,EAAW,QAAUG,EAAY,KACjCH,EAAW,OAASG,EAAY,IAC5BP,IAAa,IACXI,EAAW,OAASN,EAAc,QACpCM,EAAW,QAAU,KAAK,IAAI,EAAGQ,EAAa,EAC9CR,EAAW,QAAU,KAAK,IAAI,EAAGQ,EAAa,GAE5CR,EAAW,QAAUN,EAAc,SACrCM,EAAW,OAAS,KAAK,IAAI,EAAGS,EAAY,EAC5CT,EAAW,OAAS,KAAK,IAAI,EAAGS,EAAY,IAIpD,MACET,EAAW,QAAU,CAACA,EAAW,MACjCA,EAAW,OAAS,CAACA,EAAW,OAChCA,EAAW,QAAUN,EAAc,MACnCM,EAAW,OAASN,EAAc,MAGxC,EACA,aAAc,SAAsBgB,EAASC,EAAa,CACxD,IAAIX,EAAa,KAAK,WACpBL,EAAY,KAAK,UACnB,GAAIgB,EAAa,CACf,IAAIC,EAAmBjG,GAAgB,CACnC,MAAOgF,EAAU,aAAe,KAAK,IAAIA,EAAU,QAAU,CAAC,EAC9D,OAAQA,EAAU,cAAgB,KAAK,IAAIA,EAAU,QAAU,CAAC,EAChE,OAAQA,EAAU,QAAU,CAC9B,CAAC,EACD7D,EAAe8E,EAAiB,MAChC7E,EAAgB6E,EAAiB,OAC/BrG,EAAQyF,EAAW,OAASlE,EAAekE,EAAW,cACtD1F,EAAS0F,EAAW,QAAUjE,EAAgBiE,EAAW,eAC7DA,EAAW,OAASzF,EAAQyF,EAAW,OAAS,EAChDA,EAAW,MAAQ1F,EAAS0F,EAAW,QAAU,EACjDA,EAAW,MAAQzF,EACnByF,EAAW,OAAS1F,EACpB0F,EAAW,YAAclE,EAAeC,EACxCiE,EAAW,aAAelE,EAC1BkE,EAAW,cAAgBjE,EAC3B,KAAK,YAAY,GAAM,EAAK,CAC9B,EACIiE,EAAW,MAAQA,EAAW,UAAYA,EAAW,MAAQA,EAAW,YAC1EA,EAAW,KAAOA,EAAW,UAE3BA,EAAW,OAASA,EAAW,WAAaA,EAAW,OAASA,EAAW,aAC7EA,EAAW,IAAMA,EAAW,QAE9BA,EAAW,MAAQ,KAAK,IAAI,KAAK,IAAIA,EAAW,MAAOA,EAAW,QAAQ,EAAGA,EAAW,QAAQ,EAChGA,EAAW,OAAS,KAAK,IAAI,KAAK,IAAIA,EAAW,OAAQA,EAAW,SAAS,EAAGA,EAAW,SAAS,EACpG,KAAK,YAAY,GAAO,EAAI,EAC5BA,EAAW,KAAO,KAAK,IAAI,KAAK,IAAIA,EAAW,KAAMA,EAAW,OAAO,EAAGA,EAAW,OAAO,EAC5FA,EAAW,IAAM,KAAK,IAAI,KAAK,IAAIA,EAAW,IAAKA,EAAW,MAAM,EAAGA,EAAW,MAAM,EACxFA,EAAW,QAAUA,EAAW,KAChCA,EAAW,OAASA,EAAW,IAC/B3K,GAAS,KAAK,OAAQR,GAAO,CAC3B,MAAOmL,EAAW,MAClB,OAAQA,EAAW,MACrB,EAAG/H,GAAc,CACf,WAAY+H,EAAW,KACvB,WAAYA,EAAW,GACzB,CAAC,CAAC,CAAC,EACH,KAAK,YAAYU,CAAO,EACpB,KAAK,SAAW,KAAK,SACvB,KAAK,aAAa,GAAM,EAAI,CAEhC,EACA,YAAa,SAAqBA,EAAS,CACzC,IAAIV,EAAa,KAAK,WACpBL,EAAY,KAAK,UACfpF,EAAQoF,EAAU,cAAgBK,EAAW,MAAQA,EAAW,cAChE1F,EAASqF,EAAU,eAAiBK,EAAW,OAASA,EAAW,eACvEnL,GAAO8K,EAAW,CAChB,MAAOpF,EACP,OAAQD,EACR,MAAO0F,EAAW,MAAQzF,GAAS,EACnC,KAAMyF,EAAW,OAAS1F,GAAU,CACtC,CAAC,EACDjF,GAAS,KAAK,MAAOR,GAAO,CAC1B,MAAO8K,EAAU,MACjB,OAAQA,EAAU,MACpB,EAAG1H,GAAcpD,GAAO,CACtB,WAAY8K,EAAU,KACtB,WAAYA,EAAU,GACxB,EAAGA,CAAS,CAAC,CAAC,CAAC,EACXe,GACF,KAAK,OAAO,CAEhB,EACA,YAAa,UAAuB,CAClC,IAAI9J,EAAU,KAAK,QACjBoJ,EAAa,KAAK,WAChB3F,EAAczD,EAAQ,aAAeA,EAAQ,mBAC7CiK,EAAe,OAAOjK,EAAQ,YAAY,GAAK,GAC/CuJ,EAAc,CAChB,MAAOH,EAAW,MAClB,OAAQA,EAAW,MACrB,EACI3F,IACE2F,EAAW,OAAS3F,EAAc2F,EAAW,MAC/CG,EAAY,OAASA,EAAY,MAAQ9F,EAEzC8F,EAAY,MAAQA,EAAY,OAAS9F,GAG7C,KAAK,YAAc8F,EACnB,KAAK,aAAa,GAAM,EAAI,EAG5BA,EAAY,MAAQ,KAAK,IAAI,KAAK,IAAIA,EAAY,MAAOA,EAAY,QAAQ,EAAGA,EAAY,QAAQ,EACpGA,EAAY,OAAS,KAAK,IAAI,KAAK,IAAIA,EAAY,OAAQA,EAAY,SAAS,EAAGA,EAAY,SAAS,EAGxGA,EAAY,MAAQ,KAAK,IAAIA,EAAY,SAAUA,EAAY,MAAQU,CAAY,EACnFV,EAAY,OAAS,KAAK,IAAIA,EAAY,UAAWA,EAAY,OAASU,CAAY,EACtFV,EAAY,KAAOH,EAAW,MAAQA,EAAW,MAAQG,EAAY,OAAS,EAC9EA,EAAY,IAAMH,EAAW,KAAOA,EAAW,OAASG,EAAY,QAAU,EAC9EA,EAAY,QAAUA,EAAY,KAClCA,EAAY,OAASA,EAAY,IACjC,KAAK,mBAAqBtL,GAAO,CAAC,EAAGsL,CAAW,CAClD,EACA,aAAc,SAAsBF,EAAaC,EAAiB,CAChE,IAAItJ,EAAU,KAAK,QACjB8I,EAAgB,KAAK,cACrBM,EAAa,KAAK,WAClBG,EAAc,KAAK,YACnBW,EAAU,KAAK,QACbzG,EAAczD,EAAQ,YAC1B,GAAIqJ,EAAa,CACf,IAAIc,EAAkB,OAAOnK,EAAQ,eAAe,GAAK,EACrDoK,EAAmB,OAAOpK,EAAQ,gBAAgB,GAAK,EACvDqK,EAAkBH,EAAU,KAAK,IAAIpB,EAAc,MAAOM,EAAW,MAAOA,EAAW,MAAQA,EAAW,KAAMN,EAAc,MAAQM,EAAW,IAAI,EAAIN,EAAc,MACvKwB,EAAmBJ,EAAU,KAAK,IAAIpB,EAAc,OAAQM,EAAW,OAAQA,EAAW,OAASA,EAAW,IAAKN,EAAc,OAASM,EAAW,GAAG,EAAIN,EAAc,OAG9KqB,EAAkB,KAAK,IAAIA,EAAiBrB,EAAc,KAAK,EAC/DsB,EAAmB,KAAK,IAAIA,EAAkBtB,EAAc,MAAM,EAC9DrF,IACE0G,GAAmBC,EACjBA,EAAmB3G,EAAc0G,EACnCC,EAAmBD,EAAkB1G,EAErC0G,EAAkBC,EAAmB3G,EAE9B0G,EACTC,EAAmBD,EAAkB1G,EAC5B2G,IACTD,EAAkBC,EAAmB3G,GAEnC6G,EAAmB7G,EAAc4G,EACnCC,EAAmBD,EAAkB5G,EAErC4G,EAAkBC,EAAmB7G,GAKzC8F,EAAY,SAAW,KAAK,IAAIY,EAAiBE,CAAe,EAChEd,EAAY,UAAY,KAAK,IAAIa,EAAkBE,CAAgB,EACnEf,EAAY,SAAWc,EACvBd,EAAY,UAAYe,CAC1B,CACIhB,IACEY,GACFX,EAAY,QAAU,KAAK,IAAI,EAAGH,EAAW,IAAI,EACjDG,EAAY,OAAS,KAAK,IAAI,EAAGH,EAAW,GAAG,EAC/CG,EAAY,QAAU,KAAK,IAAIT,EAAc,MAAOM,EAAW,KAAOA,EAAW,KAAK,EAAIG,EAAY,MACtGA,EAAY,OAAS,KAAK,IAAIT,EAAc,OAAQM,EAAW,IAAMA,EAAW,MAAM,EAAIG,EAAY,SAEtGA,EAAY,QAAU,EACtBA,EAAY,OAAS,EACrBA,EAAY,QAAUT,EAAc,MAAQS,EAAY,MACxDA,EAAY,OAAST,EAAc,OAASS,EAAY,QAG9D,EACA,cAAe,UAAyB,CACtC,IAAIvJ,EAAU,KAAK,QACjB8I,EAAgB,KAAK,cACrBS,EAAc,KAAK,aACjBA,EAAY,MAAQA,EAAY,UAAYA,EAAY,MAAQA,EAAY,YAC9EA,EAAY,KAAOA,EAAY,UAE7BA,EAAY,OAASA,EAAY,WAAaA,EAAY,OAASA,EAAY,aACjFA,EAAY,IAAMA,EAAY,QAEhCA,EAAY,MAAQ,KAAK,IAAI,KAAK,IAAIA,EAAY,MAAOA,EAAY,QAAQ,EAAGA,EAAY,QAAQ,EACpGA,EAAY,OAAS,KAAK,IAAI,KAAK,IAAIA,EAAY,OAAQA,EAAY,SAAS,EAAGA,EAAY,SAAS,EACxG,KAAK,aAAa,GAAO,EAAI,EAC7BA,EAAY,KAAO,KAAK,IAAI,KAAK,IAAIA,EAAY,KAAMA,EAAY,OAAO,EAAGA,EAAY,OAAO,EAChGA,EAAY,IAAM,KAAK,IAAI,KAAK,IAAIA,EAAY,IAAKA,EAAY,MAAM,EAAGA,EAAY,MAAM,EAC5FA,EAAY,QAAUA,EAAY,KAClCA,EAAY,OAASA,EAAY,IAC7BvJ,EAAQ,SAAWA,EAAQ,gBAE7BP,GAAQ,KAAK,KAAMrE,EAAamO,EAAY,OAAST,EAAc,OAASS,EAAY,QAAUT,EAAc,OAAS3O,EAAcF,CAAU,EAEnJwE,GAAS,KAAK,QAASR,GAAO,CAC5B,MAAOsL,EAAY,MACnB,OAAQA,EAAY,MACtB,EAAGlI,GAAc,CACf,WAAYkI,EAAY,KACxB,WAAYA,EAAY,GAC1B,CAAC,CAAC,CAAC,EACC,KAAK,SAAW,KAAK,SACvB,KAAK,YAAY,GAAM,EAAI,EAExB,KAAK,UACR,KAAK,OAAO,CAEhB,EACA,OAAQ,UAAkB,CACxB,KAAK,QAAQ,EACb5I,GAAc,KAAK,QAASlF,GAAY,KAAK,QAAQ,CAAC,CACxD,CACF,EAEI8O,GAAU,CACZ,YAAa,UAAuB,CAClC,IAAI7L,EAAU,KAAK,QACjB8L,EAAc,KAAK,YACjBD,EAAU,KAAK,QAAQ,QACvBtJ,EAAMuJ,EAAc,KAAK,eAAiB,KAAK,IAC/CC,EAAM/L,EAAQ,KAAO,uBACrB8F,EAAQ,SAAS,cAAc,KAAK,EAQxC,GAPIgG,IACFhG,EAAM,YAAcgG,GAEtBhG,EAAM,IAAMvD,EACZuD,EAAM,IAAMiG,EACZ,KAAK,QAAQ,YAAYjG,CAAK,EAC9B,KAAK,aAAeA,EAChB,EAAC+F,EAGL,KAAIG,EAAWH,EACX,OAAOA,GAAY,SACrBG,EAAWhM,EAAQ,cAAc,iBAAiB6L,CAAO,EAChDA,EAAQ,gBACjBG,EAAW,CAACH,CAAO,GAErB,KAAK,SAAWG,EAChB5M,GAAQ4M,EAAU,SAAUC,EAAI,CAC9B,IAAIC,EAAM,SAAS,cAAc,KAAK,EAGtCnL,GAAQkL,EAAItP,EAAc,CACxB,MAAOsP,EAAG,YACV,OAAQA,EAAG,aACX,KAAMA,EAAG,SACX,CAAC,EACGH,IACFI,EAAI,YAAcJ,GAEpBI,EAAI,IAAM3J,EACV2J,EAAI,IAAMH,EAQVG,EAAI,MAAM,QAAU,0KACpBD,EAAG,UAAY,GACfA,EAAG,YAAYC,CAAG,CACpB,CAAC,EACH,EACA,aAAc,UAAwB,CACpC9M,GAAQ,KAAK,SAAU,SAAUY,EAAS,CACxC,IAAIX,EAAOwB,GAAQb,EAASrD,CAAY,EACxCoD,GAASC,EAAS,CAChB,MAAOX,EAAK,MACZ,OAAQA,EAAK,MACf,CAAC,EACDW,EAAQ,UAAYX,EAAK,KACzB2B,GAAWhB,EAASrD,CAAY,CAClC,CAAC,CACH,EACA,QAAS,UAAmB,CAC1B,IAAI0N,EAAY,KAAK,UACnBK,EAAa,KAAK,WAClBG,EAAc,KAAK,YACjBsB,EAAetB,EAAY,MAC7BuB,EAAgBvB,EAAY,OAC1B5F,EAAQoF,EAAU,MACpBrF,EAASqF,EAAU,OACjBgC,EAAOxB,EAAY,KAAOH,EAAW,KAAOL,EAAU,KACtDiC,EAAMzB,EAAY,IAAMH,EAAW,IAAML,EAAU,IACnD,CAAC,KAAK,SAAW,KAAK,WAG1BtK,GAAS,KAAK,aAAcR,GAAO,CACjC,MAAO0F,EACP,OAAQD,CACV,EAAGrC,GAAcpD,GAAO,CACtB,WAAY,CAAC8M,EACb,WAAY,CAACC,CACf,EAAGjC,CAAS,CAAC,CAAC,CAAC,EACfjL,GAAQ,KAAK,SAAU,SAAUY,EAAS,CACxC,IAAIX,EAAOwB,GAAQb,EAASrD,CAAY,EACpC4P,EAAgBlN,EAAK,MACrBmN,GAAiBnN,EAAK,OACtBsG,GAAW4G,EACX3G,GAAY4G,GACZvI,GAAQ,EACRkI,IACFlI,GAAQsI,EAAgBJ,EACxBvG,GAAYwG,EAAgBnI,IAE1BmI,GAAiBxG,GAAY4G,KAC/BvI,GAAQuI,GAAiBJ,EACzBzG,GAAWwG,EAAelI,GAC1B2B,GAAY4G,IAEdzM,GAASC,EAAS,CAChB,MAAO2F,GACP,OAAQC,EACV,CAAC,EACD7F,GAASC,EAAQ,qBAAqB,KAAK,EAAE,CAAC,EAAGT,GAAO,CACtD,MAAO0F,EAAQhB,GACf,OAAQe,EAASf,EACnB,EAAGtB,GAAcpD,GAAO,CACtB,WAAY,CAAC8M,EAAOpI,GACpB,WAAY,CAACqI,EAAMrI,EACrB,EAAGoG,CAAS,CAAC,CAAC,CAAC,CACjB,CAAC,EACH,CACF,EAEIoC,GAAS,CACX,KAAM,UAAgB,CACpB,IAAIzM,EAAU,KAAK,QACjBsB,EAAU,KAAK,QACf6I,EAAU,KAAK,QACblL,GAAWqC,EAAQ,SAAS,GAC9BM,GAAY5B,EAAS9C,GAAkBoE,EAAQ,SAAS,EAEtDrC,GAAWqC,EAAQ,QAAQ,GAC7BM,GAAY5B,EAAS/C,GAAiBqE,EAAQ,QAAQ,EAEpDrC,GAAWqC,EAAQ,OAAO,GAC5BM,GAAY5B,EAAShD,GAAgBsE,EAAQ,OAAO,EAElDrC,GAAWqC,EAAQ,IAAI,GACzBM,GAAY5B,EAASjD,GAAYuE,EAAQ,IAAI,EAE3CrC,GAAWqC,EAAQ,IAAI,GACzBM,GAAY5B,EAASnC,GAAYyD,EAAQ,IAAI,EAE/CM,GAAYuI,EAAS5M,GAAoB,KAAK,YAAc,KAAK,UAAU,KAAK,IAAI,CAAC,EACjF+D,EAAQ,UAAYA,EAAQ,aAC9BM,GAAYuI,EAASvM,GAAa,KAAK,QAAU,KAAK,MAAM,KAAK,IAAI,EAAG,CACtE,QAAS,GACT,QAAS,EACX,CAAC,EAEC0D,EAAQ,0BACVM,GAAYuI,EAAShN,GAAgB,KAAK,WAAa,KAAK,SAAS,KAAK,IAAI,CAAC,EAEjFyE,GAAY5B,EAAQ,cAAexC,GAAoB,KAAK,WAAa,KAAK,SAAS,KAAK,IAAI,CAAC,EACjGoE,GAAY5B,EAAQ,cAAevC,GAAkB,KAAK,UAAY,KAAK,QAAQ,KAAK,IAAI,CAAC,EACzF6D,EAAQ,YACVM,GAAY,OAAQjE,GAAc,KAAK,SAAW,KAAK,OAAO,KAAK,IAAI,CAAC,CAE5E,EACA,OAAQ,UAAkB,CACxB,IAAIqC,EAAU,KAAK,QACjBsB,EAAU,KAAK,QACf6I,EAAU,KAAK,QACblL,GAAWqC,EAAQ,SAAS,GAC9BC,GAAevB,EAAS9C,GAAkBoE,EAAQ,SAAS,EAEzDrC,GAAWqC,EAAQ,QAAQ,GAC7BC,GAAevB,EAAS/C,GAAiBqE,EAAQ,QAAQ,EAEvDrC,GAAWqC,EAAQ,OAAO,GAC5BC,GAAevB,EAAShD,GAAgBsE,EAAQ,OAAO,EAErDrC,GAAWqC,EAAQ,IAAI,GACzBC,GAAevB,EAASjD,GAAYuE,EAAQ,IAAI,EAE9CrC,GAAWqC,EAAQ,IAAI,GACzBC,GAAevB,EAASnC,GAAYyD,EAAQ,IAAI,EAElDC,GAAe4I,EAAS5M,GAAoB,KAAK,WAAW,EACxD+D,EAAQ,UAAYA,EAAQ,aAC9BC,GAAe4I,EAASvM,GAAa,KAAK,QAAS,CACjD,QAAS,GACT,QAAS,EACX,CAAC,EAEC0D,EAAQ,0BACVC,GAAe4I,EAAShN,GAAgB,KAAK,UAAU,EAEzDoE,GAAevB,EAAQ,cAAexC,GAAoB,KAAK,UAAU,EACzE+D,GAAevB,EAAQ,cAAevC,GAAkB,KAAK,SAAS,EAClE6D,EAAQ,YACVC,GAAe,OAAQ5D,GAAc,KAAK,QAAQ,CAEtD,CACF,EAEI+O,GAAW,CACb,OAAQ,UAAkB,CACxB,GAAI,MAAK,SAGT,KAAIpL,EAAU,KAAK,QACjB4I,EAAY,KAAK,UACjBE,EAAgB,KAAK,cACnBuC,EAASzC,EAAU,YAAcE,EAAc,MAC/CwC,EAAS1C,EAAU,aAAeE,EAAc,OAChDnG,EAAQ,KAAK,IAAI0I,EAAS,CAAC,EAAI,KAAK,IAAIC,EAAS,CAAC,EAAID,EAASC,EAGnE,GAAI3I,IAAU,EAAG,CACf,IAAIyG,EACAG,EACAvJ,EAAQ,UACVoJ,EAAa,KAAK,cAAc,EAChCG,EAAc,KAAK,eAAe,GAEpC,KAAK,OAAO,EACRvJ,EAAQ,UACV,KAAK,cAAclC,GAAQsL,EAAY,SAAUjQ,EAAG+N,EAAG,CACrDkC,EAAWlC,CAAC,EAAI/N,EAAIwJ,CACtB,CAAC,CAAC,EACF,KAAK,eAAe7E,GAAQyL,EAAa,SAAUpQ,EAAG+N,EAAG,CACvDqC,EAAYrC,CAAC,EAAI/N,EAAIwJ,CACvB,CAAC,CAAC,EAEN,EACF,EACA,SAAU,UAAoB,CACxB,KAAK,UAAY,KAAK,QAAQ,WAAanH,IAG/C,KAAK,YAAYsD,GAAS,KAAK,QAASjE,EAAU,EAAIU,GAAiBD,EAAc,CACvF,EACA,MAAO,SAAe8E,EAAO,CAC3B,IAAImL,EAAQ,KACR5I,EAAQ,OAAO,KAAK,QAAQ,cAAc,GAAK,GAC/C6I,EAAQ,EACR,KAAK,WAGTpL,EAAM,eAAe,EAGjB,MAAK,WAGT,KAAK,SAAW,GAChB,WAAW,UAAY,CACrBmL,EAAM,SAAW,EACnB,EAAG,EAAE,EACDnL,EAAM,OACRoL,EAAQpL,EAAM,OAAS,EAAI,EAAI,GACtBA,EAAM,WACfoL,EAAQ,CAACpL,EAAM,WAAa,IACnBA,EAAM,SACfoL,EAAQpL,EAAM,OAAS,EAAI,EAAI,IAEjC,KAAK,KAAK,CAACoL,EAAQ7I,EAAOvC,CAAK,GACjC,EACA,UAAW,SAAmBA,EAAO,CACnC,IAAIqL,EAAUrL,EAAM,QAClBsL,EAAStL,EAAM,OACjB,GAAI,OAAK,WAGLA,EAAM,OAAS,aAAeA,EAAM,OAAS,eAAiBA,EAAM,cAAgB,WAExFlD,GAASuO,CAAO,GAAKA,IAAY,GAAKvO,GAASwO,CAAM,GAAKA,IAAW,GAGlEtL,EAAM,UAGT,KAAIJ,EAAU,KAAK,QACjB+B,EAAW,KAAK,SACd4J,EACAvL,EAAM,eAERtC,GAAQsC,EAAM,eAAgB,SAAUwL,EAAO,CAC7C7J,EAAS6J,EAAM,UAAU,EAAIhJ,GAAWgJ,CAAK,CAC/C,CAAC,EAGD7J,EAAS3B,EAAM,WAAa,CAAC,EAAIwC,GAAWxC,CAAK,EAE/C,OAAO,KAAK2B,CAAQ,EAAE,OAAS,GAAK/B,EAAQ,UAAYA,EAAQ,YAClE2L,EAASvR,EAETuR,EAASpM,GAAQa,EAAM,OAAQhF,CAAW,EAEvCqB,GAAe,KAAKkP,CAAM,GAG3BhL,GAAc,KAAK,QAAS/E,GAAkB,CAChD,cAAewE,EACf,OAAQuL,CACV,CAAC,IAAM,KAKPvL,EAAM,eAAe,EACrB,KAAK,OAASuL,EACd,KAAK,SAAW,GACZA,IAAWzR,IACb,KAAK,SAAW,GAChB6E,GAAS,KAAK,QAAS7D,CAAW,IAEtC,EACA,SAAU,SAAkBkF,EAAO,CACjC,IAAIuL,EAAS,KAAK,OAClB,GAAI,OAAK,UAAY,CAACA,GAGtB,KAAI5J,EAAW,KAAK,SACpB3B,EAAM,eAAe,EACjBO,GAAc,KAAK,QAAShF,GAAiB,CAC/C,cAAeyE,EACf,OAAQuL,CACV,CAAC,IAAM,KAGHvL,EAAM,eACRtC,GAAQsC,EAAM,eAAgB,SAAUwL,EAAO,CAE7C3N,GAAO8D,EAAS6J,EAAM,UAAU,GAAK,CAAC,EAAGhJ,GAAWgJ,EAAO,EAAI,CAAC,CAClE,CAAC,EAED3N,GAAO8D,EAAS3B,EAAM,WAAa,CAAC,GAAK,CAAC,EAAGwC,GAAWxC,EAAO,EAAI,CAAC,EAEtE,KAAK,OAAOA,CAAK,GACnB,EACA,QAAS,SAAiBA,EAAO,CAC/B,GAAI,MAAK,SAGT,KAAIuL,EAAS,KAAK,OAChB5J,EAAW,KAAK,SACd3B,EAAM,eACRtC,GAAQsC,EAAM,eAAgB,SAAUwL,EAAO,CAC7C,OAAO7J,EAAS6J,EAAM,UAAU,CAClC,CAAC,EAED,OAAO7J,EAAS3B,EAAM,WAAa,CAAC,EAEjCuL,IAGLvL,EAAM,eAAe,EAChB,OAAO,KAAK2B,CAAQ,EAAE,SACzB,KAAK,OAAS,IAEZ,KAAK,WACP,KAAK,SAAW,GAChB5C,GAAY,KAAK,QAASjE,EAAa,KAAK,SAAW,KAAK,QAAQ,KAAK,GAE3EyF,GAAc,KAAK,QAASjF,GAAgB,CAC1C,cAAe0E,EACf,OAAQuL,CACV,CAAC,GACH,CACF,EAEIE,GAAS,CACX,OAAQ,SAAgBzL,EAAO,CAC7B,IAAIJ,EAAU,KAAK,QACjBoJ,EAAa,KAAK,WAClBN,EAAgB,KAAK,cACrBS,EAAc,KAAK,YACnBxH,EAAW,KAAK,SACd4J,EAAS,KAAK,OACdlI,EAAczD,EAAQ,YACtB+K,EAAOxB,EAAY,KACrByB,EAAMzB,EAAY,IAClB5F,EAAQ4F,EAAY,MACpB7F,EAAS6F,EAAY,OACnBuC,GAAQf,EAAOpH,EACfoI,GAASf,EAAMtH,EACfsI,GAAU,EACVC,GAAS,EACTtG,GAAWmD,EAAc,MACzBjD,GAAYiD,EAAc,OAC1BoD,GAAa,GACb/D,GAGA,CAAC1E,GAAerD,EAAM,WACxBqD,EAAcE,GAASD,EAASC,EAAQD,EAAS,GAE/C,KAAK,UACPsI,GAAUzC,EAAY,QACtB0C,GAAS1C,EAAY,OACrB5D,GAAWqG,GAAU,KAAK,IAAIlD,EAAc,MAAOM,EAAW,MAAOA,EAAW,KAAOA,EAAW,KAAK,EACvGvD,GAAYoG,GAAS,KAAK,IAAInD,EAAc,OAAQM,EAAW,OAAQA,EAAW,IAAMA,EAAW,MAAM,GAE3G,IAAIlH,GAAUH,EAAS,OAAO,KAAKA,CAAQ,EAAE,CAAC,CAAC,EAC3CoK,EAAQ,CACV,EAAGjK,GAAQ,KAAOA,GAAQ,OAC1B,EAAGA,GAAQ,KAAOA,GAAQ,MAC5B,EACIkK,GAAQ,SAAeC,GAAM,CAC/B,OAAQA,GAAM,CACZ,KAAKhS,EACCyR,GAAQK,EAAM,EAAIxG,KACpBwG,EAAM,EAAIxG,GAAWmG,IAEvB,MACF,KAAKxR,EACCyQ,EAAOoB,EAAM,EAAIH,KACnBG,EAAM,EAAIH,GAAUjB,GAEtB,MACF,KAAKvQ,EACCwQ,EAAMmB,EAAM,EAAIF,KAClBE,EAAM,EAAIF,GAASjB,GAErB,MACF,KAAKzQ,EACCwR,GAASI,EAAM,EAAItG,KACrBsG,EAAM,EAAItG,GAAYkG,IAExB,KACJ,CACF,EACA,OAAQJ,EAAQ,CAEd,KAAK1R,EACH8Q,GAAQoB,EAAM,EACdnB,GAAOmB,EAAM,EACb,MAGF,KAAK9R,EACH,GAAI8R,EAAM,GAAK,IAAML,IAASnG,IAAYlC,IAAgBuH,GAAOiB,IAAUF,IAAUlG,KAAa,CAChGqG,GAAa,GACb,KACF,CACAE,GAAM/R,CAAW,EACjBsJ,GAASwI,EAAM,EACXxI,EAAQ,IACVgI,EAASrR,EACTqJ,EAAQ,CAACA,EACToH,GAAQpH,GAENF,IACFC,EAASC,EAAQF,EACjBuH,IAAQzB,EAAY,OAAS7F,GAAU,GAEzC,MACF,KAAKlJ,EACH,GAAI2R,EAAM,GAAK,IAAMnB,GAAOiB,IAAUxI,IAAgBsH,GAAQiB,IAAWF,IAASnG,KAAY,CAC5FuG,GAAa,GACb,KACF,CACAE,GAAM5R,CAAY,EAClBkJ,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,EACTzI,EAAS,IACXiI,EAASpR,EACTmJ,EAAS,CAACA,EACVsH,GAAOtH,GAELD,IACFE,EAAQD,EAASD,EACjBsH,IAASxB,EAAY,MAAQ5F,GAAS,GAExC,MACF,KAAKrJ,EACH,GAAI6R,EAAM,GAAK,IAAMpB,GAAQiB,IAAWvI,IAAgBuH,GAAOiB,IAAUF,IAAUlG,KAAa,CAC9FqG,GAAa,GACb,KACF,CACAE,GAAM9R,CAAW,EACjBqJ,GAASwI,EAAM,EACfpB,GAAQoB,EAAM,EACVxI,EAAQ,IACVgI,EAAStR,EACTsJ,EAAQ,CAACA,EACToH,GAAQpH,GAENF,IACFC,EAASC,EAAQF,EACjBuH,IAAQzB,EAAY,OAAS7F,GAAU,GAEzC,MACF,KAAKnJ,EACH,GAAI4R,EAAM,GAAK,IAAMJ,IAAUlG,IAAapC,IAAgBsH,GAAQiB,IAAWF,IAASnG,KAAY,CAClGuG,GAAa,GACb,KACF,CACAE,GAAM7R,CAAY,EAClBmJ,GAAUyI,EAAM,EACZzI,EAAS,IACXiI,EAASnR,EACTkJ,EAAS,CAACA,EACVsH,GAAOtH,GAELD,IACFE,EAAQD,EAASD,EACjBsH,IAASxB,EAAY,MAAQ5F,GAAS,GAExC,MACF,KAAKlJ,EACH,GAAIgJ,EAAa,CACf,GAAI0I,EAAM,GAAK,IAAMnB,GAAOiB,IAAUH,IAASnG,IAAW,CACxDuG,GAAa,GACb,KACF,CACAE,GAAM5R,CAAY,EAClBkJ,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,EACbxI,EAAQD,EAASD,CACnB,MACE2I,GAAM5R,CAAY,EAClB4R,GAAM/R,CAAW,EACb8R,EAAM,GAAK,EACTL,GAAQnG,GACVhC,GAASwI,EAAM,EACNA,EAAM,GAAK,GAAKnB,GAAOiB,KAChCC,GAAa,IAGfvI,GAASwI,EAAM,EAEbA,EAAM,GAAK,EACTnB,EAAMiB,KACRvI,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,IAGfzI,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,GAGbxI,EAAQ,GAAKD,EAAS,GACxBiI,EAAS/Q,GACT8I,EAAS,CAACA,EACVC,EAAQ,CAACA,EACTqH,GAAOtH,EACPqH,GAAQpH,GACCA,EAAQ,GACjBgI,EAASjR,EACTiJ,EAAQ,CAACA,EACToH,GAAQpH,GACCD,EAAS,IAClBiI,EAAShR,EACT+I,EAAS,CAACA,EACVsH,GAAOtH,GAET,MACF,KAAKhJ,EACH,GAAI+I,EAAa,CACf,GAAI0I,EAAM,GAAK,IAAMnB,GAAOiB,IAAUlB,GAAQiB,IAAU,CACtDE,GAAa,GACb,KACF,CACAE,GAAM5R,CAAY,EAClBkJ,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,EACbxI,EAAQD,EAASD,EACjBsH,GAAQxB,EAAY,MAAQ5F,CAC9B,MACEyI,GAAM5R,CAAY,EAClB4R,GAAM9R,CAAW,EACb6R,EAAM,GAAK,EACTpB,EAAOiB,IACTrI,GAASwI,EAAM,EACfpB,GAAQoB,EAAM,GACLA,EAAM,GAAK,GAAKnB,GAAOiB,KAChCC,GAAa,KAGfvI,GAASwI,EAAM,EACfpB,GAAQoB,EAAM,GAEZA,EAAM,GAAK,EACTnB,EAAMiB,KACRvI,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,IAGfzI,GAAUyI,EAAM,EAChBnB,GAAOmB,EAAM,GAGbxI,EAAQ,GAAKD,EAAS,GACxBiI,EAAShR,EACT+I,EAAS,CAACA,EACVC,EAAQ,CAACA,EACTqH,GAAOtH,EACPqH,GAAQpH,GACCA,EAAQ,GACjBgI,EAASlR,EACTkJ,EAAQ,CAACA,EACToH,GAAQpH,GACCD,EAAS,IAClBiI,EAAS/Q,GACT8I,EAAS,CAACA,EACVsH,GAAOtH,GAET,MACF,KAAK9I,GACH,GAAI6I,EAAa,CACf,GAAI0I,EAAM,GAAK,IAAMpB,GAAQiB,IAAWD,IAAUlG,IAAY,CAC5DqG,GAAa,GACb,KACF,CACAE,GAAM9R,CAAW,EACjBqJ,GAASwI,EAAM,EACfpB,GAAQoB,EAAM,EACdzI,EAASC,EAAQF,CACnB,MACE2I,GAAM7R,CAAY,EAClB6R,GAAM9R,CAAW,EACb6R,EAAM,GAAK,EACTpB,EAAOiB,IACTrI,GAASwI,EAAM,EACfpB,GAAQoB,EAAM,GACLA,EAAM,GAAK,GAAKJ,IAAUlG,KACnCqG,GAAa,KAGfvI,GAASwI,EAAM,EACfpB,GAAQoB,EAAM,GAEZA,EAAM,GAAK,EACTJ,GAASlG,KACXnC,GAAUyI,EAAM,GAGlBzI,GAAUyI,EAAM,EAGhBxI,EAAQ,GAAKD,EAAS,GACxBiI,EAASlR,EACTiJ,EAAS,CAACA,EACVC,EAAQ,CAACA,EACTqH,GAAOtH,EACPqH,GAAQpH,GACCA,EAAQ,GACjBgI,EAAShR,EACTgJ,EAAQ,CAACA,EACToH,GAAQpH,GACCD,EAAS,IAClBiI,EAASjR,EACTgJ,EAAS,CAACA,EACVsH,GAAOtH,GAET,MACF,KAAK/I,EACH,GAAI8I,EAAa,CACf,GAAI0I,EAAM,GAAK,IAAML,IAASnG,IAAYoG,IAAUlG,IAAY,CAC9DqG,GAAa,GACb,KACF,CACAE,GAAM/R,CAAW,EACjBsJ,GAASwI,EAAM,EACfzI,EAASC,EAAQF,CACnB,MACE2I,GAAM7R,CAAY,EAClB6R,GAAM/R,CAAW,EACb8R,EAAM,GAAK,EACTL,GAAQnG,GACVhC,GAASwI,EAAM,EACNA,EAAM,GAAK,GAAKJ,IAAUlG,KACnCqG,GAAa,IAGfvI,GAASwI,EAAM,EAEbA,EAAM,GAAK,EACTJ,GAASlG,KACXnC,GAAUyI,EAAM,GAGlBzI,GAAUyI,EAAM,EAGhBxI,EAAQ,GAAKD,EAAS,GACxBiI,EAASjR,EACTgJ,EAAS,CAACA,EACVC,EAAQ,CAACA,EACTqH,GAAOtH,EACPqH,GAAQpH,GACCA,EAAQ,GACjBgI,EAAS/Q,GACT+I,EAAQ,CAACA,EACToH,GAAQpH,GACCD,EAAS,IAClBiI,EAASlR,EACTiJ,EAAS,CAACA,EACVsH,GAAOtH,GAET,MAGF,KAAKvJ,EACH,KAAK,KAAKgS,EAAM,EAAGA,EAAM,CAAC,EAC1BD,GAAa,GACb,MAGF,KAAK9R,EACH,KAAK,KAAK0H,GAAgBC,CAAQ,EAAG3B,CAAK,EAC1C8L,GAAa,GACb,MAGF,KAAKhS,EACH,GAAI,CAACiS,EAAM,GAAK,CAACA,EAAM,EAAG,CACxBD,GAAa,GACb,KACF,CACA/D,GAASvH,GAAU,KAAK,OAAO,EAC/BmK,EAAO7I,GAAQ,OAASiG,GAAO,KAC/B6C,EAAM9I,GAAQ,OAASiG,GAAO,IAC9BxE,EAAQ4F,EAAY,SACpB7F,EAAS6F,EAAY,UACjB4C,EAAM,EAAI,EACZR,EAASQ,EAAM,EAAI,EAAIxR,EAAoBF,EAClC0R,EAAM,EAAI,IACnBpB,GAAQpH,EACRgI,EAASQ,EAAM,EAAI,EAAIvR,GAAoBF,GAEzCyR,EAAM,EAAI,IACZnB,GAAOtH,GAIJ,KAAK,UACRxE,GAAY,KAAK,QAASnE,CAAY,EACtC,KAAK,QAAU,GACX,KAAK,SACP,KAAK,aAAa,GAAM,EAAI,GAGhC,KACJ,CACImR,KACF3C,EAAY,MAAQ5F,EACpB4F,EAAY,OAAS7F,EACrB6F,EAAY,KAAOwB,EACnBxB,EAAY,IAAMyB,EAClB,KAAK,OAASW,EACd,KAAK,cAAc,GAIrB7N,GAAQiE,EAAU,SAAUuK,GAAG,CAC7BA,GAAE,OAASA,GAAE,KACbA,GAAE,OAASA,GAAE,IACf,CAAC,CACH,CACF,EAEIC,GAAU,CAEZ,KAAM,UAAgB,CACpB,OAAI,KAAK,OAAS,CAAC,KAAK,SAAW,CAAC,KAAK,WACvC,KAAK,QAAU,GACf,KAAK,aAAa,GAAM,EAAI,EACxB,KAAK,QAAQ,OACfxN,GAAS,KAAK,QAAS7D,CAAW,EAEpCgE,GAAY,KAAK,QAASnE,CAAY,EACtC,KAAK,eAAe,KAAK,kBAAkB,GAEtC,IACT,EAEA,MAAO,UAAiB,CACtB,OAAI,KAAK,OAAS,CAAC,KAAK,WACtB,KAAK,UAAYkD,GAAO,CAAC,EAAG,KAAK,gBAAgB,EACjD,KAAK,WAAaA,GAAO,CAAC,EAAG,KAAK,iBAAiB,EACnD,KAAK,YAAcA,GAAO,CAAC,EAAG,KAAK,kBAAkB,EACrD,KAAK,aAAa,EACd,KAAK,SACP,KAAK,cAAc,GAGhB,IACT,EAEA,MAAO,UAAiB,CACtB,OAAI,KAAK,SAAW,CAAC,KAAK,WACxBA,GAAO,KAAK,YAAa,CACvB,KAAM,EACN,IAAK,EACL,MAAO,EACP,OAAQ,CACV,CAAC,EACD,KAAK,QAAU,GACf,KAAK,cAAc,EACnB,KAAK,YAAY,GAAM,EAAI,EAG3B,KAAK,aAAa,EAClBiB,GAAY,KAAK,QAAShE,CAAW,EACrC6D,GAAS,KAAK,QAAShE,CAAY,GAE9B,IACT,EAOA,QAAS,SAAiBkG,EAAK,CAC7B,IAAIuL,EAAc,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,GACtF,MAAI,CAAC,KAAK,UAAYvL,IAChB,KAAK,QACP,KAAK,QAAQ,IAAMA,GAEjBuL,GACF,KAAK,IAAMvL,EACX,KAAK,MAAM,IAAMA,EACb,KAAK,QACP,KAAK,aAAa,IAAMA,EACxBnD,GAAQ,KAAK,SAAU,SAAUY,EAAS,CACxCA,EAAQ,qBAAqB,KAAK,EAAE,CAAC,EAAE,IAAMuC,CAC/C,CAAC,KAGC,KAAK,QACP,KAAK,SAAW,IAElB,KAAK,QAAQ,KAAO,KACpB,KAAK,SAAS,EACd,KAAK,KAAKA,CAAG,IAGV,IACT,EAEA,OAAQ,UAAkB,CACxB,OAAI,KAAK,OAAS,KAAK,WACrB,KAAK,SAAW,GAChB/B,GAAY,KAAK,QAASpE,CAAc,GAEnC,IACT,EAEA,QAAS,UAAmB,CAC1B,OAAI,KAAK,OAAS,CAAC,KAAK,WACtB,KAAK,SAAW,GAChBiE,GAAS,KAAK,QAASjE,CAAc,GAEhC,IACT,EAKA,QAAS,UAAmB,CAC1B,IAAI4D,EAAU,KAAK,QACnB,OAAKA,EAAQ1E,CAAS,GAGtB0E,EAAQ1E,CAAS,EAAI,OACjB,KAAK,OAAS,KAAK,WACrB0E,EAAQ,IAAM,KAAK,aAErB,KAAK,SAAS,EACP,MAPE,IAQX,EAOA,KAAM,SAAc+N,EAAS,CAC3B,IAAIC,EAAU,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAID,EAC9EE,EAAmB,KAAK,WAC1B5B,EAAO4B,EAAiB,KACxB3B,EAAM2B,EAAiB,IACzB,OAAO,KAAK,OAAOvP,GAAYqP,CAAO,EAAIA,EAAU1B,EAAO,OAAO0B,CAAO,EAAGrP,GAAYsP,CAAO,EAAIA,EAAU1B,EAAM,OAAO0B,CAAO,CAAC,CACpI,EAOA,OAAQ,SAAgBE,EAAG,CACzB,IAAIC,EAAI,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAID,EACxExD,EAAa,KAAK,WAClBU,EAAU,GACd,OAAA8C,EAAI,OAAOA,CAAC,EACZC,EAAI,OAAOA,CAAC,EACR,KAAK,OAAS,CAAC,KAAK,UAAY,KAAK,QAAQ,UAC3C3P,GAAS0P,CAAC,IACZxD,EAAW,KAAOwD,EAClB9C,EAAU,IAER5M,GAAS2P,CAAC,IACZzD,EAAW,IAAMyD,EACjB/C,EAAU,IAERA,GACF,KAAK,aAAa,EAAI,GAGnB,IACT,EAOA,KAAM,SAAcnH,EAAOmK,EAAgB,CACzC,IAAI1D,EAAa,KAAK,WACtB,OAAAzG,EAAQ,OAAOA,CAAK,EAChBA,EAAQ,EACVA,EAAQ,GAAK,EAAIA,GAEjBA,EAAQ,EAAIA,EAEP,KAAK,OAAOyG,EAAW,MAAQzG,EAAQyG,EAAW,aAAc,KAAM0D,CAAc,CAC7F,EAQA,OAAQ,SAAgBnK,EAAOoK,EAAOD,EAAgB,CACpD,IAAI9M,EAAU,KAAK,QACjBoJ,EAAa,KAAK,WAChBzF,EAAQyF,EAAW,MACrB1F,EAAS0F,EAAW,OACpBlE,EAAekE,EAAW,aAC1BjE,EAAgBiE,EAAW,cAE7B,GADAzG,EAAQ,OAAOA,CAAK,EAChBA,GAAS,GAAK,KAAK,OAAS,CAAC,KAAK,UAAY3C,EAAQ,SAAU,CAClE,IAAIqE,EAAWa,EAAevC,EAC1B2B,EAAYa,EAAgBxC,EAChC,GAAIhC,GAAc,KAAK,QAASpE,GAAY,CAC1C,MAAOoG,EACP,SAAUgB,EAAQuB,EAClB,cAAe4H,CACjB,CAAC,IAAM,GACL,OAAO,KAET,GAAIA,EAAgB,CAClB,IAAI/K,EAAW,KAAK,SAChBoG,GAASvH,GAAU,KAAK,OAAO,EAC/BoM,GAASjL,GAAY,OAAO,KAAKA,CAAQ,EAAE,OAASmB,GAAkBnB,CAAQ,EAAI,CACpF,MAAO+K,EAAe,MACtB,MAAOA,EAAe,KACxB,EAGA1D,EAAW,OAAS/E,EAAWV,KAAWqJ,GAAO,MAAQ7E,GAAO,KAAOiB,EAAW,MAAQzF,GAC1FyF,EAAW,MAAQ9E,EAAYZ,KAAYsJ,GAAO,MAAQ7E,GAAO,IAAMiB,EAAW,KAAO1F,EAC3F,MAAWnG,GAAcwP,CAAK,GAAK7P,GAAS6P,EAAM,CAAC,GAAK7P,GAAS6P,EAAM,CAAC,GACtE3D,EAAW,OAAS/E,EAAWV,KAAWoJ,EAAM,EAAI3D,EAAW,MAAQzF,GACvEyF,EAAW,MAAQ9E,EAAYZ,KAAYqJ,EAAM,EAAI3D,EAAW,KAAO1F,KAGvE0F,EAAW,OAAS/E,EAAWV,GAAS,EACxCyF,EAAW,MAAQ9E,EAAYZ,GAAU,GAE3C0F,EAAW,MAAQ/E,EACnB+E,EAAW,OAAS9E,EACpB,KAAK,aAAa,EAAI,CACxB,CACA,OAAO,IACT,EAMA,OAAQ,SAAgBL,EAAQ,CAC9B,OAAO,KAAK,UAAU,KAAK,UAAU,QAAU,GAAK,OAAOA,CAAM,CAAC,CACpE,EAMA,SAAU,SAAkBA,EAAQ,CAClC,OAAAA,EAAS,OAAOA,CAAM,EAClB/G,GAAS+G,CAAM,GAAK,KAAK,OAAS,CAAC,KAAK,UAAY,KAAK,QAAQ,YACnE,KAAK,UAAU,OAASA,EAAS,IACjC,KAAK,aAAa,GAAM,EAAI,GAEvB,IACT,EAMA,OAAQ,SAAgBgJ,EAAS,CAC/B,IAAIxL,EAAS,KAAK,UAAU,OAC5B,OAAO,KAAK,MAAMwL,EAAS/P,GAASuE,CAAM,EAAIA,EAAS,CAAC,CAC1D,EAMA,OAAQ,SAAgByL,EAAS,CAC/B,IAAI1L,EAAS,KAAK,UAAU,OAC5B,OAAO,KAAK,MAAMtE,GAASsE,CAAM,EAAIA,EAAS,EAAG0L,CAAO,CAC1D,EAOA,MAAO,SAAe1L,EAAQ,CAC5B,IAAIC,EAAS,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAID,EAC7EuH,EAAY,KAAK,UACjBgB,EAAc,GAClB,OAAAvI,EAAS,OAAOA,CAAM,EACtBC,EAAS,OAAOA,CAAM,EAClB,KAAK,OAAS,CAAC,KAAK,UAAY,KAAK,QAAQ,WAC3CvE,GAASsE,CAAM,IACjBuH,EAAU,OAASvH,EACnBuI,EAAc,IAEZ7M,GAASuE,CAAM,IACjBsH,EAAU,OAAStH,EACnBsI,EAAc,IAEZA,GACF,KAAK,aAAa,GAAM,EAAI,GAGzB,IACT,EAMA,QAAS,UAAmB,CAC1B,IAAIoD,EAAU,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,GAC9EnN,EAAU,KAAK,QACjB+I,EAAY,KAAK,UACjBK,EAAa,KAAK,WAClBG,EAAc,KAAK,YACjBxL,EACJ,GAAI,KAAK,OAAS,KAAK,QAAS,CAC9BA,EAAO,CACL,EAAGwL,EAAY,KAAOH,EAAW,KACjC,EAAGG,EAAY,IAAMH,EAAW,IAChC,MAAOG,EAAY,MACnB,OAAQA,EAAY,MACtB,EACA,IAAI5G,EAAQoG,EAAU,MAAQA,EAAU,aAIxC,GAHAjL,GAAQC,EAAM,SAAU5E,EAAG+N,EAAG,CAC5BnJ,EAAKmJ,CAAC,EAAI/N,EAAIwJ,CAChB,CAAC,EACGwK,EAAS,CAGX,IAAIpB,EAAS,KAAK,MAAMhO,EAAK,EAAIA,EAAK,MAAM,EACxC+N,EAAQ,KAAK,MAAM/N,EAAK,EAAIA,EAAK,KAAK,EAC1CA,EAAK,EAAI,KAAK,MAAMA,EAAK,CAAC,EAC1BA,EAAK,EAAI,KAAK,MAAMA,EAAK,CAAC,EAC1BA,EAAK,MAAQ+N,EAAQ/N,EAAK,EAC1BA,EAAK,OAASgO,EAAShO,EAAK,CAC9B,CACF,MACEA,EAAO,CACL,EAAG,EACH,EAAG,EACH,MAAO,EACP,OAAQ,CACV,EAEF,OAAIiC,EAAQ,YACVjC,EAAK,OAASgL,EAAU,QAAU,GAEhC/I,EAAQ,WACVjC,EAAK,OAASgL,EAAU,QAAU,EAClChL,EAAK,OAASgL,EAAU,QAAU,GAE7BhL,CACT,EAMA,QAAS,SAAiBA,EAAM,CAC9B,IAAIiC,EAAU,KAAK,QACjB+I,EAAY,KAAK,UACjBK,EAAa,KAAK,WAChBG,EAAc,CAAC,EACnB,GAAI,KAAK,OAAS,CAAC,KAAK,UAAYhM,GAAcQ,CAAI,EAAG,CACvD,IAAIgM,EAAc,GACd/J,EAAQ,WACN9C,GAASa,EAAK,MAAM,GAAKA,EAAK,SAAWgL,EAAU,SACrDA,EAAU,OAAShL,EAAK,OACxBgM,EAAc,IAGd/J,EAAQ,WACN9C,GAASa,EAAK,MAAM,GAAKA,EAAK,SAAWgL,EAAU,SACrDA,EAAU,OAAShL,EAAK,OACxBgM,EAAc,IAEZ7M,GAASa,EAAK,MAAM,GAAKA,EAAK,SAAWgL,EAAU,SACrDA,EAAU,OAAShL,EAAK,OACxBgM,EAAc,KAGdA,GACF,KAAK,aAAa,GAAM,EAAI,EAE9B,IAAIpH,EAAQoG,EAAU,MAAQA,EAAU,aACpC7L,GAASa,EAAK,CAAC,IACjBwL,EAAY,KAAOxL,EAAK,EAAI4E,EAAQyG,EAAW,MAE7ClM,GAASa,EAAK,CAAC,IACjBwL,EAAY,IAAMxL,EAAK,EAAI4E,EAAQyG,EAAW,KAE5ClM,GAASa,EAAK,KAAK,IACrBwL,EAAY,MAAQxL,EAAK,MAAQ4E,GAE/BzF,GAASa,EAAK,MAAM,IACtBwL,EAAY,OAASxL,EAAK,OAAS4E,GAErC,KAAK,eAAe4G,CAAW,CACjC,CACA,OAAO,IACT,EAKA,iBAAkB,UAA4B,CAC5C,OAAO,KAAK,MAAQtL,GAAO,CAAC,EAAG,KAAK,aAAa,EAAI,CAAC,CACxD,EAKA,aAAc,UAAwB,CACpC,OAAO,KAAK,MAAQA,GAAO,CAAC,EAAG,KAAK,SAAS,EAAI,CAAC,CACpD,EAKA,cAAe,UAAyB,CACtC,IAAImL,EAAa,KAAK,WAClBrL,EAAO,CAAC,EACZ,OAAI,KAAK,OACPD,GAAQ,CAAC,OAAQ,MAAO,QAAS,SAAU,eAAgB,eAAe,EAAG,SAAU3E,EAAG,CACxF4E,EAAK5E,CAAC,EAAIiQ,EAAWjQ,CAAC,CACxB,CAAC,EAEI4E,CACT,EAMA,cAAe,SAAuBA,EAAM,CAC1C,IAAIqL,EAAa,KAAK,WAClB3F,EAAc2F,EAAW,YAC7B,OAAI,KAAK,OAAS,CAAC,KAAK,UAAY7L,GAAcQ,CAAI,IAChDb,GAASa,EAAK,IAAI,IACpBqL,EAAW,KAAOrL,EAAK,MAErBb,GAASa,EAAK,GAAG,IACnBqL,EAAW,IAAMrL,EAAK,KAEpBb,GAASa,EAAK,KAAK,GACrBqL,EAAW,MAAQrL,EAAK,MACxBqL,EAAW,OAASrL,EAAK,MAAQ0F,GACxBvG,GAASa,EAAK,MAAM,IAC7BqL,EAAW,OAASrL,EAAK,OACzBqL,EAAW,MAAQrL,EAAK,OAAS0F,GAEnC,KAAK,aAAa,EAAI,GAEjB,IACT,EAKA,eAAgB,UAA0B,CACxC,IAAI8F,EAAc,KAAK,YACnBxL,EACJ,OAAI,KAAK,OAAS,KAAK,UACrBA,EAAO,CACL,KAAMwL,EAAY,KAClB,IAAKA,EAAY,IACjB,MAAOA,EAAY,MACnB,OAAQA,EAAY,MACtB,GAEKxL,GAAQ,CAAC,CAClB,EAMA,eAAgB,SAAwBA,EAAM,CAC5C,IAAIwL,EAAc,KAAK,YACnB9F,EAAc,KAAK,QAAQ,YAC3B2J,EACAC,EACJ,OAAI,KAAK,OAAS,KAAK,SAAW,CAAC,KAAK,UAAY9P,GAAcQ,CAAI,IAChEb,GAASa,EAAK,IAAI,IACpBwL,EAAY,KAAOxL,EAAK,MAEtBb,GAASa,EAAK,GAAG,IACnBwL,EAAY,IAAMxL,EAAK,KAErBb,GAASa,EAAK,KAAK,GAAKA,EAAK,QAAUwL,EAAY,QACrD6D,EAAe,GACf7D,EAAY,MAAQxL,EAAK,OAEvBb,GAASa,EAAK,MAAM,GAAKA,EAAK,SAAWwL,EAAY,SACvD8D,EAAgB,GAChB9D,EAAY,OAASxL,EAAK,QAExB0F,IACE2J,EACF7D,EAAY,OAASA,EAAY,MAAQ9F,EAChC4J,IACT9D,EAAY,MAAQA,EAAY,OAAS9F,IAG7C,KAAK,cAAc,GAEd,IACT,EAMA,iBAAkB,UAA4B,CAC5C,IAAIzD,EAAU,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,CAAC,EACnF,GAAI,CAAC,KAAK,OAAS,CAAC,OAAO,kBACzB,OAAO,KAET,IAAIoJ,EAAa,KAAK,WAClBkE,EAAS/I,GAAgB,KAAK,MAAO,KAAK,UAAW6E,EAAYpJ,CAAO,EAG5E,GAAI,CAAC,KAAK,QACR,OAAOsN,EAET,IAAIC,EAAgB,KAAK,QAAQvN,EAAQ,OAAO,EAC9CwN,EAAWD,EAAc,EACzBE,EAAWF,EAAc,EACzBG,EAAeH,EAAc,MAC7BI,EAAgBJ,EAAc,OAC5B5K,EAAQ2K,EAAO,MAAQ,KAAK,MAAMlE,EAAW,YAAY,EACzDzG,IAAU,IACZ6K,GAAY7K,EACZ8K,GAAY9K,EACZ+K,GAAgB/K,EAChBgL,GAAiBhL,GAEnB,IAAIc,EAAciK,EAAeC,EAC7BvH,EAAW7C,GAAiB,CAC9B,YAAaE,EACb,MAAOzD,EAAQ,UAAY,IAC3B,OAAQA,EAAQ,WAAa,GAC/B,CAAC,EACGqG,EAAW9C,GAAiB,CAC9B,YAAaE,EACb,MAAOzD,EAAQ,UAAY,EAC3B,OAAQA,EAAQ,WAAa,CAC/B,EAAG,OAAO,EACN2J,GAAoBpG,GAAiB,CACrC,YAAaE,EACb,MAAOzD,EAAQ,QAAU2C,IAAU,EAAI2K,EAAO,MAAQI,GACtD,OAAQ1N,EAAQ,SAAW2C,IAAU,EAAI2K,EAAO,OAASK,EAC3D,CAAC,EACDhK,GAAQgG,GAAkB,MAC1BjG,GAASiG,GAAkB,OAC7BhG,GAAQ,KAAK,IAAIyC,EAAS,MAAO,KAAK,IAAIC,EAAS,MAAO1C,EAAK,CAAC,EAChED,GAAS,KAAK,IAAI0C,EAAS,OAAQ,KAAK,IAAIC,EAAS,OAAQ3C,EAAM,CAAC,EACpE,IAAIwC,GAAS,SAAS,cAAc,QAAQ,EACxCC,GAAUD,GAAO,WAAW,IAAI,EACpCA,GAAO,MAAQ5H,GAAuBqF,EAAK,EAC3CuC,GAAO,OAAS5H,GAAuBoF,EAAM,EAC7CyC,GAAQ,UAAYnG,EAAQ,WAAa,cACzCmG,GAAQ,SAAS,EAAG,EAAGxC,GAAOD,EAAM,EACpC,IAAIkK,GAAwB5N,EAAQ,sBAClCuF,GAAwBqI,KAA0B,OAAS,GAAOA,GAClEnI,GAAwBzF,EAAQ,sBAClCmG,GAAQ,sBAAwBZ,GAC5BE,KACFU,GAAQ,sBAAwBV,IAIlC,IAAIoI,GAAcP,EAAO,MACrBQ,EAAeR,EAAO,OAGtBS,GAAOP,EACPQ,GAAOP,EACPQ,GACAC,GAGAC,GACAC,GACAC,GACAC,GACAP,IAAQ,CAACL,GAAgBK,GAAOF,IAClCE,GAAO,EACPE,GAAW,EACXE,GAAO,EACPE,GAAW,GACFN,IAAQ,GACjBI,GAAO,CAACJ,GACRA,GAAO,EACPE,GAAW,KAAK,IAAIJ,GAAaH,EAAeK,EAAI,EACpDM,GAAWJ,IACFF,IAAQF,KACjBM,GAAO,EACPF,GAAW,KAAK,IAAIP,EAAcG,GAAcE,EAAI,EACpDM,GAAWJ,IAETA,IAAY,GAAKD,IAAQ,CAACL,GAAiBK,GAAOF,GACpDE,GAAO,EACPE,GAAY,EACZE,GAAO,EACPE,GAAY,GACHN,IAAQ,GACjBI,GAAO,CAACJ,GACRA,GAAO,EACPE,GAAY,KAAK,IAAIJ,EAAcH,EAAgBK,EAAI,EACvDM,GAAYJ,IACHF,IAAQF,IACjBM,GAAO,EACPF,GAAY,KAAK,IAAIP,EAAeG,EAAeE,EAAI,EACvDM,GAAYJ,IAEd,IAAIxH,GAAS,CAACqH,GAAMC,GAAMC,GAAUC,EAAS,EAG7C,GAAIG,GAAW,GAAKC,GAAY,EAAG,CACjC,IAAIC,GAAQ5K,GAAQ+J,EACpBhH,GAAO,KAAKyH,GAAOI,GAAOH,GAAOG,GAAOF,GAAWE,GAAOD,GAAYC,EAAK,CAC7E,CAIA,OAAApI,GAAQ,UAAU,MAAMA,GAAS,CAACmH,CAAM,EAAE,OAAO5U,EAAmBgO,GAAO,IAAI,SAAUC,GAAO,CAC9F,OAAO,KAAK,MAAMrI,GAAuBqI,EAAK,CAAC,CACjD,CAAC,CAAC,CAAC,CAAC,EACGT,EACT,EAMA,eAAgB,SAAwBzC,EAAa,CACnD,IAAIzD,EAAU,KAAK,QACnB,MAAI,CAAC,KAAK,UAAY,CAAC5C,GAAYqG,CAAW,IAE5CzD,EAAQ,YAAc,KAAK,IAAI,EAAGyD,CAAW,GAAK,IAC9C,KAAK,QACP,KAAK,YAAY,EACb,KAAK,SACP,KAAK,cAAc,IAIlB,IACT,EAMA,YAAa,SAAqB+K,EAAM,CACtC,IAAIxO,EAAU,KAAK,QACjByO,EAAU,KAAK,QACfC,EAAO,KAAK,KACd,GAAI,KAAK,OAAS,CAAC,KAAK,SAAU,CAChC,IAAIC,EAAYH,IAASlT,GACrBsT,EAAU5O,EAAQ,SAAWwO,IAASjT,GAC1CiT,EAAOG,GAAaC,EAAUJ,EAAOhT,GACrCwE,EAAQ,SAAWwO,EACnB/O,GAAQgP,EAASrT,EAAaoT,CAAI,EAClCrP,GAAYsP,EAAS5T,GAAY8T,CAAS,EAC1CxP,GAAYsP,EAAStT,GAAYyT,CAAO,EACnC5O,EAAQ,iBAEXP,GAAQiP,EAAMtT,EAAaoT,CAAI,EAC/BrP,GAAYuP,EAAM7T,GAAY8T,CAAS,EACvCxP,GAAYuP,EAAMvT,GAAYyT,CAAO,EAEzC,CACA,OAAO,IACT,CACF,EAEIC,GAAiBhV,EAAO,QACxBiV,GAAuB,UAAY,CAMrC,SAASA,EAAQpQ,EAAS,CACxB,IAAIsB,EAAU,UAAU,OAAS,GAAK,UAAU,CAAC,IAAM,OAAY,UAAU,CAAC,EAAI,CAAC,EAEnF,GADApI,EAAgB,KAAMkX,CAAO,EACzB,CAACpQ,GAAW,CAAC9B,GAAgB,KAAK8B,EAAQ,OAAO,EACnD,MAAM,IAAI,MAAM,0EAA0E,EAE5F,KAAK,QAAUA,EACf,KAAK,QAAUT,GAAO,CAAC,EAAGlB,GAAUQ,GAAcyC,CAAO,GAAKA,CAAO,EACrE,KAAK,QAAU,GACf,KAAK,SAAW,GAChB,KAAK,SAAW,CAAC,EACjB,KAAK,MAAQ,GACb,KAAK,UAAY,GACjB,KAAK,SAAW,GAChB,KAAK,MAAQ,GACb,KAAK,OAAS,GACd,KAAK,KAAK,CACZ,CACA,OAAA5H,EAAa0W,EAAS,CAAC,CACrB,IAAK,OACL,MAAO,UAAgB,CACrB,IAAIpQ,EAAU,KAAK,QACfqQ,EAAUrQ,EAAQ,QAAQ,YAAY,EACtCuC,EACJ,GAAI,CAAAvC,EAAQ1E,CAAS,EAIrB,IADA0E,EAAQ1E,CAAS,EAAI,KACjB+U,IAAY,MAAO,CAQrB,GAPA,KAAK,MAAQ,GAGb9N,EAAMvC,EAAQ,aAAa,KAAK,GAAK,GACrC,KAAK,YAAcuC,EAGf,CAACA,EACH,OAIFA,EAAMvC,EAAQ,GAChB,MAAWqQ,IAAY,UAAY,OAAO,oBACxC9N,EAAMvC,EAAQ,UAAU,GAE1B,KAAK,KAAKuC,CAAG,EACf,CACF,EAAG,CACD,IAAK,OACL,MAAO,SAAcA,EAAK,CACxB,IAAIsK,EAAQ,KACZ,GAAKtK,EAGL,MAAK,IAAMA,EACX,KAAK,UAAY,CAAC,EAClB,IAAIvC,EAAU,KAAK,QACjBsB,EAAU,KAAK,QAMjB,GALI,CAACA,EAAQ,WAAa,CAACA,EAAQ,WACjCA,EAAQ,iBAAmB,IAIzB,CAACA,EAAQ,kBAAoB,CAAC,OAAO,YAAa,CACpD,KAAK,MAAM,EACX,MACF,CAGA,GAAItD,GAAgB,KAAKuE,CAAG,EAAG,CAEzBtE,GAAqB,KAAKsE,CAAG,EAC/B,KAAK,KAAKmG,GAAqBnG,CAAG,CAAC,EAInC,KAAK,MAAM,EAEb,MACF,CAIA,IAAI+N,EAAM,IAAI,eACVC,EAAQ,KAAK,MAAM,KAAK,IAAI,EAChC,KAAK,UAAY,GACjB,KAAK,IAAMD,EAMXA,EAAI,QAAUC,EACdD,EAAI,QAAUC,EACdD,EAAI,UAAYC,EAChBD,EAAI,WAAa,UAAY,CAEvBA,EAAI,kBAAkB,cAAc,IAAMxS,IAC5CwS,EAAI,MAAM,CAEd,EACAA,EAAI,OAAS,UAAY,CACvBzD,EAAM,KAAKyD,EAAI,QAAQ,CACzB,EACAA,EAAI,UAAY,UAAY,CAC1BzD,EAAM,UAAY,GAClBA,EAAM,IAAM,IACd,EAGIvL,EAAQ,kBAAoBgB,GAAiBC,CAAG,GAAKvC,EAAQ,cAC/DuC,EAAME,GAAaF,CAAG,GAIxB+N,EAAI,KAAK,MAAO/N,EAAK,EAAI,EACzB+N,EAAI,aAAe,cACnBA,EAAI,gBAAkBtQ,EAAQ,cAAgB,kBAC9CsQ,EAAI,KAAK,EACX,CACF,EAAG,CACD,IAAK,OACL,MAAO,SAAcxH,EAAa,CAChC,IAAIxH,EAAU,KAAK,QACjB+I,EAAY,KAAK,UAIfhB,EAAcD,GAAuBN,CAAW,EAChDjG,EAAS,EACTC,EAAS,EACTC,EAAS,EACb,GAAIsG,EAAc,EAAG,CAEnB,KAAK,IAAML,GAAqBF,EAAahL,EAAc,EAC3D,IAAI0S,EAAoBxG,GAAiBX,CAAW,EACpDxG,EAAS2N,EAAkB,OAC3B1N,EAAS0N,EAAkB,OAC3BzN,EAASyN,EAAkB,MAC7B,CACIlP,EAAQ,YACV+I,EAAU,OAASxH,GAEjBvB,EAAQ,WACV+I,EAAU,OAASvH,EACnBuH,EAAU,OAAStH,GAErB,KAAK,MAAM,CACb,CACF,EAAG,CACD,IAAK,QACL,MAAO,UAAiB,CACtB,IAAI/C,EAAU,KAAK,QACjBuC,EAAM,KAAK,IACTuJ,EAAc9L,EAAQ,YACtByQ,EAAiBlO,EACjB,KAAK,QAAQ,kBAAoBD,GAAiBC,CAAG,IAClDuJ,IACHA,EAAc,aAIhB2E,EAAiBhO,GAAaF,CAAG,GAEnC,KAAK,YAAcuJ,EACnB,KAAK,eAAiB2E,EACtB,IAAI3K,EAAQ,SAAS,cAAc,KAAK,EACpCgG,IACFhG,EAAM,YAAcgG,GAEtBhG,EAAM,IAAM2K,GAAkBlO,EAC9BuD,EAAM,IAAM9F,EAAQ,KAAO,oBAC3B,KAAK,MAAQ8F,EACbA,EAAM,OAAS,KAAK,MAAM,KAAK,IAAI,EACnCA,EAAM,QAAU,KAAK,KAAK,KAAK,IAAI,EACnCzF,GAASyF,EAAOxJ,CAAU,EAC1B0D,EAAQ,WAAW,aAAa8F,EAAO9F,EAAQ,WAAW,CAC5D,CACF,EAAG,CACD,IAAK,QACL,MAAO,UAAiB,CACtB,IAAI0Q,EAAS,KACT5K,EAAQ,KAAK,MACjBA,EAAM,OAAS,KACfA,EAAM,QAAU,KAChB,KAAK,OAAS,GAId,IAAI6K,EAAcxV,EAAO,WAAa,sCAAsC,KAAKA,EAAO,UAAU,SAAS,EACvGyV,EAAO,SAAcpK,EAAcC,EAAe,CACpDlH,GAAOmR,EAAO,UAAW,CACvB,aAAclK,EACd,cAAeC,EACf,YAAaD,EAAeC,CAC9B,CAAC,EACDiK,EAAO,iBAAmBnR,GAAO,CAAC,EAAGmR,EAAO,SAAS,EACrDA,EAAO,OAAS,GAChBA,EAAO,MAAQ,GACfA,EAAO,MAAM,CACf,EAGA,GAAI5K,EAAM,cAAgB,CAAC6K,EAAa,CACtCC,EAAK9K,EAAM,aAAcA,EAAM,aAAa,EAC5C,MACF,CACA,IAAI+K,EAAc,SAAS,cAAc,KAAK,EAC1CC,EAAO,SAAS,MAAQ,SAAS,gBACrC,KAAK,YAAcD,EACnBA,EAAY,OAAS,UAAY,CAC/BD,EAAKC,EAAY,MAAOA,EAAY,MAAM,EACrCF,GACHG,EAAK,YAAYD,CAAW,CAEhC,EACAA,EAAY,IAAM/K,EAAM,IAInB6K,IACHE,EAAY,MAAM,QAAU,uJAC5BC,EAAK,YAAYD,CAAW,EAEhC,CACF,EAAG,CACD,IAAK,OACL,MAAO,UAAgB,CACrB,IAAI/K,EAAQ,KAAK,MACjBA,EAAM,OAAS,KACfA,EAAM,QAAU,KAChBA,EAAM,WAAW,YAAYA,CAAK,EAClC,KAAK,MAAQ,IACf,CACF,EAAG,CACD,IAAK,QACL,MAAO,UAAiB,CACtB,GAAI,GAAC,KAAK,OAAS,KAAK,OAGxB,KAAI9F,EAAU,KAAK,QACjBsB,EAAU,KAAK,QACfwE,EAAQ,KAAK,MAGXoE,EAAYlK,EAAQ,WACpB+Q,EAAW,SAAS,cAAc,KAAK,EAC3CA,EAAS,UAAYzS,GACrB,IAAI6L,EAAU4G,EAAS,cAAc,IAAI,OAAOzV,EAAW,YAAY,CAAC,EACpEkM,EAAS2C,EAAQ,cAAc,IAAI,OAAO7O,EAAW,SAAS,CAAC,EAC/DyU,EAAU5F,EAAQ,cAAc,IAAI,OAAO7O,EAAW,WAAW,CAAC,EAClE0V,EAAU7G,EAAQ,cAAc,IAAI,OAAO7O,EAAW,WAAW,CAAC,EAClE0U,EAAOgB,EAAQ,cAAc,IAAI,OAAO1V,EAAW,OAAO,CAAC,EAC/D,KAAK,UAAY4O,EACjB,KAAK,QAAUC,EACf,KAAK,OAAS3C,EACd,KAAK,QAAUuI,EACf,KAAK,QAAUiB,EACf,KAAK,QAAU7G,EAAQ,cAAc,IAAI,OAAO7O,EAAW,WAAW,CAAC,EACvE,KAAK,KAAO0U,EACZxI,EAAO,YAAY1B,CAAK,EAGxBzF,GAASL,EAAS3D,CAAY,EAG9B6N,EAAU,aAAaC,EAASnK,EAAQ,WAAW,EAGnDQ,GAAYsF,EAAOxJ,CAAU,EAC7B,KAAK,YAAY,EACjB,KAAK,KAAK,EACVgF,EAAQ,mBAAqB,KAAK,IAAI,EAAGA,EAAQ,kBAAkB,GAAK,IACxEA,EAAQ,YAAc,KAAK,IAAI,EAAGA,EAAQ,WAAW,GAAK,IAC1DA,EAAQ,SAAW,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,MAAMA,EAAQ,QAAQ,CAAC,CAAC,GAAK,EAC7EjB,GAAS2Q,EAAS3U,CAAY,EACzBiF,EAAQ,QACXjB,GAAS2Q,EAAQ,uBAAuB,GAAG,OAAO1V,EAAW,SAAS,CAAC,EAAGe,CAAY,EAEnFiF,EAAQ,QACXjB,GAAS2Q,EAAQ,uBAAuB,GAAG,OAAO1V,EAAW,SAAS,CAAC,EAAGe,CAAY,EAEpFiF,EAAQ,YACVjB,GAAS8J,EAAS,GAAG,OAAO7O,EAAW,KAAK,CAAC,EAE1CgG,EAAQ,WACXjB,GAAS2P,EAAMzT,CAAe,EAE5B+E,EAAQ,iBACVjB,GAAS2P,EAAMvT,EAAU,EACzBsE,GAAQiP,EAAMtT,EAAanB,CAAU,GAElC+F,EAAQ,mBACXjB,GAAS2Q,EAAQ,uBAAuB,GAAG,OAAO1V,EAAW,OAAO,CAAC,EAAGe,CAAY,EACpFgE,GAAS2Q,EAAQ,uBAAuB,GAAG,OAAO1V,EAAW,QAAQ,CAAC,EAAGe,CAAY,GAEvF,KAAK,OAAO,EACZ,KAAK,MAAQ,GACb,KAAK,YAAYiF,EAAQ,QAAQ,EAC7BA,EAAQ,UACV,KAAK,KAAK,EAEZ,KAAK,QAAQA,EAAQ,IAAI,EACrBrC,GAAWqC,EAAQ,KAAK,GAC1BM,GAAY5B,EAAStC,GAAa4D,EAAQ,MAAO,CAC/C,KAAM,EACR,CAAC,EAEHW,GAAcjC,EAAStC,EAAW,EACpC,CACF,EAAG,CACD,IAAK,UACL,MAAO,UAAmB,CACxB,GAAK,KAAK,MAGV,MAAK,MAAQ,GACb,KAAK,OAAO,EACZ,KAAK,aAAa,EAClB,IAAIuT,EAAa,KAAK,QAAQ,WAC1BA,GACFA,EAAW,YAAY,KAAK,OAAO,EAErCzQ,GAAY,KAAK,QAASnE,CAAY,EACxC,CACF,EAAG,CACD,IAAK,WACL,MAAO,UAAoB,CACrB,KAAK,OACP,KAAK,QAAQ,EACb,KAAK,MAAQ,GACb,KAAK,QAAU,IACN,KAAK,QACd,KAAK,YAAY,OAAS,KAC1B,KAAK,OAAS,GACd,KAAK,MAAQ,IACJ,KAAK,WACd,KAAK,IAAI,QAAU,KACnB,KAAK,IAAI,MAAM,GACN,KAAK,OACd,KAAK,KAAK,CAEd,CAMF,CAAC,EAAG,CAAC,CACH,IAAK,aACL,MAAO,UAAsB,CAC3B,cAAO,QAAU8T,GACVC,CACT,CAMF,EAAG,CACD,IAAK,cACL,MAAO,SAAqB9O,EAAS,CACnC/B,GAAOlB,GAAUQ,GAAcyC,CAAO,GAAKA,CAAO,CACpD,CACF,CAAC,CAAC,EACK8O,CACT,EAAE,EACF,OAAA7Q,GAAO6Q,GAAQ,UAAWnG,GAAQ4B,GAASY,GAAQC,GAAUS,GAAQU,EAAO,EAErEuC,EAET,CAAE,ICzsGF,IAAAc,GAAAC,GAAA,CAAAC,GAAAC,KAAA,EAOC,SAASC,EAAE,CAAC,GAAG,OAAOF,IAAU,UAAU,OAAOC,IAAS,YAAaA,GAAO,QAAQC,EAAE,UAAU,OAAO,QAAS,YAAY,OAAO,IAAK,OAAO,CAAC,EAAEA,CAAC,MAAM,CAAC,IAAIC,EAAK,OAAO,QAAS,YAAaA,EAAE,OAAe,OAAO,QAAS,YAAaA,EAAE,OAAe,OAAO,MAAO,YAAaA,EAAE,KAAUA,EAAE,KAAKA,EAAE,KAAOD,EAAE,CAAC,CAAC,GAAG,UAAU,CAAC,IAAIE,EAAOH,EAAOD,EAAQ,OAAQ,UAAU,CAAC,SAASK,EAAEC,EAAEC,EAAEC,EAAE,CAAC,SAASC,EAAEC,EAAER,EAAE,CAAC,GAAG,CAACK,EAAEG,CAAC,EAAE,CAAC,GAAG,CAACJ,EAAEI,CAAC,EAAE,CAAC,IAAI,EAAc,OAAOC,IAAnB,YAA4BA,GAAQ,GAAG,CAACT,GAAG,EAAE,OAAO,EAAEQ,EAAE,EAAE,EAAE,GAAGE,EAAE,OAAOA,EAAEF,EAAE,EAAE,EAAE,IAAIG,EAAE,IAAI,MAAM,uBAAuBH,EAAE,GAAG,EAAE,MAAMG,EAAE,KAAK,mBAAmBA,CAAC,CAAC,IAAIC,EAAEP,EAAEG,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAEJ,EAAEI,CAAC,EAAE,CAAC,EAAE,KAAKI,EAAE,QAAQ,SAAST,EAAE,CAAC,IAAIE,EAAED,EAAEI,CAAC,EAAE,CAAC,EAAEL,CAAC,EAAE,OAAOI,EAAEF,GAAGF,CAAC,CAAC,EAAES,EAAEA,EAAE,QAAQT,EAAEC,EAAEC,EAAEC,CAAC,CAAC,CAAC,OAAOD,EAAEG,CAAC,EAAE,OAAO,CAAC,QAAQE,EAAc,OAAOD,IAAnB,YAA4BA,GAAQD,EAAE,EAAEA,EAAEF,EAAE,OAAOE,IAAID,EAAED,EAAEE,CAAC,CAAC,EAAE,OAAOD,CAAC,CAAC,OAAOJ,CAAC,EAAG,EAAE,CAAC,EAAE,CAAC,SAASU,EAAQd,EAAOD,EAAQ,CAM51B,aAEA,IAAIgB,EAAYD,EAAQ,WAAW,EAE/BE,EAAkBF,EAAQ,mBAAmB,EAE7CG,EAAYH,EAAQ,aAAa,EAErC,SAASI,EAAQC,EAAoB,CACnC,IAAIC,EAAuBD,GAAsB,CAAC,EAE9CE,EAAW,CACb,GAAID,EAAqB,QAAQ,IAAI,GAAK,EAC1C,KAAMA,EAAqB,QAAQ,MAAM,GAAK,CAChD,EACAL,EAAU,KAAK,KAAMM,CAAQ,EAC7B,KAAK,SAAW,CACd,GAAIA,EAAS,GACb,KAAMA,EAAS,MAAQ,KAAK,SAAS,CACvC,EACA,KAAK,IAAIL,CAAe,EACxB,KAAK,IAAIC,CAAS,CACpB,CAEAC,EAAQ,UAAY,OAAO,OAAOH,EAAU,SAAS,EACrDG,EAAQ,UAAU,YAAcA,EAEhCA,EAAQ,UAAU,iBAAmB,SAA0BI,EAASC,EAAO,CAC7E,IAAIC,EAAS,KAAK,OAAOF,EAASC,CAAK,EAEvC,OAAID,EAAQ,eACV,KAAK,aAAaE,EAAQF,EAAQ,QAASA,EAAQ,SAAUA,EAAQ,cAAeA,EAAQ,cAAeA,EAAQ,gBAAgB,EAG9HE,CACT,EAEAxB,EAAO,QAAUkB,CAEjB,EAAE,CAAC,cAAc,EAAE,oBAAoB,EAAE,UAAY,EAAE,CAAC,EAAE,EAAE,CAAC,SAASJ,EAAQd,EAAOD,EAAQ,CAG7F,aAGA,SAAS0B,EAAShB,EAAG,CACnB,OAAOA,EAAI,EAAI,EAAIA,EAAI,IAAM,IAAMA,CACrC,CAEA,SAASiB,EAAcjB,EAAG,CACxB,OAAOA,GAAK,EAAIA,EAAI,CACtB,CAYA,SAASkB,EAAYC,EAAKC,EAAMC,EAAMC,EAAMC,EAAOC,EAAS,CAC1D,IAAI7B,EAAGF,EAAGgC,EAAGtB,EACTuB,EAAWC,EAAaC,EACxBC,EAAQC,EAAMC,EAAOC,EACrBC,EAAY,EACZC,EAAa,EAEjB,IAAKJ,EAAO,EAAGA,EAAOR,EAAMQ,IAAQ,CAGlC,IAFAJ,EAAY,EAEPK,EAAQ,EAAGA,EAAQR,EAAOQ,IAAS,CAOtC,IALAJ,EAAcH,EAAQE,GAAW,EACjCE,EAAaJ,EAAQE,GAAW,EAChCG,EAASI,EAAYN,EAAc,EAAI,EACvChC,EAAIF,EAAIgC,EAAItB,EAAI,EAETyB,EAAa,EAAGA,IACrBI,EAAYR,EAAQE,GAAW,EAG/BvB,EAAIA,EAAI6B,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtCJ,EAAIA,EAAIO,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtCpC,EAAIA,EAAIuC,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtClC,EAAIA,EAAIqC,EAAYb,EAAIU,CAAM,EAAI,EAClCA,EAASA,EAAS,EAAI,EAMxBT,EAAKc,EAAa,CAAC,EAAIjB,EAAcd,GAAK,CAAC,EAC3CiB,EAAKc,EAAa,CAAC,EAAIjB,EAAcQ,GAAK,CAAC,EAC3CL,EAAKc,EAAa,CAAC,EAAIjB,EAAcxB,GAAK,CAAC,EAC3C2B,EAAKc,CAAU,EAAIjB,EAActB,GAAK,CAAC,EACvCuC,EAAaA,EAAaZ,EAAO,EAAI,CACvC,CAEAY,GAAcJ,EAAO,GAAK,EAAI,EAC9BG,GAAaH,EAAO,GAAKT,EAAO,EAAI,CACtC,CACF,CAIA,SAASc,EAAahB,EAAKC,EAAMC,EAAMC,EAAMC,EAAOC,EAAS,CAC3D,IAAI7B,EAAGF,EAAGgC,EAAGtB,EACTuB,EAAWC,EAAaC,EACxBC,EAAQC,EAAMC,EAAOC,EACrBC,EAAY,EACZC,EAAa,EAEjB,IAAKJ,EAAO,EAAGA,EAAOR,EAAMQ,IAAQ,CAGlC,IAFAJ,EAAY,EAEPK,EAAQ,EAAGA,EAAQR,EAAOQ,IAAS,CAOtC,IALAJ,EAAcH,EAAQE,GAAW,EACjCE,EAAaJ,EAAQE,GAAW,EAChCG,EAASI,EAAYN,EAAc,EAAI,EACvChC,EAAIF,EAAIgC,EAAItB,EAAI,EAETyB,EAAa,EAAGA,IACrBI,EAAYR,EAAQE,GAAW,EAG/BvB,EAAIA,EAAI6B,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtCJ,EAAIA,EAAIO,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtCpC,EAAIA,EAAIuC,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtClC,EAAIA,EAAIqC,EAAYb,EAAIU,CAAM,EAAI,EAClCA,EAASA,EAAS,EAAI,EAIxBlC,IAAM,EACNF,IAAM,EACNgC,IAAM,EACNtB,IAAM,EAGNiB,EAAKc,EAAa,CAAC,EAAIlB,EAASb,EAAK,MAAY,EAAE,EACnDiB,EAAKc,EAAa,CAAC,EAAIlB,EAASS,EAAK,MAAY,EAAE,EACnDL,EAAKc,EAAa,CAAC,EAAIlB,EAASvB,EAAK,MAAY,EAAE,EACnD2B,EAAKc,CAAU,EAAIlB,EAASrB,EAAK,MAAY,EAAE,EAC/CuC,EAAaA,EAAaZ,EAAO,EAAI,CACvC,CAEAY,GAAcJ,EAAO,GAAK,EAAI,EAC9BG,GAAaH,EAAO,GAAKT,EAAO,EAAI,CACtC,CACF,CASA,SAASe,EAAmBjB,EAAKC,EAAMC,EAAMC,EAAMC,EAAOC,EAAS,CACjE,IAAI7B,EAAGF,EAAGgC,EAAGtB,EAAGkC,EACZX,EAAWC,EAAaC,EACxBC,EAAQC,EAAMC,EAAOC,EACrBC,EAAY,EACZC,GAAa,EAEjB,IAAKJ,EAAO,EAAGA,EAAOR,EAAMQ,IAAQ,CAGlC,IAFAJ,EAAY,EAEPK,EAAQ,EAAGA,EAAQR,EAAOQ,IAAS,CAOtC,IALAJ,EAAcH,EAAQE,GAAW,EACjCE,EAAaJ,EAAQE,GAAW,EAChCG,EAASI,EAAYN,EAAc,EAAI,EACvChC,EAAIF,EAAIgC,EAAItB,EAAI,EAETyB,EAAa,EAAGA,IACrBI,EAAYR,EAAQE,GAAW,EAG/BW,EAAQlB,EAAIU,EAAS,CAAC,EACtB1B,EAAIA,EAAI6B,EAAYK,EAAQ,EAC5BZ,EAAIA,EAAIO,EAAYb,EAAIU,EAAS,CAAC,EAAIQ,EAAQ,EAC9C5C,EAAIA,EAAIuC,EAAYb,EAAIU,EAAS,CAAC,EAAIQ,EAAQ,EAC9C1C,EAAIA,EAAIqC,EAAYb,EAAIU,CAAM,EAAIQ,EAAQ,EAC1CR,EAASA,EAAS,EAAI,EAKxBJ,EAAIA,EAAI,IAAM,EACdhC,EAAIA,EAAI,IAAM,EACdE,EAAIA,EAAI,IAAM,EAIdyB,EAAKc,GAAa,CAAC,EAAIjB,EAAcd,GAAK,CAAC,EAC3CiB,EAAKc,GAAa,CAAC,EAAIjB,EAAcQ,GAAK,CAAC,EAC3CL,EAAKc,GAAa,CAAC,EAAIjB,EAAcxB,GAAK,CAAC,EAC3C2B,EAAKc,EAAU,EAAIjB,EAActB,GAAK,CAAC,EACvCuC,GAAaA,GAAaZ,EAAO,EAAI,CACvC,CAEAY,IAAcJ,EAAO,GAAK,EAAI,EAC9BG,GAAaH,EAAO,GAAKT,EAAO,EAAI,CACtC,CACF,CAIA,SAASiB,EAAoBnB,EAAKC,EAAMC,EAAMC,EAAMC,EAAOC,EAAS,CAClE,IAAI7B,EAAGF,EAAGgC,EAAGtB,EACTuB,EAAWC,EAAaC,EACxBC,EAAQC,EAAMC,EAAOC,EACrBC,EAAY,EACZC,EAAa,EAEjB,IAAKJ,EAAO,EAAGA,EAAOR,EAAMQ,IAAQ,CAGlC,IAFAJ,EAAY,EAEPK,EAAQ,EAAGA,EAAQR,EAAOQ,IAAS,CAOtC,IALAJ,EAAcH,EAAQE,GAAW,EACjCE,EAAaJ,EAAQE,GAAW,EAChCG,EAASI,EAAYN,EAAc,EAAI,EACvChC,EAAIF,EAAIgC,EAAItB,EAAI,EAETyB,EAAa,EAAGA,IACrBI,EAAYR,EAAQE,GAAW,EAG/BvB,EAAIA,EAAI6B,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtCJ,EAAIA,EAAIO,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtCpC,EAAIA,EAAIuC,EAAYb,EAAIU,EAAS,CAAC,EAAI,EACtClC,EAAIA,EAAIqC,EAAYb,EAAIU,CAAM,EAAI,EAClCA,EAASA,EAAS,EAAI,EAIxBlC,IAAM,EACNF,IAAM,EACNgC,IAAM,EACNtB,IAAM,EAENA,EAAIa,EAASb,EAAK,MAAY,EAAE,EAE5BA,EAAI,IACNR,EAAIA,EAAI,IAAMQ,EAAI,EAClBV,EAAIA,EAAI,IAAMU,EAAI,EAClBsB,EAAIA,EAAI,IAAMtB,EAAI,GAMpBiB,EAAKc,EAAa,CAAC,EAAI/B,EACvBiB,EAAKc,EAAa,CAAC,EAAIlB,EAASS,EAAK,MAAY,EAAE,EACnDL,EAAKc,EAAa,CAAC,EAAIlB,EAASvB,EAAK,MAAY,EAAE,EACnD2B,EAAKc,CAAU,EAAIlB,EAASrB,EAAK,MAAY,EAAE,EAC/CuC,EAAaA,EAAaZ,EAAO,EAAI,CACvC,CAEAY,GAAcJ,EAAO,GAAK,EAAI,EAC9BG,GAAaH,EAAO,GAAKT,EAAO,EAAI,CACtC,CACF,CAEA9B,EAAO,QAAU,CACf,YAAa2B,EACb,aAAciB,EACd,mBAAoBC,EACpB,oBAAqBE,CACvB,CAEA,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,SAASjC,EAAQd,EAAOD,EAAQ,CAGzC,aAGAC,EAAO,QAAU,kvFAEjB,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,SAASc,EAAQd,EAAOD,EAAQ,CACzC,aAEAC,EAAO,QAAU,CACf,KAAM,SACN,GAAIc,EAAQ,UAAU,EACtB,QAASA,EAAQ,eAAe,EAChC,SAAUA,EAAQ,wBAAwB,CAC5C,CAEA,EAAE,CAAC,yBAAyB,EAAE,WAAW,EAAE,gBAAgB,CAAC,CAAC,EAAE,EAAE,CAAC,SAASA,EAAQd,EAAOD,EAAQ,CAClG,aAEA,IAAIiD,EAAgBlC,EAAQ,qBAAqB,EAE7CmC,EAAWnC,EAAQ,YAAY,EAC/Ba,EAAcsB,EAAS,YACvBL,EAAeK,EAAS,aACxBJ,EAAqBI,EAAS,mBAC9BF,EAAsBE,EAAS,oBAEnC,SAASC,EAAStB,EAAKuB,EAAOC,EAAQ,CAIpC,QAHIC,EAAM,EACNC,EAAMH,EAAQC,EAAS,EAAI,EAExBC,EAAMC,GAAK,CAChB,GAAI1B,EAAIyB,CAAG,IAAM,IAAK,MAAO,GAC7BA,EAAMA,EAAM,EAAI,CAClB,CAEA,MAAO,EACT,CAEA,SAASE,EAAWC,EAAKL,EAAOC,EAAQ,CAItC,QAHIC,EAAM,EACNC,EAAMH,EAAQC,EAAS,EAAI,EAExBC,EAAMC,GACXE,EAAIH,CAAG,EAAI,IACXA,EAAMA,EAAM,EAAI,CAEpB,CAEArD,EAAO,QAAU,SAAgBsB,EAAS,CACxC,IAAIM,EAAMN,EAAQ,IACdQ,EAAOR,EAAQ,MACfS,EAAOT,EAAQ,OACfU,EAAQV,EAAQ,QAChBmC,EAAQnC,EAAQ,SAChBoC,EAASpC,EAAQ,QAAUA,EAAQ,QAAUA,EAAQ,MACrDqC,EAASrC,EAAQ,QAAUA,EAAQ,SAAWA,EAAQ,OACtDsC,EAAUtC,EAAQ,SAAW,EAC7BuC,EAAUvC,EAAQ,SAAW,EAC7BO,EAAOP,EAAQ,MAAQ,IAAI,WAAWU,EAAQyB,EAAQ,CAAC,EACvDK,EAAS,OAAOxC,EAAQ,QAAW,YAAc,UAAYA,EAAQ,OACrEyC,EAAWf,EAAcc,EAAQhC,EAAME,EAAO0B,EAAQE,CAAO,EAC7DI,EAAWhB,EAAcc,EAAQ/B,EAAM0B,EAAOE,EAAQE,CAAO,EAC7DI,EAAM,IAAI,YAAYjC,EAAQD,EAAO,CAAC,EAE1C,OAAImB,EAAStB,EAAKE,EAAMC,CAAI,GAC1Bc,EAAmBjB,EAAKqC,EAAKnC,EAAMC,EAAMC,EAAO+B,CAAQ,EACxDhB,EAAoBkB,EAAKpC,EAAME,EAAMC,EAAOyB,EAAOO,CAAQ,IAE3DrC,EAAYC,EAAKqC,EAAKnC,EAAMC,EAAMC,EAAO+B,CAAQ,EACjDnB,EAAaqB,EAAKpC,EAAME,EAAMC,EAAOyB,EAAOO,CAAQ,EACpDT,EAAW1B,EAAMG,EAAOyB,CAAK,GAGxB5B,CACT,CAEA,EAAE,CAAC,aAAa,EAAE,sBAAsB,CAAC,CAAC,EAAE,EAAE,CAAC,SAASf,EAAQd,EAAOD,EAAQ,CAU/E,aAEA,IAAImE,EAAcpD,EAAQ,sBAAsB,EAG5CqD,EAAkB,GAEtB,SAASC,EAAaC,EAAK,CACzB,OAAO,KAAK,MAAMA,IAAQ,GAAKF,GAAmB,EAAE,CACtD,CAEAnE,EAAO,QAAU,SAAyB8D,EAAQQ,EAASC,EAAUC,EAAOC,EAAQ,CAClF,IAAIC,EAAiBR,EAAY,OAAOJ,CAAM,EAAE,GAC5Ca,EAAgB,EAAMH,EACtBI,EAAe,KAAK,IAAI,EAAKJ,CAAK,EAGlCK,EAAYX,EAAY,OAAOJ,CAAM,EAAE,IAAMc,EAC7CE,EAAWC,EAAUC,EAAUC,EAASC,EAAmBC,EAAaC,EAAWC,EAAOC,EAAKC,EAAKC,EAAUC,EAAahD,GAC3HiD,GAAcC,EAAevD,EAAaC,EAC1CuD,EAAuB,KAAK,OAAOf,EAAY,GAAK,CAAC,EACrDgB,EAAe,IAAI,YAAYD,EAAuB,GAAKrB,CAAQ,EACnEuB,GAAkB,EAClBC,EAAW,CAACF,EAAa,UAAY,CAACA,EAAa,IAEvD,IAAKf,EAAY,EAAGA,EAAYP,EAAUO,IAAa,CAUrD,IARAC,GAAYD,EAAY,IAAOH,EAAgBF,EAC/CO,EAAW,KAAK,IAAI,EAAG,KAAK,MAAMD,EAAWF,CAAS,CAAC,EACvDI,EAAU,KAAK,IAAIX,EAAU,EAAG,KAAK,KAAKS,EAAWF,CAAS,CAAC,EAC/DK,EAAoBD,EAAUD,EAAW,EACzCG,EAAc,IAAI,aAAaD,CAAiB,EAChDE,EAAY,IAAI,WAAWF,CAAiB,EAC5CG,EAAQ,EAEHC,EAAMN,EAAUO,EAAM,EAAGD,GAAOL,EAASK,IAAOC,IACnDC,EAAWd,GAAgBY,EAAM,GAAMP,GAAYH,CAAY,EAC/DS,GAASG,EACTL,EAAYI,CAAG,EAAIC,EAMrB,IAFAC,EAAc,EAETF,EAAM,EAAGA,EAAMJ,EAAY,OAAQI,IACtC9C,GAAY0C,EAAYI,CAAG,EAAIF,EAC/BI,GAAehD,GACf2C,EAAUG,CAAG,EAAInB,EAAa3B,EAAS,EAezC,IAXA2C,EAAUb,GAAY,CAAC,GAAKH,EAAa,EAAMqB,CAAW,EAS1DC,GAAe,EAERA,GAAeN,EAAU,QAAUA,EAAUM,EAAY,IAAM,GACpEA,KAGF,GAAIA,GAAeN,EAAU,OAAQ,CAGnC,IAFAO,EAAgBP,EAAU,OAAS,EAE5BO,EAAgB,GAAKP,EAAUO,CAAa,IAAM,GACvDA,IASF,GANAvD,EAAc4C,EAAWU,GACzBrD,EAAasD,EAAgBD,GAAe,EAC5CG,EAAaC,IAAiB,EAAI1D,EAElCyD,EAAaC,IAAiB,EAAIzD,EAE9B,CAAC0D,EACHF,EAAa,IAAIT,EAAU,SAASM,GAAcC,EAAgB,CAAC,EAAGG,EAAe,EACrFA,IAAmBzD,MAGnB,KAAKkD,EAAMG,GAAcH,GAAOI,EAAeJ,IAC7CM,EAAaC,IAAiB,EAAIV,EAAUG,CAAG,CAGrD,MAEEM,EAAaC,IAAiB,EAAI,EAElCD,EAAaC,IAAiB,EAAI,CAEtC,CAEA,OAAOD,CACT,CAEA,EAAE,CAAC,uBAAuB,CAAC,CAAC,EAAE,EAAE,CAAC,SAAS/E,EAAQd,EAAOD,EAAQ,CAMjE,aAEA,IAAI+D,EAAS,CAEX,IAAK,CACH,IAAK,GACL,GAAI,SAAYkC,EAAG,CACjB,OAAIA,EAAI,IAAGA,EAAI,CAACA,GACTA,EAAI,GAAM,EAAM,CACzB,CACF,EAEA,QAAS,CACP,IAAK,EACL,GAAI,SAAYA,EAAG,CAGjB,GAFIA,EAAI,IAAGA,EAAI,CAACA,GAEZA,GAAK,EACP,MAAO,GAGT,GAAIA,EAAI,aACN,MAAO,GAGT,IAAIC,EAAMD,EAAI,KAAK,GACnB,OAAO,KAAK,IAAIC,CAAG,EAAIA,GAAO,IAAO,IAAO,KAAK,IAAIA,EAAM,CAAG,EAChE,CACF,EAEA,SAAU,CACR,IAAK,EACL,GAAI,SAAYD,EAAG,CAGjB,GAFIA,EAAI,IAAGA,EAAI,CAACA,GAEZA,GAAK,EACP,MAAO,GAGT,GAAIA,EAAI,aACN,MAAO,GAGT,IAAIC,EAAMD,EAAI,KAAK,GACnB,OAAO,KAAK,IAAIC,CAAG,EAAIA,EAAM,KAAK,IAAIA,EAAM,CAAG,GAAKA,EAAM,EAC5D,CACF,EAEA,SAAU,CACR,IAAK,EACL,GAAI,SAAYD,EAAG,CAGjB,GAFIA,EAAI,IAAGA,EAAI,CAACA,GAEZA,GAAK,EACP,MAAO,GAGT,GAAIA,EAAI,aACN,MAAO,GAGT,IAAIC,EAAMD,EAAI,KAAK,GACnB,OAAO,KAAK,IAAIC,CAAG,EAAIA,EAAM,KAAK,IAAIA,EAAM,CAAG,GAAKA,EAAM,EAC5D,CACF,EAGA,QAAS,CACP,IAAK,IACL,GAAI,SAAYD,EAAG,CAGjB,OAFIA,EAAI,IAAGA,EAAI,CAACA,GAEZA,GAAK,IACA,EAGLA,GAAK,IACA,OAAUA,EAAI,MAAQA,EAAI,KAG/BA,GAAK,GACA,KAAQ,EAAIA,EAAIA,EAAI,GAAKA,EAAI,GAG/B,OAAS,KAAOA,EAAIA,CAC7B,CACF,CACF,EACAhG,EAAO,QAAU,CACf,OAAQ8D,EAER,IAAK,CACH,IAAK,EACL,QAAS,EACT,SAAU,EACV,SAAU,CACZ,EACA,IAAK,CAAC,MAAO,UAAW,WAAY,UAAU,CAChD,CAEA,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,SAAShD,EAAQd,EAAOD,EAAQ,CACzC,aAEA,IAAIiD,EAAgBlC,EAAQ,qBAAqB,EAEjD,SAASoC,EAAStB,EAAKuB,EAAOC,EAAQ,CAIpC,QAHIC,EAAM,EACNC,EAAMH,EAAQC,EAAS,EAAI,EAExBC,EAAMC,GAAK,CAChB,GAAI1B,EAAIyB,CAAG,IAAM,IAAK,MAAO,GAC7BA,EAAMA,EAAM,EAAI,CAClB,CAEA,MAAO,EACT,CAEA,SAASE,EAAWC,EAAKL,EAAOC,EAAQ,CAItC,QAHIC,EAAM,EACNC,EAAMH,EAAQC,EAAS,EAAI,EAExBC,EAAMC,GACXE,EAAIH,CAAG,EAAI,IACXA,EAAMA,EAAM,EAAI,CAEpB,CAEA,SAAS6C,EAAatE,EAAK,CACzB,OAAO,IAAI,WAAWA,EAAI,OAAQ,EAAGA,EAAI,UAAU,CACrD,CAEA,IAAIuE,EAAQ,GAEZ,GAAI,CACFA,EAAQ,IAAI,YAAY,IAAI,WAAW,CAAC,EAAG,EAAG,EAAG,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC,IAAM,CACtE,OAASC,EAAI,CAAC,CAEd,SAASC,EAAczE,EAAK0E,EAAQC,EAAe,CACjD,GAAIJ,EAAO,CACTG,EAAO,IAAIJ,EAAatE,CAAG,EAAG2E,CAAa,EAC3C,MACF,CAEA,QAASlD,EAAMkD,EAAe9F,EAAI,EAAGA,EAAImB,EAAI,OAAQnB,IAAK,CACxD,IAAI+F,EAAO5E,EAAInB,CAAC,EAChB6F,EAAOjD,GAAK,EAAImD,EAAO,IACvBF,EAAOjD,GAAK,EAAImD,GAAQ,EAAI,GAC9B,CACF,CAEAxG,EAAO,QAAU,SAAqBsB,EAAS,CAC7C,IAAIM,EAAMN,EAAQ,IACdQ,EAAOR,EAAQ,MACfS,EAAOT,EAAQ,OACfU,EAAQV,EAAQ,QAChBmC,EAAQnC,EAAQ,SAChBoC,EAASpC,EAAQ,QAAUA,EAAQ,QAAUA,EAAQ,MACrDqC,EAASrC,EAAQ,QAAUA,EAAQ,SAAWA,EAAQ,OACtDsC,EAAUtC,EAAQ,SAAW,EAC7BuC,EAAUvC,EAAQ,SAAW,EAC7BO,EAAOP,EAAQ,MAAQ,IAAI,WAAWU,EAAQyB,EAAQ,CAAC,EACvDK,EAAS,OAAOxC,EAAQ,QAAW,YAAc,UAAYA,EAAQ,OACrEyC,EAAWf,EAAcc,EAAQhC,EAAME,EAAO0B,EAAQE,CAAO,EAC7DI,EAAWhB,EAAcc,EAAQ/B,EAAM0B,EAAOE,EAAQE,CAAO,EAE7D4C,EAAa,EACbC,EAAW,KAAK,IAAI9E,EAAI,WAAYC,EAAK,UAAU,EAEnD8E,EAAa,KAAK,QAAQF,EAAaC,CAAQ,EAE/CE,EAAW7E,EAAOC,EAAQ,EAAI,EAE9B6E,GAAkB,KAAK,QAAQF,EAAaC,CAAQ,EAEpDE,GAAkB,KAAK,QAAQD,GAAkB9C,EAAS,UAAU,EAEpEgD,EAAcD,GAAkB9C,EAAS,WAEzCgD,EAAW,KAAK,WAAW,SAAUD,CAAW,EAKhDE,EAAM,IAAI,WAAW,KAAK,SAAS,MAAM,EACzCC,EAAQ,IAAI,YAAY,KAAK,SAAS,MAAM,EAE5CC,EAAQ,IAAI,YAAYvF,EAAI,MAAM,EACtCsF,EAAM,IAAIC,CAAK,EAGfd,EAActC,EAAUkD,EAAKJ,EAAe,EAC5CR,EAAcrC,EAAUiD,EAAKH,EAAe,EAG5C,IAAIM,GAAKJ,EAAS,QAAQ,YAAcA,EAAS,QAAQ,YAErD9D,EAAStB,EAAKE,EAAMC,CAAI,EAC1BqF,GAAGP,GAAiBC,GAAiBH,EAAY7E,EAAMC,EAAMC,EAAOyB,EAAO,CAAC,GAE5E2D,GAAGP,GAAiBC,GAAiBH,EAAY7E,EAAMC,EAAMC,EAAOyB,EAAO,CAAC,EAC5EF,EAAW1B,EAAMG,EAAOyB,CAAK,GAO/B,IAAI4D,EAAS,IAAI,YAAYxF,EAAK,MAAM,EACxC,OAAAwF,EAAO,IAAI,IAAI,YAAY,KAAK,SAAS,OAAQ,EAAG5D,EAAQzB,CAAK,CAAC,EAC3DH,CACT,CAEA,EAAE,CAAC,sBAAsB,CAAC,CAAC,EAAE,EAAE,CAAC,SAASf,EAAQd,EAAOD,EAAQ,CAChE,aAEAC,EAAO,QAAU,CACf,KAAM,eACN,GAAIc,EAAQ,gBAAgB,EAC5B,QAASA,EAAQ,qBAAqB,EACtC,SAAUA,EAAQ,4BAA4B,CAChD,CAEA,EAAE,CAAC,iBAAiB,GAAG,sBAAsB,GAAG,6BAA6B,EAAE,CAAC,EAAE,GAAG,CAAC,SAASA,EAAQd,EAAOD,EAAQ,CAUtH,aAEA,IAAIuH,EAAcxG,EAAQ,aAAa,EAEvC,SAASyG,EAAQC,EAAKrE,EAAOC,EAAQ,CAKnC,QAJIqE,EAAOtE,EAAQC,EACfsE,EAAM,IAAI,YAAYD,CAAI,EAC1BrH,EAAGF,EAAGgC,EAAGyF,EAEJlH,EAAI,EAAGA,EAAIgH,EAAMhH,IACxBL,EAAIoH,EAAI,EAAI/G,CAAC,EACbP,EAAIsH,EAAI,EAAI/G,EAAI,CAAC,EACjByB,EAAIsF,EAAI,EAAI/G,EAAI,CAAC,EACjBkH,EAAMvH,GAAKF,GAAKE,GAAK8B,EAAI9B,EAAIF,GAAKgC,GAAKhC,GAAKE,EAAIF,EAAIgC,EACpDwF,EAAIjH,CAAC,EAAIkH,GAAO,EAGlB,OAAOD,CACT,CAEA1H,EAAO,QAAU,SAAiBwH,EAAKrE,EAAOC,EAAQwE,EAAQC,EAAQC,EAAW,CAC/E,IAAIC,EAAIC,EAAIC,EACRC,EAAMC,EAEV,GAAI,EAAAP,IAAW,GAAKC,EAAS,IAI7B,CAAIA,EAAS,IACXA,EAAS,GAGX,IAAIO,EAAab,EAAQC,EAAKrE,EAAOC,CAAM,EACvCiF,EAAS,IAAI,YAAYD,CAAU,EAEvCd,EAAYe,EAAQlF,EAAOC,EAAQyE,CAAM,EAMzC,QALIS,EAAWV,EAAS,IAAM,KAAS,GAAM,EACzCW,EAAcT,GAAa,EAC3BL,EAAOtE,EAAQC,EAGV3C,EAAI,EAAGA,EAAIgH,EAAMhH,IACxBsH,EAAKK,EAAW3H,CAAC,EACjByH,EAAOH,EAAKM,EAAO5H,CAAC,EAEhB,KAAK,IAAIyH,CAAI,GAAKK,IAEpBP,EAAKD,GAAMO,EAAWJ,EAAO,MAAS,IAItCF,EAAKA,EAAK,MAAS,MAASA,EAC5BA,EAAKA,EAAK,EAAS,EAASA,EAG5BD,EAAKA,IAAO,EAAIA,EAAK,EAIrBE,GAAQD,GAAM,IAAMD,EAAK,EAMzBI,EAAU1H,EAAI,EACd+G,EAAIW,CAAO,EAAIX,EAAIW,CAAO,EAAIF,EAAO,MAAS,GAE9CT,EAAIW,EAAU,CAAC,EAAIX,EAAIW,EAAU,CAAC,EAAIF,EAAO,MAAS,GAEtDT,EAAIW,EAAU,CAAC,EAAIX,EAAIW,EAAU,CAAC,EAAIF,EAAO,MAAS,IAG5D,CAEA,EAAE,CAAC,cAAc,EAAE,CAAC,EAAE,GAAG,CAAC,SAASnH,EAAQd,EAAOD,EAAQ,CAC1D,aAEAC,EAAO,QAAU,SAAiBwH,EAAKrE,EAAOC,EAAQwE,EAAQC,EAAQC,EAAW,CAC/E,GAAI,EAAAF,IAAW,GAAKC,EAAS,IAI7B,CAAIA,EAAS,IACXA,EAAS,GAGX,IAAIW,EAASrF,EAAQC,EACjBqF,EAAgBD,EAAS,EACzBE,EAAgBF,EAAS,EACzBG,EAAiBH,EAAS,EAC1BI,EAAqB,KAAK,IAAIzF,EAAOC,CAAM,EAAI,EAE/CyF,EAAuB,EAAI,EAE3BC,EAAa,EACbC,EAAaN,EACbO,EAAcD,EAAaL,EAC3BO,EAAkBD,EAAcL,EAChCO,EAAmBD,EAAkBN,EACrCQ,EAAqBD,EAAmBN,EAExC5B,EAAW,KAAK,WAAW,eAAgByB,EAAgBC,EAAgBC,EAAiB,EAAIC,EAAqBC,EAAsB,CAC7I,IAAK,KAAK,GACZ,CAAC,EAGGO,EAAQ,IAAI,YAAY5B,EAAI,MAAM,EAClCN,EAAQ,IAAI,YAAY,KAAK,SAAS,MAAM,EAChDA,EAAM,IAAIkC,CAAK,EAEf,IAAIhC,EAAKJ,EAAS,QAAQ,SAAWA,EAAS,QAAQ,SACtDI,EAAG0B,EAAYC,EAAY5F,EAAOC,CAAM,EAExCgE,EAAKJ,EAAS,QAAQ,YAAcA,EAAS,QAAQ,YACrDI,EAAG2B,EAAYC,EAAaC,EAAiBC,EAAkBC,EAAoBhG,EAAOC,EAAQyE,CAAM,EAExGT,EAAKJ,EAAS,QAAQ,SAAWA,EAAS,QAAQ,SAClDI,EAAG0B,EAAYA,EAAYC,EAAYC,EAAa7F,EAAOC,EAAQwE,EAAQE,CAAS,EAEpFsB,EAAM,IAAI,IAAI,YAAY,KAAK,SAAS,OAAQ,EAAGZ,CAAM,CAAC,EAC5D,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAAS1H,EAAQd,EAAOD,EAAQ,CAG1C,aAGAC,EAAO,QAAU,87EAEjB,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASc,EAAQd,EAAOD,EAAQ,CAC1C,aAEA,IAAIsJ,EAAc,IAElB,SAASC,EAAKC,EAAQC,EAAM,CAC1B,KAAK,OAASD,EACd,KAAK,UAAY,CAAC,EAClB,KAAK,SAAW,CAAC,EACjB,KAAK,OAAS,EACd,KAAK,UAAY,EACjB,KAAK,KAAOC,GAAQ,GACtB,CAEAF,EAAK,UAAU,QAAU,UAAY,CACnC,IAAIG,EAAQ,KAERC,EAEJ,OAAI,KAAK,UAAU,SAAW,EAC5BA,EAAW,KAAK,UAAU,IAAI,GAE9BA,EAAW,KAAK,OAAO,EACvBA,EAAS,GAAK,KAAK,SAEnBA,EAAS,QAAU,UAAY,CAC7B,OAAOD,EAAM,QAAQC,CAAQ,CAC/B,GAGF,KAAK,SAASA,EAAS,EAAE,EAAIA,EACtBA,CACT,EAEAJ,EAAK,UAAU,QAAU,SAAUI,EAAU,CAC3C,IAAIC,EAAS,KAEb,OAAO,KAAK,SAASD,EAAS,EAAE,EAChCA,EAAS,SAAW,KAAK,IAAI,EAC7B,KAAK,UAAU,KAAKA,CAAQ,EAExB,KAAK,YAAc,IACrB,KAAK,UAAY,WAAW,UAAY,CACtC,OAAOC,EAAO,GAAG,CACnB,EAAGN,CAAW,EAElB,EAEAC,EAAK,UAAU,GAAK,UAAY,CAC9B,IAAIM,EAAS,KAETC,EAAM,KAAK,IAAI,EACnB,KAAK,UAAY,KAAK,UAAU,OAAO,SAAUH,EAAU,CACzD,OAAIG,EAAMH,EAAS,SAAWE,EAAO,MACnCF,EAAS,QAAQ,EACV,IAGF,EACT,CAAC,EAEG,KAAK,UAAU,SAAW,EAC5B,KAAK,UAAY,WAAW,UAAY,CACtC,OAAOE,EAAO,GAAG,CACnB,EAAGP,CAAW,EAEd,KAAK,UAAY,CAErB,EAEArJ,EAAO,QAAUsJ,CAEjB,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASxI,EAAQd,EAAOD,EAAQ,CAa1C,aAGA,IAAI+J,EAAsB,EAE1B9J,EAAO,QAAU,SAAsB+J,EAAWC,EAAYC,EAASC,EAAUC,EAAaC,EAAgB,CAC5G,IAAI1G,EAASuG,EAAUF,EACnBpG,EAASuG,EAAWF,EAGpBK,GAAY,EAAID,EAAiBN,EAAsB,GAAKK,EAGhE,GAAIE,EAAW,GAAK,MAAO,CAAC,CAACJ,EAASC,CAAQ,CAAC,EAC/C,IAAII,EAAa,KAAK,KAAK,KAAK,IAAI,KAAK,IAAI5G,EAAQC,CAAM,CAAC,EAAI,KAAK,IAAI0G,CAAQ,CAAC,EAGlF,GAAIC,GAAc,EAAG,MAAO,CAAC,CAACL,EAASC,CAAQ,CAAC,EAGhD,QAFI1I,EAAS,CAAC,EAELf,EAAI,EAAGA,EAAI6J,EAAY7J,IAAK,CACnC,IAAI0C,EAAQ,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI4G,EAAWO,EAAa7J,EAAI,CAAC,EAAI,KAAK,IAAIwJ,EAASxJ,EAAI,CAAC,EAAG,EAAI6J,CAAU,CAAC,EAC/GlH,EAAS,KAAK,MAAM,KAAK,IAAI,KAAK,IAAI4G,EAAYM,EAAa7J,EAAI,CAAC,EAAI,KAAK,IAAIyJ,EAAUzJ,EAAI,CAAC,EAAG,EAAI6J,CAAU,CAAC,EACtH9I,EAAO,KAAK,CAAC2B,EAAOC,CAAM,CAAC,CAC7B,CAEA,OAAO5B,CACT,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASV,EAAQd,EAAOD,EAAQ,CAK1C,aASA,IAAIwK,EAAgB,KAEpB,SAASC,EAAWxE,EAAG,CACrB,IAAIyE,EAAU,KAAK,MAAMzE,CAAC,EAE1B,OAAI,KAAK,IAAIA,EAAIyE,CAAO,EAAIF,EACnBE,EAGF,KAAK,MAAMzE,CAAC,CACrB,CAEA,SAAS0E,EAAU1E,EAAG,CACpB,IAAIyE,EAAU,KAAK,MAAMzE,CAAC,EAE1B,OAAI,KAAK,IAAIA,EAAIyE,CAAO,EAAIF,EACnBE,EAGF,KAAK,KAAKzE,CAAC,CACpB,CAEAhG,EAAO,QAAU,SAAuBsB,EAAS,CAC/C,IAAIoC,EAASpC,EAAQ,QAAUA,EAAQ,MACnCqC,EAASrC,EAAQ,SAAWA,EAAQ,OACpCqJ,EAAiBH,EAAWlJ,EAAQ,YAAcoC,CAAM,EAAI,EAAIpC,EAAQ,eACxEsJ,EAAkBJ,EAAWlJ,EAAQ,YAAcqC,CAAM,EAAI,EAAIrC,EAAQ,eAE7E,GAAIqJ,EAAiB,GAAKC,EAAkB,EAC1C,MAAM,IAAI,MAAM,gEAAgE,EAGlF,IAAI5E,EAAG6E,EACHC,EAAQC,EAAQC,EAAaC,EAC7BC,EAAQ,CAAC,EACTC,EAGJ,IAAKJ,EAAS,EAAGA,EAASzJ,EAAQ,SAAUyJ,GAAUH,EACpD,IAAKE,EAAS,EAAGA,EAASxJ,EAAQ,QAASwJ,GAAUH,EACnD3E,EAAI8E,EAASxJ,EAAQ,eAEjB0E,EAAI,IACNA,EAAI,GAGNgF,EAAcF,EAASH,EAAiBrJ,EAAQ,eAAiB0E,EAE7DA,EAAIgF,GAAe1J,EAAQ,UAC7B0J,EAAc1J,EAAQ,QAAU0E,GAGlC6E,EAAIE,EAASzJ,EAAQ,eAEjBuJ,EAAI,IACNA,EAAI,GAGNI,EAAeF,EAASH,EAAkBtJ,EAAQ,eAAiBuJ,EAE/DA,EAAII,GAAgB3J,EAAQ,WAC9B2J,EAAe3J,EAAQ,SAAWuJ,GAGpCM,EAAO,CACL,IAAKnF,EACL,IAAK6E,EACL,QAASG,EACT,SAAUC,EACV,SAAUH,EACV,SAAUC,EACV,aAAcJ,EACd,cAAeC,EACf,QAAS5E,EAAItC,EAAS8G,EAAWxE,EAAItC,CAAM,EAC3C,QAASmH,EAAIlH,EAAS6G,EAAWK,EAAIlH,CAAM,EAC3C,OAAQD,EACR,OAAQC,EACR,EAAG6G,EAAWxE,EAAItC,CAAM,EACxB,EAAG8G,EAAWK,EAAIlH,CAAM,EACxB,MAAO+G,EAAUM,EAActH,CAAM,EACrC,OAAQgH,EAAUO,EAAetH,CAAM,CACzC,EACAuH,EAAM,KAAKC,CAAI,EAInB,OAAOD,CACT,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASpK,EAAQd,EAAOD,EAAQ,CAC1C,aAEA,SAASqL,EAASC,EAAK,CACrB,OAAO,OAAO,UAAU,SAAS,KAAKA,CAAG,CAC3C,CAEArL,EAAO,QAAQ,SAAW,SAAkBsL,EAAS,CACnD,IAAIC,EAAQH,EAASE,CAAO,EAC5B,OAAOC,IAAU,8BAEdA,IAAU,4BAA8BA,IAAU,iBAGvD,EAEAvL,EAAO,QAAQ,QAAU,SAAiBsL,EAAS,CACjD,OAAOF,EAASE,CAAO,IAAM,2BAC/B,EAEAtL,EAAO,QAAQ,cAAgB,SAAuBsL,EAAS,CAC7D,OAAOF,EAASE,CAAO,IAAM,sBAC/B,EAEAtL,EAAO,QAAQ,QAAU,SAAiBwL,EAAa,CACrD,IAAIC,EAAS,EACTC,EAAQ,CAAC,EAEb,SAASC,GAAO,CACVF,EAASD,GAAeE,EAAM,SAChCD,IACAC,EAAM,MAAM,EAAE,EAElB,CAEA,OAAO,SAAetE,EAAI,CACxB,OAAO,IAAI,QAAQ,SAAUwE,EAASC,EAAQ,CAC5CH,EAAM,KAAK,UAAY,CACrBtE,EAAG,EAAE,KAAK,SAAU5F,EAAQ,CAC1BoK,EAAQpK,CAAM,EACdiK,IACAE,EAAK,CACP,EAAG,SAAUG,EAAK,CAChBD,EAAOC,CAAG,EACVL,IACAE,EAAK,CACP,CAAC,CACH,CAAC,EACDA,EAAK,CACP,CAAC,CACH,CACF,EAEA3L,EAAO,QAAQ,iBAAmB,SAA0BqE,EAAK,CAC/D,OAAQA,EAAK,CACX,IAAK,GACH,MAAO,YAET,IAAK,GACH,MAAO,MAET,IAAK,GACH,MAAO,QACX,CAEA,MAAO,MACT,EAEArE,EAAO,QAAQ,YAAc,SAAqB+L,EAAc,CAC9D,OAAO,QAAQ,QAAQ,EAAE,KAAK,UAAY,CACxC,GAAI,OAAO,mBAAsB,YAC/B,MAAO,GAGT,IAAIC,EAAID,EAAa,IAAK,GAAG,EAC7B,OAAO,kBAAkBC,EAAG,EAAG,EAAG,IAAK,IAAK,CAC1C,YAAa,GACb,aAAc,GACd,cAAe,MACjB,CAAC,EAAE,KAAK,SAAUC,EAAQ,CACxB,IAAIC,EAASD,EAAO,QAAU,GAQ9B,OAAAA,EAAO,MAAM,EACbD,EAAI,KACGE,CACT,CAAC,CACH,CAAC,EAAE,MAAS,UAAY,CACtB,MAAO,EACT,CAAC,CACH,EAEAlM,EAAO,QAAQ,gCAAkC,UAA2C,CAC1F,OAAO,IAAI,QAAQ,SAAU4L,EAASC,EAAQ,CAC5C,GAAI,OAAO,iBAAoB,YAAa,CAE1CD,EAAQ,EAAK,EACb,MACF,CAEA,SAASO,EAAcC,EAAM,CAC3B,GAAI,OAAO,mBAAsB,YAAa,CAC5CA,EAAK,YAAY,EAAK,EACtB,MACF,CAEA,QAAQ,QAAQ,EAAE,KAAK,UAAY,CACjC,IAAIC,EAAS,IAAI,gBAAgB,GAAI,EAAE,EAEnCC,EAAMD,EAAO,WAAW,IAAI,EAChC,OAAAC,EAAI,KAAK,EAAG,EAAG,EAAG,CAAC,EAEZ,kBAAkBD,EAAQ,EAAG,EAAG,EAAG,CAAC,CAC7C,CAAC,EAAE,KAAK,UAAY,CAClB,OAAOD,EAAK,YAAY,EAAI,CAC9B,EAAG,UAAY,CACb,OAAOA,EAAK,YAAY,EAAK,CAC/B,CAAC,CACH,CAEA,IAAIG,EAAO,KAAK,IAAI,OAAOJ,EAAc,SAAS,EAAG,UAAU,CAAC,EAC5DK,EAAI,IAAI,OAAO,+BAA+B,OAAOD,CAAI,CAAC,EAE9DC,EAAE,UAAY,SAAUC,EAAI,CAC1B,OAAOb,EAAQa,EAAG,IAAI,CACxB,EAEAD,EAAE,QAAUX,CACd,CAAC,EAAE,KAAK,SAAUrK,EAAQ,CACxB,OAAOA,CACT,EAAG,UAAY,CACb,MAAO,EACT,CAAC,CACH,EAIAxB,EAAO,QAAQ,eAAiB,SAAwB+L,EAAc,CACpE,IAAIW,EAAS,GAEb,GAAI,CACF,IAAIL,EAASN,EAAa,EAAG,CAAC,EAC1BO,EAAMD,EAAO,WAAW,IAAI,EAC5BM,EAAIL,EAAI,gBAAgB,EAAG,CAAC,EAChCK,EAAE,KAAK,CAAC,EAAI,GACZA,EAAE,KAAK,CAAC,EAAI,GACZA,EAAE,KAAK,CAAC,EAAI,GACZA,EAAE,KAAK,CAAC,EAAI,IACZA,EAAE,KAAK,CAAC,EAAI,GACZA,EAAE,KAAK,CAAC,EAAI,GACZA,EAAE,KAAK,CAAC,EAAI,GACZA,EAAE,KAAK,CAAC,EAAI,IACZL,EAAI,aAAaK,EAAG,EAAG,CAAC,EACxBA,EAAI,KACJA,EAAIL,EAAI,aAAa,EAAG,EAAG,EAAG,CAAC,EAE3BK,EAAE,KAAK,CAAC,IAAM,IAAMA,EAAE,KAAK,CAAC,IAAM,IAAMA,EAAE,KAAK,CAAC,IAAM,IAAMA,EAAE,KAAK,CAAC,IAAM,KAAOA,EAAE,KAAK,CAAC,IAAM,IAAMA,EAAE,KAAK,CAAC,IAAM,IAAMA,EAAE,KAAK,CAAC,IAAM,IAAMA,EAAE,KAAK,CAAC,IAAM,MAC7JD,EAAS,GAEb,OAASZ,EAAK,CAAC,CAEf,OAAOY,CACT,EAMA1M,EAAO,QAAQ,mBAAqB,UAA8B,CAChE,OAAO,IAAI,QAAQ,SAAU4L,EAAS,CAEpC,GAAI,OAAO,OAAU,aAAe,OAAO,mBAAsB,YAAa,CAC5EA,EAAQ,EAAK,EACb,MACF,CAEA,IAAIgB,EAAQ,IAAI,MAChBA,EAAM,IAAM,0zBAEZA,EAAM,OAAS,UAAY,CACzB,kBAAkBA,EAAO,EAAG,EAAGA,EAAM,MAAOA,EAAM,MAAM,EAAE,KAAK,SAAUX,EAAQ,CAC3EA,EAAO,QAAUW,EAAM,OAASX,EAAO,SAAWW,EAAM,OAC1DhB,EAAQ,EAAI,EAEZA,EAAQ,EAAK,CAEjB,EAAG,UAAY,CACb,OAAOA,EAAQ,EAAK,CACtB,CAAC,CACH,EAEAgB,EAAM,QAAU,UAAY,CAC1B,OAAOhB,EAAQ,EAAK,CACtB,CACF,CAAC,CACH,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAAS9K,EAAQd,EAAOD,EAAQ,CAE1C,aAEAC,EAAO,QAAU,UAAY,CAC3B,IAAIkB,EAAUJ,EAAQ,WAAW,EAE7B+L,EAGJ,UAAY,SAAmBJ,EAAI,CACjC,IAAIK,EAAWL,EAAG,KAAK,KACnBM,EAAe,GAEnB,GAAI,CAACD,EAAS,KAAOA,EAAS,UAAW,CACvC,IAAIT,EAAS,IAAI,gBAAgBS,EAAS,MAAOA,EAAS,MAAM,EAC5DR,EAAMD,EAAO,WAAW,IAAI,EAChCC,EAAI,UAAUQ,EAAS,UAAW,EAAG,CAAC,EACtCA,EAAS,IAAMR,EAAI,aAAa,EAAG,EAAGQ,EAAS,MAAOA,EAAS,MAAM,EAAE,KACvET,EAAO,MAAQA,EAAO,OAAS,EAC/BA,EAAS,KACTS,EAAS,UAAU,MAAM,EACzBA,EAAS,UAAY,IAGvB,CAEKD,IAASA,EAAU,IAAI3L,EAAQuL,EAAG,KAAK,QAAQ,GAGpD,IAAIjG,EAAOqG,EAAQ,iBAAiBC,CAAQ,EAE5C,GAAIC,EAAc,CAChB,IAAIC,EAAc,IAAI,UAAU,IAAI,kBAAkBxG,CAAI,EAAGsG,EAAS,QAASA,EAAS,QAAQ,EAE5FG,EAAU,IAAI,gBAAgBH,EAAS,QAASA,EAAS,QAAQ,EAEjEI,EAAOD,EAAQ,WAAW,IAAI,EAElCC,EAAK,aAAaF,EAAa,EAAG,CAAC,EAEnC,kBAAkBC,CAAO,EAAE,KAAK,SAAUhB,EAAQ,CAChD,YAAY,CACV,OAAQA,CACV,EAAG,CAACA,CAAM,CAAC,CACb,CAAC,CACH,MACE,YAAY,CACV,KAAMzF,CACR,EAAG,CAACA,EAAK,MAAM,CAAC,CAEpB,CACF,CAEA,EAAE,CAAC,YAAY,CAAC,CAAC,EAAE,GAAG,CAAC,SAAS1F,EAAQd,EAAOD,EAAQ,CAMvD,IAAIoN,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAaC,EAEzC,SAASC,EAAUC,EAAO,CACpBA,EAAQ,KACVA,EAAQ,IAGV,IAAIhN,EAAI,KAAK,IAAI,KAAQ,IAAK,EAAIgN,EAC9BC,EAAK,KAAK,IAAI,CAACjN,CAAC,EAChBkN,EAAK,KAAK,IAAI,GAAKlN,CAAC,EACpBmN,GAAK,EAAIF,IAAO,EAAIA,IAAO,EAAI,EAAIjN,EAAIiN,EAAKC,GAEhD,OAAAX,EAAKY,EACLX,EAAKW,GAAKnN,EAAI,GAAKiN,EACnBR,EAAKU,GAAKnN,EAAI,GAAKiN,EACnBP,EAAK,CAACS,EAAID,EACVP,EAAK,EAAIM,EACTL,EAAK,CAACM,EACNL,GAAeN,EAAKC,IAAO,EAAIG,EAAKC,GACpCE,GAAgBL,EAAKC,IAAO,EAAIC,EAAKC,GAG9B,IAAI,aAAa,CAAEL,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAaC,CAAa,CAAC,CAC/E,CAEA,SAASM,EAAepM,EAAK8F,EAAKuG,EAAMC,EAAO/K,EAAOC,EAAQ,CAG5D,IAAI+K,EAAUC,EAAUC,EAAUC,EAAUC,EACxCC,EAAWC,EAAWC,EACtBjO,GAAGkO,GACHC,EAAUC,EAAUC,EAAUC,EAElC,IAAKtO,GAAI,EAAGA,GAAI2C,EAAQ3C,KAAK,CAe3B,IAdA+N,EAAY/N,GAAI0C,EAChBsL,EAAYhO,GACZiO,EAAa,EAGbP,EAAWvM,EAAI4M,CAAS,EACxBD,EAAgBJ,EAAWD,EAAM,CAAC,EAClCI,EAAWC,EAEXK,EAAWV,EAAM,CAAC,EAClBW,EAAWX,EAAM,CAAC,EAClBY,EAAWZ,EAAM,CAAC,EAClBa,EAAWb,EAAM,CAAC,EAEbS,GAAI,EAAGA,GAAIxL,EAAOwL,KACrBP,EAAWxM,EAAI4M,CAAS,EAExBH,EAAWD,EAAWQ,EACXT,EAAWU,EACXP,EAAWQ,EACXP,EAAgBQ,EAE3BR,EAAgBD,EAChBA,EAAWD,EACXF,EAAWC,EAEXH,EAAKS,CAAU,EAAIJ,EACnBI,IACAF,IAgBF,IAbAA,IACAE,IACAD,GAAarL,GAAUD,EAAQ,GAG/BgL,EAAWvM,EAAI4M,CAAS,EACxBD,EAAgBJ,EAAWD,EAAM,CAAC,EAClCI,EAAWC,EACXH,EAAWD,EAEXS,EAAWV,EAAM,CAAC,EAClBW,EAAWX,EAAM,CAAC,EAEbS,GAAIxL,EAAQ,EAAGwL,IAAK,EAAGA,KAC1BN,EAAWD,EAAWQ,EACXT,EAAWU,EACXP,EAAWQ,EACXP,EAAgBQ,EAE3BR,EAAgBD,EAChBA,EAAWD,EAEXF,EAAWC,EACXA,EAAWxM,EAAI4M,CAAS,EAExB9G,EAAI+G,CAAS,EAAIR,EAAKS,CAAU,EAAIJ,EAEpCE,IACAE,IACAD,GAAarL,CAEjB,CACF,CAGA,SAAS4L,EAAWpN,EAAKuB,EAAOC,EAAQyE,EAAQ,CAE9C,GAAKA,EAEL,KAAIH,EAAW,IAAI,YAAY9F,EAAI,MAAM,EACrCqN,EAAW,IAAI,aAAa,KAAK,IAAI9L,EAAOC,CAAM,CAAC,EAEnD8K,EAAQP,EAAU9F,CAAM,EAE5BmG,EAAepM,EAAK8F,EAAKuH,EAAUf,EAAO/K,EAAOC,EAAQyE,CAAM,EAC/DmG,EAAetG,EAAK9F,EAAKqN,EAAUf,EAAO9K,EAAQD,EAAO0E,CAAM,EACjE,CAEA7H,EAAO,QAAUgP,CAEjB,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASlO,EAAQd,EAAOD,EAAQ,CAC1C,aAGA,IAAImP,EAAiBpO,EAAQ,eAAe,EACxCqO,EAAiBrO,EAAQ,oBAAoB,EAC7CsO,EAAiBtO,EAAQ,iBAAiB,EAG1CuO,EAAkB,CACpB,GAAI,GACJ,KAAM,EACR,EAGA,SAASC,EAAUhO,EAAS,CAC1B,GAAI,EAAE,gBAAgBgO,GAAY,OAAO,IAAIA,EAAUhO,CAAO,EAE9D,IAAIiO,EAAOL,EAAO,CAAC,EAAGG,EAAiB/N,GAAW,CAAC,CAAC,EAapD,GAXA,KAAK,QAAkBiO,EAEvB,KAAK,QAAkB,CAAC,EAExB,KAAK,eAAkB,KACvB,KAAK,UAAkBA,EAAK,SAAW,CAAC,EACxC,KAAK,SAAkB,KACvB,KAAK,OAAkB,CAAC,EAExB,KAAK,OAAW,IAAI,YAAa,IAAI,WAAW,CAAE,EAAG,EAAG,EAAG,CAAE,CAAC,EAAG,MAAM,EAAG,CAAC,IAAM,EAE7E,CAAC,KAAK,QAAQ,IAAM,CAAC,KAAK,QAAQ,KACpC,MAAM,IAAI,MAAM,oDAAoD,CAExE,CAGAD,EAAU,UAAU,SAAWF,EAG/BE,EAAU,UAAU,IAAM,SAAUtP,EAAQ,CAC1C,YAAK,UAAUA,EAAO,IAAI,EAAIA,EAG1B,KAAK,QAAQ,MAAQ,KAAK,SAAS,GAAKA,EAAO,QACjD,KAAKA,EAAO,IAAI,EAAIA,EAAO,QAE3B,KAAKA,EAAO,IAAI,EAAIA,EAAO,GAGtB,IACT,EAGAsP,EAAU,UAAU,KAAO,UAAY,CACrC,GAAI,KAAK,eAAgB,OAAO,KAAK,eAErC,GAAI,CAAC,KAAK,QAAQ,IAAM,KAAK,QAAQ,MAAQ,CAAC,KAAK,SAAS,EAC1D,OAAO,QAAQ,OAAO,IAAI,MAAM,0DAA2D,CAAC,EAG9F,IAAIlD,EAAO,KAEX,YAAK,eAAiB,QAAQ,IAAI,OAAO,KAAKA,EAAK,SAAS,EAAE,IAAI,SAAUoD,EAAM,CAChF,IAAIxP,EAASoM,EAAK,UAAUoD,CAAI,EAKhC,MAHI,CAACpD,EAAK,QAAQ,MAAQ,CAACA,EAAK,SAAS,GAAK,CAACpM,EAAO,SAGlDoM,EAAK,OAAOoD,CAAI,EAAU,KAGvB,YAAY,QAAQpD,EAAK,eAAepM,EAAO,QAAQ,CAAC,EAC5D,KAAK,SAAUyP,EAAG,CAAErD,EAAK,OAAOoD,CAAI,EAAIC,CAAG,CAAC,CACjD,CAAC,CAAC,EACC,KAAK,UAAY,CAAE,OAAOrD,CAAM,CAAC,EAE7B,KAAK,cACd,EAUAkD,EAAU,UAAU,eAAiBH,EAOrCG,EAAU,UAAU,aAAe,SAAqBI,EAAO,CAC7D,GAAI,CAAC,KAAK,SACR,YAAK,SAAW,IAAI,YAAY,OAAO,CACrC,QAAS,KAAK,KAAKA,GAAS,GAAK,KAAK,CACxC,CAAC,EACM,KAAK,SAGd,IAAIC,EAAW,KAAK,SAAS,OAAO,WAEpC,OAAIA,EAAWD,GACb,KAAK,SAAS,KAAK,KAAK,MAAMA,EAAQC,IAAa,GAAK,KAAK,CAAC,EAGzD,KAAK,QACd,EAWAL,EAAU,UAAU,WAAa,SAAkBE,EAAMI,EAASC,EAAW,CAI3E,GAHID,GAAS,KAAK,aAAaA,CAAO,EAGlC,CAAC,KAAK,OAAOJ,CAAI,EAAG,CACtB,IAAIxP,EAAS,KAAK,UAAUwP,CAAI,EAChC,KAAK,OAAOA,CAAI,EAAI,IAAI,YAAY,OAAO,KAAK,eAAexP,EAAO,QAAQ,CAAC,CACjF,CAEA,GAAI,CAAC,KAAK,QAAQwP,CAAI,EAAG,CACvB,IAAIM,EAAW,CACb,WAAY,EACZ,OAAQ,KAAK,SACb,UAAW,EACX,MAAO,IAAI,YAAY,MAAM,CAAE,QAAS,EAAG,QAAS,SAAU,CAAC,CACjE,EAEA,KAAK,QAAQN,CAAI,EAAI,IAAI,YAAY,SAAS,KAAK,OAAOA,CAAI,EAAG,CAC/D,IAAKN,EAAOY,EAAUD,GAAa,CAAC,CAAC,CACvC,CAAC,CACH,CAEA,OAAO,KAAK,QAAQL,CAAI,CAC1B,EAMAF,EAAU,UAAU,QAAU,SAAeS,EAAQC,EAAM,CACzDA,EAAOA,GAAQ,EACf,IAAIC,EAAWF,EAASC,EACxB,OAAOD,GAAUE,EAAWD,EAAOC,EAAW,EAChD,EAGAjQ,EAAO,QAAUsP,CAEjB,EAAE,CAAC,qBAAqB,GAAG,kBAAkB,GAAG,gBAAgB,EAAE,CAAC,EAAE,GAAG,CAAC,SAASxO,EAAQd,EAAOD,EAAQ,CAGzG,aAGA,IAAImQ,EAAa,mEAGjBlQ,EAAO,QAAU,SAAsBmQ,EAAK,CAW1C,QAVIC,EAAQD,EAAI,QAAQ,WAAY,EAAE,EAClCxI,EAAQyI,EAAM,OAEd1I,EAAM,IAAI,WAAYC,EAAM,GAAM,CAAC,EAInC0I,EAAO,EACPhN,EAAO,EAEFkC,EAAM,EAAGA,EAAMoC,EAAKpC,IACtBA,EAAM,IAAM,GAAMA,IACrBmC,EAAIrE,GAAK,EAAKgN,GAAQ,GAAM,IAC5B3I,EAAIrE,GAAK,EAAKgN,GAAQ,EAAK,IAC3B3I,EAAIrE,GAAK,EAAIgN,EAAO,KAGtBA,EAAQA,GAAQ,EAAKH,EAAW,QAAQE,EAAM,OAAO7K,CAAG,CAAC,EAK3D,IAAI+K,EAAY3I,EAAM,EAAK,EAE3B,OAAI2I,IAAa,GACf5I,EAAIrE,GAAK,EAAKgN,GAAQ,GAAM,IAC5B3I,EAAIrE,GAAK,EAAKgN,GAAQ,EAAK,IAC3B3I,EAAIrE,GAAK,EAAIgN,EAAO,KACXC,IAAa,IACtB5I,EAAIrE,GAAK,EAAKgN,GAAQ,GAAM,IAC5B3I,EAAIrE,GAAK,EAAKgN,GAAQ,EAAK,KAClBC,IAAa,KACtB5I,EAAIrE,GAAK,EAAKgN,GAAQ,EAAK,KAGtB3I,CACT,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAAS5G,EAAQd,EAAOD,EAAQ,CAK1C,aAGA,IAAIwQ,EAGJvQ,EAAO,QAAU,UAA0B,CAMzC,GAJI,OAAOuQ,GAAO,cAElBA,EAAK,GAED,OAAO,aAAgB,aAAa,OAAOA,EAG/C,GAAI,CAKF,IAAIC,EAAW,IAAI,WAAW,CAAE,EAAE,GAAG,IAAI,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,IAAI,IAAI,IAAI,IAAI,EAAE,EAAE,GAAG,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,EAAG,CAAC,EAClKxQ,EAAW,IAAI,YAAY,OAAOwQ,CAAG,EACrCxJ,EAAW,IAAI,YAAY,SAAShH,EAAQ,CAAC,CAAC,EAIlD,OAAIgH,EAAS,QAAQ,KAAK,CAAC,IAAM,IAAGuJ,EAAK,IAElCA,CACT,OAASnK,EAAI,CAAC,CAEd,OAAOmK,CACT,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASzP,EAAQd,EAAOD,EAAQ,CAO1C,aAEA,IAAI0Q,EAAwB,OAAO,sBAC/BC,EAAiB,OAAO,UAAU,eAClCC,EAAmB,OAAO,UAAU,qBAExC,SAASC,EAASC,EAAK,CACtB,GAAIA,GAAQ,KACX,MAAM,IAAI,UAAU,uDAAuD,EAG5E,OAAO,OAAOA,CAAG,CAClB,CAEA,SAASC,GAAkB,CAC1B,GAAI,CACH,GAAI,CAAC,OAAO,OACX,MAAO,GAMR,IAAIC,EAAQ,IAAI,OAAO,KAAK,EAE5B,GADAA,EAAM,CAAC,EAAI,KACP,OAAO,oBAAoBA,CAAK,EAAE,CAAC,IAAM,IAC5C,MAAO,GAKR,QADIC,EAAQ,CAAC,EACJvQ,EAAI,EAAGA,EAAI,GAAIA,IACvBuQ,EAAM,IAAM,OAAO,aAAavQ,CAAC,CAAC,EAAIA,EAEvC,IAAIwQ,EAAS,OAAO,oBAAoBD,CAAK,EAAE,IAAI,SAAU1Q,EAAG,CAC/D,OAAO0Q,EAAM1Q,CAAC,CACf,CAAC,EACD,GAAI2Q,EAAO,KAAK,EAAE,IAAM,aACvB,MAAO,GAIR,IAAIC,EAAQ,CAAC,EAIb,MAHA,uBAAuB,MAAM,EAAE,EAAE,QAAQ,SAAUC,EAAQ,CAC1DD,EAAMC,CAAM,EAAIA,CACjB,CAAC,EACG,OAAO,KAAK,OAAO,OAAO,CAAC,EAAGD,CAAK,CAAC,EAAE,KAAK,EAAE,IAC/C,sBAKH,OAASpF,EAAK,CAEb,MAAO,EACR,CACD,CAEA9L,EAAO,QAAU8Q,EAAgB,EAAI,OAAO,OAAS,SAAUxK,EAAQ8K,EAAQ,CAK9E,QAJIC,EACAC,EAAKV,EAAStK,CAAM,EACpBiL,EAEKC,EAAI,EAAGA,EAAI,UAAU,OAAQA,IAAK,CAC1CH,EAAO,OAAO,UAAUG,CAAC,CAAC,EAE1B,QAASC,KAAOJ,EACXX,EAAe,KAAKW,EAAMI,CAAG,IAChCH,EAAGG,CAAG,EAAIJ,EAAKI,CAAG,GAIpB,GAAIhB,EAAuB,CAC1Bc,EAAUd,EAAsBY,CAAI,EACpC,QAAS5Q,EAAI,EAAGA,EAAI8Q,EAAQ,OAAQ9Q,IAC/BkQ,EAAiB,KAAKU,EAAME,EAAQ9Q,CAAC,CAAC,IACzC6Q,EAAGC,EAAQ9Q,CAAC,CAAC,EAAI4Q,EAAKE,EAAQ9Q,CAAC,CAAC,EAGnC,CACD,CAEA,OAAO6Q,CACR,CAEA,EAAE,CAAC,CAAC,EAAE,GAAG,CAAC,SAASxQ,EAAQd,EAAOD,EAAQ,CAC1C,IAAI2R,EAAW,UAAU,CAAC,EACtBC,EAAU,UAAU,CAAC,EACrBpQ,EAAQ,UAAU,CAAC,EAEnBqQ,EAAY,KAAK,UAErB5R,EAAO,QAAU,SAAUoH,EAAI9F,EAAS,CAIpC,QAHIuQ,EACAC,EAAY,OAAO,KAAKvQ,CAAK,EAExBd,EAAI,EAAGsR,EAAID,EAAU,OAAQrR,EAAIsR,EAAGtR,IAAK,CAC9C,IAAIgR,EAAMK,EAAUrR,CAAC,EACjBuR,EAAMzQ,EAAMkQ,CAAG,EAAE,QAKrB,GAAIO,IAAQ5K,GAAM4K,GAAOA,EAAI,UAAY5K,EAAI,CACzCyK,EAAOJ,EACP,KACJ,CACJ,CAEA,GAAI,CAACI,EAAM,CACPA,EAAO,KAAK,MAAM,KAAK,IAAI,GAAI,CAAC,EAAI,KAAK,OAAO,CAAC,EAAE,SAAS,EAAE,EAE9D,QADII,EAAS,CAAC,EACLxR,EAAI,EAAGsR,EAAID,EAAU,OAAQrR,EAAIsR,EAAGtR,IAAK,CAC9C,IAAIgR,EAAMK,EAAUrR,CAAC,EACrBwR,EAAOR,CAAG,EAAIA,CAClB,CACAE,EAAQE,CAAI,EAAI,CACZ,oCAAsCzK,EAAK,YAC3C6K,CACJ,CACJ,CACA,IAAIC,EAAO,KAAK,MAAM,KAAK,IAAI,GAAI,CAAC,EAAI,KAAK,OAAO,CAAC,EAAE,SAAS,EAAE,EAE9DC,EAAS,CAAC,EAAGA,EAAON,CAAI,EAAIA,EAChCF,EAAQO,CAAI,EAAI,CACZ,oDAEyBN,EAAUC,CAAI,EAAI,wCAG3CM,CACJ,EAEA,IAAIC,EAAgB,CAAC,EACrBC,EAAeH,CAAI,EAEnB,SAASG,EAAeZ,EAAK,CACzBW,EAAcX,CAAG,EAAI,GAErB,QAASa,KAAWX,EAAQF,CAAG,EAAE,CAAC,EAAG,CACjC,IAAIc,EAASZ,EAAQF,CAAG,EAAE,CAAC,EAAEa,CAAO,EAC/BF,EAAcG,CAAM,GACrBF,EAAeE,CAAM,CAE7B,CACJ,CAEA,IAAI3Q,EAAM,IAAM8P,EAAW,MACrB,OAAO,KAAKU,CAAa,EAAE,IAAI,SAAUX,EAAK,CAC5C,OAAOG,EAAUH,CAAG,EAAI,KAClBE,EAAQF,CAAG,EAAE,CAAC,EACd,IAAMG,EAAUD,EAAQF,CAAG,EAAE,CAAC,CAAC,EAAI,GAE7C,CAAC,EAAE,KAAK,GAAG,EACT,SAAWG,EAAUM,CAAI,EAAI,KAG/BM,EAAM,OAAO,KAAO,OAAO,WAAa,OAAO,QAAU,OAAO,MAEhEC,EAAO,IAAI,KAAK,CAAC7Q,CAAG,EAAG,CAAE,KAAM,iBAAkB,CAAC,EACtD,GAAIN,GAAWA,EAAQ,KAAQ,OAAOmR,EACtC,IAAIC,EAAYF,EAAI,gBAAgBC,CAAI,EACpCE,EAAS,IAAI,OAAOD,CAAS,EACjC,OAAAC,EAAO,UAAYD,EACZC,CACX,CAEA,EAAE,CAAC,CAAC,EAAE,YAAY,CAAC,SAAS7R,EAAQd,EAAOD,EAAQ,CACnD,aAEA,SAAS6S,EAAeC,EAAKpS,EAAG,CAAE,OAAOqS,EAAgBD,CAAG,GAAKE,EAAsBF,EAAKpS,CAAC,GAAKuS,EAA4BH,EAAKpS,CAAC,GAAKwS,EAAiB,CAAG,CAE7J,SAASA,GAAmB,CAAE,MAAM,IAAI,UAAU;AAAA,mFAA2I,CAAG,CAEhM,SAASD,EAA4BxS,EAAG0S,EAAQ,CAAE,GAAK1S,EAAW,IAAI,OAAOA,GAAM,SAAU,OAAO2S,EAAkB3S,EAAG0S,CAAM,EAAG,IAAI5S,EAAI,OAAO,UAAU,SAAS,KAAKE,CAAC,EAAE,MAAM,EAAG,EAAE,EAAgE,GAAzDF,IAAM,UAAYE,EAAE,cAAaF,EAAIE,EAAE,YAAY,MAAUF,IAAM,OAASA,IAAM,MAAO,OAAO,MAAM,KAAKE,CAAC,EAAG,GAAIF,IAAM,aAAe,2CAA2C,KAAKA,CAAC,EAAG,OAAO6S,EAAkB3S,EAAG0S,CAAM,EAAG,CAE/Z,SAASC,EAAkBN,EAAKvP,EAAK,EAAMA,GAAO,MAAQA,EAAMuP,EAAI,UAAQvP,EAAMuP,EAAI,QAAQ,QAASpS,EAAI,EAAG2S,EAAO,IAAI,MAAM9P,CAAG,EAAG7C,EAAI6C,EAAK7C,IAAO2S,EAAK3S,CAAC,EAAIoS,EAAIpS,CAAC,EAAK,OAAO2S,CAAM,CAEtL,SAASL,EAAsBF,EAAKpS,EAAG,CAAE,IAAI4S,EAAKR,GAAO,KAAO,KAAO,OAAO,QAAW,aAAeA,EAAI,OAAO,QAAQ,GAAKA,EAAI,YAAY,EAAG,GAAIQ,GAAM,KAAc,KAAIC,EAAO,CAAC,EAAOC,EAAK,GAAUC,GAAK,GAAWC,EAAIC,EAAI,GAAI,CAAE,IAAKL,EAAKA,EAAG,KAAKR,CAAG,EAAG,EAAEU,GAAME,EAAKJ,EAAG,KAAK,GAAG,QAAoBC,EAAK,KAAKG,EAAG,KAAK,EAAO,EAAAhT,GAAK6S,EAAK,SAAW7S,IAA3D8S,EAAK,GAA6B,CAAqC,OAASzH,GAAK,CAAE0H,GAAK,GAAME,EAAK5H,EAAK,QAAE,CAAU,GAAI,CAAM,CAACyH,GAAMF,EAAG,QAAa,MAAMA,EAAG,OAAU,CAAG,QAAE,CAAU,GAAIG,GAAI,MAAME,CAAI,CAAE,CAAE,OAAOJ,EAAM,CAEhgB,SAASR,EAAgBD,EAAK,CAAE,GAAI,MAAM,QAAQA,CAAG,EAAG,OAAOA,CAAK,CAEpE,IAAI3D,EAASpO,EAAQ,eAAe,EAEhC6S,EAAa7S,EAAQ,YAAY,EAEjCI,EAAUJ,EAAQ,eAAe,EAEjCwI,EAAOxI,EAAQ,YAAY,EAE3B8S,EAAQ9S,EAAQ,aAAa,EAE7B6R,EAAS7R,EAAQ,cAAc,EAE/B+S,EAAe/S,EAAQ,eAAe,EAEtCgT,EAAgBhT,EAAQ,aAAa,EAErCiT,EAAcjT,EAAQ,oCAAoC,EAI1DkT,EAAc,CAAC,EACfC,EAAkB,GAEtB,GAAI,CACE,OAAO,WAAc,aAAe,UAAU,YAChDA,EAAkB,UAAU,UAAU,QAAQ,QAAQ,GAAK,EAE/D,OAAS5T,EAAG,CAAC,CAEb,IAAImL,EAAc,EAEd,OAAO,WAAc,cACvBA,EAAc,KAAK,IAAI,UAAU,qBAAuB,EAAG,CAAC,GAG9D,IAAI0I,EAAoB,CACtB,KAAM,KACN,YAAa1I,EACb,SAAU,CAAC,KAAM,OAAQ,IAAI,EAC7B,KAAM,IACN,aAAc,SAAsBrI,EAAOC,EAAQ,CACjD,IAAI+Q,EAAY,SAAS,cAAc,QAAQ,EAC/C,OAAAA,EAAU,MAAQhR,EAClBgR,EAAU,OAAS/Q,EACZ+Q,CACT,CACF,EACIC,EAAsB,CACxB,OAAQ,UACR,cAAe,EACf,cAAe,EACf,iBAAkB,CACpB,EACIC,EAAqB,GACrBC,EAA0B,GAC1BC,EAAgC,GAChCC,EAA2B,GAC3BC,EAA+B,GAEnC,SAASC,IAAe,CACtB,MAAO,CACL,MAAOf,EAAWhB,CAAM,EACxB,QAAS,UAAmB,CAG1B,GAFA,KAAK,MAAM,UAAU,EAEjB,OAAO,QAAW,YAAa,CACjC,IAAIgC,EAAM,OAAO,KAAO,OAAO,WAAa,OAAO,QAAU,OAAO,MAEhEA,GAAOA,EAAI,iBAAmB,KAAK,MAAM,WAC3CA,EAAI,gBAAgB,KAAK,MAAM,SAAS,CAE5C,CACF,CACF,CACF,CAIA,SAASC,GAAKtT,EAAS,CACrB,GAAI,EAAE,gBAAgBsT,IAAO,OAAO,IAAIA,GAAKtT,CAAO,EACpD,KAAK,QAAU4N,EAAO,CAAC,EAAGgF,EAAmB5S,GAAW,CAAC,CAAC,EAC1D,IAAIuT,EAAc,MAAM,OAAO,KAAK,QAAQ,WAAW,EAGvD,KAAK,QAAUb,EAAYa,CAAW,GAAKjB,EAAM,QAAQ,KAAK,QAAQ,WAAW,EAC5EI,EAAYa,CAAW,IAAGb,EAAYa,CAAW,EAAI,KAAK,SAE/D,KAAK,SAAW,CACd,GAAI,GAEJ,KAAM,GAEN,IAAK,GAEL,GAAI,EAEN,EACA,KAAK,cAAgB,KAErB,KAAK,qBAAuB,CAAC,EAC7B,KAAK,UAAY,IACnB,CAEAD,GAAK,UAAU,KAAO,UAAY,CAChC,IAAInL,EAAQ,KAEZ,GAAI,KAAK,cAAe,OAAO,KAAK,cAEpC,GAAI,OAAO,WAAc,aAAe,OAAO,mBAAsB,YACnE,GAAI,CAEF,IAAI,UAAU,IAAI,kBAAkB,GAAG,EAAG,GAAI,EAAE,EAChD4K,EAAqB,EACvB,OAASjO,GAAI,CAAC,CAUZ,OAAO,aAAgB,cACrB,YAAY,WAAa,YAAY,UAAU,MACjDkO,EAA0B,GAE1B,KAAK,MAAM,iDAAiD,GAIhE,IAAIjT,EAAW,KAAK,QAAQ,SAAS,MAAM,EAS3C,GAPIA,EAAS,QAAQ,KAAK,GAAK,IAC7BA,EAAW,CAAC,MAAO,OAAQ,KAAM,IAAI,GAGvC,KAAK,qBAAuBA,EAC5B,KAAK,UAAY,IAAIH,EAAQG,CAAQ,EAEjCA,EAAS,QAAQ,IAAI,GAAK,GACxB,OAAO,QAAW,aAAe,WAAY,OAG/C,GAAI,CACF,IAAIyT,EAAMhU,EAAQ,YAAY,EAAE,UAAY,CAAC,CAAC,EAE9CgU,EAAI,UAAU,EACd,KAAK,SAAS,GAAK,GAEnB,IAAIC,EAAY,MAAM,OAAO,KAAK,UAAU,KAAK,OAAO,CAAC,EAErDf,EAAYe,CAAS,EACvB,KAAK,cAAgBf,EAAYe,CAAS,GAE1C,KAAK,cAAgB,IAAIzL,EAAKoL,GAAc,KAAK,QAAQ,IAAI,EAC7DV,EAAYe,CAAS,EAAI,KAAK,cAElC,OAAS3O,GAAI,CAAC,CAIlB,IAAI4O,EAAW,KAAK,UAAU,KAAK,EAAE,KAAK,SAAUC,GAAS,CAE3D/F,EAAOzF,EAAM,SAAUwL,GAAQ,QAAQ,CACzC,CAAC,EAEGC,GAECZ,EAGHY,GAAiBtB,EAAM,YAAY,KAAK,QAAQ,YAAY,EAAE,KAAK,SAAU1H,GAAQ,CACnF,GAAIzC,EAAM,SAAS,KAAOpI,EAAS,QAAQ,KAAK,EAAI,EAAG,CACrDoI,EAAM,MAAM,8DAA8D,EAE1E,MACF,CAEIpI,EAAS,QAAQ,KAAK,GAAK,IAAGoI,EAAM,SAAS,IAAMyC,GACzD,CAAC,EAVDgJ,GAAiB,QAAQ,QAAQ,EAAK,EAaxCX,EAAgCX,EAAM,eAAe,KAAK,QAAQ,YAAY,EAC9E,IAAIuB,EAEAb,GAA2BD,GAAsBhT,EAAS,QAAQ,IAAI,IAAM,GAC9E8T,EAAuBvB,EAAM,gCAAgC,EAE7DuB,EAAuB,QAAQ,QAAQ,EAAK,EAG9CA,EAAuBA,EAAqB,KAAK,SAAU3T,GAAQ,CACjEgT,EAA2BhT,EAC7B,CAAC,EAID,IAAI4T,EAAiBxB,EAAM,mBAAmB,EAAE,KAAK,SAAUpS,GAAQ,CACrEiT,EAA+BjT,EACjC,CAAC,EAED,YAAK,cAAgB,QAAQ,IAAI,CAACwT,EAAUE,GAAgBC,EAAsBC,CAAc,CAAC,EAAE,KAAK,UAAY,CAClH,OAAO3L,CACT,CAAC,EACM,KAAK,aACd,EAGAmL,GAAK,UAAU,eAAiB,SAAU9H,EAAUyC,EAAM,CACxD,IAAI5F,EAAS,KAOb,OAAA4F,EAAK,YAAcA,EAAK,aAAe,CAAC,EACjC,QAAQ,QAAQ,EAAE,KAAK,UAAY,CACxC,OAAK5F,EAAO,SAAS,GAOd,IAAI,QAAQ,SAAUiC,EAASC,EAAQ,CAC5C,IAAIW,GAAI7C,EAAO,cAAc,QAAQ,EAEjC4F,EAAK,aAAaA,EAAK,YAAY,MAAS,SAAUzD,EAAK,CAC7D,OAAOD,EAAOC,CAAG,CACnB,CAAC,EAEDU,GAAE,MAAM,UAAY,SAAUC,EAAI,CAChCD,GAAE,QAAQ,EACNC,EAAG,KAAK,IAAKZ,EAAOY,EAAG,KAAK,GAAG,EAAOb,EAAQa,EAAG,IAAI,CAC3D,EAEA,IAAI4I,EAAW,CAAC,EACZvI,EAAS,KAAKuI,EAAS,KAAKvI,EAAS,IAAI,MAAM,EAC/CA,EAAS,WAAWuI,EAAS,KAAKvI,EAAS,SAAS,EACxDN,GAAE,MAAM,YAAY,CAClB,KAAMM,EACN,SAAUnD,EAAO,qBACjB,QAAS,CACP,YAAaA,EAAO,UAAU,EAChC,CACF,EAAG0L,CAAQ,CACb,CAAC,EA3BQ,CACL,KAAM1L,EAAO,UAAU,iBAAiBmD,EAAUyC,EAAK,WAAW,CACpE,CA0BJ,CAAC,CACH,EAGAqF,GAAK,UAAU,kBAAoB,SAAUzJ,EAAMkG,EAAM9B,EAAM+F,EAAUC,EAAW,CAClF,GAAI,KAAK,SAAS,IAAMf,IAGxBZ,EAAM,SAASvC,CAAI,GAAKoD,GACtB,YAAK,MAAM,iCAAiC,EACrC,kBAAkBa,EAAS,gBAAkBjE,EAAMlG,EAAK,EAAGA,EAAK,EAAGA,EAAK,MAAOA,EAAK,MAAM,EAAE,KAAK,SAAUc,EAAQ,CACxH,OAAAsJ,EAAU,UAAYtJ,EACfsJ,CACT,CAAC,EAIH,GAAI3B,EAAM,SAASvC,CAAI,EACrB,OAAKiE,EAAS,SAAQA,EAAS,OAASjE,EAAK,WAAW,IAAI,GAE5D,KAAK,MAAM,qBAAqB,EAChCkE,EAAU,IAAMD,EAAS,OAAO,aAAanK,EAAK,EAAGA,EAAK,EAAGA,EAAK,MAAOA,EAAK,MAAM,EAAE,KAC/EoK,EAQT,KAAK,MAAM,iDAAiD,EAC5D,IAAIpB,GAAY,KAAK,QAAQ,aAAahJ,EAAK,MAAOA,EAAK,MAAM,EAC7DqK,EAASrB,GAAU,WAAW,IAAI,EACtC,OAAAqB,EAAO,yBAA2B,OAClCA,EAAO,UAAUF,EAAS,gBAAkBjE,EAAMlG,EAAK,EAAGA,EAAK,EAAGA,EAAK,MAAOA,EAAK,OAAQ,EAAG,EAAGA,EAAK,MAAOA,EAAK,MAAM,EACxH,KAAK,MAAM,qBAAqB,EAChCoK,EAAU,IAAMC,EAAO,aAAa,EAAG,EAAGrK,EAAK,MAAOA,EAAK,MAAM,EAAE,KAGnEgJ,GAAU,MAAQA,GAAU,OAAS,EAC9BoB,CACT,EAEAX,GAAK,UAAU,eAAiB,SAAUzJ,EAAM3J,EAAQ8T,EAAU,CAChE,IAAItI,EAGJ,GAFA,KAAK,MAAM,2CAA2C,EAElDxL,EAAO,OACT,OAAA8T,EAAS,MAAM,UAAU9T,EAAO,OAAQ2J,EAAK,IAAKA,EAAK,GAAG,EACnD,KAGT,GAAIkJ,EAGFrH,EAAc,IAAI,UAAU,IAAI,kBAAkBxL,EAAO,IAAI,EAAG2J,EAAK,QAASA,EAAK,QAAQ,UAI3F6B,EAAcsI,EAAS,MAAM,gBAAgBnK,EAAK,QAASA,EAAK,QAAQ,EAEpE6B,EAAY,KAAK,IACnBA,EAAY,KAAK,IAAIxL,EAAO,IAAI,MAGhC,SAASf,EAAIuM,EAAY,KAAK,OAAS,EAAGvM,GAAK,EAAGA,IAChDuM,EAAY,KAAKvM,CAAC,EAAIe,EAAO,KAAKf,CAAC,EAKzC,YAAK,MAAM,WAAW,EAElBwT,EAEFqB,EAAS,MAAM,aAAatI,EAAa7B,EAAK,IAAKA,EAAK,IAAKA,EAAK,SAAWA,EAAK,IAAKA,EAAK,SAAWA,EAAK,IAAKA,EAAK,aAAe,KAAMA,EAAK,cAAgB,IAAI,EAEpKmK,EAAS,MAAM,aAAatI,EAAa7B,EAAK,IAAKA,EAAK,IAAKA,EAAK,SAAWA,EAAK,IAAKA,EAAK,SAAWA,EAAK,IAAKA,EAAK,aAAcA,EAAK,aAAa,EAGjJ,IACT,EAEAyJ,GAAK,UAAU,gBAAkB,SAAUvD,EAAMC,EAAI/B,EAAM,CACzD,IAAI3F,EAAS,KAET0L,EAAW,CACb,OAAQ,KACR,eAAgB,KAChB,oBAAqB,GACrB,MAAO,IACT,EAEIG,GAAc,SAAqBtK,EAAM,CAC3C,OAAOvB,EAAO,QAAQ,UAAY,CAChC,GAAI2F,EAAK,SAAU,OAAOA,EAAK,YAC/B,IAAIzC,GAAW,CACb,MAAO3B,EAAK,MACZ,OAAQA,EAAK,OACb,QAASA,EAAK,QACd,SAAUA,EAAK,SACf,OAAQA,EAAK,OACb,OAAQA,EAAK,OACb,QAASA,EAAK,QACd,QAASA,EAAK,QACd,OAAQoE,EAAK,OACb,cAAeA,EAAK,cACpB,cAAeA,EAAK,cACpB,iBAAkBA,EAAK,gBACzB,EAEA,OAAA3F,EAAO,MAAM,oBAAoB,EAE1B,QAAQ,QAAQkD,EAAQ,EAAE,KAAK,SAAUA,GAAU,CACxD,OAAOlD,EAAO,kBAAkBuB,EAAMkG,EAAM9B,EAAM+F,EAAUxI,EAAQ,CACtE,CAAC,EAAE,KAAK,SAAUA,GAAU,CAC1B,OAAAlD,EAAO,MAAM,oBAAoB,EAE1BA,EAAO,eAAekD,GAAUyC,CAAI,CAC7C,CAAC,EAAE,KAAK,SAAU/N,GAAQ,CACxB,OAAI+N,EAAK,SAAiBA,EAAK,aAC/B+F,EAAS,aAAe,KACjB1L,EAAO,eAAeuB,EAAM3J,GAAQ8T,CAAQ,EACrD,CAAC,CACH,CAAC,CACH,EAIA,OAAO,QAAQ,QAAQ,EAAE,KAAK,UAAY,CAExC,GADAA,EAAS,MAAQhE,EAAG,WAAW,IAAI,EAC/BsC,EAAM,SAASvC,CAAI,EAAG,OAAO,KAEjC,GAAIuC,EAAM,cAAcvC,CAAI,EAC1B,OAAAiE,EAAS,eAAiBjE,EAC1BiE,EAAS,oBAAsB,GACxB,KAGT,GAAI1B,EAAM,QAAQvC,CAAI,EAGpB,OAAKiD,GAEL1K,EAAO,MAAM,oCAAoC,EAE1C,kBAAkByH,CAAI,EAAE,KAAK,SAAUqE,EAAa,CACzDJ,EAAS,eAAiBI,CAC5B,CAAC,EAIA,MAAS,SAAUrV,EAAG,CACrB,OAAO,IACT,CAAC,GAZoC,KAevC,MAAM,IAAI,MAAM,sDAAsD,CACxE,CAAC,EAAE,KAAK,UAAY,CAClB,GAAIkP,EAAK,SAAU,OAAOA,EAAK,YAE/B3F,EAAO,MAAM,iBAAiB,EAM9B,IAAI+L,EAAU7B,EAAc,CAC1B,MAAOvE,EAAK,MACZ,OAAQA,EAAK,OACb,YAAa3F,EAAO,QAAQ,KAC5B,QAAS2F,EAAK,QACd,SAAUA,EAAK,SACf,eAAgBA,EAAK,gBACvB,CAAC,EACGqG,EAAOD,EAAQ,IAAI,SAAUxK,GAAM,CACrC,OAAOsK,GAAYtK,EAAI,CACzB,CAAC,EAED,SAAS0K,GAAQP,GAAU,CACrBA,GAAS,iBACNA,GAAS,qBAAqBA,GAAS,eAAe,MAAM,EACjEA,GAAS,eAAiB,KAE9B,CAEA,OAAA1L,EAAO,MAAM,eAAe,EAErB,QAAQ,IAAIgM,CAAI,EAAE,KAAK,UAAY,CACxC,OAAAhM,EAAO,MAAM,WAAW,EAExBiM,GAAQP,CAAQ,EACThE,CACT,EAAG,SAAUxF,GAAK,CAChB,MAAA+J,GAAQP,CAAQ,EACVxJ,EACR,CAAC,CACH,CAAC,CACH,EAEA8I,GAAK,UAAU,gBAAkB,SAAUkB,EAAQzE,EAAMC,EAAI/B,EAAM,CACjE,IAAIwG,EAAS,KAEb,GAAIxG,EAAK,SAAU,OAAOA,EAAK,YAE/B,IAAIyG,GAAgBF,EAAO,MAAM,EAC7BG,EAAiBrD,EAAeoD,GAAe,CAAC,EAChD/L,EAAUgM,EAAe,CAAC,EAC1B/L,GAAW+L,EAAe,CAAC,EAE3BC,GAAcJ,EAAO,SAAW,EAQhChS,GACAoS,IAAenC,EAAY,IAAI,QAAQxE,EAAK,MAAM,EAAI,EAAGzL,GAASyL,EAAK,OAAgBA,EAAK,SAAW,MAAOzL,GAAS,MAAWA,GAAS,UAC/IyL,EAAOL,EAAO,CAAC,EAAGK,EAAM,CACtB,QAAStF,EACT,SAAUC,GACV,OAAQpG,EACV,CAAC,EACD,IAAIqQ,GAEJ,OAAK+B,KAEH/B,GAAY,KAAK,QAAQ,aAAalK,EAASC,EAAQ,GAGlD,KAAK,gBAAgBmH,EAAM6E,GAAc5E,EAAK6C,GAAW5E,CAAI,EAAE,KAAK,UAAY,CACrF,OAAI2G,GAAoB5E,GACxB/B,EAAK,MAAQtF,EACbsF,EAAK,OAASrF,GACP6L,EAAO,gBAAgBD,EAAQ3B,GAAW7C,EAAI/B,CAAI,EAC3D,CAAC,EAAE,KAAK,SAAU4G,GAAK,CACrB,OAAIhC,KAGFA,GAAU,MAAQA,GAAU,OAAS,GAGhCgC,EACT,CAAC,CACH,EAEAvB,GAAK,UAAU,6BAA+B,SAAUvD,EAAMC,EAAI/B,EAAM,CACtE,IAAI6G,EAAS,KAETC,EAAQ/E,EAAG,WAAW,IAAI,EAC9B,YAAK,MAAM,gCAAgC,EACpC,kBAAkBD,EAAM,CAC7B,YAAa9B,EAAK,QAClB,aAAcA,EAAK,SACnB,cAAeqE,EAAM,iBAAiBG,EAAY,IAAIxE,EAAK,MAAM,CAAC,CACpE,CAAC,EAAE,KAAK,SAAUmG,GAAa,CAC7B,GAAInG,EAAK,SAAU,OAAOA,EAAK,YAE/B,GAAI,CAACA,EAAK,cACR,OAAA8G,EAAM,UAAUX,GAAa,EAAG,CAAC,EACjCA,GAAY,MAAM,EAClBW,EAAQ,KAERD,EAAO,MAAM,WAAW,EAEjB9E,EAGT8E,EAAO,MAAM,gBAAgB,EAE7B,IAAIjC,EAAYiC,EAAO,QAAQ,aAAa7G,EAAK,QAASA,EAAK,QAAQ,EAEnEiG,EAASrB,EAAU,WAAW,IAAI,EACtCqB,EAAO,UAAUE,GAAa,EAAG,CAAC,EAClCA,GAAY,MAAM,EAClB,IAAIY,GAAQd,EAAO,aAAa,EAAG,EAAGjG,EAAK,QAASA,EAAK,QAAQ,EAEjE,OAAA6G,EAAO,UAAU,aAAaE,GAAM,KAAM/G,EAAK,QAASA,EAAK,SAAUA,EAAK,cAAeA,EAAK,cAAeA,EAAK,gBAAgB,EAEpI8G,EAAM,aAAaC,GAAO,EAAG,CAAC,EAG9BnC,EAAU,MAAQA,EAAU,OAAS,EACrCmC,GAAQd,EAASrB,EAAYkC,EAAQ,KAErCD,EAAO,MAAM,WAAW,EAEjB9E,CACT,CAAC,CACH,EAEAsD,GAAK,UAAU,OAAS,SAAUvD,EAAMC,EAAIhQ,EAAS,CACnD,IAAIiV,EAAS,KAEb,KAAK,MAAM,iBAAiB,EAC5B,IAAIhH,EAAOL,EAAO,CAAC,EAAGkF,CAAmB,EAezC,GAbK,MAAM9S,CAAO,EAIPA,IACTiO,EAAOL,EAAOK,EAAMjO,CAAO,GAJ3BiO,EAAOL,EAAOK,EAAM,CAClB,QAASjO,CACX,CAAC,EAKHiO,EAAK,QAAU+B,EAAG,MAClB/B,EAAK,SAAW+B,EAAG,OACnB/B,EAAK,MAAQ8B,EAAK,cAAgBA,EAAK,MACvC9B,EAAK,OAAS8B,EAAK,eAAiBA,EAAK,OAErC,OAAO,UAAU,eAAe,KAAK9B,EAAM,SAAS,EAAG,CACzD,GAAIA,EAAK,QAAU,GAAKA,EAAK,QAAU,EACrC,MAAM,IAAI,MAAM,wCAAwC,OAAOA,EAAK,OAAO,CAAC,EAG9EA,EAAK,OAASwE,EAAY,IAAIxE,EAAK,OAAO,CAC5C,CAGA,GAAI+B,EAAG,QAAU,GAAKA,EAAG,SAAW,EAClC,OAAO,QAAQ,OAAO,IAAI,MAAM,wBAAwB,OAAOA,EAAG,MAAO,GAAG,EAAE,OAAOA,EAAG,MAAM,CAAC,CAAC,EAG9F/B,EAAK,cAAgB,IAAGA,EAAK,cAAgB,GACjDA,EAAK,SAAW,GAEZA,EAAK,cAEPA,EAAK,YAAcA,EAAK,YAAY,KAAK,SAAU/I,EAAM,CACvD,MAAA+I,EAAK,SAAW,GACV/I,CACR,EAAG,SAAUsF,EAAK,CAChB,MAAAyD,EAAK,SAAW,GACVzD,CACR,CAAC,GAGH,IAAI0K,GAAmB,EAEvB,OAAAjH,EAAK,iBAAmB,KAAK,KAAK,KAAK,IAAIiH,GAAkB,IAAMjH,EAAK,cAAgB,CAAC,CAAC,EACnF,KAAK,KAAK,EAAE,KAAK,UAAY,CAClC,GAAIA,EAAK,SAAU,OAAOA,EAAK,YAE/B,GAAIgH,EAAO,SAAS,IAAK,CACvB,GAAIxC,EAAY,IAAI,QAAQxE,EAAK,MAAM,GAAK,EAC1C,OAAOgH,EAAO,6BAA6BlF,EAAMC,EAAI/B,CAAI,EAG3DgH,EAAO,MAAM,2EAA2E,CAC1F,CAEA,GAAI,CAAChC,EAA+B,CAClC,IAAIzI,EAAM,IAAI,MAAM,4FAAiG,EACrH,MAAAA,EAAI,KAAO,qBACLA,CACR,CAKA,IAAIgK,EAASjC,EAAatE,EAAK,MAAOA,EAAK,OAAQA,EAAK,QAASA,EAAK,SAAUgH,EAAO,QAAQ,KAAMhH,EAAK,gBAAgB,EAC1H,OAAOgH,EAAO,gBAAgBT,EAAQzE,EAAMC,EAAI/B,CAAI,CACtD,CAAC,CACH,EAIAqF,GAAK,UAAU,aAAe,SAAUtT,EAAS,CAC/C,IAAImV,EAAS,KAETlH,EAAOL,EAAO,CAAC,EAAGkF,EAAqB9S,CAAO,EAElD,GAAI,OAAO,UAAU,eAAe,KAAKiO,EAAM,SAAS,EAAG,CACzD,GAAIA,EAAK,QAAU,GAAKA,EAAK,QAAU,EACrC,MAAM,IAAI,MAAM,wCAAwC,OAAOA,EAAK,OAAO,CAAC,EAG9EA,EAAK,OAASwE,EAAY,IAAIxE,EAAK,OAAO,CAC5C,CAEA,OAAO,KAAK,KAAK,EAAE,KAAK,UAAY,CAClC,OAAOkH,EAAO,UAAU,iBAAiBlH,CAAI,CAC/C,CAAC,CACH,EAEAqF,GAAK,UAAU,OAAS,SAAUvI,EAAQqK,EAAUC,EAAS,CAC3D,OAAAD,EAAWA,GAAY,YAChB,IAAI,QAAQ,SAAU9K,EAAS,CACpC,GAAIS,EAAO,OAAQ,CACjBA,EAAO,OAAO,SAAUoG,GAAM,CAC5B,OAAO7G,EAAQ6G,EAAI,CACrB,EAAGiE,EAAUC,CAAO,EACpB,MACF,CAEA,GAAItK,EAAO,cAAe,CACxBT,EAAQS,EAAO,cAAc,CAC3B,KAAMqK,EACN,QAASC,CACX,CAAC,CAAC,EACF,MACF,CAOA,QAJIC,EAAW,KAAKvK,EAAO,UAAUqK,EAAUC,CAAO,EAAE,MAAM,GAAG,EAAE,CAAC,CAAC,EACjErT,GAAMsT,EAAS,OACfC,EAAW,IAAI,WAAWvT,EAAG,EAExB7C,EAAI,EAAGA,EAAI6C,GAAK7C,IACvBoW,EAASpW,CAAC,EAAImW,EAAS,WAAWnW,CAAC,EAGrCmL,EAAQ,IAAI,KAAK,CAACiL,CAAQ,EAAG,CAC3B,KAAMH,CACR,CAAC,CAAC,CACJ,CAAC,CACH,EAEA9B,GAAK,UAAU,MAAQ,UAAY,CAAC,EAEpC5U,EAAO,QAAU4U,EAEjB,EAAE,CAAC,gBAAgB,EAAE,qCAAqC,EAAE,aAAa,GAAG,gBAAgB,GAAG,cAAc,GAAG,cAAc,GAAG,eAAe,GAAG,gBAAgB,GAAG,WAAa,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,WAAW,CAC3M,CAAC,uKCp+ED,SAASkC,EAAKC,EAAMD,EAAM,CAAA,OACpB,OAAOA,GAAS,YAAaA,EAAO,CAAE,QAAO,EAAT,EAC/B,OAAOA,GAAS,WACvB,QAAQ,KAAK,oDAAb,EACAA,EAAO,CAAE,QAAS,CAACA,CAAZ,GAKLA,EAAK,SAAW,6EAA6E,KAAKC,EAAK,IAAvF,EACX,IAAI,KAAK,CAAA,SAA8BA,CAA9B,EAAqC,CAAE,KAAMA,EAAK,IAAb,CAA9C,EAEFA,CACR,CAED,SAASC,EAAUD,EAAKD,EAAME,EAAM,CAClC,IAAIC,EAAM,IAAI,eACdA,EAAI,KAAK,MAAOF,CAAhB,EACAE,EAAI,aAAe,OACnBA,EAAI,OAAS,UAAY,CACvBC,EAAOD,EAAI,SAAUH,EAAME,CAArB,CACP,EACDC,EAAI,QAAU,UAAY,CACxB,QAAQ,MAAM,yBAAd,CACD,EACDA,EAAI,KAAJ,CACD,CAED,SAASA,EAAaF,EAAK,CACzB,IAAID,EAAM,IAAI,eAEdA,EAAI,KAAK,OAAQC,EAAjB,EAAA,EACA,GAAI,CACFD,EAAI,KAAJ,CACD,OAAQC,EAAG,CAAE,CACd,MAAqB,MAAdD,EAAI,QAA+B,KAAdA,EAAI,MACjC,CAGD,SAASK,EAAOJ,EAAM,CACpB,GAAI,CACFA,EAAK,cAAc,IAAI,WAAW,OAAf,CAAnB,CACD,OAAQC,EAAG,CACV,IAAIF,EAAM,SAAS,YAAY,aAArB,EACVA,EAAI,eAAe,QAAnB,GAAA,GAAwC,OAAQ,EAAG,EAAG,EAAG,GACnC,GADtB,GAAA,GAAA,GAAA,GACsD,EAAG,IADzD,EAEAC,EAAK,cAAcD,CAAnB,CACD,CACF,CAAA,IAtDGM,EAAU,OAAO,QAAW,UAAY,OAAO,SAAW,OAC1D,OAAS,OAAO,MAAS,UAAY,KAAK,OAAS,KACnD,KAAO,OAAO,QAAW,UAAY,OAAO,SAAW,OACvD,OADO,OAyDPL,EAAiBK,EAAQ,WAAa,YAAY,KAAK,UAAU,SAA3B,GAAyC,cAAc,KAAK,UAAU,SAA7B,GAA2C,CAAC,SAAS,KAAK,UAAU,SAAxB,EAE3HF,EAASE,EAAQ,SAElB,OAAO,QAAW,UAAY,SAAWA,EACtC,UAAmB,CAAc,EAGlC,aAAc,kBAAkB,WAAa,CAACL,EAC/C,SAAiBD,EAAMI,EAAMG,EAAM,CAAA,IAC/BC,EAAMF,EAAQ,KAAOA,EAAQ,UAC7BG,EAAI,SAAS,cAAc,GAAvB,EACRL,EAAOA,GAAQJ,EAAK,MAAQ,WAE5BS,EAAE,SAAWL,EACbK,EAAE,IAAM,WAKJ,OAAOT,GAAS,UAElBS,EAAE,KAAOT,EACLS,EAAE,SAAW,SAAS,OAKxBJ,EAAMI,CAAD,EAJLN,EAAYM,EAAE,IAAH,EACPP,EAASF,EAAMI,EAAMG,CAAb,EACRF,EAAMI,EAAGA,EAAE,OAAS,QAAf,IAMXA,EAAE,KAAOD,EAAI,gBAAgBR,CAApB,EACT,WAAW,UAAY,CAAEQ,EAAI,gBAAgBC,EAAE,IAAtB,CAA6B,EAAE,GAA9C,EACV,WAAW,UAAY,CAAEJ,EAAMI,CAAD,CAAK,EAAE,CAA3B,EAEb,EAGC,qBAAsB,UACtB,SAAiBH,EAAMF,EAAMG,EAAM,CAGnC,GAFAH,EAAOA,GAAQE,EAAK,MAAQ,WAExB,OAAOA,GAAS,SAUlB,UAAU,iBAAiBN,EAAIM,EAAMC,CAAP,EAAcH,CAA5C,UATID,EAAYG,CAAD,EACbJ,EAASI,EAAMF,EAAMG,CAAb,MACH,CACL,IAAIC,EAAI,SAAS,cAAc,GAAvB,EACRA,EAAE,KAAOF,EACTE,EAAE,OAAS,SACX,WAAW,UAAY,CAAEH,EAAMG,CAAD,CAAK,CAAzB,CACX,CAIJ,EAGC,SAAiBR,EAAMG,EAAME,EAAMD,EAAO,CAS1C,GANAA,EAAQA,GAAS,KAAK,GAAI,QAAL,EACjBA,IACFA,EAAM,SAAS,MACfA,EAAM,SAAS,KAAK,UAAY,kBAG9B,OAAOJ,GAAS,SAAU,OAAOE,EAASF,EAAMG,EAAME,CAAb,EATH,IAWtCE,EAAQP,EAAK,OAAS,2BACtBQ,EAAW,eAAe,KAAKF,EAAQ,WAA5B,GAA4CA,EAAQ,OAC/DG,EAAc,eAAe,KAAK,UAAU,SAA9B,EAElB,IAAKA,GAAgBF,GAASC,GAAaP,IAAmB,OAAO,YAAe,YAAa,CAE/F,IAAIS,EAAS,IAAI,WACjBA,EAAO,UAAY,UAAY,CAC7B,IAAIT,EAAMS,EAAO,OACjBT,EAAMQ,EAAcR,EAAMA,EAAI,QAAQ,eAAgB,uBAA5B,EACtBG,EAAOA,EAAM,SAAS,KAAOH,EAC5B,SAAWA,EAChBG,EAAQ,IACT,EACDM,EAAO,cAAcV,CAArB,CACD,KAAM,CAAA,IACDW,EAAML,EAAQ,KAAOA,EAAQ,UAC7BM,EAAMD,EAAI,gBAAgBX,CAApB,EACNI,EAAOA,EAAM,SAAWQ,EACvB,SAAS,KAAOA,EACrBR,EAAQ,KACR,WAAW,UAAY,CAAEO,EAAI,gBAAgBC,CAApB,CAA0B,EAAE,GAA3C,CACX,CACF,GAGHN,EAAQ,OAASF,EAAO,OAASA,EAE7B,OAAOS,IAAW,cACpBA,GAAO,QAAUT,EAAA,CAAA,ICvKZ,SAASU,EAAIC,EAAWC,EAAWC,EAAW,CACjD,OAASF,EAAI,MAAS,GAAOC,EAAI,MAAS,GAAOC,EAAI,MAAS,EAClE,CAEO,IAAMC,GAAW,CACpBJ,EAAI,EAAG,EAAG,CAAC,EACXA,EAAI,IAAK,IAAK,GAAG,CACrB,EAEaK,GAAW,CACpBL,EAAI,EAAG,EAAG,CAAC,EACXA,EAAI,IAAK,IAAK,EAAE,EAChBA,EAAI,GAAI,IAAK,GAAG,EAChBA,EAAI,IAAK,GAAI,GAAG,EAChBA,EAAI,IAAK,IAAK,GAAG,CACrB,EAEaM,GAAe,CACxB,EACA,SACAN,EAAI,IAAK,GAAI,EAAE,EACfA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,GAAI,GAAG,EAChBA,EAAI,GAAI,IAAK,EAAE,EACfA,EAAI,GAAI,GAAI,GAAG,EACfA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,GAAI,EAAE,EACfA,EAAI,IAAK,GAAI,CAAC,EACdA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,GAAI,GAAI,EAAE,EACdA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,CACrB,EAGaO,GAAc,CACvBP,EAAI,EAAM,EAAM,CAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,GAAM,EAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,GAAM,GAAI,EACpBA,EAAI,GAAM,IAAM,EAAI,EACpBA,EAAI,GAAM,GAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,GAAM,EAAI,EACpBA,EAAI,GAAM,GAAM,CAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,GAAM,GAAM,EAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,CACxB,EAGaQ,GAAgB,CACzBR,EAAI,EAAK,EAAK,CAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,GAAK,EAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,GAAK,GAAI,EAClBA,EAAI,GAAK,IAAK,EAAI,EAClBA,EAAI,GAAK,GAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,EAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,EAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,EAClBA,EAAI,IAAK,IAAK,GAAI,CACtB,EAEaS,GAAc,CACvBT,EAAI,EAAG,EAAG,CAAC,EACXA,EAAI,EAAG,EAAG,CAAC,EACXA,EAAI,GAAI,IAAK,EAAE,EACfA,EAAI,GAAI,IAAK,GAAG,EAChBA,EAAI,GAAI,GAAI,GAAG,EACfA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,GAAI,EAAE,EACfA,EAAI,GAAI,IAAK,GAAG,EAChBA,EAAI,IAAK,GAAI,EAAE,EACfA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,EAAE,EAChBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,GAAI,IAAK,EAAE,EACfA,EAAI,IAAK,GAAI,GAAG,EAChBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,CACrB,EAEaU,GAAU,CACnB,QAAU,SAAU,SAAU,SAAU,QAAU,GAAU,GAAU,KAAU,MAAU,OAAU,MAAU,QAAU,QAAU,EAAU,EAAU,EACtJ,SAAU,SAAU,SAAU,SAAU,SAAU,QAAU,KAAU,MAAU,MAAU,MAAU,MAAU,QAAU,SAAU,EAAU,EAAU,EACtJ,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAU,MAAU,MAAU,MAAU,OAAU,QAAU,SAAU,QAAU,EAAU,EACtJ,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,EAAU,CAC1J,EAEaC,GAAe,CACxBX,EAAI,EAAG,EAAG,CAAC,EACXA,EAAI,IAAK,GAAI,GAAG,EAChBA,EAAI,GAAI,IAAK,EAAE,EACfA,EAAI,GAAI,IAAK,GAAG,EAChBA,EAAI,IAAK,IAAK,EAAE,EAChBA,EAAI,IAAK,IAAK,GAAG,CACrB,EAEaY,GAAe,CACxBZ,EAAI,EAAG,EAAG,CAAC,EACXA,EAAI,IAAK,GAAI,EAAE,EACfA,EAAI,GAAI,GAAI,GAAG,EACfA,EAAI,IAAK,GAAI,GAAG,EAChBA,EAAI,EAAG,IAAK,EAAE,EACdA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,GAAI,IAAK,GAAG,EAChBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,GAAI,IAAK,CAAC,EACdA,EAAI,IAAK,IAAK,EAAE,EAChBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,GAAI,IAAK,EAAE,EACfA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,EACjBA,EAAI,IAAK,IAAK,GAAG,CACrB,EAEaa,GAAgB,CAAC,EAAG,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,IAAK,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,IAAK,IAAK,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,IAAK,IAAK,IAAK,QAAS,QAAS,QAAS,QAAS,SAAU,IAAK,IAAK,KAAM,OAAQ,QAAS,QAAS,QAAS,QAAS,IAAK,IAAK,KAAM,MAAO,OAAQ,QAAS,QAAS,QAAS,IAAK,KAAM,MAAO,MAAO,MAAO,QAAS,QAAS,QAAS,GAAI,KAAM,MAAO,MAAO,MAAO,OAAQ,QAAS,QAAS,KAAM,MAAO,MAAO,MAAO,MAAO,MAAO,QAAS,QAAS,KAAM,MAAO,MAAO,MAAO,MAAO,MAAO,QAAS,QAAS,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,QAAS,QAAS,MAAO,MAAO,MAAO,MAAO,MAAO,OAAQ,QAAS,QAAS,MAAO,MAAO,MAAO,MAAO,MAAO,QAAS,QAAS,QAAS,MAAO,MAAO,MAAO,MAAO,OAAQ,QAAS,QAAS,QAAS,MAAO,MAAO,MAAO,OAAQ,QAAS,QAAS,QAAS,QAAS,MAAO,MAAO,MAAO,QAAS,QAAS,QAAS,QAAS,SAAU,MAAO,MAAO,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,MAAO,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,QAAS,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAQ,EAE/sEC,GAAU,CACnB,EAAU,EAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,MAAU,MAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QACtJ,MAAU,MAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QACtJ,KAAU,KAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QACtJ,IAAU,IAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SACtJ,MAAU,MAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SAAU,SAAU,SACtJ,MAAU,MAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SACtJ,MAAU,MAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,SAAU,SACtJ,MAAU,MAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,QAAU,OAC1J,EAEaC,GAAU,CACnB,EAAU,SAAU,MAAU,SAAU,IAAU,SAAU,MAAU,SACtE,QAAU,SAAU,QAAU,SAAU,QAAU,SAAU,QAAU,QAC1E,EAEaC,GAAY,CAAC,EAAU,MAAU,IAAU,KAAQ,EACnDC,GAAY,CAAC,EAAU,SAAU,SAAU,QAAQ,EACnDC,GAAY,CAAC,EAAU,SAAU,IAAU,QAAQ,EACnDC,GAAa,CAAC,EAAU,QAAU,QAAU,OAAQ,EACpDC,GAAa,CAAC,EAAU,SAAU,SAAU,QAAQ,EACpDC,GAAa,CAAC,EAAU,SAAU,QAAU,QAAQ,EACpDC,GAAUC,GAAmB,EAAG,EAAG,CAAC,EACpCC,GAAeD,GAAmB,EAAG,EAAG,CAAC,EACzCE,GAAcF,GAAmB,EAAG,EAAG,CAAC,EACxCG,GAAeH,GAAmB,EAAG,EAAG,CAAC,EAEzCI,GAAiB,CAC1B3B,EAAI,EAAM,EAAM,CAAI,EACpBA,EAAI,EAAM,EAAM,GAAI,EACpBA,EAAI,IAAM,EAAM,CAAI,EACpBA,EAAI,IAAM,EAAM,GAAI,EACpBA,EAAI,EAAM,IAAM,EAAI,EACpBA,EAAI,EAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,EAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EAEpBA,EAAI,EAAM,EAAM,CAAI,EACpBA,EAAI,EAAM,EAAM,GAAI,EACpBA,EAAI,IAAM,EAAM,CAAI,EACpBA,EAAI,IAAM,EAAM,GAAI,EACpBA,EAAI,EAAM,IAAM,EAAI,EACpBA,EAAI,EAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,EAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,CACxB,EAGa4B,GAAyB,CAClC5B,EAAM,EAAI,EAAI,CAAC,EACfA,EAAM,EAAE,IAAI,GAAG,EACfA,EAAI,IAAK,GAAI,EAAE,EACfA,EAAI,IAAI,IAAK,EAAE,EACfA,EAAM,EAAE,IAAM,CAAC,EACfA,EAAK,GAAG,IAAK,EAAE,EACfA,EAAI,IAAI,IAAM,CAAC,EACfA,EAAI,IAAI,IAAI,GAAG,EACfA,EAAI,IAAI,IAAI,GAAG,EACfA,EAAK,GAAG,IAAI,GAAG,EACfA,EAAI,IAAI,IAAK,EAAE,EACfA,EAAI,IAAI,IAAM,CAAC,EACfA,EAAI,IAAK,GAAG,GAAG,EACfA,EAAI,IAAI,IAAI,GAAG,EACfA,EAAI,IAAI,IAAM,CAAC,EACfA,EAAI,IAAK,GAAG,GAAG,CACnB,EAEa6B,GAAkB,CAC3B,EAAU,QAAU,SACpB,IAAU,QAAU,SACpB,IAAU,QAAU,SACpB,MAAU,QAAU,SACpB,MAAU,QAAU,SACpB,MAAU,QAAU,SACpB,MAAU,QAAU,SACpB,MAAU,QAAU,SACpB,MAAU,QAAU,QACxB,EAGaC,GAAY,CACrB,EACA,QACA,QACA,MACA,SACA,QACA,SACA,SACA,SACA,SACA,SACA,MACA,QACA,QACA,SACA,QACJ,EAEaC,GAAY,CACrB,QACA,QACA,QACA,QACA,QACA,QACA,SACA,QACA,QACA,SACA,QACA,QACA,SACA,QACA,SACA,QACJ,EAGaC,GAAe,CASxB,SACA,SACA,OACA,OACJ,EAEaC,GAAoB,CAC7B,OACA,QACA,QACA,OACJ,EASO,IAAMC,GAAUC,GAAmB,EAAG,EAAG,CAAC,EAE1C,IAAMC,GAAsBC,GACtBC,GAAiBD,GACjBE,GAAqBF,GACrBG,GAAkBC,GAAmB,EACrCC,GAAmBC,GAAwB,EAE3CC,GAAkB,CAC3BC,EAAI,GAAM,IAAM,CAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,GAAM,GAAM,GAAI,EACpBA,EAAI,IAAM,GAAM,EAAI,CACxB,EAEaC,GAAkB,CAC3BD,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,GAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,GAAI,EACpBA,EAAI,IAAM,IAAM,CAAI,CACxB,EAEA,SAASE,GAAmBC,EAAYC,EAAYC,EAAY,CAM5D,QALIC,EAAI,GAAMH,EAAKC,EAAKC,EACpBE,EAAK,MAAQ,GAAKJ,GAAM,GACxBK,EAAK,MAAQ,GAAKJ,GAAM,GACxBK,EAAK,MAAQ,GAAKJ,GAAM,GACxBK,EAAM,IAAI,YAAYJ,CAAC,EAClBK,EAAI,EAAGA,EAAIL,EAAGK,IAAK,CACxB,IAAIC,EAAKD,GAAM,GAAKR,GAAM,EACtBU,EAAMF,GAAKR,GAAQ,GAAKC,GAAM,EAC9BU,EAAMH,GAAMR,EAAKC,GAAS,GAAKC,GAAM,EACzCK,EAAIC,CAAC,EAAIX,EAAIY,EAAIL,EAAIM,EAAIL,EAAIM,EAAIL,CAAE,CACvC,CACA,OAAOC,CACX,CAEA,SAASd,IAAmC,CACxC,IAAImB,EAAS,IAAI,YAAY,KAAY,EACrCJ,EAAI,EACR,QAASC,EAAI,EAAGA,EAAK,GAAS,EAAEA,EAC5B,QAASC,EAAI,EAAGA,EAAK,GAAS,EAAEA,EAC5B,QAASC,EAAI,EAAGA,EAAK,GAAS,EAAEA,EAAG,EAAEH,EAAG,CACpC,IAAIK,EAASJ,GAAK,EAAMC,GAAM,GAAWC,GAAM,GAC/CE,IAAWJ,EAAI,KAAY,GAAQC,EAAI,KAAY,GAAM,GAAQC,EAAI,KAAY,GAAM,GACvFC,EAAOJ,CAAC,EAAIK,CAChB,CAGR,OAAOD,CACX,CAEA,SAASjB,IAAwC,CAE7C,IAAIiB,EAAS,IAAI,YAAY,IAAY,EACrCJ,EAAI,EACR,QAASC,EAAI,EAAGA,EAAK,GAAS,EAAEA,EAC5B,QAASC,EAAI,EAAGA,EAAK,GAAS,EAAEA,EAC5B,QAASC,EAAI,EAAGA,EAAK,EAAS,EAAEA,EAAG,EAAEH,EAAG,CACpC,IAAIK,EAASJ,GAAK,EAAMC,GAAM,GAAWC,GAAM,GAC/CC,EAAOJ,CAAC,EAAIK,CAChB,CAGR,OAAOD,CACX,CChWO,IAAME,GAAyC,CAClD,CACI,GAAI,YACJ,KAAM,aACN,MAAO,IACP,OAAQ,IACR,OAAQ,KAAQ,EAChB,KAAM,eACN,IAAcC,GACd,MAAO,CAAE,EAAE,EAAG,EAAE,EAAG,OAAQ,EAAG,GAAG,EAAG,GAAG,CAAE,EACzC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,eAAe,CAAC,WAAY,EAAI,EAChC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,SAAU,gBACd,EACA,CACI,GAAI,gBACJ,KAAM,2BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KAAQ,EAChB,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,GAAI,CAAE,EACtC,eAAe,CAAE,WAAY,EAAK,EAClC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAO,UAAW,GAAO,WAAY,GAAO,aAAc,CAAE,EACxE,SAAU,gBACd,EACA,CACI,GAAI,oBACJ,KAAM,4BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KAAQ,EAChB,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,GAAI,CAAE,EACtC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,eAAgB,CAAE,WAAY,EAAK,EACnC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAM,UAAW,GAAO,WAAY,GAAO,aAAc,CAAE,EACvE,SAAU,gBACd,EACA,CACI,GAAI,2BACJ,KAAM,8BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KAAQ,EAChB,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,GAAI,CAAE,EACtC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,eAAgB,CAAE,WAAY,EAAK,EACnC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAO,UAAW,GAAM,WAAY,GAAO,aAAc,CAAE,EACvE,SAAU,gBACd,EACA,CACI,GAAI,sBACJ,KAAM,6BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KAAQ,EAChB,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,GAAI,CAAE,EACtC,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,eAAgB,CAAE,WAAW,EAAK,EAClC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAO,UAAW,GAAM,WAAY,GAAM,aAAc,CAAE,EACtE,SAAU,gBACd,EACA,CACI,GAAI,YACJ,KAAM,aACN,MAAO,IACP,OAAQ,IACR,OAAQ,KACR,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,MAAO,CAAE,MAAO,CAAE,EAClB,SAAU,gBACd,EACA,CACI,GAAI,gBACJ,KAAM,2BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KACR,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAO,UAAW,GAAO,WAAY,GAAO,aAAc,CAAE,EACxE,SAAU,gBACd,EACA,CACI,GAAI,oBACJ,KAAM,4BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KACR,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAM,UAAW,GAAO,WAAY,GAAO,aAAc,CAAE,EACvE,SAAU,gBACd,EACA,CACI,GAAI,sBACJ,KAAM,6BACN,MAAO,IACP,OAAQ,IACR,OAAQ,KACR,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,MAAO,CAAE,MAAO,CAAE,EAClB,IAAK,CAAE,IAAK,GAAO,UAAW,GAAM,WAAY,GAAM,aAAc,CAAE,EACtE,SAAU,gBACd,EACA,CACI,GAAI,MACJ,KAAM,2BACN,MAAO,IACP,OAAQ,GACR,OAAQ,EAAI,EACZ,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,WACd,EACA,CACI,GAAI,MACJ,KAAM,wBACN,MAAO,IACP,OAAQ,IACR,KAAM,aACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,SAAU,eACd,EACA,CACI,GAAI,eACJ,KAAM,mBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,gBACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,SAAU,wBACd,EACA,CACI,GAAI,WACJ,KAAM,uBACN,MAAO,IACP,OAAQ,GACR,OAAQ,MACR,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,KAAM,EAAK,CACvC,EACA,CACI,GAAI,cACJ,KAAM,0BACN,MAAO,GACP,OAAQ,IACR,OAAQ,MAAS,EACjB,KAAM,kBACN,IAAcA,GACd,OAAQ,EACR,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,KAAM,EAAK,CACvC,EACA,CACI,GAAI,MACJ,KAAM,YACN,MAAO,GACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcA,GACd,OAAQ,EACR,SAAU,oBACd,EACA,CACI,GAAI,YACJ,KAAM,oBACN,MAAO,GACP,OAAQ,IACR,OAAQ,EACR,KAAM,2BACN,IAAcA,GACd,SAAU,oBACd,EACA,CACI,GAAI,YACJ,KAAM,kBACN,MAAO,IACP,OAAQ,GACR,OAAQ,EACR,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,KAAM,EAAK,CACvC,EACA,CACI,GAAI,KACJ,KAAM,cACN,MAAO,IACP,OAAQ,IACR,KAAM,oBACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,SAAU,kBACd,EACA,CACI,GAAI,UACJ,KAAM,0BACN,MAAO,IACP,OAAQ,IACR,KAAM,oBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CAAE,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EAClD,SAAU,kBACd,EACA,CACI,GAAI,YACJ,KAAM,4BACN,MAAO,IACP,OAAQ,IACR,KAAM,oBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CAAE,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CAAE,EACnD,SAAU,kBACd,EACA,CACI,GAAI,iBACJ,KAAM,sCACN,MAAO,IACP,OAAQ,IACR,KAAM,oBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CAAE,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EAClD,UAAW,CAAE,YAAa,EAAK,EAC/B,SAAU,kBACd,EACA,CACI,GAAI,iBACJ,KAAM,sCACN,MAAO,IACP,OAAQ,IACR,KAAM,oBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CAAE,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CAAE,EACnD,UAAW,CAAE,YAAa,EAAK,EAC/B,SAAU,kBACd,EACA,CACI,GAAI,YACJ,KAAM,uBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcC,GACd,OAAQ,GACR,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,OAAQ,CAAC,EAAG,GAAI,IAAI,EAAG,SAAU,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAAE,CACtF,EACA,CACI,GAAI,YACJ,KAAM,uBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcA,GACd,OAAQ,EACR,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,OAAQ,CAAC,EAAG,GAAI,IAAI,EAAG,SAAU,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAAE,CACtF,EAGA,KAEA,CACI,GAAI,cACJ,KAAM,eACN,MAAO,IACP,OAAQ,IACR,OAAQ,IACR,KAAM,eACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,eAAgB,CACZ,WAAY,GACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,CAAE,EAClC,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,SAAS,gBACb,EACA,CACI,GAAI,cACJ,KAAM,eACN,MAAO,GACP,OAAQ,IACR,OAAQ,EACR,KAAM,eACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAC,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EAClC,eAAgB,CACZ,WAAY,GACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EACnC,IAAK,GACL,SAAU,CAAE,IAAK,EAAG,IAAK,EAAE,EAC3B,OAAQ,GACR,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,SAAS,gBACb,EACA,CACI,GAAI,WACJ,KAAM,kCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,SAAU,EAAM,EAChD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,CAAE,EAClC,SAAU,CAAE,IAAK,EAAG,IAAK,CAAE,EAC3B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,OAAQ,EACR,UAAW,CAAE,cAAe,GAAO,cAAe,EAAK,EACvD,SAAS,YACb,EACA,CACI,GAAI,WACJ,KAAM,kCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,SAAU,EAAM,EAChD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,CAAE,EAClC,SAAU,CAAE,IAAK,EAAG,IAAK,CAAE,EAC3B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,OAAQ,EACR,UAAW,CAAE,cAAe,GAAO,cAAe,EAAK,EACvD,SAAS,YACb,EACA,CACI,GAAI,YACJ,KAAM,kDACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,SAAU,EAAM,EAChD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,CAAE,EAClC,SAAU,CAAE,IAAK,EAAG,IAAK,CAAE,EAC3B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,UAAW,CAAE,cAAe,GAAO,cAAe,GAAO,cAAe,aAAc,EACtF,OAAQ,EACR,SAAS,YACb,EACA,CACI,GAAI,YACJ,KAAM,mCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,SAAU,EAAM,EAChD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,CAAE,EAClC,SAAU,CAAE,IAAK,EAAG,IAAK,CAAE,EAC3B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,OAAQ,EACR,UAAW,CAAE,cAAe,aAAc,EAC1C,SAAS,YACb,EACA,CACI,GAAI,YACJ,KAAM,mCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,GAAI,SAAU,EAAM,EACjD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EACnC,SAAU,CAAE,IAAK,EAAG,IAAK,EAAE,EAC3B,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,EAC/B,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CACnC,EACA,UAAW,CAAE,cAAe,aAAc,EAC1C,OAAQ,GACR,SAAS,YACb,EACA,CACI,GAAI,YACJ,KAAM,mCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,IAAK,SAAU,EAAM,EAClD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,GAAI,EACpC,SAAU,CAAE,IAAK,EAAG,IAAK,GAAI,EAC7B,YAAa,CAAE,IAAK,EAAG,IAAK,GAAI,EAChC,YAAa,CAAE,IAAK,EAAG,IAAK,GAAI,CACpC,EACA,UAAW,CAAE,cAAe,aAAc,EAC1C,OAAQ,IACR,SAAS,YACb,EACA,CACI,GAAI,aACJ,KAAM,qCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,IAAK,SAAU,EAAM,EAClD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,GAAI,EACpC,SAAU,CAAE,IAAK,EAAG,IAAK,GAAI,EAC7B,YAAa,CAAE,IAAK,EAAG,IAAK,GAAI,EAChC,YAAa,CAAE,IAAK,EAAG,IAAK,GAAI,CACpC,EACA,UAAW,CAAE,YAAa,EAAG,OAAQ,CAAE,EACvC,OAAQ,IACR,SAAS,YACb,EACA,CACI,GAAI,gBACJ,KAAM,2CACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,IAAK,SAAU,EAAM,EAClD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,GAAI,EACpC,SAAU,CAAE,IAAK,EAAG,IAAK,GAAI,EAC7B,YAAa,CAAE,IAAK,EAAG,IAAK,GAAI,EAChC,YAAa,CAAE,IAAK,EAAG,IAAK,GAAI,CACpC,EACA,UAAW,CAAE,cAAe,GAAO,cAAe,GAAO,YAAa,EAAG,OAAQ,EAAG,kBAAmB,EAAM,EAC7G,OAAQ,IACR,SAAS,YACb,EACA,CACI,GAAI,aACJ,KAAM,kCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,SAAU,EAAM,EAChD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,CAAE,EAClC,SAAU,CAAE,IAAK,EAAG,IAAK,CAAE,EAC3B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAClC,EACA,UAAW,CAAE,cAAe,GAAO,cAAe,GAAO,YAAa,EAAG,OAAQ,EAAG,kBAAmB,EAAK,EAC5G,OAAQ,EACR,SAAS,YACb,EACA,CACI,GAAI,SACJ,KAAM,4EACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,GAAI,SAAU,EAAM,EACjD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EACnC,SAAU,CAAE,IAAK,EAAG,IAAK,EAAG,EAC5B,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,EAC/B,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CACnC,EACA,UAAW,CAAE,cAAe,GAAO,cAAe,GAAO,cAAe,QAAS,EACjF,OAAQ,GACR,SAAS,YACb,EACA,CACI,GAAI,UACJ,KAAM,mCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,cACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,GAAI,SAAU,EAAM,EACjD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EACnC,SAAU,CAAE,IAAK,EAAG,IAAK,EAAG,EAC5B,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,EAC/B,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CACnC,EACA,UAAW,CAAE,cAAe,GAAO,cAAe,GAAO,YAAa,EAAG,OAAQ,EAAG,kBAAmB,EAAK,EAC5G,OAAQ,GACR,SAAS,YACb,EACA,CACI,GAAI,mBACJ,KAAM,yCACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,OAAQ,EACR,KAAM,qBACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,KAAM,SAAU,EAAM,EACnD,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CACZ,gBAAiB,CAAE,IAAK,EAAG,IAAK,IAAK,EACrC,SAAU,CAAE,IAAK,EAAG,IAAK,IAAK,EAC9B,YAAa,CAAE,IAAK,EAAG,IAAK,IAAK,EACjC,YAAa,CAAE,IAAK,EAAG,IAAK,IAAK,CACrC,EACA,UAAW,CAAE,cAAe,GAAM,cAAe,GAAO,eAAgB,WAAY,OAAQ,CAAE,EAC9F,SAAS,YACb,EACA,CACI,GAAI,OACJ,KAAM,wCACN,MAAO,EAAE,EACT,OAAQ,EAAE,EACV,KAAM,mBACN,IAAcC,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,eAAgB,CAAE,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EACxF,SAAU,gBACd,EACA,CACI,GAAI,kBACJ,KAAM,oDACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,KAAM,yBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,eAAgB,CAAE,OAAQ,EAAG,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EACnG,SAAU,sBACd,EACA,CACI,GAAI,kBACJ,KAAM,oDACN,MAAO,EAAE,EACT,OAAQ,EAAE,EACV,KAAM,yBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,GAAI,CAAE,EAAG,EAAG,EAAG,CAAE,EACjB,MAAO,CAAE,MAAO,CAAE,EAClB,eAAgB,CAAE,OAAQ,EAAG,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CAAE,EACpG,SAAU,sBACd,EACA,CACI,GAAI,qBACJ,KAAM,oDACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,KAAM,yBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,GAAM,GAAI,EAAG,GAAI,CAAE,EACjD,GAAI,CAAE,EAAG,EAAG,EAAG,CAAE,EAEjB,MAAO,CAAE,KAAM,GAAM,MAAO,CAAE,EAC9B,eAAgB,CAAE,OAAQ,EAAG,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EACnG,SAAU,sBACd,EACA,CACI,GAAI,yBACJ,KAAM,yDACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,KAAM,yBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,GAAI,CAAE,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,CAAE,EAC/B,MAAO,CAAE,MAAO,CAAE,EAClB,eAAgB,CAAE,OAAQ,EAAG,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EACnG,UAAW,CAAE,YAAa,EAAK,EAC/B,SAAU,sBACd,EACA,CACI,GAAI,yBACJ,KAAM,yDACN,MAAO,EAAE,EACT,OAAQ,EAAE,EACV,KAAM,yBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,EAAK,EACnC,GAAI,CAAE,EAAG,EAAG,EAAG,CAAE,EACjB,MAAO,CAAE,MAAO,CAAE,EAClB,eAAgB,CAAE,OAAQ,EAAG,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,EAAG,CAAE,EACpG,UAAW,CAAE,YAAa,EAAK,EAC/B,SAAU,sBACd,EACA,CACI,GAAI,4BACJ,KAAM,yDACN,MAAO,GAAG,EACV,OAAQ,GAAG,EACX,KAAM,yBACN,IAAcA,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,EAC/B,KAAM,CAAE,EAAG,EAAG,EAAG,EAAG,SAAU,GAAM,GAAI,EAAG,GAAI,CAAE,EACjD,GAAI,CAAE,EAAG,EAAG,EAAG,CAAE,EAEjB,MAAO,CAAE,KAAM,GAAM,MAAO,CAAE,EAC9B,eAAgB,CAAE,OAAQ,EAAG,gBAAiB,CAAE,IAAK,EAAG,IAAK,EAAG,EAAG,YAAa,CAAE,IAAK,EAAG,IAAK,CAAE,CAAE,EACnG,UAAW,CAAE,YAAa,EAAK,EAC/B,SAAU,sBACd,EACA,CACI,GAAI,QACJ,KAAM,6BACN,MAAO,IACP,OAAQ,IACR,OAAQ,EAAI,EACZ,KAAM,kBACN,IAAcV,GACd,OAAQ,EACR,SAAU,WACd,EACA,CACI,GAAI,QACJ,KAAM,6BACN,MAAO,IACP,OAAQ,IACR,OAAQ,EAAI,EACZ,KAAM,aACN,IAAcA,GACd,OAAQ,EACR,SAAU,WACd,EACA,CACI,GAAI,iBACJ,KAAM,oBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcG,GACd,OAAQ,CACZ,EACA,CACI,GAAI,iBACJ,KAAM,oBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcA,GACd,OAAQ,EACZ,EACA,CACI,GAAI,MACJ,KAAM,qBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EAAI,EACZ,KAAM,kBACN,IAAcQ,GACd,OAAQ,EACZ,EACA,CACI,GAAI,SACJ,KAAM,gBACN,MAAO,IACP,OAAQ,IACR,OAAQ,IACR,KAAM,kBACN,IAAcC,GACd,OAAQ,EACZ,EACA,CACI,GAAI,iBACJ,KAAM,qBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcC,EAClB,EACA,CACI,GAAI,eACJ,KAAM,mBACN,MAAO,GACP,OAAQ,GACR,OAAQ,IACR,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,CAAE,CAC3B,EACA,CACI,GAAI,kBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcA,EAClB,EACA,CACI,GAAI,mBACJ,KAAM,yBACN,MAAO,IACP,OAAQ,IACR,KAAM,kBACN,IAAcC,GACd,OAAQ,EACZ,EACA,CACI,GAAI,WACJ,KAAM,sBACN,MAAO,IACP,OAAQ,GACR,KAAM,kBACN,IAAcC,GACd,OAAQ,CACZ,EACA,CACI,GAAI,MACJ,KAAM,WACN,MAAO,IACP,OAAQ,IACR,KAAM,kBACN,IAAcC,EAClB,EACA,CACI,GAAI,gBACJ,KAAM,+BACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,iBACJ,KAAM,8BACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,gBACJ,KAAM,+BACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,iBACJ,KAAM,8BACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,cACJ,KAAM,oBACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,gBACJ,KAAM,4BACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,cACJ,KAAM,oBACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcC,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,cACJ,KAAM,oBACN,MAAO,IACP,OAAQ,IACR,OAAQ,IAAM,IAAM,KACpB,KAAM,kBACN,IAAcA,GACd,SAAU,oBACV,aAAc,CAAE,IAAK,EAAG,GAAI,CAAE,CAClC,EACA,CACI,GAAI,WACJ,KAAM,kBACN,MAAO,IACP,OAAQ,IACR,KAAM,kBACN,IAAcC,GACd,OAAQ,EACZ,EACA,CACI,GAAI,QACJ,KAAM,SACN,MAAO,IACP,OAAQ,IACR,KAAM,kBACN,IAAcC,EAClB,EACA,CACI,GAAI,QACJ,KAAM,SACN,MAAO,IACP,OAAQ,IACR,KAAM,kBACN,IAAcC,EAClB,EACA,CACI,GAAI,KACJ,KAAM,mBACN,MAAO,IACP,OAAQ,IACR,OAAQ,GAAK,EACb,KAAM,kBACN,IAAcC,EAClB,EAaA,CACI,GAAI,cACJ,KAAM,gBACN,MAAO,IACP,OAAQ,IACR,KAAM,kBACN,IAAcC,GACd,OAAQ,EAGZ,EACA,CACI,GAAI,mBACJ,KAAM,sBACN,MAAO,IACP,OAAQ,IACR,KAAM,cACN,IAAcA,GACd,OAAQ,GACR,YAAa,EAGjB,EACA,CACI,GAAI,aACJ,KAAM,wBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcA,GACd,OAAQ,GACZ,EACA,CACI,GAAI,aACJ,KAAM,iCACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAcA,GACd,OAAQ,EACZ,EACA,CACI,GAAI,aACJ,KAAM,aACN,MAAO,IACP,OAAQ,IACR,OAAQ,IACR,KAAM,oBACN,IAAcxB,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,CACnC,EAEA,CACI,GAAI,WACJ,KAAM,WACN,MAAO,GAAK,EACZ,OAAQ,GAAK,EACb,OAAQ,EAAI,EACZ,KAAM,kBACN,IAAcQ,GACd,MAAO,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,CAAE,CACnC,EACA,CACI,GAAI,UACJ,KAAM,WACN,MAAO,IACP,OAAQ,IACR,OAAQ,EACR,KAAM,kBACN,IAAciB,GACd,OAAQ,EACZ,EACA,CACI,GAAI,sBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,GACR,OAAQ,EAAI,IACZ,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,cACd,EACA,CACI,GAAI,sBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,GACR,OAAQ,EAAI,IACZ,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,cACd,EACA,CACI,GAAI,sBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,GACR,OAAQ,EAAI,IAAM,GAAK,GACvB,KAAM,kBACN,IAAcD,GACd,OAAQ,EACR,SAAU,cACd,EACA,CACI,GAAI,sBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,GACR,OAAQ,EAAI,IAAM,GAAK,GACvB,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,cACd,EACA,CACI,GAAI,sBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,IACR,OAAQ,EAAI,IAAM,IAAM,GACxB,KAAM,kBACN,IAAcD,GACd,OAAQ,EACR,SAAU,cACd,EACA,CACI,GAAI,sBACJ,KAAM,0BACN,MAAO,IACP,OAAQ,IACR,OAAQ,EAAI,IAAM,IAAM,GACxB,KAAM,kBACN,IAAcC,GACd,OAAQ,EACR,SAAU,cACd,EACA,CACI,GAAI,SACJ,KAAM,2BACN,MAAO,GACP,OAAQ,GACR,KAAM,kBACN,IAAc7B,GACd,OAAQ,CACZ,EACA,CACI,GAAI,cACJ,KAAM,sBACN,MAAO,IACP,OAAQ,IACR,OAAQ,EAAI,EACZ,KAAM,kBACN,IAAc2B,GACd,OAAQ,EACZ,CACJ,EAEWG,GAAsD,CAAC,EAClEnC,GAAQ,QAASoC,GAAQ,CAAMA,IAAKD,GAAcC,EAAI,IAAMA,EAAI,IAAI,EAAIA,EAAK,CAAC,ECplC9E,IAAAC,GAAA,GAAAC,GAAAD,GAAA,0BAAAE,GAAA,2BAAAC,GAAA,mBAAAC,GAAA,mBAAAC,GAAA,0CAAAC,GAAA,sBAAAC,GAAA,iBAAAC,GAAA,cAAAC,GAAA,oBAAAC,GAAA,eAAAC,GAAA,yBAAAC,GAAA,mBAAAC,GAAA,kBAAAC,GAAA,uBAAAC,GAAA,mBAAAC,GAAA,mBAAAC,GAAA,qBAAAC,GAAA,6BAAAC,GAAA,yBAAAC,KCCO,SAASC,GAAIC,EAAWC,EAAa,CACxC,OAAKA,IAAIA,EAAK,GACPC,GAAQF,EAAGC,EAAI,EAAE,CAC5B,CAEO,SAASC,GAAQF,EAAWC,EAAYE,EAAe,CAC1D,GAAI,CAEA,QADIC,EAAIJ,EAAE,SAASG,CAAK,EAAE,YAAY,EAC/BC,EAAE,OAASH,GACdG,EAAI,IAAMA,EACd,OAAOA,CACX,OAASC,EAAG,CACR,OAAOL,EAAI,EACf,CACJ,CA2BO,SAASM,GAAeC,EAAoBC,EAAqB,CAEhED,IAGAC,GAAW,KACX,QAAQ,OAAOD,CAAS,EAExB,QAAQ,OAAOA,EAAWC,CAAO,EACzC,CC0MO,SAASC,GAAuBC,EAAkBC,EAAgC,CACrF,OAAOD,EAAI,IAAKE,GAASD,EAAO,QAAQC,EAAO,QAAQ,CAAC,CAC5D,CCoJO,SAASC,GAAuBC,EAAeC,EAAwBC,EAA0BC,EAA+B,CACnI,GAASF,GAAL,EACA,MAAO,CAAC,EAEZ,IAAIG,EAAQJ,EAERK,EAAmB,CAAC,EACxB,KAAOJ,EAAiB,GACpBI,EAAO,KAAKD,EAAQF,CAAgB,EACpCE,IAAUD,EACV,EAAEF,EAEN,OAAOI,CACX,CAEO,SAASC,GAA8BN,EAAeC,EAAwBM,EAAqE,CACtJ,OAAOR,GAAuBC,EAAOC,EAAgBM,EAAQ,iBAAkBA,EAAQ,WAAW,CACtG,CAEO,SAASC,GAAwBC,EAAgBC,EAAqBT,EAAwBC,EAA0BC,EAA+B,CAC1J,OAASF,GAAL,EACO,CAAC,GACZU,GAAeF,EAASC,EAAO,MAAM,EAC9BX,GAAuBW,EAAOD,CAAM,EAAGR,EAAgBC,EAAkBC,CAAW,EAC/F,CAEO,SAASS,GAA+BH,EAAgBC,EAAqBT,EAAwBM,EAAqE,CAC7K,OAAOC,GAAwBC,EAAQC,EAAQT,EAAgBM,EAAQ,iBAAkBA,EAAQ,WAAW,CAChH,CHxaA,SAASM,GAAUC,EAAWC,EAAwB,CAClD,GAAI,CAACA,EAAK,OAAOD,EAEjB,QADIE,EAAI,EACCC,EAAI,EAAGA,EAAIF,EAAI,OAAQE,IAAK,CACjC,IAAIC,EAAIH,EAAIE,CAAC,EACTC,EAAI,IACJA,EAAI,CAACA,EAAI,EACTF,GAAK,GAAKE,GAEVJ,EAAK,GAAKG,IACVD,GAAK,GAAKE,EAElB,CACA,OAAOF,CACX,CAEA,SAASG,GAAqBC,EAAuBC,EAAgD,CAC7FA,EAAI,UAASA,EAAMA,EAAI,SAC3B,IAAIC,EAAQD,EAAI,EACZE,EAASF,EAAI,EACbG,EAAQH,EAAI,OAAS,EACrBI,EAAMJ,EAAI,KAAO,EACjBK,EAAUL,EAAI,IAAM,EACpBM,EAAcN,EAAI,KAAO,EACzBO,EAAeP,EAAI,IAAM,KAAK,KAAKA,EAAI,EAAII,EAAME,CAAW,EAC5DE,GAAQ,GAAKJ,GAAO,EACpBK,EAAOT,EAAI,MAAQO,EAAeL,EAASC,EAC3CO,EAAOV,EAAI,MAAQ,EACnBW,EACAN,EAAU,GAAKL,EAAI,GACnBW,EAAQ,IAAI,WAAWJ,EAAeL,EAASC,CAAK,EAC/CH,EAAI,OACTW,EAAQ,IAAI,WAAWR,IAAUD,GAAUF,EAAI,OAAO,CAAC,GAAKA,EAAI,OAAO,CAAC,IAAO,GAAKA,EAAI,OAAO,CAAC,GAAK,GAAKA,EAAI,OAAO,CAAC,EAAG,EACpHM,GAAe,EACpBK,EAAQ,IAAI,WAAWJ,EAAeL,EAASC,EAAQE,CAAO,EAE9DM,EAAQ,IAAI,YAAYJ,EAAeL,EAASC,EAAQE,CAAO,EACnE,QAASO,EAAI,EAAGA,EAAIT,EAAOS,IAGvB,QAFIC,EAAUd,EAAOa,CAAC,EAClBhB,EAAI,EACCD,EAAI,EAAGA,EAAIO,EAAQP,IAAK,CAC7B,IAAImB,EAAKd,EAAI,KAAOE,EAAS,EAAIP,EAAIA,EACjCoB,EAAOH,EAAIL,EAAeL,EAASY,EAAKP,EACxCP,EAAI,SAAUe,GAASpB,GAAKK,EAAI,OAAO,CAAC,GAAKA,EAAI,OAAO,CAAC,GAAOL,GAAK,GAAKK,EAAI,OAAO,CAAC,GAAK,GAAKA,EAAI,OAAO,CAAC,GAEhH,QADIgB,EAAQ,EACHvB,EAAI,EAAGA,EAAIQ,EAAOR,IAAK,CAC5B,IAAIwB,EAASJ,EAAQjB,GAAG,EAAK,IACzBsB,EAAM1B,GAAUuB,EAAMf,EAAI,KAAK,EACnC,GAAIA,EAAI,SACJ,QAASmB,EAAI,EAAGA,GAAKnB,EAAI,KAAO,GAAImB,IAC5BF,EAAS,GAAKE,IACdR,EAAMO,CAAG,GAAK,GAAKlB,EAAI,SAASgB,EAAQG,CAAC,OAGjD,SAASA,EAAI,EAAGA,EAAId,EAASc,IAAK,CAC9B,IAAIC,EAAKH,GAAUE,EAAIf,EAAQI,EAC/BG,EAAMO,EAAMC,EAAIV,EAAOC,CAAI,GAAMV,EAAI,KAAQoB,GAAMd,EAAcU,EAAQZ,EAASgB,GAAKJ,CAC3F,CAEJA,GAASZ,EACLY,GAASV,IACTS,GAAQ,EACRC,EAAQ,EAEhB,CACJ,CAEJ,OAAOL,CACX,CAEA,SAASU,GAAaC,EAAkC,CACpD,IAAIC,EAAQ,EACZD,EAAO,QAASE,GAAM,CAAED,GAASC,EAAE,MAAO,CAAC,EAC3C,IAAIC,EAAO,IAAI,WAAWF,CAAK,EAC/B,OAAAA,EAAQ,EACRD,EAAO,QAASE,GAAM,CAAEC,EAAK,IAAID,EAAGD,CAAK,EAAGA,GAASC,EAAE,MAAO,CAAC,EACxDC,CACX,CAEO,SAASC,GAAkBC,EAA6BC,EAA0C,CACrG,IAAI5B,EAAM4B,EAAS,aACnB,GAAI,CAAC5B,EAAK,KAAM,mBAChB,OAAAA,EAAI,EAAI2B,EAAI,MACZ3B,EAAI,EAAI2B,EAAI,OACL,IAAI,WAAW7B,GAAqB,CAAC6B,EAAI,OAAO,EAAG3B,CAAG,CAAC,CAClE,CAEO,SAAS6B,GAAuBF,EAA6BC,EAA0C,CAI1G,QAFIE,EAAO,IAAI,WAAW,IAAM,EAC5BC,EAAS,EACJpC,EAAI,EAAGA,EAAIgC,EAAI,OAAQhC,IAE5B,QADIqC,GAAWrC,EAAI,GAAK,MAAUA,GAAK,EAAK,GAAK,KAAQA,GAAK,GAAK,GAC1DF,EAAI,EAAGA,EAAIkC,EAAI,MAAOlC,GAAK,EAAG,CAGnC,QAFIwC,EAAI,EACJC,EAAQ,EACHtC,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAIuC,EAAOR,EAAI,QAAQI,GAAQ,EAAK,KAChCI,GAAO,GAAKA,GAAO,KAAGD,GAAS,KAC/BC,GAAO,IAAGA,GAAO,GACrBF,GAAME,GAAOvC,EAAI,CACrB,CACAkC,EAAKE,GAAS,EAAKC,EAAI,IAAQC,EAC/BJ,EAAKE,GAAS,EAAMC,GAAK,EAAK,IAAQC,CAC1C,CAEJ,OAAOJ,CACX,CAEO,SAASM,GACZC,EACAC,EACAC,EACAC,EACAC,EACAC,EAA8B,CAW9BA,EAAeA,IAAiB,OAAY,GAAOA,EAEnD,IAAIC,GAAa,GAAKF,GAAY,EAG9BG,GAFWL,EAAaI,IAEAH,EAC5BG,IAAcH,EAEdF,GAAWI,EAAe,GAAMD,EAAWD,EAAW,GAAK,EAC3D,IAAIK,EAAYH,EAAe,EAAI,GAEnC,QAASI,EAAgBL,EAAWD,EAAUM,EAAgB,EAAGA,GAAiB,EAAGR,GAAUO,EAAW,CAGtG,IAAIE,GAFoB,GAAMJ,GAEU,IACpCK,EAAcJ,EAAa,IAE/BK,GAAeX,EAASD,EAAM,MAAM,EACpCA,EAAMC,CAAM,EAAKD,EAAMC,CAAM,EAAIS,EAAkBC,EAEnDJ,IAAe,EACfD,IAAc,CAClB,CACJ,CAiGA,SAASO,GACLC,EACAC,EAA6D,CAE7D,IAAIC,EAAkBD,EAAO,kBAAoB,OAAYD,EAAO,gBAAkBC,EAAO,gBAE7F,GAAIA,IAAW,OACX,OAEJ,GAAIA,EAAO,UAAY,OACnB,KAAM,oCAEV,IAAIE,EAEAC,EAAU,KACVD,EAAQF,EAAO,QAAQ,EACvBE,EAAM,aAAeA,EAAM,eAAiB,OAAY,GAAOA,EAAM,aAC9DA,GAGPE,EAAqBJ,EAAO,oBAAsB,OAAYA,EAAO,kBAAoB,CAACK,EAAeC,EAAsBC,IAAuB,CAEtJ,GAAIN,EACA,OAAOK,EAEX,IAAIE,EAASC,GACTJ,EACAL,EAAO,SAAW,OAAYD,EAAO,OAASC,EAAO,OACrDA,EAAO,mBAAqB,OAAYD,EAAO,iBAAmBC,EAAO,iBACzEA,EAAO,cAAgB,OAAYD,EAAO,YAAcC,EAAO,WAAW,EAG9E,GAAIA,EAAO,yBAA2B,QAClC,QAASxD,EAAI,EAAGA,EAAIwD,EAAO,uBAAuB,OAAQ,EAAExD,EACxD,GAAI8D,GAAgBN,EAAO,uBAAuBxD,CAAC,EAAE,aACjD,OAAOwD,EAAO,uBAAuBxD,CAAC,EAAE,WAIpD,GAAIwD,EAAO,0BAA4B,OAAW,CAC9C,IAAIU,EAAUV,EAAO,wBAAwBK,EAAOC,EAAcC,CAAI,EACtE,GAAIG,IAAY,OACZ,OAAOA,CACf,CAEA,GAAIV,EAAO,oBAAsB,OAAW,CACxC,IAAIU,EAAUV,EAAO,kBAAkBK,EAAOC,EAAcC,CAAI,EAChE,GAAIG,IAAY,OACZ,OAAOA,CACf,CAGA,QAASlE,EAAI,EAAIA,EAAIgE,EAAO,QAAYhE,EAAIwD,EAAO,iBAAiB,OAAU,EAAExD,EAC5E,GAAI8D,GAAgBE,EAAOhE,CAAC,EAE5B,OAAOwD,EAAO,iBAAiBxD,CAAC,EAGpC,eAAQ,IAAI,2DAA4DuD,EAAQC,EAAQK,EAAOC,EAAcC,CAAI,EACjHV,GAAe,EAAK,EACb,CACX,EAEIc,EAAWX,EAAO,UAAY,OAAYA,EAAO,QAAWf,GAAsB,CAElF,IAAI2B,EAASZ,EAAO,SAAW,OAAYD,EAAO,OAASC,EAAO,OAC9Da,EAAUb,EAAO,UAAY,OAAYD,EAAO,QAAUC,EAAO,QAErE,GAAIA,EAAO,cAAgB,OAG3B,IAAKa,IAAY,QAAgBD,IAAW,QAAe,CAACX,EACxD,KAAM,+CAEV,QAASzD,EAAI,EAAGD,EAAI,EAAGA,GAAKyD,EAAO,SAAW,OAAWD,EAAO,OAASC,EAAO,QAAS,EAAEzD,EACvF,QAASF,EAAI,EAAGA,GAAK2D,EAAO,QAAU,OAAYD,EAAO,MAAQC,EAAO,OAAQ,EAAE3D,EAAG,EAAEG,EAAG,CACtF,IAAI+D,EAAOP,EAAO,YAAY3D,EAAGE,CAAC,EAClCsD,GAAgBe,IAAW,QAAeL,EAAK,YAAcK,EAAO,MAAO,EAC3E,IAAIzB,EAAaiB,EAAkBQ,IAAW,OAAY,EAAKA,EAAOL,EAAK,WAAW,EAAIM,EAAQrE,CAAC,EAAG+D,CAAI,EAC1GvB,GAAqBC,EAAOsB,EAAK,OAAQpB,EAAYoB,EAAK,SAAUA,EAAK,SAAUL,EAAM,YAAY,CACzG,EAGR,EAmBA,MAjB0C,CAEtC,QAASC,EACT,QAASH,EAAO,QAChB,QAASA,EAAO,UAAY,OAAYW,EAAUX,EAAO,QACzD,OAAQA,EAAO,OACf,SAAUA,EAAO,SAEjB,YAAaA,EAAO,YACpB,kBAAmBI,EAEnB,uBAAwBJ,EAAO,yBAA2B,OAAY,CAAC,EAAIA,EAAO,uBAClF,wBAAyBA,EAAO,wBAChC,iBAAkBA,EAAO,iBACzB,kBAAmBA,EAAO,iBAC9B,CAGJ,CAEA,SAASc,GACLf,EACAC,EAA0E,CAE1E,GAAI,YAAaA,EACb,OAAOF,GAA+BC,EAAQC,CAAM,EAGxD,GAAI,SAAUA,EAOV,MAL0C,CACtC,SAAuB,CACnB,MAAO,CAAE,KAAMA,EAAO,KAAK,CAAE,CACjC,CACJ,EAIJ,KAAM,uFACV,CAEA,SAASe,GACLC,EACAjB,EACAC,EAA+D,CAE/D,GAAKA,IAAW,QAAe,CAACgB,EAC5B,OAEJ,IAAId,EAEJ,GAAIF,EAAO,UAAY,OACnB,KAAM,oCAEV,IAAIG,EAAU,KACVD,EAAQF,EAAO,QAAQ,EACvBE,EAAM,aAAeA,EAAM,eAAiB,OAAY,GAAOA,EAAM,aAC9DA,GAGPS,EAAU,IAAM,CAChB,IAAIC,EAAUZ,EAAO,SAAW,OAAYD,EAAO,OAASC,EAAO,OAEnE,GAAK,EAAAA,EAAO,iBAAmB,QAAeA,EAAO,oBAAsB,QAG3E,IAAKA,EAAO,iBAAmB,QAAeA,EAAO,oBAAsB,QAAeY,IAAW,OACjG,KAAM,gFAEV,QAASpE,EAAI,EAAGA,EAAIoE,EAAO,OAAQpE,IAAK,CAMpC,IAAIuB,EAAI6C,EAAOpE,CAAC,EACZ+D,EAAOP,EAAO,eAAexD,CAAC,EAC9B2C,EAAaa,EAAO,kBAAkBjC,EAAGwC,CAAI,EACjDvB,GAAqBkB,EAAM,KAAMK,EAAK,OAAQpB,EAAYoB,EAAK,SAAUA,EAAK,SAAUL,EAAM,YAAY,CAC9G,EACJ,EAeA,MAb2C,CAEvC,QAASC,EACT,QAASH,EAAO,QAChB,QAASA,EAAO,UAAY,OAAYW,EAAUX,EAAO,QACzD,OAAQA,EAAO,OACf,SAAUA,EAAO,SAEjB,OAAQA,EAAO,SAAW,OAAYD,EAAO,OAASC,EAAO,OAC7D,eAAgBA,EAAO,eACvB,kBAAmBA,EAAO,iBAC9B,CAGJ,CAEA,SAASiB,GACLD,EACAjB,EACAC,EAA4E,CAE5E,GAAK,GAACgB,GAAahB,IAAW,QAG9B,IAAI,YAAaA,EACb,OAAOe,GAAwBC,EAASjB,EAAQC,CAAM,EAG1D,GAAI,SAAUA,EAOV,MAN2C,CACvC,SAAuB,CACnB,MAAO,CAAE,KAAMA,EAAO,KAAK,CAAE,CACjC,CACJ,EAKJ,KAAM,yFACV,CAcO,SAASkB,GAAsCC,EAA4D,CAE9G,IAAIC,EAAaN,GACb,CACI,MAAOK,EAAQ,QAAQ,MACvB,OAAQA,EAAQ,QAAQ,OACxB,OAAQA,EAAQ,QAAQ,YACxB,QAASA,EAAQ,QAAQ,QACzB,OAAQA,EAAQ,QAAQ,MAAM,OAC9B,gBAAiBA,EAAQ,QAAQ,gBACjC,iBAAkBA,EAAQ,QAAQ,iBAClC,YAAaA,EAAQ,QAAQ,WACjC,EACAA,EAAQ,UAAU,EAClBE,EAAmBJ,GAAwCE,EAAQ,mBAAqB,OAAW,CAAE,OAAQA,EAAQ,QAAQ,WAAY,EAAGA,EAAQ,gBAAgB,EACpKG,EAAwBL,GAAwCE,EAAQ,QAAQ,UAAU,GAAI,CAAE,OAAQA,EAAQ,QAAQ,QAAS,EAAGA,EAAQ,qBAAqB,EACjKI,EAAkBN,GAAwCE,EAAQ,QAAQ,UAAU,KAAM,CAAE,OAAQA,EAAQ,QAAQ,UAAW,EAAGA,EAAQ,eAAe,EACzJK,EAAmBP,GAAwCE,EAAQ,QAAQ,UAAU,MAAQ,EAAG,CAAE,OAAQA,EAAQ,QAAQ,WAAY,EAAGA,EAAQ,gBAAgB,EAEjKM,EAA2C,CAACL,EAAYC,EAAkBC,EAAuBC,EAAiBC,CAAgB,EAClIE,EAAqBD,EAAW,OAAQpF,GAAMA,IAAM,MAAS,EAE7D6D,EAAuB,CAAC,EACxBxB,EAAqB,CAAC,EAG1B,QAASlC,EAAI,EAAGA,EAAIiF,EAAW,OAAQ,EAAEjF,EAAG,CACxC,GAAIiF,EAAWjF,CAAC,IAAM,OAAW,CAC7BkC,EAAK,KAAK,MAAS,EACnB,QACJ,CAEA,IAAI6B,EAAOkB,EAAWjF,CAAC,EAAE,QAAQ,EACjC0D,EAAM,KAAKK,CAAI,EACf7B,EAAK,KAAK6B,EAAK,IAAI,CACvB,CAGA,QAAS/D,EAAI,EAAGA,EAAIkF,EAAmB,OAAQ,EAAElF,EACzCkF,EAAmBlF,CAAC,EAAE,UAAY,QAGtCkF,EAAmBlF,CAAC,EAAE,QAAQ0D,EAAM1D,CAAC,EAAE,IAAI,EAI/C,QAASA,EAAI,EAAGA,EAAIkF,EAAmB,OAAQ,EAAElF,EACzCkF,EAAmBlF,CAAC,EAAE,UAAY,QAGtCkF,EAAmBlF,CAAC,EAAE,QAAQ0D,EAAM1D,CAAC,EAAE,IAAI,EAI/C,QAASA,EAAI,EAAGA,EAAIkF,EAAmB,OAAQ,EAAElF,EACzCkF,EAAmBlF,CAAC,EAAE,SAAW,QAGrCkF,EAAmBlF,CAAC,EAAE,OAAO0D,EAAM1D,CAAC,EAAE,IAAI,EAI9C,IAAImF,EAAmB,GACvB,QAASnF,EAAI,EAAGmF,EAAkB,EAAEnF,EAAG,CAEnCmF,EAAmB,GAEnB,QAASnF,EAAI,EAAGA,EAAIkF,EAAmB,OAAQ,EAAElF,EACzCkF,EAAmBlF,CAAC,EAAE,WAAa,SAGvCmF,EAAmBD,EAAmBlF,CAAC,EAAE,SAASA,EAAGkC,EAAK,CAAC,EAAGA,EAAK,CAAC,EAAGA,EAAK,CAAC,EAAGA,EAAK,CAAC,EAAGA,EAAK,CAAC,CAAC,GAAKiD,EAE7G,CAGA,IAAIC,EAAclD,EAAK,OAAQrC,GAAMA,IAAM,MAAS,EACpD,OAAI8E,EAAQ,gBAAkB,SAC1BS,EAAcT,EAAQ,cAAcS,CAAW,GAG5C3D,GAAa2D,CAAW,CACnC,CAEA,SAASC,GACLC,EACA9B,EAAuF,CAEvF,IAAIhD,EAAM8E,EAAQ,aACdC,EAAoBD,EAAQ,KAAK,EAAI9E,EACrCgF,EAAcF,EAAQ,KAAK,EAAIC,EAC/BE,EAAe,KAAK,KAAKD,EAAc,CAAC,EACxCE,EAAkB,EAwCtB,OAtCmCC,GAAAC,GAAA,GAC5BpC,GAD4B,CAG/B,SAAuB,CACnB,OAAAkC,EAAkBJ,EAAQ,MAAM,QAAUG,EACnC,CAAE,KAAM,IAAI,WAAWH,EAAQ,MAAQA,EAAQ,OAAS9E,EAAM,CAAC,CAAE,CAC5E,EAEA,YAAYX,EAAWE,EAAyB,CAE5C,IAAIwC,EAAM,KAAK,MAAM1C,EAAIyF,EAAQ,MAAM,CAAC,EAGpCO,EAAU,KAAK,MAAMhG,EAAIyF,EAAQ,KAAK,CAAC,EACvCQ,EAAU,KAAK,MAAM/F,EAAIuF,EAAQ,KAAK,CAAC,EAEvCS,EAAe,KAAK,MAAMhG,EAAIuF,EAAQ,MAAM,CAAC,EAAIA,EAAQ,MAAM,QAAW/C,EAG1EyD,EAAgBP,EAAeI,EAC/BI,EAAgBP,EAAkBI,EAGlCI,EAAc,KAAK,MAAQrG,EAAIyF,EAAQ,KAAK,EAAK9E,EAAO,CAAC,EACzD2F,EAAc,KAAK,MAAQpG,EAAIuF,EAAQ,KAAK,EAAKC,EAAoB,CAAC,EAGtE3C,EAAY0C,EAAQ,KAAK,SAAYC,GAAsB1F,EAAIyF,EAAQ,KAAK,EAAK,GAAK9E,EAASX,EAAIyF,EAAQ,KAAK,EAAK9E,EAEzH,MAAO,CACH,OAAQyF,EAAgBD,EAAgBG,EAAcD,EACtD,SAAUtD,EACV,SAAUpC,EACV,YAAauF,CACjB,CACJ,CACJ,EAGJ,CAEA,SAASK,GACLd,EACA9B,EAAyF,CAEzF,IAAI6C,EAAaf,EAAQ,QAErB9E,EAAM8E,EAAQ,aAEdgB,EAA4B,EAqChC,OAnCoCX,GAAAC,GAAA,GAC7BpC,GAD6B,CAGhC,SAAuB,CAEnB,IAAI+C,EAAcjB,EAAQ,KAAK,QAAUA,EAAQ,KAAK,KACtD,OAAAgB,EAAqB,GAAK,KAAK,KAAK,KAAK,KAAKC,CAAU,CAAC,EAElD,CAAE,KAAM,IAAI,WAAWF,EAAcC,EAAoBhB,EAAQ,KAAK,EAAMA,EAAQ,KAAK,QAAUA,EAAQ,KAAK,IAAK,CAAE,CAClI,EAEA,eAAeS,EAAmC,CAE9C,IAAIrD,EAAiB,EAOrB,OAAI2D,EACA3D,GAAU,KAAK,MAAMqD,EAAcT,EAAQ,KAAK,OAAO,EAAKA,EAAQ,KAAK,EAAI,GAAMgB,EAAqB,KAAK,MAAMP,GAAevF,EAAM8E,EAAQ,MAAM,EAAIA,EAAQ,KAAK,QAAYS,EAAcT,EAAQ,KAAK,QAE9M5C,EAASqD,EAGN,CACH,OAAQrD,EACR,SAAU,EACV,SAAU,EACV,YAAaqD,CACjB,CACJ,CACJ,EAGJ,CAEA,SAASS,GACLlB,EACA9B,EAAyF,CAkBzF,OAhBoCmC,GAAAC,GAAA,GAC7BpC,GAD6B,CAGhC,SAAuB,CACnB,MAAO,CAAE,KAAM,IAAI,WAAW8B,EAAQ,GAAG,QAAUA,EAAQ,GAAG,IAAI,CAAE,CACxE,EACA,eAAeS,EAAmC,CAC9C,MAAO,CACH,OAAQA,EACR,SAAU,EACV,SAAU,EACV,YAAaA,CACjB,CACJ,CACJ,EAGJ,CAEO,SAASU,GAAeC,EAAiC1E,EAA0C,CAEtG,IAAIsD,EAAyCoB,EAAQ,QAErD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYD,GACRC,EACA,CAKI,uBAAwB,CAAC,CAAE,aAAcA,EAAQ,gBAAkB,GAAK,WAAY,CAAK,CAAC,EAC1F,iBAAkB,CAAE,EAAM,EAAM,CAAK,CACzC,CACJ,EACA,iBAAkBc,GACdd,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CACzD,IAAIC,EAAS2C,GAA8B9C,EAAO,EAAGyB,CAAO,EAC5D,OAAOtB,EAAO,CAAC,EAAIA,EAAO,CAAC,GAAK,CACpC,CACJ,CACJ,EACA,sBAAuBwC,GACnBlB,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CAEzD,OADa4C,GAA8B9C,EAAO,EAAGyB,CAAO,EAC9C,CAAC,CACnB,CACJ,CACJ,EACA,iBAAkB,CACd,MAAmB,CACf,IAAI7C,EAAQ,IAAI,WAAW,CAAC,EAC5B,OAAAA,EAAM,CAAC,EAAK6C,EAAQ,gBAAkB,IAAUA,EAAQ,SAAW,KAAS,EAC5E7C,EAAM,CAAC,EAAK6C,EAAQ,YAAc,GAC3B7C,CACX,CACJ,CACJ,CAAC,CACL,CAEO,SAASmE,GAAeF,EAAiC1E,EAA0C,CAEtG,IAAIsD,EAAyCoB,EAAQ,QAErD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYD,GACRC,EACA,CAGI,iBAAkB,CAAE,EAAM,CAAK,CACnC,CACJ,EACA,iBAAkBc,GACdd,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CACzD,IAAIC,EAAS2C,GAA8B9C,EAAO,EAAGyB,CAAO,EAC5D,OAAQtB,EAAO,CAAC,GAAK,EAAMA,EAAO,CAAC,CACvC,CACJ,CACJ,EACA,iBAAkB,CACd,MAAmB,CACf,IAAIvB,EAAQ,IAAI,WAAW,CAAC,EAC5B,OAAAA,EAAM,CAAC,EAAK6C,EAAQ,gBAAkB,IAAUA,EAAQ,SAAW,KAAS,EAC5E7C,EAAM,CAAC,EAAK6C,EAAQ,YAAc,GAC3B7C,CACX,CACJ,CACJ,CAAC,CACL,CAEO,SAASoE,GAAeH,EAAiC1E,EAA0C,CAEtG,IAAIsD,EAAyCoB,EAAQ,QAYrD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYD,GACRC,EACA,CAII,uBAAwB,CAAC,CAAE,aAAcA,EAAQ,gBAAiB,WAAY,CAAK,CAAC,EACpF,iBAAkB,CAAE,CAAK,CAC7B,CACJ,EACA,iBAAkBc,GACdd,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CAEzD,OADa4C,GAA8B9C,EAAO,EAAGyB,CAAO,EAC9C,CAAC,CACnB,CACJ,CACJ,EACA,iBAAkB,CACd,MAAmB,CACf,IAAI7C,EAAQ,IAAI,WAAW,CAAC,EAC5B,OAAAA,EAAM,CAAC,EAAI6C,EAAQ,gBACnB7C,EAAM,CAAC,EAAI6C,EAAQ,YACnB7C,EAAM,CAAC,EAAI6C,EAAQ,SACZ7C,CACX,CACJ,CACJ,CAAC,CACL,CAEO,SAASqE,GAAeJ,EAAiC1E,EAA0C,CAEtG,IAAIsD,EAAyCoB,EAAQ,QAQrD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYD,GACRC,EACA,CAMI,uBAAwB,CACpB,CAAE,aAAcA,EAAQ,gBAAiB,WAAY,CAAK,EAC1D,CAAE,aAAcA,EAAQ,YAAa,WAAY,CAAK,EACtD,CAAE,aAAcA,EAAQ,SAAU,WAAY,CAAK,CACvD,EACA,iBAAkB,CAAE,CAAK,CAC7B,CACJ,EACA,iBAAkBc,GACdd,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CAEzD,OADa4C,GAA8B9C,EAAO,EAAGyB,CAAO,EAC9C,CAAC,CACnB,CACJ,CACJ,EACA,iBAAkB,CACd,MAAmB,CACf,IAAI7C,EAAQ,IAAI,WAAW,CAAC,EAC5B,OAAAA,EAAM,CAAC,EAAI6C,EAAQ,gBACnB7C,EAAM,CAAC,EAAI6C,EAAQ,YACnB7C,EAAM,CAAC,EAAI6C,EAAQ,SACZ7C,CACX,CACJ,CACJ,CAAC,CACL,CAEA,SAASsE,GACLzB,EACA9B,EAAuF,CAEvF,IAAIhD,EAAM8E,EAAQ,aACdC,EAAoBD,EAAQ,KAAK,EAAI9E,EAiDzC,OA/CmCmF,GAAAC,GAAA,GAC5BpC,GAD4B,CAG/B,SAAuB,CACnB,MAAO,CAAE,KAAM,IAAI,WAAW8B,EAAQ,MAAQA,EAAQ,OAASA,EAAQ,aAAe,CAAC,CAAE,CAC7F,EAEA,YAAYzF,EAAWE,EAAyB,CAE5C,IAAIiH,EAAS,KAAK,MAAMnH,EAAIyF,EAAQ,MAAM,CAAC,EACvCS,EAAe,KAAK,MAAMhG,EAAIuF,EAAQ,MAAM,CAAC,EAAIA,EAAQ,MAAM,QAAW0B,EAE1EC,EAAW,KAAK,MAAMpH,EAAIyF,EAAQ,MAAM,CAAC,EAmBzC4B,GAAmBnH,EAAI,MAAe,GAAM,IACzBA,EAAI,IAAe,GAAM,GACzBA,EAAI,KAAe,GAAM,GACzBkH,EAAW,KAAe,GAAM,EAEnDrE,EAAY0C,EAAQ,KAAK,SAAYC,GAAsB1F,EAAIyF,EAAQ,KAAK,EAAK,GAAK9E,EAASX,EAAIyF,EAAQ,KAAK,EAAK9E,EAEzH,MAAO,CACH,OAAQ0G,EACR,SAAUtE,EACV,SAAUpC,EACV,YAAauF,CACjB,CACJ,CACJ,EAGJ,CAEO,SAASoB,GAAiBT,EAAiC1E,EAA0C,CAExG,IAAIsD,EAAyCoB,EAAQ,QAwBrD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYyB,GACRzB,EACA,CACI,iBAAkB,CAAE,EAAM,CAAK,CACnC,CACJ,EACA,iBAAkBc,GACdd,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CACzD,IAAIC,EAAS2C,GAA8B9C,EAAO,EAAGyB,CAAO,EAC5D,OAAStB,EAAO,CAAC,EAAI,IAAS,EAAMA,EAAO,CAAC,EAAI,GAAUA,EAAO,CAAC,EAAI,IAAS,GAAM,CACzF,CACJ,CACJ,CACJ,CAAC,CACL,CAEA,SAASoD,GACL9B,EACA9B,EAAyF,CAkEzF,OAhEoCmC,GAAAC,GAAA,GAC7BpC,GAD6B,CAGhC,SAAuB,CACnB,IAAI6D,EAAU,GACVC,EAAO,GAIX,MAAO,CAAE,KAAM,IAAI,WAAYD,EAAUC,EAAQ,CAAC,EAAG,aAAc,EAAK,CAC5E,EACA,QAAQ7E,EAAyB,CAC7B,IAAI8E,EAAK,EACLC,EAAK,EACLC,EAAW,EACXC,EAAO,EACPC,EAASJ,GAAOC,EAAK,IAAS,GAAQA,EAAK,IAAU,GAAM,IAASA,EAAK,IAAW,GAAM,GAAOC,GAAY,IAAOC,GAAQ,IAE5HE,EAAUD,EAAS,IACnBE,GAAYF,EAAS,QAAW,EAEpC,QAAS3H,EAAI,EAAGA,EAAIyC,EAAM,OAAQ,EAAEzC,EAC5BA,EAAI,GAAK,EACTyC,EAAMzC,CAAC,EAAI4H,EAEXnF,EAAMzC,CAAC,EAAI6H,EAKnB,IAAInF,EAAU,EAAI,GAAM,EAClBoF,EAAkB,CAAC,GAAM,GAAM,GAAM,GAAM,EAAM,GAAM,GAAM,EAAM,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,EAAI,EACnI,QAASjI,EAAI,EAAGA,EAAIiI,EAAM,OAAQ,EAAEjI,EAAG,CACnC,IAAI8H,EAASJ,GAAOC,EAAK,IAAS,GAAQA,EAAK,IAAU,GAAM,IAASA,EAAK,IAAW,GAAM,GAAOM,EAAMjI,CAAC,GAAK,IAAO6H,GAAQ,IAE5HE,EAAUD,EAAS,IACnBE,GAAYF,EAAS,QAAW,EACpClF,EAAMC,EAAU7C,EAAG,CAAE,EAAI+H,EACzBnF,EAAMC,EAAU7C,EAAG,EAAK,CAAC,EAAIgI,CACjC,CACJ,EACA,eAAe9B,EAAmC,CAM9C,IAAIhG,EAAI,KAAK,MAAMgG,EAAc,KAAK,MAAMT,EAAQ,MAAQA,EAAQ,MAAM,CAAC,CAAC,EAGxEzF,EAAIkG,EAAc,KAAK,MAAMT,EAAQ,MAAQA,EAAQ,MAAM,CAAC,EAKhE,MAAO,CACH,QAHUvF,EAAI,GAAMF,GAGH,EACjB,SAAU,EACV,SAAU,GACV,YAAakG,CACjB,CACJ,CACJ,EAGJ,CAEO,SAASgC,GAAerB,EAAiC1E,EAA0C,CAEtG,IAAIsD,EAAyCoB,EAAQ,QAErD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYD,GACRC,EACA,CACI,iBAAkB,CAAE,EAAM,CAAK,CACnC,CACJ,EACA,iBAAkB8B,GACd9B,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CAczD,IAAIC,EAAS2C,GAA8B9C,EAAO,EAAGyB,CAAO,EAExDiC,EAAKvD,EAAO,CAAC,EACbwD,EAAKxD,EAAO,CAAC,EAEbgE,EAAO,EACPC,EAAYlE,EAAK,YAAc,GAInC,OAFawD,GAAOC,EAAK,IAAS,GAAQA,EAAK,IAAU,GAAM,IAASA,EAAK,IAAW,GAAM,GAAOS,GAAY,IAAOD,GAAQ,GAGpI,CACJ,CACJ,CACJ,CAAC,CACL,CAEA,SAASE,GACL5C,EACA9B,EAA0F,CA0C1F,OAtCoCmC,GAAAC,GAAA,GAC7BpC,GAD6B,CAGhC,SAAuB,CACnB,IAAI6D,EAAU,EACVC,EAAO,EAIX,MAAO,CAAE,KAAM,IAAI,WAAYD,EAAUC,EAAQ,CAAa,EAAG,aAAc,EAAK,CACxF,EACA,SAASa,EAAWC,EAAWpE,EAAQqE,EAAYC,EAAWC,EAAgB,CAE1E,QAASC,EAAkB,EAAGA,EAAkBlD,EAAQ,WAAW,OAAQ,EAAEkD,EAAiB,CAC1F,IAAIC,EAAYC,GAAwBF,EAAiBlD,EAAQ,WAAY,EAAG,IAAM,CAAC,EAEvF,GAAImD,EAAU,CAAC,GAAK,EAChB,SAGJ,IAAI5G,EAAQ4G,EAAU,CAAC,EAAI,EAIvBzB,EAAUwB,EAAkBlD,EAAQ,KAAK,QAGzCqD,EAFM,KAAK,MAAMH,EAAkBlD,EAAQ,KAAK,OAAO,EAEvCA,EAAQ,KAAK,QAAU,EAAkB0B,EAAS,EAEtE,QAAShH,EAAI,EAAGA,EAAI,EAAe,EAAEA,EAEjCsI,EAAUzG,EAAO7B,CAAC,EAAIoI,EAAUO,EAAS3I,CAAC,CAElD,CACA,MAAO,EACX,CACJ,EAGJ,CAEO,SAAS4I,GAAqBlC,EAAiC1E,EAA0C,CAE5G,IAAIsD,EAAyCoB,EAAQ,QAEjDmC,EAAuB,CAAE,EAAM,CAAK,EAEpCjE,EAAaS,GACbC,EACA,CACI,kBAAkBzB,EAAeC,EAAsBC,EAA4B,CAE/E,IAAIC,EAAS2C,GAA8B9C,EAAOyB,EAAQ,eAAe,OAAQA,CAAO,EAExF,QAAStF,EAAI,EAAGA,EAAIsF,EAAQ,eAAe,OAAQ,EAAEtF,EACjD,GAAIgE,EAAOhE,CAAC,GAAK8D,EACb,OAAO+E,EAAqB,EAAI7I,CAAC,EAGzC,IAAI8I,EAAUC,GAA+BhF,EAAK,YAAauB,EAAQ,SAAU,EAAGA,CAAO,EAAE,CAAC,EAC9F,OAAIwD,GAAWhF,EACJ+E,EAAqB,CAAC,GAEjC,QAAQ,IAAI,uDAAwDhF,EAAOC,EAAcE,EAAQD,EAAM+E,CAAO,EAC9GzF,GAAe,EAAK,EACb,EACX,CACJ,CACJ,EAEA,OAAOqB,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYV,EACZ,iBAAkBwC,GACd9B,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CA2BzD,IAAIC,EAAS2C,GAA8B9C,EAAO,EAAGyB,CAAO,EAExDiC,EAAKvD,EAAO,CAAC,EACbgF,EAAUhF,EAAO,CAAC,EAElBiF,EAAW3D,EAAQ,MAAM,KAAQ,EAAE,EAAE,EAErC4D,GAAuB3B,EAAK,IAAW,EACvC4B,EAAY7D,EAAQ,UAAU,KAAOoD,GAAwB3E,EAAK,YAAauB,EAAQ,WAAY,EAAG,IAAM,CAAC,EAAI,CAAC2D,EAAW,EAAI,EAAGA,EAAYlF,EAAK,YAAc,GAAY,CAAC,EAChLqF,EAAaD,EAAS,CAAC,GAAK,EAChC9F,GAAgB,CAAC6F,GAAyBA,GAAwBE,CAAW,EAE7E,IAAIC,EAAYD,EAAY,EAAM,EAC9BE,EAAgBF,EAAaD,EAAS,CAAC,EAAI,GAAapF,EAAK,YAAc,IAI/E,OAFcwD,EAAK,GAAYA,EAAK,IAAW,GAAM,IAAQyB,EAAU,IAAQ,GAAOM,GAAiB,IAAOD,GAAa,GAG/H,CACJ,CACJ,EACA,gBAAkB/D,EAAQ,UAAU,KAAO4C,GAAkB5C,CAAO,EAAI,OACxE,iBAAkB,CACd,MAAmB,CACf,IAAIqC,EAAS,IAAI,WAAWrC,EAAQ,UAAU,KAAK,EACnD,QAAStF,EAAI,EAAGA,EAAIsF,EAAQ,UAAU,MAAO,EAAEtF,EAC3C2H,EAAO3H,CAAC,EAAI+I,GAA+B/I,EAAGsF,EAAQ,YAAa,EAAGA,CAAO,EAAE,CAAC,EAEpF,OAAOqC,CACX,CACJ,CACJ,CAAC,CACL,CAEA,SAAS4B,GACLjE,EACA9B,EAA0F,CAuB1F,OArBoCmC,GAAAC,GAAA,GAC7BpC,GAD6B,CAGhC,SAAuB,CACnB,MAAO,CAAE,KAAM,IAAI,WAAW8B,EAAQ,MAAM,IAAI,CAAE,CACtD,EACA,eAAeS,EAAmC,CAC9C,IAAIlG,EAAIkG,EAAc,GAClBhG,EAAIgG,GAAe,EAIvB,MAAO,CACH,OAHUhG,EAAI,EAAMF,GAAK,EAAOE,GAAK,GAAM,EAI3C,SAAU,EACV,SAAU,EACV,YAAagG,CACjB,CACJ,CACJ,EAGJ,CAEO,SAASyD,GAAc9C,EAAiC1E,EAA0C,CAErG,IAAIsD,EAAyCoB,EAAQ,QAErD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYD,GACRC,EACA,CACI,iBAAkB,CAAE,EAAM,CAAK,CACnC,CACJ,EACA,iBAAkBiE,GACdjE,EACA,CACI,kBAAkBzB,EAAeE,EAA4B,CACzD,IAAIC,EAAS2C,GAA8B9C,EAAO,EAAGyB,CAAO,EAK5D,OAAAtB,EAAO,CAAC,EAAKA,EAAO,CAAC,GAAK,EAAQ,EAAOA,EAAO,CAAC,EACjDA,EAAO,CAAC,EAAKA,EAAO,CAAC,GAAK,EAAQ,EAAOA,EAAO,CAAC,EAE1CA,EAAO,CAAC,EAAKA,EAAO,CAAC,GAAK,CACrC,CACJ,CACJ,CACJ,CAAC,CACL,CAWA,SAASyF,GACLC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAzE,EAAiD,CAkDjD,IAAI0E,EAAmBF,EAAcxE,EAAQ,MAAM,EAG/C2E,EAAiB,KAAK,MAAOD,EAAmB1E,EAAQ,MAAM,EAAIoE,EAAUM,EAAmBH,CAAa,EAAI,EAEhHK,EAAoB5E,EAAQ,KAAK,UAChCA,EAAQ,MAAM,GAAKsE,EAAkB,IAAME,EAC5CF,EAAkBE,EAElBK,EAAmB,KAAK,MAAMD,EAAoB,CAAC,EACvD,OAAAC,EAAmBJ,EAAsBI,EAAmB,KAAK,MAAMH,EAAmB,CAAC,EAAIG,EAAmB,EAElHD,EAAoBA,EAAoB,EAExC7G,IAAgB4G,EAAiBE,GAAoB,EAAKR,EAASK,EAAmB1E,EAAQ,MAAM,CAAE,EAC/F,CAAE,OAAQ2E,EAAiBE,EAAkB,SAAUD,EAAmB,SAAUJ,CAAY,CAC3G,CAGA,SAASM,GACLV,EACAC,EACAC,EACAC,EACAC,EACAC,EACAzE,EAAiD,CAkCjD,IAAI0E,EAAmBF,EAAcxE,EAAQ,MAAM,EAE/C+E,GAAaR,EAAe,IAAQ,EAKpCI,EAAiB,KAAK,QAASD,EAAmB1E,EAAQ,MAAM,GAAKoE,GAAS,IAAO,GACtDM,EAAmBH,GAAkBQ,EAAW,EAAI,IAAM,CAAC,EAE1FH,EAAoB5E,EAAQ,KAAK,UAChCA,EAAQ,MAAM,GAAKsE,EAAkB,IAAME,EAC5CF,EAAkBE,EAElBK,EAAmB,KAAK,MAAMD,EAAoB,CAAC,EACvD,OAAAC,EAAmBJ,EAAsBI,EAAmB,KAAK,MAAMH,EAAmB,CAAC,EAAIG,EAAmB,EAElHD,EAAoBA,EAAoB,EAExC7G,IAAgB4G,EAAiBE,GAAoB,EAAKR,EAASK,EAAmB1E,EAAQ,MAAM,CAAE,EAC/F,CAAE,OAAQ2E,EAAiBE,EAAkB,SAAUD,EAAmB,SAAUJ,CAAY,CAC3G,CAGA,SAASQ,GACLZ,EACAC,EACAC,EACAC,EACAC,EACAC,EACAzE,EAAiD,CAajD,IAAI0E,EAAmBF,EAAcxE,EAAQ,MAAM,EAG/C2E,EAAiB,KAAK,MAAOD,EAAmBL,EAASE,EAAiBG,EAAmBN,CAAM,EAAI,EAEvGQ,EAAoB5E,EAAQ,KAAK,UAChCA,EAAQ,MAAM,GAAKsE,EAAkB,IAAME,EAC5CF,EAAkBE,EAElBK,EAAmB,KAAK,MAAMD,EAAoB,CAAC,EACvD,OAAAC,EAAmBJ,EAAsBI,EAAmB,KAAK,MAAMH,EAAmB,CAAC,EAAIG,EAAmB,EAElHD,EAAoBA,EAAoB,EAExC7G,IAAgB4G,EAAiBE,GAAoB,EAAKR,EAASK,EAAmB1E,EAAQ,MAAM,CAAE,EAC/F,CAAE,OAAQ2E,EAAiBE,EAAkB,SAAUD,EAAmB,SAAUJ,CAAY,CAC3G,CAEA,IAAMS,GACN,CACI,QAASd,GACT,YAAaW,GACb,OAAQE,EACZ,EAOUE,GACV,CACI,QAASC,GACT,SAAUC,EACd,EAEA,SAASD,GACLpJ,EACAsJ,EACJ,CACI,OAAOtJ,CACX,CAEA,SAASqJ,GACLrJ,EACAsJ,EACJ,CACI,IAAIC,EAAMD,EAAQtJ,CAAK,EAEnBwJ,EAAKD,EAAM,IACXE,EAAKF,GAAO,EAAK,IAGrB,OAFSA,GAAO,GAAM,IAER,MAAe,GAAM,GAAQE,EAAI,MAAe,GAAM,GAAQD,EAAI,MAAe,GAAM,CACzG,CAEO,SAASE,GACZrE,EACApB,EACAtD,EACAwB,EACJ,CACI,IAAIa,EAAUqC,EAAQ,QAGlBiD,EAAiB,EAGjBqB,EAAuB,EAGvBC,EAAuB,EAGvBnB,EAAsB,EAEpBoB,EAAuB,GACvBC,EAAwB,GAqH9B,OAnHmCxF,GAAAC,GAAA,GAC5BpC,GAD4B,CAE/B,SAAuB,CAEnB,OAAAmG,EAAU3H,EAAS,YAAc,OAC7B,KAAK,KAAK,KAAK,KAAKsD,EAAQ,MAAM,MAAM,CAAC,EACxC,WAAYtD,EAAS,UAAYA,EAAS,UAAU,OAAS,KAAK,KAAK,KAAK,KAAKsD,EAAQ,MAAM,MAAM,CAAC,EAG3G0F,EAAe1F,EAAQ,MAAM,EAAIA,EAAQ,MAAM,EAG/C2F,EAAe3F,EAAQ,MAAM,QAAUA,EAAQ,MAAM,KAErDwE,EAAe9H,EAAS,YAAc,OAClC,EACC,gBAAiBA,EAAS,UAAYA,EAAS,UAAU,YAAc,EAErE,CAAE,KAAM,IAAI,WAAW,KAAK,MAAO2H,EAASG,EAAckB,EAAeC,EAAgB,CAAC,CAAC,CAAE,CACxG,EACA,QAAQ/I,EAAwB,CAC5B,IAAIkJ,EAAe,KAAK,MAAM9F,EAAQ,MAAM,QAAU4F,CAAY,EAC9DG,EAAe,KAAK,MAAM/F,EAAQ,MAAM,KAAO6F,CAAa,EAE5DG,EAAoB,KAAK,MAAO3B,EAASG,EAAckB,EAAeE,EAAeC,EAAiB,CAAC,EACvGI,EAAc,KAAK,MAAO5B,EAASG,EAAckB,EAAgB,CAAC,EAClEQ,EAAoBD,EAAcL,EAElCO,EAA6BzJ,EAAS,YAAc,OACpDuI,GAA2B,QAC1B,kBAAmBvI,EAAS,UAAYuI,GAA2BvI,EAAS,UAAU,aAAa,EAAIuI,GAA2B,QAEnImB,EAAsB1J,EAAS,YAAc,OAC7CwI,GAAmB,QAClB,mBAAoBxI,EAAS,UAAYwI,GAAmBxI,EAAS,UAAU,cAAc,EAAIwI,GAAmB,QAErHmB,GAAc,GAAK7B,GAAe,EAElCC,EAAgC/H,EAAS,YAAc,OACvD,GACC,sBAAuBA,EAAS,UAAYA,EAAS,UAAU,aAAe,GAE/E4J,EAAiBtG,EAAQ,MAAM,SAC/B,CAACoE,EAAerI,IAAkB,CAC9B,IAAIwK,GAAWlC,GAAUD,EAAQ,IAAMI,EACnCgC,EAAgBzK,EAASsK,GAAcE,EAC3C,MAAO,CAAE,cAAeC,GAAiBD,EAAS,cAAexK,EAAQyK,CAAc,CAC3F,EACA,CAACpC,EAAerI,IAAkB,CAC9B,IAAIwK,EAAUnC,EAAQI,EAClBgC,EAAgBzK,EAASsK,GAAcE,EAC3C,MAAO,CAAE,cAAeC,EAAe,cAAezK,EAAQyK,CAAc,CAChF,EAGJ,QAAS9L,EAAI,EAAGA,EAAIqE,EAAQ,OAAQ,EAAErE,EAAG,CAErC,IAAIgH,EAAS,KAAK,MAAMhH,EAAIsF,EAAQ,MAAM,CAAC,EAAIA,EAAQ,MAAM,QACzDyG,EAAM,KAAK,MAAM/L,GAAKsF,EAAQ,MAAQA,EAAQ,MAAM,EAAE,EAEtD0G,EAAa,KAAK,MAAMhF,EAASkE,CAAY,EAO7Ce,GANa,KAAK,MAAMF,EAAMZ,CAAa,EAGLC,EAAgBY,GAGPV,EAG/CY,EAAgBlF,EAASkE,EACzBiB,GAAaJ,EAAMZ,EAEnB9J,GAAQqK,EAAmBrH,EAAQrE,CAAC,EAAGgC,EAAS,GAAG,EAGnDoK,EAAMpM,EAAIsF,EAAQ,MAAM,EACxB+G,EAAK,KAAK,MAAMrM,EAAIsF,EAAQ,KAAK,EAAIA,EAAQ,MAAM,EAGnDgH,EAAcd,EAAoBW,GAAeZ,EAAcW,EAGnE,QAASxC,EAAQ,EAAIA,EAAQC,EAA+B,EAAED,EAAO,CACjE,GAAI,CAAE,cAAAoC,EAAe,cAAAS,EAAc,EAAIX,EAAelC,EAAOrI,EAAK,EAC9DmL,EAAUf,EAA0B/B,EAAOC,EAAQyC,EAAIC,EAAIvC,EAAaC,EAAqBzE,CAAO,EACxGjE,GAAQkL,GAER,IAAIE,EAAcR,EAAsBK,EAAaE,EAAQ,OAC7DhK,GAAqBN,EAAMuK,EAAaX,EAAeU,EAAQ,SAAUA,EAAQ,SAAUzC,CAAmB,CAqBlH,CACJ,CACJ,CACJ,EAGJ,CAEO,SAAS2C,GACZhG,EACApB,EACAtD,EACAwB,EACJ,CAEI,IAAIyH,EAAuB,EAErBC,EAAuB,GACvBC,EAAwB,GAE1BwB,EAA0B3K,EAAS,YAAc,OACjD,GACC,kBAAmBA,EAAS,UAAYA,EAAS,UAAU,aAAe,GAE3E4K,EAA0B5K,EAAS,YAAc,OACjD,GACC,kBAAmBA,EAAS,UAAYA,EAAS,UAAU,aAAe,GAE/E,MAAK,CAAC2K,GACD,CAACC,EACF,OAEgCjH,GAAAC,GAAA,GAC7BpC,GAD6B,CAEhC,SAAuB,CAGnB,OAAAyH,EAAe3F,EAAQ,MAAM,QAAUA,EAAQ,MAAM,KAE9C,CAAE,KAAM,IAAI,WAAa,EAAI2F,GAAiB0B,EAAgB,EAAI,IAAOC,EAAgBtH,EAAQ,MAAM,OAAS,EAAE,CAAE,CAC/H,EACA,QAAQpD,EAAwB,CAC5B,IAAI2K,EAA+B7K,EAAS,YAAc,OACtD,GACC,wBAAyBA,EAAS,UAAYA,EAAS,UAAU,aAAe,GAEzF,GAAI2K,EAAe,CACX,IAAIvB,EAAe,KAAK,MAAM9F,EAAQ,MAAM,QAAU4F,CAAY,EAC9DG,EAAe,KAAK,MAAM/F,EAAQ,MAAM,KAAO6F,CAAa,EAE5DG,EAAoB,KAAK,MAAOJ,EAAeC,EAAiB,CAAC,EAErE,QAASY,EAAM,EAAGA,EAAMzG,EAAQ,MAAM,KAAM,EAAEyG,EAC1C,QAAS/E,EAAS,EAAGA,EAAS1B,EAAQ,MAAM,QAAS,EAAE0B,EAAQ,CAC3D,IAAIgF,EAAa,KAAK,MAAMhF,EAASkE,CAAY,EAO7Ce,GANa,KAAK,MAAMF,EAAMZ,CAAa,EAGLC,EAAgBY,GAGPV,EAE/CY,EAAgBlF,EAASkE,EACzBiB,EAAaJ,EAAMZ,EAEnBzI,GAAWyJ,EAAa7G,EAAQ,MAAM,QAAW4G,GAAiB,EAElEO,EAAcR,EAAsBvJ,EAEpCoK,EAAM7I,GAAuBqB,EAAQ,YAAayG,EAAK/E,EAAUA,CAAM,EAAG,EAAG,EAAK,CAAC,EAEnF+F,EAAI,EACJC,EAAI,EACJzL,EAAIuL,EAAI,CAAC,EAAI,EACbtL,EAAM2K,EAAajB,EAAgBgB,EAAiB,KACpDe,EAAQF,GAAK,GAAOC,GAAK,GAAOzL,GAAK,GAAMC,EAE/CgB,GAAqBN,EAAMuK,EAAaQ,EAAM,EAAG,GAAIJ,CAAkB,CAE3E,CAER,CAEA,GAAID,EAAe,CACf,IAAIM,EAAgBP,EAAgB,EAAK,KAAK,MAAO,EAAI1B,EAAgB,CAAC,EAE1E,QAAS1J,EAAI,EAAGA,EAAI+D,EAAQ,MAAM,OAAQ,EAAE/D,EAAG,CAC3C,IAAIqJ,EAAMlE,EAAQ,IAAInF,CAAC,EAEnBsJ,EAAKD,EAAM,IACXE,EAAMF,GAAO,EAAK,IAClBuC,EAAMvC,GAAO,GAAM,IAEnBwC,EAAWvC,GAAK,EAAK,IAAcC,GAAK,EAAK,KAAY,GAAQqC,GAAK,EAAK,KAAY,GAE3F3K,GAAqBN,EAAMgL,EAAiB3L,EAAI,EAAI6L,EAAQ,EAAG,GAAIP,CAAkB,CAEzF,CACJ,CACJ,CACJ,EAGJ,CAEO,SAASQ,GAAW3G,EAAiC1E,EAA0C,CAClG,IAAIsD,EAAyCoB,EAAQ,QAErD,OAAOhC,GAAsC,CACzC,QAASgC,EACT,QAASpB,EACT,WAAYyF,GAAyBrE,EAASpB,EAAStD,EAAU,CAAC,CAAC,EACnE,iBAAkB0K,GAAqBhG,EAASpB,EAAStD,EAAU,CAAC,CAAC,CACzE,CAAC,CACL,CAEO,SAASsL,GAAUvL,EAA6BC,EAA0C,CAK7F,QAJIhC,EAAI,EACJuN,EAAOxL,EAAI,MAAQ,EACnBuF,EAAOvF,EAAI,OAAS,EACpByL,EAAO,IAAI,WAAWzL,EAAI,MAAQA,EAAI,OAAS,EAAI,CAAC,EAC/ChC,EAAI,EAAGA,EAAIgC,EAAI,OAAQhC,IAC5B,QAASF,EAAI,EAAGA,EAAIkC,EAAI,MAAOlC,IAAK,CAChC,IAAI4N,EAAU,KAAK,MAAM5N,EAAI,CAAC,EAAI,KAAK,MAAME,EAAI,CAAC,EAAIwN,EAClDjM,EAAMmM,EAAU,IAAM1N,EAAI,GAC1BqB,EAAQ,GAAKvB,EAAI,GACjB6N,EAAO3L,EAAI,QAAQ/B,CAAC,EAAK,IAC7BwN,EAAKlM,CAAG,IAAMoM,EAAM,IAAMtM,EAC1BoM,EAAKlM,EAAM,CAAC,IAAOoM,GAAO,EAAK,IAAMtM,EACrCpB,GACJ,CAEJ,OAAOwN,CACX,CAEO,SAASG,GAAgB5L,EAA6BC,EAA0C,CACnG,GAAI,CAACA,EAAS,MAAO,KAAM,gBAC3B,IAAIwL,EAAO1L,GAAkBC,EAAKC,CAAQ,EAEtC5B,EAAM,CAAE,EAAG4B,EAAS,MAAM,EAAG,EAAGA,EAAS,MAAM,EAAG,IAAK,CAAE,EACzD4L,EAAO,IAAI,WAAW1N,GAAqB,CAAC6B,EAAI,OAAO,EAAG3B,CAAG,CAAC,EAClE,OAAOqB,GAAa,CAAC+L,EAAMI,CAAI,CAAC,CACpC,CAEO,SAASC,GAAmB9L,EAA6BC,EAA0C,CAEtG,IAAIwL,EAAO,IAAI,WAAW,EAAIzL,EAAI,MAAM,EACxC,IAAM+L,EAAQ,CACV,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GACxB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GACtB,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5B,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5B,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAC5B,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAChC,EACA,QAAS/N,EAAI,EAAGA,EAAIgC,EAAI,OAAQhC,IAC5B,QAASF,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAIsC,EAAS2L,EAAMjO,CAAC,EACpB,GAAIsC,GAAU,IACVA,GAAUpC,EAAIgC,EAAI,MACdA,EAAI,QAAQI,CAAM,GAAG,CACrB,IAAIC,GAAWvC,GAAK,GAAKkC,EAAI,OAASA,EAAI,OAAShC,EAAI,EACvDyN,EAAKpL,CAAO,GAAK,MAAQvC,EAAI,EACjC,CAER,CAEJ,OAAO2N,CACX,CAEO,SAASO,GAAahM,EAA6BC,EAA0C,CAChG,IAAIwL,EAAO,IAAI,WAAWzL,EAAI,MAAQA,EAAI,OAAS,CAAC,EACpD,IAAIiM,EAAO,EACPC,EAAO,EACX,QAASlO,EAAI,EAAGA,EAAIgC,EAAI,OAAQhC,IAC5B,QAASF,EAAI,EAAGA,EAAIkC,EAAI,MAAOlC,GAAK,EAAGoO,GAAQ,EAC3CT,EAAKQ,GAAM,IAAMjM,EAAI,QAAQkM,EAAO,CAAC,EAAI,IAAS,KAC5ClM,EAAI,QAAQkM,EAAO,CAAC,EAAI,IAAS,KACjClM,EAAI,QAAQkM,EAAO,CAAC,EAAI,IAAS,KACjClM,EAAI,QAAQkM,EAAO,CAAC,EAAI,IAAS,GAG/C,eAAQ,IAAIT,CAAI,EACTA,CACX,CIryDA,IAAAU,GAAA,GAAAC,GAAAD,GAAA,oCAAAE,GAAA,gCAAAC,GAAA,+BAAAC,GAAA,kCAAAC,GAAA,8BAAAC,GAAA,gCAAAC,GAAA,oCAAAC,GAAA,0CAAAC,GAAA,wCAAAC,GAAA,gCAAAC,GAAA,oCAAAC,GAAA,0CAAAC,GAAA,+CAAAC,GAAA,wCAAAC,GAAA,0BAAAC,GAAA,gCAAAC,GAAA,gCAAAC,GAAA,0BAAAC,GAAA,0BAAAC,GAAA,0BAAAC,GAAA,yBAAAC,GAAA,gCAAAC,GAAA,qCAAAC,GAAA,8BAAAC,GAAA,qCAAAC,KCAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAA,IAAAC,GAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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",
  "names": ["require_cropper", "__commonJSMin", "exports", "module", "global", "factory", "ownKeys", "e", "r", "t", "o", "_objectSpread2", "_defineProperty", "_typeof", "_classCallCheck", "instance", "Constructor", "_defineProperties", "target", "props", "descriptor", "_toPropertyKey", "_createClass", "protoProps", "staticProps", "obj", "key", "value", "_toConsumableArray", "arr", "_arrayWithoutHoles", "_iterableToArray", "_unsupportedIterableToArray", "_nonIterableSpread", "_arrayLikeToArray", "iter", "minLen", "n", "len", "arr2", "_toPrimitive", "input", "hint", "prim", "res", "arg", "IS_BROWSER", "WINDOW", "IS_TOUCH_DEVICE", "HAS_POINTER_EVENT", "NAMESPACE", "ACTION_ALL", "ACTION_CROP", "ACTION_MOVE", "ACTION_ZOOM", "ACTION_EAST", "ACTION_WEST", "ACTION_SOUTH", "ACTION_NORTH", "ACTION_NORTH_EAST", "ACTION_NORTH_WEST", "ACTION_SOUTH_EAST", "ACTION_SOUTH_WEST", "CLASS_CROP", "CLASS_DISABLED", "CLASS_HIDDEN", "CLASS_HIDE", "CLASS_INVISIBLE", "CLASS_MODAL", "CLASS_MOVE", "DATA_ACTION", "DATA_PREVIEW", "DRAG_MODE_CROP", "DRAG_MODE_MOVE", "DRAG_MODE_NONE", "EVENT_CROP", "EVENT_CROP_END", "EVENT_CROP_MOVE", "EVENT_CROP_START", "EVENT_DBLCLICK", "EVENT_TOUCH_START", "EVENT_TOUCH_MOVE", "EVENT_TOUCH_END", "EVENT_POINTER_DOWN", "EVENT_POINTER_MOVE", "EVENT_POINTER_UP", "EVENT_READY", "EVENT_RESIZE", "EVENT_WHEEL", "EVENT_ZOOM", "MIME_TYPE_JPEG", "REGEXP_ACTIONS", "REGEXP_DATA_URL", "REGEXP_DATA_URL_JPEG", "REGEXP_TAG_NAME", "MIN_CONTAINER_WIDTH", "MIN_CONTAINER_HEIGHT", "DEFAULTS", "TEMPLATE", "isNaN", "isNumber", "isPositiveNumber", "isUndefined", "isObject", "hasOwnProperty", "isPlainObject", "_constructor", "prototype", "error", "isFunction", "slice", "toArray", "forEach", "data", "callback", "assign", "_len", "args", "_key", "REGEXP_DECIMALS", "normalizeDecimalNumber", "times", "REGEXP_SUFFIX", "setStyle", "element", "styles", "style", "property", "hasClass", "addClass", "elem", "className", "removeClass", "toggleClass", "added", "REGEXP_CAMEL_CASE", "toParamCase", "getData", "name", "setData", "removeData", "REGEXP_SPACES", "onceSupported", "supported", "once", "listener", "options", "removeListener", "type", "handler", "event", "listeners", "addListener", "_handler", "_element$listeners", "_len2", "_key2", "dispatchEvent", "getOffset", "box", "location", "REGEXP_ORIGINS", "isCrossOriginURL", "url", "parts", "addTimestamp", "timestamp", "getTransforms", "_ref", "rotate", "scaleX", "scaleY", "translateX", "translateY", "values", "transform", "getMaxZoomRatio", "pointers", "pointers2", "maxRatio", "pointer", "pointerId", "pointer2", "x1", "y1", "x2", "y2", "z1", "z2", "ratio", "getPointer", "_ref2", "endOnly", "pageX", "pageY", "end", "getPointersCenter", "count", "_ref3", "startX", "startY", "getAdjustedSizes", "_ref4", "aspectRatio", "height", "width", "isValidWidth", "isValidHeight", "adjustedWidth", "getRotatedSizes", "_ref5", "degree", "arc", "sinArc", "cosArc", "newWidth", "newHeight", "getSourceCanvas", "image", "_ref6", "_ref7", "_ref8", "imageAspectRatio", "imageNaturalWidth", "imageNaturalHeight", "_ref6$rotate", "_ref6$scaleX", "_ref6$scaleY", "naturalWidth", "naturalHeight", "_ref8$fillColor", "fillColor", "_ref8$imageSmoothingE", "imageSmoothingEnabled", "_ref8$imageSmoothingQ", "imageSmoothingQuality", "_ref8$maxWidth", "maxWidth", "_ref8$maxHeight", "maxHeight", "_ref8$minWidth", "minWidth", "_ref8$minHeight", "minHeight", "canvas", "context", "maxSizes", "minSizes", "destMaxSizes", "destMinSizes", "destWidth", "destHeight", "params", "param", "fromCharCode", "getStringFromCharCode", "dataView", "start", "length", "str", "i", "REGEXP_DATA_URL_HEAD", "dataURLToArrayBuffer", "dataURL", "base64", "binary", "arrayBuffer", "uint8", "arrayBufferToDataURL", "mimeType", "chunks", "chunkSize", "resetAndGetOrientation", "orientation", "littleEndian", "app1Start", "ifdStart", "offset", "exifIDCode", "tiffOffset", "endianness", "firstIFDOffset", "_length", "_offset", "parseOrientation", "render", "container", "cropper", "containerData", "imageData", "viewMode", "rotated", "canvasWidth", "canvasHeight", "canvasData", "sizeLimited", "positionLimited", "cropBoxData", "cropped", "minCanvasWidth", "minCanvasHeight", "_getAdjustedSizes", "newCanvasLeft", "newCanvasTop", "changed", "transformed", "_getRotatedSizes", "autoCropArea", "limited", "minCropBoxWidth", "minCropBoxHeight", "maxCropBoxWidth", "maxCropBoxHeight", "preview", "crossOrigin", "alt", "previews", "el", "img", "cropBoxWidth", "cropBoxHeight", "left", "top", "originalWidth", "originalHeight", "events", "handlers", "ratioX", "ratioY", "_this", "delta", "buttons", "button", "action", "touch", "change", "right", "bottom", "minLeft", "minTop", "renderable", "range", "check", "side", "p", "methods", "hasSameSize", "offsetX", "offsetY", "_this$canvasData", "x", "y", "_originalEvent", "pivot", "center", "_scaleX", "_scaleY", "rounded", "widthChanged", "heightChanged", "source", "_this$getData", "initialX", "initialY", "initialWidth", "initialHeight", "_options$imageSmoothi", "sourceWidth", "sourceHeight", "srcX", "srcY", "srcWidth", "srcHeight", "dstX", "dstY", "dstWidth", "dstHeight", "scale", "mode", "dragBox", "face", "croppable", "movable", "AnotherCropper", "Cropper", "tagName", "xhr", "clone", "_parseOrientation", "crossOriginUrl", "_this2", "isIOSWebKit", "done", "sizingImage", "body", "template", "cropBox", "parentNode", "require_pica", "__commonJSMin", "exports", "module", "f", "g", "define", "r", "e", "n", "t", "o", "i", "__require", "u", "a", "p", "_dereq_", "Multimath", "mm_unsharp_mask", "mm_resize", "MathLib", "requested_features", "__requested_features", "features", "options", "cache", "result", "clampTo8", "clampNegative", "convolveHor", "src", "dest", "srcW", "srcH", "destW", "filters", "b", "filterPtr", "filterShift", "filterSize", "srcPtr", "srcY", "destX", "filterVal", "srcOffset", "destOffset", "convolveVert", "convolveHorWithPre", "alpha", "convolveVertWithPre", "createFilters", "_require", "hasAlpha", "width", "height", "ptr", "len", "resetAlpha", "dst", "destH", "scaleX", "scaleY", "offsetX", "offsetY", "filter", "filtersX", "filtersY", "tmp", "FILTER_INFO", "FIXED_FRAC_BITS", "toFixedPoint", "num", "srcSize", "destSize", "scale", "offset", "filterFunction", "scaleInverted", "scaleClamped", "srcWindow", "destPixel", "srcPixel", "srcFirst", "srcLast", "filterElementSize", "floatFilter", "fxpFilter", "total", "pxl", "idx", "floatVal", "filterTotal", "leftNotEmpty", "rightNotEmpty", "maxFilterElementSize", "packedFilter", "packedFilterPtr", "slowCopy", "x", "xpi", "asUint8Array", "IS_LE", "__", "copyInt16asLE", "target", "target_offset", "data", "src_offset", "src_size", "tmp_offset", "tmp_size", "filtersX_offset", "filtersY_offset", "alloc_bytes", "instance", "mem", "mem32", "src32", "fn", "dest32", "glur_mono16", "hsv_v16", "img", "size", "out", "max", "amount", "radius", "threshold", "v1", "v2", "vmul", "diff", "iTimes4", "brightness", "blured", "amountFp", "thresholdFp", "pixels", "img_bytes_cnt", "hsv_bytes_cnt", "blur_bytes_cnt", "blur_line_byte_cnt", "blur_coeffs_byte_cnt", "img_offset", "hsv_offset", "blur_offset", "blur_tmp_offset", "blur_line_offset", "blur_coeffs_offset", "img32", "GC_INTERVAL", "Pool", "create", "idle", "_this", "resource", "_this2", "_this3", "now", "MIN_INNER_TILE_SIZE", "fromWidth", "fromHeight", "toWidth", "toHeight", "srcTileSize", "destTileBorder", "minScale", "stageCount", "PIXEL_EPSILON", "pixelFloor", "nearest", "pixelCeil", "innerTileWidth", "innerTileHeight", "y", "innerX", "innerY", "toTileWidth", "toTileHeight", "tiles", "tile", "objClass", "obj", "element", "cname", "concurrency", "active", "queue", "roll", "resolve", "reject", "err", "createCanvas", "c", "bitmap", "status", "workerPayload", "self", "canvas", "ctx", "code", "w", "ev", "usable", "d", "image", "mathLib", "tileOpts", "returnBitmap", "toImageData", "_canvas", "_ctx", "a0", "a1", "a2", "a3", "b1", "b2", "left_corner", "right_corner", "gaussCoef", "sigma", "g1", "g2", "k", "convolveMono16", "line", "coeff", "prev_src", "curr_src", "curr_out", "prev_out", "prev_prev_out", "src_index", "out_index", "line_index", "j", "coeff_a0", "coeff_a1", "coeff_b1", "coeff_b2", "blurMono16", "tmp_line", "assign", "base64decode", "hasWebAssembly", "DEFAULT_OPTIONS", "MultiMath", "opts", "name", "m", "bytes", "mem_size", "memsize", "env_extra", "env_base", "number", "base", "reminder", "BASE64_MAP", "str", "input", "bits", "tailbits", "wa", "bin", "getOwnPropertySymbols", "hasOwnProperty", "propIsEnumerable", "toObject", "val", "shouldUseNative", "test1", "test2", "order2", "test3", "letter", "source", "from", "to", "symbols", "s", "key", "bundleFn", "sources", "stringify", "wkey", "cacheKeys", "l", "exp", "wcache", "skey", "scache", "workerSources", "resolveSources", "depPath", "depKey", "URL", "blob", "workerUrl", "worker", "_slicedToArray", "arr", "_arrayWithHoles", "_iterableToArrayLimit", "_unsupportedIterableToArray", "_nonIterableRest", "minLen", "_arrayLikeToArray", "arr2", "_i", "_arr", "_n", "_d", "_s", "_e", "webworkify", "utils", "createStages", "createRegions", "filter_info", "singletones", "NEED_SAFARI_FIX", "DEFAULT_PICA_OPTS", "tmpCanvas", "DEFAULT_RESIZE_OPTS", "CAN_NEW_IMAGE_DATA", "CAN_CREATE_IMAGE_BITMAP", "CAN_USE_CANVAS_GET_IMAGE_DATA", "CAN_USE_OFFSCREEN_CANVAS", "CAN_USE_CIB_REGION_FOR_IMAGE", "workerFabric", "url", "Pica", "limiter_key", "wkr", "wpool_key", "initMath", "mathlib", "checkCibResize", "checkOffscreenCanvas", "checkCibRegion", "transfer", "stageEnv", "extractTo", "tmpCtx", "processTile", "imageBitmap", "regions", "jobs", "cleanup", "stages", "_this4", "_stages$shift", "_stages$shift2", "isLastStage", "res", "_this5", "toCtx", "iData", "_this6", "DEST_TILE_BORDER", "_this7", "mimeType", "quality", "asString", "asBuffer", "b", "a", "c", "d", "g", "e", "f", "h", "i", "j", "k", "l", "m", "module", "RGB", "r", "g", "b", "MONO_RGB", "CMYK_RGB", "VIC_NTSC_RGB", "VIC_PAL_RGB", "VIC20_PAL_RGB", "TMS9918_RGB", "NES_RGB", "AP2HIRES_RGB", "AP2LORES_RGB", "ASTROCADE_RGB", "VCS_RGB", "CGA_RGB", "CGA_RGB_1", "CGA_RGB_2", "CGA_RGB_3", "CGA_RGB_1H", "CGA_RGB_2H", "CGA_RGB_3H", "SMS_RGB", "generateRGBPalette", "WILLIAMS_RGB", "ATARIST_RGB", "TELETEXT_RGB", "ZXSPECTRUM_RGB", "INTELLIVISION_STIC_RGB", "AMSTRAD_CPC_RGB", "PICO8_RGB", "TIC80_RGB", "CHANNELF_RGB", "GAMEBOY_GREEN_RGB", "RGB_444", "generateRGBPalette", "AMIGA_OCS_COLOR_RGB", "RGB_444", "IIGS_COLOR_RGB", "GAMEGEAR_COLOR_RGB", "SNES_B5G5R5_RGB", "generateSNESB5G5R5", "SNES_BBPGGGPRRRP", "generateSNESDirectColor", "MC6847_PALETTE0", "RGB", "MC6847_PALETTE1", "generateRGBPalette", "rr", "gg", "bb", "n", "rs", "gs", "bs", "pal", "i", "r", "g", "b", "result", "color", "SYSTEMS", "VIC_PAL_RGB", "NES_RGB", "TMS9918_RGB", "AP2HIRES_RGB", "VCS_RGB", "ASTROCADE_RGB", "ZXSPECTRUM_RGB", "AMSTRAD_CPC_RGB", "VIC20_PAL_RGB", "SNES_B5G5R5_RGB", "SNES_BBPGGGPRRRP", "INTELLIVISION_STIC_RGB", "SMS_RGB", "GAMEGEAR_COLOR_RGB", "TELETEXT_RGB", "AP2LORES_RGB", "IIGS_COLOR_RGB", "CHANNELF_RGB", "MONO_RGB", "CGA_RGB_1", "CGA_RGB_1H", "CGA_RGB_2", "CGA_RGB_2H", "CGA_RGB_3", "CGA_RGB_3H", "CGA_RGB", "WILLIAMS_RGB", "PICO8_RGB", "TIC80_RGB", "GAMEBOY_GREEN_RGB", "AMIGA_OCS_COLOR_RGB", "ATARIST_RGB", "MC6847_PALETTE0", "MC6847_PALETTE1", "SYSTEM_LOOKUP", "sys", "exportfuncs_exports", "__export", "bitOverlayUint8Array", "exportApple2HiresToHGR", "exportC64Hires", "exportC64Multi", "exportCombinedImageAndColorCellBuffer", "exportFrameBuffer", "exportMC6847", "exportNES", "exportNES5Color", "exportSNES", "exportSticColorStack", "exportSticFgbg", "exportTMS9918", "exportVCSPlayfield", "exportVicHires", "exportVicMulti", "exportZXSpectrum", "getSnesBitplanCellMapper", "getSnesTilemapMapper", "hex", "v", "nd", "toradix", "radix", "s", "e", "runtime_assert", "condition", "message", "convertToSystemPalette", "pal", "syspal", "rgba", "extractColorsFromParam", "param", "totalToExtract", "paletteBitFilter", "paletteBits", "value", "result", "extractColorsFromParamContent", "content", "extractColorsFromParams", "offset", "params", "runtime_assert", "extractColorsFromParamsContent", "remapBits", "x", "arr", "y", "i", "s", "convertImagesToWords", "images", "fmt", "width", "height", "count", "bpp", "nplanes", "bitsperword", "wordsperline", "mask", "pofs", "skip", "words", "n", "imgdata", "yp", "ofs0", "shift", "color", "ofs", "p", "c", "concatArrays", "arrays", "total", "a", "dest", "exportFrameBuffer", "img", "settings", "exportApple2HiresToHGR", "data", "srcofs", "destofs", "z", "hibit", "col", "bitOverlayUint8Array", "array", "offset", "bitPattern", "bitShift", "bitCount", "littleEndian", "bitFilter", "bitOverlay", "direction", "bitsRemaining", "complimentByte", "overlayByte", "runtime_assert", "getDefaultedCellExporterMapper", "values", "mapper", "fullPaletteMode", "setup", "prepare", "paramToBitPattern", "param", "paletteIndex", "info", "colors", "extractColorsFromParam", "pattern", "iterate", "params", "indexed", "getDefaultedCellExporterMapperOrFromDataMapper", "getDefaultedParamMapper", "isUsing", "getDefaultedParamMapperOrFromDataMapper", "exportCombinedImageAndColorCellBuffer", "options", "cellMapper", "colorParamMapper", "colorBlockParamMapper", "cellParamMapper", "extraParamMapper", "allMappers", "allMappersFiltered", "continueFinalize", "mergeArrays", "getVicCellMapper", "content", "bitsPerCellWidth", "bitsPerCell", "bytesPerCell", "cellBytesPerRow", "__spreadProps", "__spreadValues", "cellCol", "cellRow", "paramOffset", "cellColOffset", "cellRowOffset", "cellXOffset", "cellYOffset", "getVicColorMapper", "isUsingFli", "colorAlignedBytes", "colorBytes", "getVicColorBlockMapper", "exportC64Multi", "message", "extractColorsFromParamContent", "exportC64Hires", "exportVicHires", "exportVicMulti", "getZxCellMapper", "column", "xInBytes", "strangeOffset", "exportZXSpectrum", "getSticColorMapper", "columns", "rows", "c1", "c2", "gromCard", "grom", "result", "lowByte", "highByte", "stamp", "exportSticFgbg", "gram", "gramCard", "getSticCellMapper", "iteration", "cellImage", "colorBlock", "cellBlock", "extra", "cellParamOffset", "extracted", "extractColorsFromParams", "source", "exportSticColorStack", "cellColorsBitPattern", "cbColor", "extractColorsFromParamsContent", "advance", "gramMode", "usingExtendedColor", "cellInfo", "usingGram", "gramOrRom", "gramOrRomCard", "getTMS9918ColorMapper", "exportTMS9918", "snesDefautPlaneToMemoryLocationFunc", "plane", "planes", "pixelCellColumn", "pixelCellRow", "bitsInPlane", "bitPlaneByteOrderLE", "bitPlaneRowWidth", "bitPlaneOffset", "shiftedBitInPlane", "whichByteInPlane", "snesInterleavedPlaneToMemoryLocationFunc", "onOddRow", "snesLinearPlaneToMemoryLocationFunc", "snesPlaneToMemoryLocations", "snesTransformColor", "snesTransformNoop", "snesTransformBBGGGRRR", "palette", "rgb", "r", "g", "getSnesBitplanCellMapper", "pixelsInCell", "cellsInImage", "tilesetWidth", "tilesetHeight", "tilesetsWide", "tilesetsHigh", "totalTilesetBytes", "bytesInCell", "bytesInTilesetRow", "planeToMemoryLocationFunc", "transformColorFunc", "filterBits", "filterColorBit", "shifted", "extractedBits", "row", "inTilesetW", "tilesetMemoryOffset", "tilesetColumn", "tilesetRow", "pc", "pr", "cellOffset", "filteredColor", "bitInfo", "finalOffset", "getSnesTilemapMapper", "outputTileset", "outputPalette", "tilesetByteOrderLE", "ppp", "v", "h", "tile", "paletteOffset", "b", "b5g5r5", "exportSNES", "exportNES", "cols", "char", "charofs", "idx", "exportNES5Color", "attr", "exportVCSPlayfield", "pfmap", "exportMC6847", "dptr", "sptr", "fileviewers_exports", "__export", "getFileViewerCode_apple2_hires", "getFileViewerCode_astrocade", "getFileViewerCode_atari8_d", "getFileViewerCode_atari8_f_10", "getFileViewerCode_c64_fli", "getFileViewerCode_c64_hires", "getFileViewerCode_c64_hires_fli", "getFileViewerCode_c64_hires_fli_blank", "getFileViewerCode_c64_hires_fli_bug", "getFileViewerCode_c64_multi", "getFileViewerCode_c64_multi_fli", "getFileViewerCode_c64_multi_fli_blank", "getFileViewerCode_c64_multi_fli_blank_left", "getFileViewerCode_c64_multi_fli_bug", "getFileViewerCode_cpc", "getFileViewerCode_cpc_mode0", "getFileViewerCode_cpc_mode1", "getFileViewerCode_msx", "getFileViewerCode_nes", "getFileViewerCode_vcs", "getFileViewerCode_zx", "getFileViewerCode_zx_bright", "getFileViewerCode_zx_bright_dark", "getFileViewerCode_zx_dark", "getFileViewerCode_zx_dark_bright", "c64_multi_default", "apple2_hires_default", "nes_default", "msx_default", "vcs_default", "astrocade_default", "atari8_d_default", "zx_default", "cpc_default", "c64_fli_default", "getFileViewerCode_c64_multi", "code", "c64_multi_default", "getFileViewerCode_c64_hires", "getFileViewerCode_apple2_hires", "apple2_hires_default", "getFileViewerCode_nes", "nes_default", "palinds", "convertToSystemPalette", "dithertron", "hex", "getFileViewerCode_msx", "msx_default", "getFileViewerCode_vcs", "vcs_default", "getFileViewerCode_astrocade", "astrocade_default", "getFileViewerCode_atari8_d", "atari8_d_default", "i", "getFileViewerCode_atari8_f_10", "getFileViewerCode_zx", "zx_default", "getFileViewerCode_zx_dark", "getFileViewerCode_zx_bright", "getFileViewerCode_zx_dark_bright", "getFileViewerCode_zx_bright_dark", "getFileViewerCode_cpc", "mode", "cpc_default", "getFileViewerCode_cpc_mode0", "getFileViewerCode_cpc_mode1", "getFileViewerCode_c64_fli", "c64_fli_default", "getFileViewerCode_c64_hires_fli", "getFileViewerCode_c64_hires_fli_bug", "getFileViewerCode_c64_hires_fli_blank", "getFileViewerCode_c64_multi_fli", "getFileViewerCode_c64_multi_fli_bug", "getFileViewerCode_c64_multi_fli_blank", "getFileViewerCode_c64_multi_fli_blank_left", "FLOYD", "FALSEFLOYD", "ATKINSON", "SIERRA2", "SIERRALITE", "STUCKI", "TWOD", "RIGHT", "DOWN", "DOUBLE_DOWN", "DIAG", "VDIAMOND", "import_cropperjs", "import_pica", "import_file_saver", "EXAMPLE_IMAGES", "cropper", "brightSlider", "contrastSlider", "saturationSlider", "noiseSlider", "diffuseSlider", "orderedSlider", "diversitySlider", "imageUpload", "sourceImage", "resizeCanvas", "destCanvas", "ProxyDithertron", "ev", "data", "settings", "img", "dithertron", "filenameLoaded", "presetLoaded", "ALL_DITHER_SETTINGS", "FLOYD", "FALSEFLOYD", "ATKINSON", "SIERRA2", "SIERRALITE", "STUCKI", "TWOD", "RIGHT", "DOWN", "DOUBLE_DOWN", "DIAG", "VDIAMOND", "ERROR_FUNCS", "getCanvasImageData", "canvas", "drawRGBA", "dest", "arr", "ctx", "imageData", "datau32", "applyBrightness", "bright", "bias", "sat", "gamma", "u8arr", "i", "r", "g", "b", "gray", "reprocessImage", "resizeImageData", "resetImage", "opt", "convertImage", "cropCanvas", "pica", "getSystemInfo", "sys", "s", "showSystemInfo", "updatePaletteSwatches", "pal", "swat", "col", "index", "rgb", "sq", "isExactMatch", "processImageDirectly", "loadSourceImage", "url", "aspect", "Cropper", "event", "updateURL", "setTargetSystem", "showNoise", "pixelAspect", "getCodeConvertFunction", "repopulateSystemSelector", "getFilenamePrefix", "fn", "e", "getNativeFormatData", "funcname", "exportfuncs_exports", "downloadNativeFormat", "blob", "downloadImageFormat", "byteArrayToString", "str", "charLUT", "len", "convertFuncName", "convertFunc", "fileviewers_exports", "gotoIDE", "addHiddenField", "form", "name", "val", "platform_id", "codeFilename", "dataFilename", "code", "qs", "decodeQueryString", "p", "currentSystem", "sel", "currentParentName", "currentSubtypeName", "allParents", "optgroup", "SYSTEMS", "parentName", "subtypeName", "startUI", "inputElement", "file", "EXAMPLE_IMAGES", "filename", "dset", "msg", "currentSystemId", "SYSTEM_LOOKUP", "printSystems"]
}
